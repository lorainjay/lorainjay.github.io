<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Yjçš„Betterä¹‹è·¯</title>
  
  
  <link href="https://axdmdyj.github.io/atom.xml" rel="self"/>
  
  <link href="https://axdmdyj.github.io/"/>
  <updated>2024-02-14T14:38:44.647Z</updated>
  <id>https://axdmdyj.github.io/</id>
  
  <author>
    <name>coderLyj</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æ³›å‹åœ¨é¡¹ç›®ä¸­ä¸æ€ä¹ˆç”¨ï¼Ÿè¿™æ¬¡ç»“åˆå®æˆ˜ï¼</title>
    <link href="https://axdmdyj.github.io/posts/20748c35.html"/>
    <id>https://axdmdyj.github.io/posts/20748c35.html</id>
    <published>2024-02-14T14:33:44.000Z</published>
    <updated>2024-02-14T14:38:44.647Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ³›å‹åœ¨é¡¹ç›®ä¸­ç”¨çš„ç¡®å®ç›¸å¯¹æ²¡æœ‰é‚£ä¹ˆå¤šï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æä¾›ä¸€äº›ä¾¿æ·ï¼Œæœ¬æ–‡å…ˆä»åŸºç¡€ä»‹ç»ï¼Œç„¶ååœ¨æ–‡ç« æœ€åè®²è§£é¡¹ç›®å®æˆ˜ä¸­çš„ä¸€äº›ä½¿ç”¨ï¼Œè¶…çº§è¯¦ç»†ï¼ğŸŒŸ</p></blockquote><p>[TOC]</p><h1 id="æ³›å‹åŸºç¡€"><a href="#æ³›å‹åŸºç¡€" class="headerlink" title="æ³›å‹åŸºç¡€"></a>æ³›å‹åŸºç¡€</h1><h2 id="ä¸ºä»€ä¹ˆå¼•å…¥æ³›å‹"><a href="#ä¸ºä»€ä¹ˆå¼•å…¥æ³›å‹" class="headerlink" title="ä¸ºä»€ä¹ˆå¼•å…¥æ³›å‹"></a>ä¸ºä»€ä¹ˆå¼•å…¥æ³›å‹</h2><ul><li><strong>é€‚ç”¨äºå¤šç§æ•°æ®ç±»å‹æ‰§è¡Œç›¸åŒçš„ä»£ç </strong>ï¼ˆä»£ç å¤ç”¨ï¼‰</li><li>æ³›å‹ä¸­çš„ç±»å‹åœ¨ä½¿ç”¨æ—¶æŒ‡å®šï¼Œä¸éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ˆ<strong>ç±»å‹å®‰å…¨</strong>ï¼Œç¼–è¯‘å™¨ä¼š<strong>æ£€æŸ¥ç±»å‹</strong>ï¼‰</li><li>Javaæ³›å‹ä¹Ÿæ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œåœ¨<strong>ç¼–è¯‘é˜¶æ®µå®Œæˆç±»å‹çš„è½¬æ¢çš„å·¥ä½œ</strong>ï¼Œé¿å…åœ¨è¿è¡Œæ—¶å¼ºåˆ¶ç±»å‹è½¬æ¢è€Œå‡ºç°ClassCastException,ç±»å‹è½¬åŒ–å¼‚å¸¸ã€‚</li></ul><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><ul><li>ä¸å¼•å…¥æ³›å‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">target_01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        list.add(<span class="number">11</span>);</span><br><span class="line">        list.add(<span class="string">&quot;è½é›¨æ—¢ç„¶&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">            System.out.println((String)list.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¼šæŠ¥ç±»å‹è½¬æ¢å¼‚å¸¸ï¼š<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/46b5cd26895e468a86a1d210994cc6b1~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1432&h=262&s=35825&e=png&b=202124" alt="image.png"></p><ul><li>ä½¿ç”¨æ³›å‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">target_01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        list.add(<span class="string">&quot;è½é›¨æ—¢ç„¶&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">            System.out.println((String)list.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b342e5999f74c66a171e95f213e2c51~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=918&h=236&s=12681&e=png&b=1e1f22" alt="image.png"><br>åœ¨ä¸Šè¿°çš„å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬åªèƒ½æ·»åŠ Stringç±»å‹çš„æ•°æ®ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p><h2 id="æ³›å‹çš„åŸºæœ¬ä½¿ç”¨"><a href="#æ³›å‹çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="æ³›å‹çš„åŸºæœ¬ä½¿ç”¨"></a>æ³›å‹çš„åŸºæœ¬ä½¿ç”¨</h2><h3 id="æ³›å‹ç±»"><a href="#æ³›å‹ç±»" class="headerlink" title="æ³›å‹ç±»"></a>æ³›å‹ç±»</h3><ul><li>æ³›å‹ç±»æ¦‚è¿°ï¼šæŠŠæ³›å‹å®šä¹‰åœ¨ç±»ä¸Š</li><li>å®šä¹‰æ ¼å¼ï¼š</li></ul><blockquote><p>æ³¨æ„äº‹é¡¹ï¼šæ³›å‹ç±»å‹å¿…é¡»æ˜¯å¼•ç”¨ç±»å‹ï¼ˆéåŸºæœ¬æ•°æ®ç±»å‹ï¼‰</p></blockquote><h3 id="æ³›å‹æ¥å£"><a href="#æ³›å‹æ¥å£" class="headerlink" title="æ³›å‹æ¥å£"></a>æ³›å‹æ¥å£</h3><ul><li>æ³›å‹æ–¹æ³•æ¦‚è¿°ï¼šæŠŠæ³›å‹å®šä¹‰åœ¨æ–¹æ³•ä¸Š</li><li>å®šä¹‰æ ¼å¼ï¼š</li></ul><blockquote><p>æ³¨æ„è¦ç‚¹ï¼š<strong>æ–¹æ³•å£°æ˜</strong>ä¸­å®šä¹‰çš„<strong>å½¢å‚åªèƒ½åœ¨è¯¥æ–¹æ³•é‡Œä½¿ç”¨</strong>ï¼Œè€Œ<strong>æ¥å£ã€ç±»å£°æ˜ä¸­å®šä¹‰çš„ç±»å‹å½¢å‚</strong>åˆ™å¯ä»¥åœ¨æ•´ä¸ªæ¥å£ã€ç±»ä¸­ä½¿ç”¨ã€‚å½“è°ƒç”¨fun()æ–¹æ³•æ—¶ï¼Œæ ¹æ®ä¼ å…¥çš„å®é™…å¯¹è±¡ï¼Œç¼–è¯‘å™¨å°±ä¼šåˆ¤æ–­å‡ºç±»å‹å½¢å‚Tæ‰€ä»£è¡¨çš„å®é™…ç±»å‹ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">  <span class="comment">// æ³›å‹æ–¹æ³•ï¼Œå¯ä»¥æ¥æ”¶ä»»æ„ç±»å‹çš„æ•°æ®</span></span><br><span class="line">  <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">fun</span><span class="params">(T t)</span> &#123;</span><br><span class="line">    <span class="comment">// ç›´æ¥å°†å‚æ•°è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenericsDemo26</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line">    <span class="comment">// å®ä¾‹åŒ–Demoå¯¹è±¡</span></span><br><span class="line">    <span class="type">Demo</span> <span class="variable">d</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo</span>();</span><br><span class="line">    <span class="comment">// ä¼ é€’å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> d.fun(<span class="string">&quot;è½é›¨æ—¢ç„¶&quot;</span>);</span><br><span class="line">    <span class="comment">// ä¼ é€’æ•°å­—ï¼Œè‡ªåŠ¨è£…ç®±</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> d.fun(<span class="number">30</span>);</span><br><span class="line">    <span class="comment">// è¾“å‡ºå­—ç¬¦ä¸²å†…å®¹</span></span><br><span class="line">    System.out.println(str);</span><br><span class="line">    <span class="comment">// è¾“å‡ºæ•°å­—å†…å®¹</span></span><br><span class="line">    System.out.println(i);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//  è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">//  è½é›¨æ—¢ç„¶</span></span><br><span class="line"><span class="comment">//  30</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ³›å‹æ–¹æ³•"><a href="#æ³›å‹æ–¹æ³•" class="headerlink" title="æ³›å‹æ–¹æ³•"></a>æ³›å‹æ–¹æ³•</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/075218b91c3a42418fe096972490a7fd~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1199&h=543&s=25686&e=png&b=fefefe" alt="image.png"><br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/de3e70bb1a0c4e27b035264405a907f7~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=950&h=248&s=22406&e=png&b=ffffff" alt="image.png"><br>è¯´æ˜ä¸€ä¸‹ï¼Œå®šä¹‰æ³›å‹æ–¹æ³•æ—¶ï¼Œå¿…é¡»åœ¨è¿”å›å€¼å‰è¾¹åŠ ä¸€ä¸ª<T>ï¼Œæ¥å£°æ˜è¿™æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼ŒæŒæœ‰ä¸€ä¸ªæ³›å‹Tï¼Œç„¶åæ‰å¯ä»¥ç”¨æ³›å‹Tä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼ã€‚<br>Class<T>çš„ä½œç”¨å°±æ˜¯æŒ‡æ˜æ³›å‹çš„å…·ä½“ç±»å‹ï¼Œè€ŒClass<T>ç±»å‹çš„å˜é‡cï¼Œå¯ä»¥ç”¨æ¥åˆ›å»ºæ³›å‹ç±»çš„å¯¹è±¡ã€‚<br>ä¸ºä»€ä¹ˆè¦ç”¨å˜é‡cæ¥åˆ›å»ºå¯¹è±¡å‘¢ï¼Ÿæ—¢ç„¶æ˜¯æ³›å‹æ–¹æ³•ï¼Œå°±ä»£è¡¨ç€æˆ‘ä»¬ä¸çŸ¥é“å…·ä½“çš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œä¹Ÿä¸çŸ¥é“æ„é€ æ–¹æ³•å¦‚ä½•ï¼Œå› æ­¤æ²¡æœ‰åŠæ³•å»newä¸€ä¸ªå¯¹è±¡ï¼Œä½†å¯ä»¥åˆ©ç”¨å˜é‡cçš„newInstanceæ–¹æ³•å»åˆ›å»ºå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨åå°„åˆ›å»ºå¯¹è±¡ã€‚<br>æ³›å‹æ–¹æ³•è¦æ±‚çš„å‚æ•°æ˜¯Class<T>ç±»å‹ï¼Œè€ŒClass.forName()æ–¹æ³•çš„è¿”å›å€¼ä¹Ÿæ˜¯Class<T>ï¼Œå› æ­¤å¯ä»¥ç”¨Class.forName()ä½œä¸ºå‚æ•°ã€‚å…¶ä¸­ï¼ŒforName()æ–¹æ³•ä¸­çš„å‚æ•°æ˜¯ä½•ç§ç±»å‹ï¼Œè¿”å›çš„Class<T>å°±æ˜¯ä½•ç§ç±»å‹ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒforName()æ–¹æ³•ä¸­ä¼ å…¥çš„æ˜¯Userç±»çš„å®Œæ•´è·¯å¾„ï¼Œå› æ­¤è¿”å›çš„æ˜¯Class<User>ç±»å‹çš„å¯¹è±¡ï¼Œå› æ­¤è°ƒç”¨æ³›å‹æ–¹æ³•æ—¶ï¼Œå˜é‡cçš„ç±»å‹å°±æ˜¯Class<User>ï¼Œå› æ­¤æ³›å‹æ–¹æ³•ä¸­çš„æ³›å‹Tå°±è¢«æŒ‡æ˜ä¸ºUserï¼Œå› æ­¤å˜é‡objçš„ç±»å‹ä¸ºUserã€‚<br>å½“ç„¶ï¼Œæ³›å‹æ–¹æ³•ä¸æ˜¯ä»…ä»…å¯ä»¥æœ‰ä¸€ä¸ªå‚æ•°Class<T>ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ å…¶ä»–å‚æ•°ã€‚<br><strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ³›å‹æ–¹æ³•å‘¢</strong>ï¼Ÿ<br>å› ä¸ºæ³›å‹ç±»è¦åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°±æŒ‡æ˜ç±»å‹ï¼Œå¦‚æœæƒ³æ¢ä¸€ç§ç±»å‹ï¼Œä¸å¾—ä¸é‡æ–°newä¸€æ¬¡ï¼Œå¯èƒ½ä¸å¤Ÿçµæ´»ï¼›è€Œæ³›å‹æ–¹æ³•å¯ä»¥åœ¨è°ƒç”¨çš„æ—¶å€™æŒ‡æ˜ç±»å‹ï¼Œæ›´åŠ çµæ´»ã€‚</p><h3 id="æ³›å‹ä¸Šä¸‹é™"><a href="#æ³›å‹ä¸Šä¸‹é™" class="headerlink" title="æ³›å‹ä¸Šä¸‹é™"></a>æ³›å‹ä¸Šä¸‹é™</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">funC</span><span class="params">(List&lt;? extends A&gt; listA)</span> &#123;</span><br><span class="line">    <span class="comment">// ...          </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">funD</span><span class="params">(List&lt;B&gt; listB)</span> &#123;</span><br><span class="line">    funC(listB); <span class="comment">// OK</span></span><br><span class="line">    <span class="comment">// ...             </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è§£å†³æ³›å‹ä¸­éšå«çš„è½¬æ¢é—®é¢˜ï¼ŒJavaæ³›å‹åŠ å…¥äº†ç±»å‹å‚æ•°çš„ä¸Šä¸‹è¾¹ç•Œæœºåˆ¶ã€‚&lt;? extends A&gt;è¡¨ç¤ºè¯¥ç±»å‹å‚æ•°å¯ä»¥æ˜¯A(ä¸Šè¾¹ç•Œ)æˆ–è€…Açš„å­ç±»ç±»å‹ã€‚ç¼–è¯‘æ—¶æ“¦é™¤åˆ°ç±»å‹Aï¼Œå³ç”¨Aç±»å‹ä»£æ›¿ç±»å‹å‚æ•°ã€‚è¿™ç§æ–¹æ³•å¯ä»¥è§£å†³å¼€å§‹é‡åˆ°çš„é—®é¢˜ï¼Œç¼–è¯‘å™¨çŸ¥é“ç±»å‹å‚æ•°çš„èŒƒå›´ï¼Œå¦‚æœä¼ å…¥çš„å®ä¾‹ç±»å‹Bæ˜¯åœ¨è¿™ä¸ªèŒƒå›´å†…çš„è¯å…è®¸è½¬æ¢ï¼Œè¿™æ—¶åªè¦ä¸€æ¬¡ç±»å‹è½¬æ¢å°±å¯ä»¥äº†ï¼Œè¿è¡Œæ—¶ä¼šæŠŠå¯¹è±¡å½“åšAçš„å®ä¾‹çœ‹å¾…ã€‚<br>å¦‚æœä¸ç”¨æ³›å‹å°±ä¼šæŠ¥é”™ï¼š&#x2F;&#x2F; Unresolved compilation problem: The method doPrint(List<A>) in the type test is not applicable for the arguments (List<B>)<br>ä¸Šç•Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Info</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Number</span>&gt;&#123;    <span class="comment">// æ­¤å¤„æ³›å‹åªèƒ½æ˜¯æ•°å­—ç±»å‹</span></span><br></pre></td></tr></table></figure><p>ä¸‹ç•Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">fun</span><span class="params">(Info&lt;? <span class="built_in">super</span> String&gt; temp)</span>&#123;    <span class="comment">// åªèƒ½æ¥æ”¶Stringæˆ–Objectç±»å‹çš„æ³›å‹ï¼ŒStringç±»çš„çˆ¶ç±»åªæœ‰Objectç±»</span></span><br></pre></td></tr></table></figure><p>å°ç»“ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?&gt; æ— é™åˆ¶é€šé…ç¬¦</span><br><span class="line">&lt;? <span class="keyword">extends</span> <span class="title class_">E</span>&gt; extends å…³é”®å­—å£°æ˜äº†ç±»å‹çš„ä¸Šç•Œï¼Œè¡¨ç¤ºå‚æ•°åŒ–çš„ç±»å‹å¯èƒ½æ˜¯æ‰€æŒ‡å®šçš„ç±»å‹ï¼Œæˆ–è€…æ˜¯æ­¤ç±»å‹çš„å­ç±»</span><br><span class="line">&lt;? <span class="built_in">super</span> E&gt; <span class="built_in">super</span> å…³é”®å­—å£°æ˜äº†ç±»å‹çš„ä¸‹ç•Œï¼Œè¡¨ç¤ºå‚æ•°åŒ–çš„ç±»å‹å¯èƒ½æ˜¯æŒ‡å®šçš„ç±»å‹ï¼Œæˆ–è€…æ˜¯æ­¤ç±»å‹çš„çˆ¶ç±»</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨åŸåˆ™ã€ŠEffictive Javaã€‹</span></span><br><span class="line"><span class="comment">// ä¸ºäº†è·å¾—æœ€å¤§é™åº¦çš„çµæ´»æ€§ï¼Œè¦åœ¨è¡¨ç¤º ç”Ÿäº§è€…æˆ–è€…æ¶ˆè´¹è€… çš„è¾“å…¥å‚æ•°ä¸Šä½¿ç”¨é€šé…ç¬¦ï¼Œä½¿ç”¨çš„è§„åˆ™å°±æ˜¯ï¼šç”Ÿäº§è€…æœ‰ä¸Šé™ã€æ¶ˆè´¹è€…æœ‰ä¸‹é™</span></span><br><span class="line"><span class="number">1.</span> å¦‚æœå‚æ•°åŒ–ç±»å‹è¡¨ç¤ºä¸€ä¸ª T çš„ç”Ÿäº§è€…ï¼Œä½¿ç”¨ &lt; ? <span class="keyword">extends</span> <span class="title class_">T</span>&gt;;</span><br><span class="line"><span class="number">2.</span> å¦‚æœå®ƒè¡¨ç¤ºä¸€ä¸ª T çš„æ¶ˆè´¹è€…ï¼Œå°±ä½¿ç”¨ &lt; ? <span class="built_in">super</span> T&gt;ï¼›</span><br><span class="line"><span class="number">3.</span> å¦‚æœæ—¢æ˜¯ç”Ÿäº§åˆæ˜¯æ¶ˆè´¹ï¼Œé‚£ä½¿ç”¨é€šé…ç¬¦å°±æ²¡ä»€ä¹ˆæ„ä¹‰äº†ï¼Œå› ä¸ºä½ éœ€è¦çš„æ˜¯ç²¾ç¡®çš„å‚æ•°ç±»å‹ã€‚</span><br></pre></td></tr></table></figure><h3 id="æ³›å‹æ•°ç»„"><a href="#æ³›å‹æ•°ç»„" class="headerlink" title="æ³›å‹æ•°ç»„"></a>æ³›å‹æ•°ç»„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt;[] list11 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;[<span class="number">10</span>]; <span class="comment">//ç¼–è¯‘é”™è¯¯ï¼Œéæ³•åˆ›å»º </span></span><br><span class="line">List&lt;String&gt;[] list12 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;?&gt;[<span class="number">10</span>]; <span class="comment">//ç¼–è¯‘é”™è¯¯ï¼Œéœ€è¦å¼ºè½¬ç±»å‹ </span></span><br><span class="line">List&lt;String&gt;[] list13 = (List&lt;String&gt;[]) <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;?&gt;[<span class="number">10</span>]; <span class="comment">//OKï¼Œä½†æ˜¯ä¼šæœ‰è­¦å‘Š </span></span><br><span class="line">List&lt;?&gt;[] list14 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;[<span class="number">10</span>]; <span class="comment">//ç¼–è¯‘é”™è¯¯ï¼Œéæ³•åˆ›å»º </span></span><br><span class="line">List&lt;?&gt;[] list15 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;?&gt;[<span class="number">10</span>]; <span class="comment">//OK </span></span><br><span class="line">List&lt;String&gt;[] list6 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>[<span class="number">10</span>]; <span class="comment">//OKï¼Œä½†æ˜¯ä¼šæœ‰è­¦å‘Š</span></span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨åœºæ™¯</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenericsDemo30</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span>&#123;  </span><br><span class="line">        Integer i[] = fun1(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>) ;   <span class="comment">// è¿”å›æ³›å‹æ•°ç»„  </span></span><br><span class="line">        fun2(i) ;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T[] fun1(T...arg)&#123;  <span class="comment">// æ¥æ”¶å¯å˜å‚æ•°  </span></span><br><span class="line">        <span class="keyword">return</span> arg ;            <span class="comment">// è¿”å›æ³›å‹æ•°ç»„  </span></span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">fun2</span><span class="params">(T param[])</span>&#123;   <span class="comment">// è¾“å‡º  </span></span><br><span class="line">        System.out.print(<span class="string">&quot;æ¥æ”¶æ³›å‹æ•°ç»„ï¼š&quot;</span>) ;  </span><br><span class="line">        <span class="keyword">for</span>(T t:param)&#123;  </span><br><span class="line">            System.out.print(t + <span class="string">&quot;ã€&quot;</span>) ;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/da0e9136ae784482a65592dd47561d02~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1756&h=1130&s=248753&e=png&b=222427" alt="image.png"></p><h1 id="æ·±å…¥ç†è§£æ³›å‹"><a href="#æ·±å…¥ç†è§£æ³›å‹" class="headerlink" title="æ·±å…¥ç†è§£æ³›å‹"></a>æ·±å…¥ç†è§£æ³›å‹</h1><h2 id="ç±»å‹æ“¦é™¤"><a href="#ç±»å‹æ“¦é™¤" class="headerlink" title="ç±»å‹æ“¦é™¤"></a>ç±»å‹æ“¦é™¤</h2><p><strong>æ³›å‹çš„ç±»å‹æ“¦é™¤åŸåˆ™</strong>æ˜¯ï¼š</p><ul><li>æ¶ˆé™¤ç±»å‹å‚æ•°å£°æ˜ï¼Œå³åˆ é™¤&lt;&gt;åŠå…¶åŒ…å›´çš„éƒ¨åˆ†ã€‚</li><li>æ ¹æ®ç±»å‹å‚æ•°çš„ä¸Šä¸‹ç•Œæ¨æ–­å¹¶æ›¿æ¢æ‰€æœ‰çš„ç±»å‹å‚æ•°ä¸ºåŸç”Ÿæ€ç±»å‹ï¼šå¦‚æœç±»å‹å‚æ•°æ˜¯æ— é™åˆ¶é€šé…ç¬¦æˆ–æ²¡æœ‰ä¸Šä¸‹ç•Œé™å®šåˆ™æ›¿æ¢ä¸ºObjectï¼Œå¦‚æœå­˜åœ¨ä¸Šä¸‹ç•Œé™å®šåˆ™æ ¹æ®å­ç±»æ›¿æ¢åŸåˆ™å–ç±»å‹å‚æ•°çš„æœ€å·¦è¾¹é™å®šç±»å‹ï¼ˆå³çˆ¶ç±»ï¼‰ã€‚</li><li>ä¸ºäº†ä¿è¯ç±»å‹å®‰å…¨ï¼Œå¿…è¦æ—¶æ’å…¥å¼ºåˆ¶ç±»å‹è½¬æ¢ä»£ç ã€‚</li><li>è‡ªåŠ¨äº§ç”Ÿâ€œæ¡¥æ¥æ–¹æ³•â€ä»¥ä¿è¯æ“¦é™¤ç±»å‹åçš„ä»£ç ä»ç„¶å…·æœ‰æ³›å‹çš„â€œå¤šæ€æ€§â€ã€‚</li></ul><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c2dc031266c04baf8fca9ac12a25ad22~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=776&h=223&s=30986&e=png&a=1&b=000000" alt="image.png"><br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d4ac4d20ae2a479fb71d9ff2f7a7101e~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=822&h=236&s=31204&e=png&a=1&b=000000" alt="image.png"><br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a56013c830d44a2fa84bac6bc42eb717~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=982&h=144&s=20440&e=png&a=1&b=fb9f00" alt="image.png"></p><h2 id="ç±»å‹æ“¦é™¤ä¿ç•™çš„åŸå§‹ç±»å‹"><a href="#ç±»å‹æ“¦é™¤ä¿ç•™çš„åŸå§‹ç±»å‹" class="headerlink" title="ç±»å‹æ“¦é™¤ä¿ç•™çš„åŸå§‹ç±»å‹"></a>ç±»å‹æ“¦é™¤ä¿ç•™çš„åŸå§‹ç±»å‹</h2><p>åŸå§‹ç±»å‹ å°±æ˜¯æ“¦é™¤å»äº†æ³›å‹ä¿¡æ¯ï¼Œæœ€ååœ¨å­—èŠ‚ç ä¸­çš„ç±»å‹å˜é‡çš„çœŸæ­£ç±»å‹ï¼Œæ— è®ºä½•æ—¶å®šä¹‰ä¸€ä¸ªæ³›å‹ï¼Œç›¸åº”çš„åŸå§‹ç±»å‹éƒ½ä¼šè¢«è‡ªåŠ¨æä¾›ï¼Œç±»å‹å˜é‡æ“¦é™¤ï¼Œå¹¶ä½¿ç”¨å…¶é™å®šç±»å‹ï¼ˆæ— é™å®šçš„å˜é‡ç”¨Objectï¼‰æ›¿æ¢ã€‚</p><h2 id="æ³›å‹åœ¨ç¼–è¯‘å™¨çš„æ£€æŸ¥"><a href="#æ³›å‹åœ¨ç¼–è¯‘å™¨çš„æ£€æŸ¥" class="headerlink" title="æ³›å‹åœ¨ç¼–è¯‘å™¨çš„æ£€æŸ¥"></a>æ³›å‹åœ¨ç¼–è¯‘å™¨çš„æ£€æŸ¥</h2><p>javaç¼–è¯‘å™¨æ˜¯é€šè¿‡å…ˆæ£€æŸ¥ä»£ç ä¸­æ³›å‹çš„ç±»å‹ï¼Œç„¶ååœ¨è¿›è¡Œç±»å‹æ“¦é™¤ï¼Œå†è¿›è¡Œç¼–è¯‘ã€‚<br>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;  </span><br><span class="line"></span><br><span class="line">    ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();  </span><br><span class="line">    list.add(<span class="string">&quot;123&quot;</span>);  </span><br><span class="line">    list.add(<span class="number">123</span>);<span class="comment">//ç¼–è¯‘é”™è¯¯  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ç¨‹åºä¸­ï¼Œä½¿ç”¨addæ–¹æ³•æ·»åŠ ä¸€ä¸ªæ•´å‹ï¼Œåœ¨IDEä¸­ï¼Œç›´æ¥ä¼šæŠ¥é”™ï¼Œè¯´æ˜è¿™å°±æ˜¯åœ¨ç¼–è¯‘ä¹‹å‰çš„æ£€æŸ¥ï¼Œå› ä¸ºå¦‚æœæ˜¯åœ¨ç¼–è¯‘ä¹‹åæ£€æŸ¥ï¼Œç±»å‹æ“¦é™¤åï¼ŒåŸå§‹ç±»å‹ä¸ºObjectï¼Œæ˜¯åº”è¯¥å…è®¸ä»»æ„å¼•ç”¨ç±»å‹æ·»åŠ çš„ã€‚å¯å®é™…ä¸Šå´ä¸æ˜¯è¿™æ ·çš„ï¼Œè¿™æ°æ°è¯´æ˜äº†å…³äºæ³›å‹å˜é‡çš„ä½¿ç”¨ï¼Œæ˜¯ä¼šåœ¨ç¼–è¯‘ä¹‹å‰æ£€æŸ¥çš„ã€‚</p><h1 id="é¡¹ç›®ä¸­çš„æ³›å‹å®æˆ˜"><a href="#é¡¹ç›®ä¸­çš„æ³›å‹å®æˆ˜" class="headerlink" title="é¡¹ç›®ä¸­çš„æ³›å‹å®æˆ˜"></a>é¡¹ç›®ä¸­çš„æ³›å‹å®æˆ˜</h1><p>æ³›å‹å¾ˆå¤šéƒ½æ˜¯ç†è®ºï¼Œåœ¨é¡¹ç›®ä¸­æ€ä¹ˆç”¨å‘¢ï¼Ÿ<br>æ¯”å¦‚å¯¹äºå¸¸è§çš„ç¼“å­˜ç©¿é€ï¼Œç¼“å­˜å‡»ç©¿ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ³›å‹å°†å…¶å°è£…åˆ°ä¸€ä¸ªç±»é‡Œé¢ã€‚<br>æ¯”å¦‚ä¸‹é¢ä»£ç ï¼Œæ˜¯é»‘é©¬ç‚¹è¯„é¡¹ç›®ä¸­çš„ä¸€ä¸ªç‚¹ï¼š<strong>é€šè¿‡æ³›å‹ + å‡½æ•°å¼ç¼–ç¨‹å°è£…æˆé€šç”¨è§£å†³æ–¹æ¡ˆã€‚</strong><br><strong>éš¾ç‚¹ï¼š</strong></p><ul><li><strong>æ³›å‹æ–¹æ³•</strong>çš„ä½¿ç”¨ï¼šè¿”å›å€¼ç±»å‹ä¸ç¡®å®šã€idç±»å‹ä¸ç¡®å®šã€‚æ‰€ä»¥å°±å£°æ˜æ³›å‹ï¼Œ<strong>è®©è°ƒç”¨è€…å‘Šè¯‰æˆ‘ä»¬æ³›å‹</strong>æ˜¯ä»€ä¹ˆï¼›</li><li><strong>ä½¿ç”¨å‡½æ•°å¼æ¥å£</strong>ï¼šç‰µæ‰¯åˆ°æ•°æ®åº“æŸ¥è¯¢ï¼Œéœ€è¦å‚æ•°å’Œè¿”å›å€¼ï¼Œä½¿ç”¨å‡½æ•°å¼æ¥å£Function&lt;ID,R&gt;<ul><li>å››å¤§å‡½æ•°å¼æ¥å£ Function&lt;T,R&gt;   Predicate<T>    Consumer<T>    Supplier<T></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¼“å­˜å·¥å…·å°è£…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="comment">//ç¼“å­˜å‡»ç©¿ä½¿ç”¨çš„çº¿ç¨‹æ± </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">CACHE_REBUILD_EXECUTOR</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†ä»»æ„javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå­—ç¬¦ä¸²å¹¶å­˜å‚¨åœ¨stringç±»å‹çš„keyä¸­ï¼Œå¹¶è®¾ç½®TTL</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   stringç±»å‹çš„key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value ä»»æ„javaå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit  å•ä½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String key, Object value, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(value), time, unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†ä»»æ„javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå­—ç¬¦ä¸²å¹¶å­˜å‚¨åœ¨stringç±»å‹çš„keyä¸­ï¼Œå¹¶è®¾ç½®é€»è¾‘è¿‡æœŸæ—¶é—´ï¼Œç”¨äºå¤„ç†ç¼“å­˜å‡»ç©¿</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   stringç±»å‹çš„key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value ä»»æ„javaå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  é€»è¾‘æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit  å•ä½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWithLogicalExpire</span><span class="params">(String key, Object value, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="comment">// RedisDataå¯¹è±¡ï¼Œè®¾ç½®é€»è¾‘è¿‡æœŸ</span></span><br><span class="line">        <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisData</span>();</span><br><span class="line">        redisData.setData(value);</span><br><span class="line">        redisData.setExpireTime(LocalDateTime.now().plusSeconds(unit.toSeconds(time)));</span><br><span class="line">        <span class="comment">// å†™å…¥Redis</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(redisData));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£å†³ç¼“å­˜ç©¿é€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> keyPrefix  keyå‰ç¼€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id         idä¸çŸ¥é“ä»€ä¹ˆç±»å‹ï¼Œæ‰€ä»¥éœ€è¦å£°åæ³›å‹IDï¼Œåå­—éšæ„èµ·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type       æ˜¯ä»€ä¹ˆç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dbFallback å¦‚æœredisæŸ¥è¯¢çš„ä¸æ˜¯&quot;&quot;ï¼Œé‚£å°±éœ€è¦æŸ¥è¯¢æ•°æ®åº“ï¼Œå‡½æ•°å¼æ¥å£æŒ‡å®šé€»è¾‘</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time       é‡å»ºç¼“å­˜åçš„æœ‰æ•ˆæ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit       æ—¶é—´å•ä½</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;R&gt;        è¿”å›å€¼ç±»å‹ï¼Œä¾‹å¦‚Shopç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;ID&gt;       idä¸çŸ¥é“ä»€ä¹ˆç±»å‹ï¼Œæ‰€ä»¥éœ€è¦å£°åæ³›å‹IDï¼Œåå­—éšæ„èµ·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;R, ID&gt; R <span class="title function_">queryWithPassThrough</span><span class="params">(</span></span><br><span class="line"><span class="params">            String keyPrefix, ID id, Class&lt;R&gt; type, Function&lt;ID, R&gt; dbFallback, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> keyPrefix + id;</span><br><span class="line">        <span class="comment">// 1.ä»redisæŸ¥è¯¢ç¼“å­˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="comment">// 2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨ ã€‚isNotBlankåªæœ‰åœ¨ å­—ç¬¦ä¸² æ‰è¿”å›trueã€‚ æ¢è¡Œ ï¼Œnull, &quot;&quot;ç­‰éƒ½æ˜¯false</span></span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isNotBlank(json)) &#123;</span><br><span class="line">        <span class="comment">// 3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="keyword">return</span> JSONUtil.toBean(json, type);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//      3.2  å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æœ‰  nullï¼Œ&quot;&quot;,æ¢è¡Œ  ç­‰å¯èƒ½æ€§ã€‚å¦‚æœæ˜¯&quot;&quot;ï¼Œ åˆ™æ˜¯ä¸ºäº†è§£å†³ç¼“å­˜ç©¿é€è€Œçº¦å®šçš„è§„åˆ™</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;&quot;</span>.equals(json)) &#123;</span><br><span class="line">            <span class="comment">// è§£å†³ç¼“å­˜ç©¿é€ï¼Œä¸ä¼šå†å»æŸ¥æ•°æ®åº“</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.å¦‚æœä¸å­˜åœ¨ï¼Œä¸”ä¸æ˜¯&quot;&quot; ï¼›é‚£ä¹ˆåŸå› å¯èƒ½æ˜¯ç¼“å­˜ä¸­ä¸ºnullï¼Œéœ€è¦æ ¹æ®idå»æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> dbFallback.apply(id);</span><br><span class="line">        <span class="comment">// 5.ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line">        <span class="keyword">if</span> (r == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å°†ç©ºå€¼å†™å…¥redis</span></span><br><span class="line">            stringRedisTemplate.opsForValue().set(key, <span class="string">&quot;&quot;</span>, CACHE_NULL_TTL, TimeUnit.MINUTES);</span><br><span class="line">            <span class="comment">// è¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6.å­˜åœ¨ï¼Œå†™å…¥redisï¼Œè°ƒç”¨å·²ç»å†™å¥½çš„æ–¹æ³•,è¶…æ—¶å‰”é™¤</span></span><br><span class="line">        <span class="built_in">this</span>.set(key, r, time, unit);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€»è¾‘è¿‡æœŸ è§£å†³ç¼“å­˜å‡»ç©¿</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;R, ID&gt; R <span class="title function_">queryWithLogicalExpire</span><span class="params">(</span></span><br><span class="line"><span class="params">            String keyPrefix, ID id, Class&lt;R&gt; type,String lockKeyPrefix, Function&lt;ID, R&gt; dbFallback, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> keyPrefix + id;</span><br><span class="line">        <span class="comment">// 1.ä»redisæŸ¥è¯¢ç¼“å­˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="comment">// 2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(json)) &#123;</span><br><span class="line">            <span class="comment">//  3.1 ä¸å­˜åœ¨ç›´æ¥è¿”å›nullï¼Œä¸æ˜¯çƒ­ç‚¹key</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">            <span class="comment">//  3.2 å­˜åœ¨ï¼Œååºåˆ—åŒ–ä¸ºRedisDataå¯¹è±¡</span></span><br><span class="line">        <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> JSONUtil.toBean(json, RedisData.class);</span><br><span class="line">        <span class="comment">//        å¾—åˆ°Rå¯¹è±¡</span></span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> JSONUtil.toBean((JSONObject) redisData.getData(), type);</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">expireTime</span> <span class="operator">=</span> redisData.getExpireTime();</span><br><span class="line">        <span class="comment">// 4.åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">        <span class="keyword">if</span> (expireTime.isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">            <span class="comment">// 4.1.æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="keyword">return</span> r;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 5. å·²è¿‡æœŸï¼Œéœ€è¦ç¼“å­˜é‡å»º</span></span><br><span class="line">        <span class="comment">// 6.ç¼“å­˜é‡å»º</span></span><br><span class="line">        <span class="comment">// 6.1.è·å–äº’æ–¥é”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> lockKeyPrefix + id;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line">        <span class="comment">// 6.2.åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">if</span> (isLock) &#123;</span><br><span class="line">            <span class="comment">// 6.3.æˆåŠŸï¼Œå¼€å¯ç‹¬ç«‹çº¿ç¨‹ï¼Œå®ç°ç¼“å­˜é‡å»º</span></span><br><span class="line"><span class="comment">//            åœ¨è¿™ä¹‹å‰éœ€è¦DoubleCheckï¼Œå†æ¬¡æŸ¥çœ‹redisç¼“å­˜æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">            json = stringRedisTemplate.opsForValue().get(key);</span><br><span class="line"><span class="comment">//            åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">            <span class="keyword">if</span> (StrUtil.isNotBlank(json)) &#123;</span><br><span class="line">                <span class="comment">//            5.2.2.1 å­˜åœ¨åˆ™åˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼Œæœªè¿‡æœŸå°±ç›´æ¥è¿”å›ï¼Œä¸éœ€è¦ç¼“å­˜æ„å»º</span></span><br><span class="line">                redisData = JSONUtil.toBean(json, RedisData.class);</span><br><span class="line">                r = JSONUtil.toBean((JSONObject) redisData.getData(), type);</span><br><span class="line">                expireTime = redisData.getExpireTime();</span><br><span class="line">                <span class="keyword">if</span> (expireTime.isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">                    <span class="comment">//   æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">                    <span class="keyword">return</span> r;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//   6.4 å·²è¿‡æœŸ || ä¸å­˜åœ¨  åˆ™é‡æ–°æ„å»ºï¼Œå¼€å¯çº¿ç¨‹æ± ï¼ˆå¦‚æœè‡ªå·±new çº¿ç¨‹ï¼Œæ€§èƒ½ä¸å¥½ï¼‰</span></span><br><span class="line"></span><br><span class="line">            CACHE_REBUILD_EXECUTOR.submit(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">                    <span class="type">R</span> <span class="variable">newR</span> <span class="operator">=</span> dbFallback.apply(id);</span><br><span class="line">                    <span class="comment">// é‡å»ºç¼“å­˜--çƒ­ç‚¹key</span></span><br><span class="line">                    <span class="built_in">this</span>.setWithLogicalExpire(key, newR, time, unit);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">                    unlock(lockKey);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6.4.è¿”å›è¿‡æœŸçš„ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº’æ–¥é” è§£å†³ç¼“å­˜å‡»ç©¿</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;R, ID&gt; R <span class="title function_">queryWithMutex</span><span class="params">(</span></span><br><span class="line"><span class="params">            String keyPrefix, ID id, Class&lt;R&gt; type,String lockKeyPrefix, <span class="type">long</span> sleepTime,Function&lt;ID, R&gt; dbFallback, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> keyPrefix + id;</span><br><span class="line">        <span class="comment">// 1.ä»redisæŸ¥è¯¢ç¼“å­˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line"><span class="comment">//        2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨ ã€‚isNotBlankåªæœ‰åœ¨ å­—ç¬¦ä¸² æ‰è¿”å›trueã€‚ æ¢è¡Œ ï¼Œnull, &quot;&quot;ç­‰éƒ½æ˜¯false</span></span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isNotBlank(json)) &#123;</span><br><span class="line">            <span class="comment">// 3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="keyword">return</span> JSONUtil.toBean(json, type);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//      3.2  å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æœ‰  nullï¼Œ&quot;&quot;,æ¢è¡Œ  ç­‰å¯èƒ½æ€§ã€‚å¦‚æœæ˜¯&quot;&quot;ï¼Œ åˆ™æ˜¯ä¸ºäº†è§£å†³ç¼“å­˜ç©¿é€è€Œçº¦å®šçš„è§„åˆ™</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;&quot;</span>.equals(json)) &#123;</span><br><span class="line"><span class="comment">//            è§£å†³ç¼“å­˜ç©¿é€ï¼Œä¸ä¼šå†å»æŸ¥æ•°æ®åº“</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        4.å¦‚æœä¸å­˜åœ¨ï¼Œä¸”ä¸æ˜¯&quot;&quot; ï¼›é‚£ä¹ˆåŸå› å¯èƒ½æ˜¯ç¼“å­˜ä¸­ä¸ºnullï¼Œéœ€è¦æ ¹æ®idå»æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line"><span class="comment">//        ==========è§£å†³ç¼“å­˜å‡»ç©¿==========</span></span><br><span class="line"><span class="comment">//        4.1 è·å–äº’æ–¥é”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> lockKeyPrefix + id;</span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line">            <span class="comment">// 4.2.åˆ¤æ–­æ˜¯å¦è·å–æˆåŠŸ</span></span><br><span class="line">            <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">                <span class="comment">// 4.3.è·å–é”å¤±è´¥ï¼Œä¼‘çœ å¹¶é‡è¯•</span></span><br><span class="line">                Thread.sleep(sleepTime);</span><br><span class="line">                <span class="keyword">return</span> queryWithMutex(keyPrefix, id ,type,lockKeyPrefix,sleepTime, dbFallback, time, unit);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 4.4 æˆåŠŸï¼ŒåšåŒé‡æ£€æŸ¥é”ï¼ŒæŸ¥çœ‹redisç¼“å­˜æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™æ— éœ€é‡å»ºç¼“å­˜</span></span><br><span class="line">            json = stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨ ã€‚isNotBlankåªæœ‰åœ¨ å­—ç¬¦ä¸² æ‰è¿”å›trueã€‚ æ¢è¡Œ ï¼Œnull, &quot;&quot;ç­‰éƒ½æ˜¯false</span></span><br><span class="line">            <span class="keyword">if</span> (StrUtil.isNotBlank(json)) &#123;</span><br><span class="line">                <span class="comment">//   å­˜åœ¨ç›´æ¥è¿”å›</span></span><br><span class="line">                r = JSONUtil.toBean(json, type);</span><br><span class="line">                <span class="keyword">return</span> r;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//   å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æœ‰  nullï¼Œ&quot;&quot;,æ¢è¡Œ  ç­‰å¯èƒ½æ€§ã€‚å¦‚æœæ˜¯&quot;&quot;ï¼Œ åˆ™æ˜¯ä¸ºäº†è§£å†³ç¼“å­˜ç©¿é€è€Œçº¦å®šçš„è§„åˆ™</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;&quot;</span>.equals(json)) &#123;</span><br><span class="line">                <span class="comment">//           è§£å†³ç¼“å­˜ç©¿é€ï¼Œä¸ä¼šå†å»æŸ¥æ•°æ®åº“</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//  5. åˆ°è¿™é‡Œè¯´æ˜é€šè¿‡åŒé‡æ£€æŸ¥é”ï¼Œä»£è¡¨æ˜¯ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œåˆ™æ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">            r = dbFallback.apply(id);</span><br><span class="line">            <span class="comment">// ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line">            <span class="keyword">if</span> (r == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// å°†ç©ºå€¼å†™å…¥redis</span></span><br><span class="line">                stringRedisTemplate.opsForValue().set(key, <span class="string">&quot;&quot;</span>, CACHE_NULL_TTL, TimeUnit.MINUTES);</span><br><span class="line">                <span class="comment">// è¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 6.å­˜åœ¨ï¼Œå†™å…¥redis</span></span><br><span class="line">            <span class="built_in">this</span>.set(key, r, time, unit);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 7.é‡Šæ”¾é”</span></span><br><span class="line">            unlock(lockKey);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 8.è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">flag</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="string">&quot;1&quot;</span>, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line"><span class="comment">//        ä¸è¦ç›´æ¥è¿”å›ï¼Œå› ä¸ºä¼šè‡ªåŠ¨æ‹†ç®±ï¼Œå¦‚æœä¸ºnullï¼Œä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</span></span><br><span class="line"><span class="comment">//        ä½¿ç”¨å·¥å…·ç±»</span></span><br><span class="line">        <span class="keyword">return</span> BooleanUtil.isTrue(flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        stringRedisTemplate.delete(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒæ–‡ç« ï¼š<br><a href="https://pdai.tech/md/java/basic/java-basic-x-generic.html#%E6%B3%9B%E5%9E%8B%E7%B1%BB">https://pdai.tech/md/java/basic/java-basic-x-generic.html#æ³›å‹ç±»</a><br>    <a href="https://juejin.cn/post/6844903925666021389?searchId=202402142156151370FABE70EBA2501841#heading-8">https://juejin.cn/post/6844903925666021389?searchId=202402142156151370FABE70EBA2501841#heading-8</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ³›å‹åœ¨é¡¹ç›®ä¸­ç”¨çš„ç¡®å®ç›¸å¯¹æ²¡æœ‰é‚£ä¹ˆå¤šï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æä¾›ä¸€äº›ä¾¿æ·ï¼Œæœ¬æ–‡å…ˆä»åŸºç¡€ä»‹ç»ï¼Œç„¶ååœ¨æ–‡ç« æœ€åè®²è§£é¡¹ç›®å®æˆ˜ä¸­çš„ä¸€äº›ä½¿ç”¨ï¼Œè¶…çº§è¯¦ç»†ï¼ğŸŒŸ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;æ³›å‹åŸºç¡€&quot;&gt;&lt;a href=&quot;#æ³›å‹</summary>
      
    
    
    
    <category term="Java" scheme="https://axdmdyj.github.io/categories/Java/"/>
    
    
    <category term="Java" scheme="https://axdmdyj.github.io/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>JVMåƒåœ¾å›æ”¶å…¥é—¨ï¼ˆçˆ±ä¸ŠJVMï¼ï¼ï¼‰</title>
    <link href="https://axdmdyj.github.io/posts/63f114ae.html"/>
    <id>https://axdmdyj.github.io/posts/63f114ae.html</id>
    <published>2024-01-30T02:48:52.000Z</published>
    <updated>2024-01-30T02:53:09.606Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><meta name="referrer" content="no-referrer" /><h1 id="å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯å›æ”¶"><a href="#å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯å›æ”¶" class="headerlink" title="å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯å›æ”¶"></a>å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯å›æ”¶</h1><h2 id="å¼•ç”¨è®¡æ•°æ³•"><a href="#å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°æ³•"></a>å¼•ç”¨è®¡æ•°æ³•</h2><p>å¦‚æœä¸€ä¸ªå¯¹è±¡è¢«å…¶ä»–å˜é‡æ‰€å¼•ç”¨ï¼Œåˆ™è®©è¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°+1ï¼Œå¦‚æœè¯¥å¯¹è±¡è¢«å¼•ç”¨2æ¬¡åˆ™å…¶å¼•ç”¨è®¡æ•°ä¸º2ï¼Œä¾æ¬¡ç±»æ¨ã€‚<br>æŸä¸ªå˜é‡ä¸å†å¼•ç”¨è¯¥å¯¹è±¡ï¼Œåˆ™è®©è¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°-1ï¼Œå½“è¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å˜ä¸º0æ—¶ï¼Œåˆ™è¡¨ç¤ºè¯¥å¯¹è±¡æ²¡ç”¨è¢«å…¶ä»–å˜é‡æ‰€å¼•ç”¨ï¼Œè¿™æ—¶å€™è¯¥å¯¹è±¡å°±å¯ä»¥è¢«ä½œä¸ºåƒåœ¾è¿›è¡Œå›æ”¶ã€‚<br>å¼•ç”¨è®¡æ•°æ³•å¼Šç«¯ï¼šå¾ªç¯å¼•ç”¨æ—¶ï¼Œä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°éƒ½ä¸º1ï¼Œå¯¼è‡´ä¸¤ä¸ªå¯¹è±¡éƒ½æ— æ³•è¢«é‡Šæ”¾å›æ”¶ã€‚æœ€ç»ˆå°±ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706285104990-31a78b77-2fa1-4cdf-95ed-5796e62cca6f.png#averageHue=%23f8f8f7&clientId=u30874917-ba43-4&from=paste&height=173&id=ua318ec17&originHeight=346&originWidth=718&originalType=binary&ratio=2&rotation=0&showTitle=false&size=41902&status=done&style=none&taskId=u5e50c46c-531b-4b80-8438-a79c782602a&title=&width=359" alt="image.png"></p><h2 id="å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="å¯è¾¾æ€§åˆ†æç®—æ³•"></a>å¯è¾¾æ€§åˆ†æç®—æ³•</h2><p>å¯è¾¾æ€§åˆ†æç®—æ³•ï¼šå°±æ˜¯JVMä¸­åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ˜¯åƒåœ¾çš„ç®—æ³•ï¼šè¯¥ç®—æ³•é¦–å…ˆè¦ç¡®å®šGC Root(æ ¹å¯¹è±¡ï¼Œå°±æ˜¯è‚¯å®šä¸ä¼šè¢«å½“æˆåƒåœ¾å›æ”¶çš„å¯¹è±¡)ã€‚<br>åœ¨åƒåœ¾å›æ”¶ä¹‹å‰ï¼ŒJVMä¼šå…ˆå¯¹å †ä¸­çš„æ‰€æœ‰å¯¹è±¡è¿›è¡Œæ‰«æï¼Œåˆ¤æ–­æ¯ä¸€ä¸ªå¯¹è±¡æ˜¯å¦èƒ½è¢«GC Rootç›´æ¥æˆ–è€…é—´æ¥çš„å¼•ç”¨ï¼Œå¦‚æœèƒ½è¢«æ ¹å¯¹è±¡ç›´æ¥æˆ–é—´æ¥å¼•ç”¨åˆ™è¡¨ç¤ºè¯¥å¯¹è±¡ä¸èƒ½è¢«åƒåœ¾å›æ”¶ï¼Œåä¹‹åˆ™è¡¨ç¤ºè¯¥å¯¹è±¡å¯ä»¥è¢«å›æ”¶ï¼š<br>JVMä¸­çš„åƒåœ¾å›æ”¶å™¨é€šè¿‡å¯è¾¾æ€§åˆ†ææ¥æ¢ç´¢æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ã€‚<br>æ‰«æå †ä¸­çš„å¯¹è±¡ï¼Œçœ‹èƒ½å¦æ²¿ç€GC Rootä¸ºèµ·ç‚¹çš„å¼•ç”¨é“¾æ‰¾åˆ°è¯¥å¯¹è±¡ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥å›æ”¶ï¼Œå¦åˆ™å°±å¯ä»¥å›æ”¶ã€‚<br>å¯ä»¥ä½œä¸ºGC Rootçš„å¯¹è±¡ï¼š<br>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚<br>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ã€‚<br>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡<br>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆå³ä¸€èˆ¬è¯´çš„Nativeæ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡ã€‚</p><blockquote><p>å¯ä»¥ç†è§£æˆä¸€ä¸ªè‘¡è„ï¼Œä»æ ¹å‡ºå‘èƒ½åˆ°è¾¾å„ä¸ªè‘¡è„çš„ä½ç½®ã€‚</p></blockquote><p>æ¡ˆä¾‹æ¼”ç¤ºï¼š<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706286510162-965b841c-3f1b-4c05-90cc-da4fb616d941.png#averageHue=%23faf9f9&clientId=u9964b7dd-f54e-4&from=paste&height=636&id=uca5ea950&originHeight=1272&originWidth=2810&originalType=binary&ratio=2&rotation=0&showTitle=false&size=721676&status=done&style=none&taskId=u1b2faba7-4158-476c-b9ea-706e1393da6&title=&width=1405" alt="image.png"><br>è¿™é‡Œåœ¨list1æœ‰æ— å€¼ä¸¤æ–¹é¢æŠ“å–å¿«ç…§ã€‚<br>ç„¶åé€šè¿‡eclipseæä¾›çš„MATå·¥å…·æ¥ <code>GCRoot</code>ï¼Œå“ªäº›å¯ä»¥ä½œä¸º<code>GCRoot</code><br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706286861093-06406389-103f-4a01-abf0-dad164d4f4de.png#averageHue=%23ece9e2&clientId=u9964b7dd-f54e-4&from=paste&height=262&id=u1d8e0269&originHeight=524&originWidth=1204&originalType=binary&ratio=2&rotation=0&showTitle=false&size=234129&status=done&style=none&taskId=ua9ee7593-c0ac-404a-9ca8-c06fc092092&title=&width=602" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706286775480-81f7544c-d99f-44e1-aa5b-e186d932bc12.png#averageHue=%23eae8e2&clientId=u9964b7dd-f54e-4&from=paste&height=467&id=u08ab5f86&originHeight=934&originWidth=2308&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1147449&status=done&style=none&taskId=u7c022eb1-cce0-48fe-863b-fe141f1e59f&title=&width=1154" alt="image.png"><br>è¿™äº›éƒ½å¯ä»¥ä½œä¸º<code>gcroot</code><br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706287024040-9700c11d-1fcb-41df-9314-24ab95d9f363.png#averageHue=%23edede8&clientId=u9964b7dd-f54e-4&from=paste&height=761&id=u2aa131a4&originHeight=1522&originWidth=2546&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1286962&status=done&style=none&taskId=uefd0b948-48df-401f-84cc-eb2f1f850b0&title=&width=1273" alt="image.png"></p><ul><li>æ‰€ä»¥ä»¥åæˆ‘ä»¬æŸ¥çœ‹è·Ÿå¯¹è±¡å°±å¯ä»¥é€šè¿‡MATå·¥å…·å•¦ã€‚</li></ul><h1 id="äº”ç§å¼•ç”¨"><a href="#äº”ç§å¼•ç”¨" class="headerlink" title="äº”ç§å¼•ç”¨"></a>äº”ç§å¼•ç”¨</h1><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706341743263-6f3e11ef-731f-4948-9b2a-92758904999c.png#averageHue=%23dedad4&clientId=u9964b7dd-f54e-4&from=paste&height=644&id=gTuV2&originHeight=1288&originWidth=2066&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1168397&status=done&style=none&taskId=u6b208f64-cea3-4c93-bf18-e96e793340f&title=&width=1033" alt="image.png"></p><h2 id="å¼ºè½¯å¼±"><a href="#å¼ºè½¯å¼±" class="headerlink" title="å¼ºè½¯å¼±"></a>å¼ºè½¯å¼±</h2><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706287702315-3b3cbca2-5e11-48e5-b188-6afc037d3d97.png#averageHue=%23f9f7f0&clientId=u9964b7dd-f54e-4&from=paste&height=614&id=u969b987b&originHeight=1228&originWidth=2376&originalType=binary&ratio=2&rotation=0&showTitle=false&size=580538&status=done&style=none&taskId=u7a15e292-5bcc-4dc6-9b5a-2e578847c76&title=&width=1188" alt="image.png"></p><ul><li>å¼ºå¼•ç”¨ï¼šå¯¹äºA1å¯¹è±¡ï¼Œåªæœ‰ä¸¤ä¸ª<code>GC Root</code>éƒ½ä¸åœ¨å¼•ç”¨å®ƒï¼Œæ‰ä¼šé‡Šæ”¾ã€‚</li><li>è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨ï¼Œå½“å†…å­˜ä¸å¤Ÿçš„æ—¶å€™ï¼Œçœ‹ä½ å°±ä¼šé‡Šæ”¾A2,A3å¯¹è±¡ï¼Œä¹‹åè½¯å¼•ç”¨å’Œå¼±å¼•ç”¨å°±ä¼šè¿›å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œå¦‚æœè¦é‡Šæ”¾äºŒè€…ï¼Œå°±éœ€è¦é€šè¿‡å¼•ç”¨é˜Ÿåˆ—éå†ï¼Œç„¶åé‡Šæ”¾ä¸¤ä¸ªå¼•ç”¨ï¼ˆå› ä¸ºå®ƒä»¬ä¿©ä¹Ÿæ˜¯å¯¹è±¡ï¼‰</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706287970236-c1deb335-9fff-415c-b008-8eb8b173eef1.png#averageHue=%23f9f8f4&clientId=u9964b7dd-f54e-4&from=paste&height=583&id=ud2beb0e6&originHeight=1166&originWidth=2348&originalType=binary&ratio=2&rotation=0&showTitle=false&size=472767&status=done&style=none&taskId=u18d56396-e792-44ca-8363-a3ffbab3f01&title=&width=1174" alt="image.png"></p><h2 id="è™šç»ˆ"><a href="#è™šç»ˆ" class="headerlink" title="è™šç»ˆ"></a>è™šç»ˆ</h2><ul><li>è™šå¼•ç”¨å’Œç»ˆå¼•ç”¨å¿…é¡»é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ ç”¨</li></ul><h3 id="è™šå¼•ç”¨"><a href="#è™šå¼•ç”¨" class="headerlink" title="è™šå¼•ç”¨"></a>è™šå¼•ç”¨</h3><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706340580486-818f346a-e34f-4cad-8e88-343a2b7460d2.png#averageHue=%23f9f7f3&clientId=u9964b7dd-f54e-4&from=paste&height=339&id=u8641f669&originHeight=678&originWidth=1480&originalType=binary&ratio=2&rotation=0&showTitle=false&size=221705&status=done&style=none&taskId=ucca23a33-d880-46b3-80cc-d1963d16cf8&title=&width=740" alt="image.png"><br>å½“å¼•ç”¨çš„å¯¹äºByteBufferè¢«å›æ”¶ä»¥åï¼Œç›´æ¥å†…å­˜è¿˜æ²¡æœ‰è¢«å›æ”¶ï¼Œè™šå¼•ç”¨å¯¹è±¡ï¼ˆCleaner)å°±ä¼šè¢«æ”¾å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œ<br>ç„¶åå°±ä¼šç”±çº¿ç¨‹<code>ReferencHandler</code>å®šæ—¶å»å¼•ç”¨é˜Ÿåˆ—å¯»æ‰¾æ˜¯å¦æœ‰<code>Cleaner</code>å¯¹è±¡ï¼Œå¦‚æœæœ‰ï¼Œå°±ä¼šè°ƒç”¨Cleanerå¯¹è±¡çš„cleanæ–¹æ³•ï¼Œè€Œcleanæ–¹æ³•å°±ä¼šæ ¹æ®å‰é¢è®°å½•çš„ç›´æ¥å†…å­˜åœ°å€ï¼Œè°ƒç”¨Unsafe.freeMemory()æ–¹æ³•ï¼Œæ¥é‡Šæ”¾ç›´æ¥å†…å­˜ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706340798493-29f35654-5f12-4f6c-88e9-5b03b2f1eb25.png#averageHue=%23f9f8f4&clientId=u9964b7dd-f54e-4&from=paste&height=316&id=u2f462385&originHeight=632&originWidth=1508&originalType=binary&ratio=2&rotation=0&showTitle=false&size=208623&status=done&style=none&taskId=uae20db02-e918-45e7-8dbc-ddc52855982&title=&width=754" alt="image.png"><br>æ€»ä¹‹è™šå¼•ç”¨çš„ä¸€ä¸ªä½“ç°æ˜¯é‡Šæ”¾ç›´æ¥å†…å­˜æ‰€åˆ†é…çš„å†…å­˜ï¼Œå½“å¼•ç”¨çš„å¯¹è±¡ByteBufferè¢«åƒåœ¾å›æ”¶ä»¥åï¼Œè™šå¼•ç”¨å¯¹è±¡Cleanerå°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åè°ƒç”¨Cleanerçš„cleanæ–¹æ³•æ¥é‡Šæ”¾ç›´æ¥å†…å­˜ã€‚<br>æ ¹æ®ä¸Šé¢çš„å›¾ï¼ŒBå¯¹è±¡ä¸å†å¼•ç”¨ByteBufferå¯¹è±¡ï¼ŒByteBufferå°±ä¼šè¢«å›æ”¶ã€‚ä½†æ˜¯ç›´æ¥å†…å­˜ä¸­çš„å†…å­˜è¿˜æœªè¢«å›æ”¶ã€‚è¿™æ—¶éœ€è¦å°†è™šå¼•ç”¨å¯¹è±¡Cleaneræ”¾å…¥å¼•ç”¨ é˜Ÿåˆ—ä¸­ï¼Œç„¶åè°ƒç”¨å®ƒçš„cleanæ–¹æ³•æ¥é‡Šæ”¾ç›´æ¥å†…å­˜ã€‚</p><blockquote><p>å¯ä»¥å›é¡¾ä¸€ä¸‹ä¹‹å‰å­¦çš„ç›´æ¥å†…å­˜ï¼Œå’ŒCleaneråº•å±‚åŸç†ã€‚</p></blockquote><h3 id="ç»ˆå¼•ç”¨"><a href="#ç»ˆå¼•ç”¨" class="headerlink" title="ç»ˆå¼•ç”¨"></a>ç»ˆå¼•ç”¨</h3><p>æ‰€æœ‰çš„ç±»éƒ½ç»§æ‰¿è‡ªObjectç±»ï¼ŒObjectç±»æœ‰ä¸€ä¸ªfinalize()æ–¹æ³•ã€‚å½“æŸä¸ªå¯¹è±¡ä¸å†è¢«å…¶ä»–çš„å¯¹è±¡æ‰€å¼•ç”¨æ—¶ï¼Œä¼šå…ˆå°†ç»ˆç»“å™¨å¼•ç”¨å¯¹è±¡æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åæ ¹æ®ç»ˆç»“å™¨å¼•ç”¨å¯¹è±¡æ‰¾åˆ°å®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œç„¶åè°ƒç”¨è¯¥å¯¹è±¡çš„finalize()æ–¹æ³•ã€‚è°ƒç”¨ä»¥åï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«åƒåœ¾å›æ”¶äº†ã€‚<br> <img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706341322729-5dbafcfd-a4af-4ee5-968a-f77ed1995c06.png#averageHue=%23faf8f6&clientId=u9964b7dd-f54e-4&from=paste&height=500&id=u1816a410&originHeight=1000&originWidth=2268&originalType=binary&ratio=2&rotation=0&showTitle=false&size=275505&status=done&style=none&taskId=ub155ae2c-26a6-48c6-a24a-14e8f67e575&title=&width=1134" alt="image.png"><br>å½“ä¸€ä¸ªå¯¹è±¡é‡å†™äº†finalizeæ–¹æ³•ï¼Œè‚¯å®šæ˜¯å¸Œæœ›é€šè¿‡ç»ˆç»“å™¨åº”ç”¨é‡Šæ”¾ã€‚<br>ä¾‹å¦‚ä¸Šå›¾ï¼Œå½“A4å¯¹è±¡æ²¡æœ‰å¼ºå¼•ç”¨çš„æ—¶å€™ï¼Œè¿™æ—¶å€™ä¼šè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè™šæ‹Ÿæœºä¼šå¯¹è¿™ä¸ªå¯¹è±¡åˆ›å»ºç»ˆç»“å™¨å¼•ç”¨ï¼Œç»ˆç»“å™¨åº”ç”¨ä¼šè¿›å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œä½†è¿™æ—¶å€™A4å¯¹è±¡è¿˜æ²¡æœ‰è¢«é‡Šæ”¾ï¼ï¼<br>åªæœ‰å½“ä¼˜å…ˆçº§å¾ˆä½çš„FinallizeHandlerçº¿ç¨‹æ¥åº”ç”¨é˜Ÿåˆ—å¯»æ‰¾æ˜¯å¦æœ‰ç»ˆç»“å™¨åº”ç”¨ï¼Œç„¶åè°ƒç”¨A4å¯¹è±¡çš„finallize()æ–¹æ³•ï¼Œåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶çš„æ—¶å€™A4å¯¹è±¡æ‰ä¼šå¾—åˆ°é‡Šæ”¾ã€‚</p><blockquote><p>æ‰€ä»¥ä¹Ÿå°±æœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œå› ä¸ºFinallizeHandlerçº¿ç¨‹ä¼˜å…ˆçº§å¾ˆä½ï¼Œè€Œä¸”ç¬¬ä¸€æ¬¡å†…å­˜å›æ”¶çš„æ—¶å€™å¹¶ä¸èƒ½å®Œå…¨é‡Šæ”¾ã€‚æ‰€ä»¥æœ‰æ—¶å€™å¯¹è±¡è¿Ÿè¿Ÿå¾—ä¸åˆ°é‡Šæ”¾ï¼Œå†…å­˜å°±ä¼šä¸€ç›´è¢«å ç”¨ï¼Œæ‰€ä»¥è¿™ä¸ªç»ˆç»“å™¨åº”ç”¨åœ¨æ—¥å¸¸ç”¨çš„å¹¶ä¸å¤šã€‚</p></blockquote><hr><h2 id="è½¯å¼•ç”¨æ¡ˆä¾‹"><a href="#è½¯å¼•ç”¨æ¡ˆä¾‹" class="headerlink" title="è½¯å¼•ç”¨æ¡ˆä¾‹"></a>è½¯å¼•ç”¨æ¡ˆä¾‹</h2><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706347165062-a9a75e54-7b71-42cc-9407-bfccde1f4fc9.png#averageHue=%23f0ecdf&clientId=u9964b7dd-f54e-4&from=paste&height=508&id=u63d2e236&originHeight=1016&originWidth=2220&originalType=binary&ratio=2&rotation=0&showTitle=false&size=648652&status=done&style=none&taskId=u136180f6-a625-4acd-af36-d0755c7acb8&title=&width=1110" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706347325360-08e2b093-3ff1-4595-9702-44c59b9ebafb.png#averageHue=%23fafaf8&clientId=u9964b7dd-f54e-4&from=paste&height=664&id=u7ab57e66&originHeight=1328&originWidth=2672&originalType=binary&ratio=2&rotation=0&showTitle=false&size=801552&status=done&style=none&taskId=u7e118bab-2526-4e05-906c-19afdfbf113&title=&width=1336" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706347369906-fac8d4c4-76e5-4680-9be5-3f7a95d827ad.png#averageHue=%23fcfbfb&clientId=u9964b7dd-f54e-4&from=paste&height=551&id=u1923440c&originHeight=1102&originWidth=2306&originalType=binary&ratio=2&rotation=0&showTitle=false&size=439484&status=done&style=none&taskId=uaaff3dc5-e4fa-4dcc-948c-5d857a752d7&title=&width=1153" alt="image.png"><br>è®©æˆ‘ä»¬ç»†çœ‹ä¸€ä¸‹ç»†èŠ‚ã€‚æ‰“å°gcè¯¦æƒ…<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706347638207-0bf901a4-88df-454f-90e1-857b6149be68.png#averageHue=%23e1dfd8&clientId=u9964b7dd-f54e-4&from=paste&height=473&id=u1690702f&originHeight=946&originWidth=2880&originalType=binary&ratio=2&rotation=0&showTitle=false&size=994686&status=done&style=none&taskId=uc35aa18b-e351-4c35-85db-91a4d54e303&title=&width=1440" alt="image.png"><br>æ‰€ä»¥åœ¨å¤„ç†ä¸€äº›ä¸é‡è¦çš„å¯¹è±¡çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡è½¯å¼•ç”¨æ¥é™ä½å†…å­˜å‹åŠ›ã€‚</p><h2 id="è½¯å¼•ç”¨-å¼•ç”¨é˜Ÿåˆ—"><a href="#è½¯å¼•ç”¨-å¼•ç”¨é˜Ÿåˆ—" class="headerlink" title="è½¯å¼•ç”¨_å¼•ç”¨é˜Ÿåˆ—"></a>è½¯å¼•ç”¨_å¼•ç”¨é˜Ÿåˆ—<img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706348021334-2093d593-def0-49e1-81eb-2b2c3efa9a7b.png#averageHue=%23edece6&clientId=u9964b7dd-f54e-4&from=paste&height=446&id=u641eca1e&originHeight=892&originWidth=1680&originalType=binary&ratio=2&rotation=0&showTitle=false&size=524549&status=done&style=none&taskId=ucba936bc-e745-4ee3-86fe-70ef89a69d9&title=&width=840" alt="image.png"></h2><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706347973037-6d201545-2b9b-467c-b5e2-000e71b58f26.png#averageHue=%23f1eee1&clientId=u9964b7dd-f54e-4&from=paste&height=605&id=uc14935a2&originHeight=1210&originWidth=2628&originalType=binary&ratio=2&rotation=0&showTitle=false&size=635074&status=done&style=none&taskId=u6478809c-8762-44e2-bd04-5b2c42d8562&title=&width=1314" alt="image.png"></p><h2 id="å¼±å¼•ç”¨å¯¹è±¡"><a href="#å¼±å¼•ç”¨å¯¹è±¡" class="headerlink" title="å¼±å¼•ç”¨å¯¹è±¡"></a>å¼±å¼•ç”¨å¯¹è±¡</h2><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706348447712-e4db3f90-ab7a-4edc-9622-a70b6db345fa.png#averageHue=%23eeece3&clientId=u9964b7dd-f54e-4&from=paste&height=600&id=u7b445252&originHeight=1200&originWidth=2416&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1236319&status=done&style=none&taskId=u9773bbed-0dbb-41ca-8e06-23ff6565402&title=&width=1208" alt="image.png"><br>å¼±å¼•ç”¨ä¸€èˆ¬ä¼šå‘ç”Ÿåœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œå½“å†…å­˜ç´§å¼ æ—¶ï¼Œå°±ä¼šå›æ”¶å¼±å¼•ç”¨å¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿä¼šå›æ”¶å¼±å¼•ç”¨è‡ªèº«ã€‚</p><h1 id="å›æ”¶ç®—æ³•"><a href="#å›æ”¶ç®—æ³•" class="headerlink" title="å›æ”¶ç®—æ³•"></a>å›æ”¶ç®—æ³•</h1><h2 id="æ ‡è®°æ¸…é™¤ç®—æ³•"><a href="#æ ‡è®°æ¸…é™¤ç®—æ³•" class="headerlink" title="æ ‡è®°æ¸…é™¤ç®—æ³•"></a>æ ‡è®°æ¸…é™¤ç®—æ³•</h2><p>é¦–å…ˆæœ‰ä¸¤æ­¥</p><ul><li>å…ˆæ ‡è®°å“ªäº›å¯¹è±¡å¯ä»¥æ˜¯åƒåœ¾</li><li>ç„¶åæ¸…é™¤åƒåœ¾å›æ”¶å¯¹è±¡ï¼ˆè¿™é‡Œçš„è…¾å‡ºå†…å­˜ç©ºé—´å¹¶ä¸æ˜¯å°†å†…å­˜ç©ºé—´çš„å­—èŠ‚æ¸… 0ï¼Œè€Œæ˜¯è®°å½•ä¸‹è¿™æ®µå†…å­˜çš„èµ·å§‹ç»“æŸåœ°å€ï¼Œä¸‹æ¬¡åˆ†é…å†…å­˜çš„æ—¶å€™ï¼Œä¼šç›´æ¥<strong>è¦†ç›–</strong>è¿™æ®µå†…å­˜ã€‚ï¼‰</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š<strong>å®¹æ˜“äº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡</strong>ï¼Œå¯èƒ½æ— æ³•æ»¡è¶³å¤§å¯¹è±¡çš„å†…å­˜åˆ†é…ï¼Œä¸€æ—¦å¯¼è‡´æ— æ³•åˆ†é…å¯¹è±¡ï¼Œé‚£å°±ä¼šå¯¼è‡´jvmå¯åŠ¨gcï¼Œä¸€æ—¦å¯åŠ¨gcï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°±ä¼šæš‚åœï¼Œè¿™å°±å¯¼è‡´åº”ç”¨çš„å“åº”é€Ÿåº¦å˜æ…¢ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706349164883-994f2c35-6859-427d-8ddd-5453e0629fba.png#averageHue=%23f8f8f6&clientId=u9964b7dd-f54e-4&from=paste&height=644&id=ua8b12acc&originHeight=1288&originWidth=1782&originalType=binary&ratio=2&rotation=0&showTitle=false&size=295572&status=done&style=none&taskId=ua30e9cb0-4773-46f5-9471-13046710775&title=&width=891" alt="image.png"></p><h2 id="æ ‡è®°æ•´ç†"><a href="#æ ‡è®°æ•´ç†" class="headerlink" title="æ ‡è®°æ•´ç†"></a>æ ‡è®°æ•´ç†</h2><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706349501497-21a252ea-cc5b-467e-a68f-b982d7752814.png#averageHue=%23f8f8f7&clientId=ud1c445ad-4364-4&from=paste&height=510&id=u69fd961f&originHeight=1020&originWidth=2166&originalType=binary&ratio=2&rotation=0&showTitle=false&size=383709&status=done&style=none&taskId=u5d3ff6a0-6269-496a-8da3-286446eb84e&title=&width=1083" alt="image.png">ä¼šå°†ä¸è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡å›æ”¶ï¼Œæ¸…é™¤å…¶å ç”¨çš„å†…å­˜ç©ºé—´ã€‚ç„¶åæ•´ç†å‰©ä½™çš„å¯¹è±¡ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…å› å†…å­˜ç¢ç‰‡è€Œå¯¼è‡´çš„é—®é¢˜ï¼Œä½†æ˜¯ç‰µæ‰¯åˆ°å¯¹è±¡çš„æ•´ç†ç§»åŠ¨ï¼Œéœ€è¦æ¶ˆè€—ä¸€å®šçš„æ—¶é—´ï¼Œæ‰€ä»¥æ•ˆç‡è¾ƒä½ã€‚ </p><h2 id="å¤åˆ¶å›æ”¶"><a href="#å¤åˆ¶å›æ”¶" class="headerlink" title="å¤åˆ¶å›æ”¶"></a>å¤åˆ¶å›æ”¶</h2><ul><li>ç¬¬ä¸€æ­¥ï¼Œåˆ†ä¸¤ä¸ªåŒºï¼ŒFromåŒºå’Œ ToåŒº</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706349661483-d9b3176e-5827-49f4-bdf9-0b4b679c3ccc.png#averageHue=%23faf9f8&clientId=ud1c445ad-4364-4&from=paste&height=204&id=uc1ec8f95&originHeight=408&originWidth=1534&originalType=binary&ratio=2&rotation=0&showTitle=false&size=128470&status=done&style=none&taskId=uceee1eac-d330-46ba-9fad-52660c0ff8a&title=&width=767" alt="image.png"></p><ul><li>ç¬¬äºŒæ­¥ï¼Œå°†FromåŒºå­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°ToåŒºï¼Œå®Œæˆç¢ç‰‡çš„æ•´ç†</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706349713486-70ce3114-9d57-4f04-b3ad-67d6f577fcad.png#averageHue=%23f6f6f6&clientId=ud1c445ad-4364-4&from=paste&height=200&id=uffb1c45b&originHeight=400&originWidth=1430&originalType=binary&ratio=2&rotation=0&showTitle=false&size=126655&status=done&style=none&taskId=uecf4a7da-fbf5-4b88-a812-41e5cd0df2a&title=&width=715" alt="image.png"></p><ul><li>ç¬¬ä¸‰æ­¥ï¼Œäº¤æ¢FromåŒºå’ŒToåŒºï¼Œä½¿ToåŒºæ€»æ˜¯ç©ºé—²çš„ä¸€å—ç©ºé—´</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706349723740-6b5d89dd-5c39-447d-9858-49eeb46cf6c7.png#averageHue=%23f9f9f8&clientId=ud1c445ad-4364-4&from=paste&height=183&id=u0fec0796&originHeight=366&originWidth=1472&originalType=binary&ratio=2&rotation=0&showTitle=false&size=128196&status=done&style=none&taskId=u8c7d6052-9e5f-4483-8d43-b9b7fe02819&title=&width=736" alt="image.png"><br>å¤åˆ¶ç®—æ³•ï¼šå°†å†…å­˜åˆ†ä¸ºç­‰å¤§å°çš„ä¸¤ä¸ªåŒºåŸŸï¼Œ<strong>FROM</strong>å’Œ<strong>TO</strong>ï¼ˆTOä¸­ä¸ºç©ºï¼‰ã€‚å…ˆå°†è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡ä»FROMæ”¾å…¥TOä¸­ï¼Œå†å›æ”¶ä¸è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡ã€‚ç„¶åäº¤æ¢FROMå’ŒTOã€‚<strong>è¿™æ ·ä¹Ÿå¯ä»¥é¿å…å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œä½†æ˜¯ä¼šå ç”¨åŒå€çš„å†…å­˜ç©ºé—´</strong>ã€‚</p><h1 id="åˆ†ä»£åƒåœ¾å›æ”¶"><a href="#åˆ†ä»£åƒåœ¾å›æ”¶" class="headerlink" title="åˆ†ä»£åƒåœ¾å›æ”¶"></a>åˆ†ä»£åƒåœ¾å›æ”¶</h1><p>é•¿æ—¶é—´ä½¿ç”¨çš„å¯¹è±¡æ”¾åœ¨è€å¹´ä»£ä¸­ï¼ˆé•¿æ—¶é—´å›æ”¶ä¸€æ¬¡ï¼Œå›æ”¶èŠ±è´¹æ—¶é—´ä¹…ï¼‰ï¼Œåœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™ä¹Ÿå¯èƒ½å›æ”¶ï¼Œç”¨å®Œå³å¯ä¸¢å¼ƒçš„å¯¹è±¡æ”¾åœ¨æ–°ç”Ÿä»£ä¸­ï¼ˆé¢‘ç¹éœ€è¦å›æ”¶ï¼Œå›æ”¶é€Ÿåº¦ç›¸å¯¹è¾ƒå¿«ï¼‰ï¼š</p><h2 id="å †å†…å­˜å¤§è‡´åˆ†ä¸ºä¸¤å—ï¼š"><a href="#å †å†…å­˜å¤§è‡´åˆ†ä¸ºä¸¤å—ï¼š" class="headerlink" title="å †å†…å­˜å¤§è‡´åˆ†ä¸ºä¸¤å—ï¼š"></a>å †å†…å­˜å¤§è‡´åˆ†ä¸ºä¸¤å—ï¼š</h2><p>æ–°ç”Ÿä»£ã€è€å¹´ä»£ï¼›æ–°ç”Ÿä»£åˆåˆ’åˆ†ä¸ºä¼Šç”¸å›­ã€å¹¸å­˜åŒºfromã€å¹¸å­˜åŒºtoã€‚<br>é•¿æ—¶é—´ä½¿ç”¨çš„å¯¹è±¡æ”¾åœ¨è€å¹´ä»£ä¸­ï¼Œç”¨å®Œäº†å°±ä¸¢å¼ƒçš„å¯¹è±¡æ”¾åœ¨æ–°ç”Ÿä»£ä¸­ã€‚æ ¹æ®å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒç‰¹ç‚¹ï¼Œé‡‡ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œè€å¹´ä»£å‘ç”Ÿæ¬¡æ•°å°‘ï¼Œæ–°ç”Ÿä»£æ¯”è¾ƒé¢‘ç¹ã€‚ä¸åŒåŒºåŸŸé‡‡ç”¨ä¸åŒç®—æ³•ï¼Œæ›´æœ‰æ•ˆçš„å¯¹åƒåœ¾å›æ”¶è¿›è¡Œç®¡ç†<br><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1648881007627-58238735-ea09-46ba-8a18-eb949359a3d5.png#averageHue=%23f8f8f8&clientId=u64d6ddc7-8e02-4&from=paste&height=287&id=uc287fade&originHeight=359&originWidth=1575&originalType=binary&ratio=1&rotation=0&showTitle=false&size=68146&status=done&style=none&taskId=u7422b092-03c8-4cc3-ba33-46651a1163b&title=&width=1260" alt="image.png"></p><h2 id="åˆ†ä»£åƒåœ¾å›æ”¶æ€ä¹ˆå·¥ä½œï¼š"><a href="#åˆ†ä»£åƒåœ¾å›æ”¶æ€ä¹ˆå·¥ä½œï¼š" class="headerlink" title="åˆ†ä»£åƒåœ¾å›æ”¶æ€ä¹ˆå·¥ä½œï¼š"></a>åˆ†ä»£åƒåœ¾å›æ”¶æ€ä¹ˆå·¥ä½œï¼š</h2><p>javaè™šæ‹Ÿæœºæœ¬èº«å°±æ˜¯ä¸€ä¸ªå°çš„æ“ä½œç³»ç»Ÿå§ï¼Ÿ</p><ul><li>æ–°åˆ›å»ºçš„å¯¹è±¡é¦–å…ˆåˆ†é…åœ¨ ä¼Šç”¸å›­ åŒºï¼›</li><li>ä¼Šç”¸å›­ åŒºç©ºé—´ä¸è¶³æ—¶ï¼Œè§¦å‘ minor gc ï¼Œä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•æ²¿ç€GC rootå¼•ç”¨é“¾å»æ‰¾ï¼Œè¿›è¡Œæ ‡è®°çš„åŠ¨ä½œï¼›</li><li>é‡‡ç”¨å¤åˆ¶ç®—æ³•å°† ä¼Šç”¸å›­ åŒº å’Œå¹¸å­˜åŒºfrom åŒºå­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¹¸å­˜åŒºto ä¸­ï¼Œå­˜æ´»çš„å¯¹è±¡å¹´é¾„åŠ ä¸€ï¼Œç„¶åäº¤æ¢ from toï¼ˆè¿™é‡Œå¾ˆç»†èŠ‚ï¼Œå®é™…å˜çš„ä¸æ˜¯ä¸¤å—ç‰©ç†åœ°å€ï¼Œè€Œæ˜¯æŒ‡é’ˆå¼•ç”¨ï¼‰ï¼›</li><li>minor gc ä¼šå¼•å‘ stop the worldï¼Œå› ä¸ºåƒåœ¾å›æ”¶çš„æ—¶å€™å¯¹è±¡åœ°å€å‘ç”Ÿæ”¹å˜ï¼Œå¦‚æœå…¶ä»–çº¿ç¨‹ä¹Ÿåœ¨è¿è¡Œï¼Œä¼šé€ æˆæ··ä¹±ã€‚æš‚åœå…¶ä»–çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸåï¼Œæ¢å¤ç”¨æˆ·çº¿ç¨‹è¿è¡Œï¼›</li><li>æ–°ç”Ÿä»£è§¦å‘çš„STWçš„æ—¶é—´è¾ƒçŸ­  </li><li>æ¯æ¬¡minorGCåï¼Œedenå’Œfromå¯¹è±¡éƒ½æ¸…é™¤å¹²å‡€äº† </li><li>æ¯æ¬¡éƒ½æŠŠä¸éœ€è¦å›æ”¶å’Œå¹¸å­˜åŒºfromç•™ä¸‹çš„ç§»åˆ°Toä¸­ï¼Œç„¶åäº¤æ¢Fromå’ŒToçš„ä½ç½®</li><li>å½“å¹¸å­˜åŒºtoå¯¹è±¡çš„å¯¿å‘½è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä¼šæ™‹å‡åˆ°è€å¹´ä»£ï¼Œæœ€å¤§å¯¿å‘½æ˜¯15ï¼ˆ4bitï¼‰</li><li>ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äºSurvivorç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— é¡»ç­‰åˆ°MaxTenuringThresholdä¸­è¦æ±‚çš„å¹´é¾„</li><li>å¦‚æœè€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šå…ˆå°è¯•è§¦å‘ minor gcï¼Œå¦‚æœç©ºé—´ä»ç„¶ä¸è¶³ï¼Œé‚£ä¹ˆå°±è§¦å‘ full fc ï¼ŒSTWåœæ­¢çš„æ—¶é—´æ›´é•¿ï¼</li><li>fromå’Œtoæ¯æ¬¡éƒ½è¦ç•™ä¸€ä¸ªç©ºçš„ï¼Œç©ºé—´ä¸è¶³å°±è§¦å‘gcï¼Œè¿˜ä¸è¶³å°±ä¼šè§¦å‘æå‰æ™‹å‡è€å¹´ä»£ï¼Œè€å¹´ä»£å¦‚æœæ”¾ä¸ä¸‹å…ˆè§¦å‘full gc ç„¶åå†å°è¯•æå‰æ™‹å‡ï¼Œè¿˜ä¸è¡Œå°±Java heap space outofmemoryerrorå¼‚å¸¸</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1648881771672-021f9d70-7ed1-45bb-a8b4-669bee5ffa8f.png#averageHue=%23fafafa&clientId=u64d6ddc7-8e02-4&from=paste&height=638&id=uc808cb5a&originHeight=798&originWidth=1573&originalType=binary&ratio=1&rotation=0&showTitle=false&size=161287&status=done&style=none&taskId=u8cb047b9-4dfd-4147-ac34-1ff98b7e2ec&title=&width=1258.4" alt="image.png"></p><h1 id="GC"><a href="#GC" class="headerlink" title="GC"></a>GC</h1><h2 id="ç›¸å…³å‚æ•°"><a href="#ç›¸å…³å‚æ•°" class="headerlink" title="ç›¸å…³å‚æ•°"></a>ç›¸å…³å‚æ•°</h2><p>**å«ä¹‰ **                                      <strong>å‚æ•°</strong><br>å †åˆå§‹å¤§å°                      -Xms<br>å †æœ€å¤§å¤§å°                      -Xmx æˆ– -XX:MaxHeapSize&#x3D;size<br>æ–°ç”Ÿä»£å¤§å°                      -Xmn æˆ– (-XX:NewSize&#x3D;size + -XX:MaxNewSize&#x3D;size )<br>å¹¸å­˜åŒºæ¯”ä¾‹ï¼ˆåŠ¨æ€ï¼‰       -XX:InitialSurvivorRatio&#x3D;ratio å’Œ -XX:+UseAdaptiveSizePolicy<br>å¹¸å­˜åŒºæ¯”ä¾‹                      -XX:SurvivorRatio&#x3D;ratio<br>æ™‹å‡é˜ˆå€¼                              -XX:MaxTenuringThreshold&#x3D;threshold<br>æ™‹å‡è¯¦æƒ…                              -XX:+PrintTenuringDistribution<br>GCè¯¦æƒ…                             -XX:+PrintGCDetails -verbose:gc<br>FullGC å‰ MinorGC              -XX:+ScavengeBeforeFullGC</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><ul><li>ç¨‹åºåˆšåŠ è½½æ—¶çš„å †å†…å­˜æƒ…å†µï¼š</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1648887378100-37e3a00f-3c41-43d5-8c39-92f11622161a.png#averageHue=%23dfdfd7&clientId=u64d6ddc7-8e02-4&from=paste&height=215&id=a9BI9&originHeight=269&originWidth=1365&originalType=binary&ratio=1&rotation=0&showTitle=false&size=285016&status=done&style=none&taskId=udf81d81a-5c97-47f1-8349-81474096d8f&title=&width=1092" alt="image.png"></p><ul><li>ä»£ç åˆ†æ</li></ul><p>é€šè¿‡å¦‚ä¸‹ä»£ç ï¼Œç»™ list åˆ†é…å†…å­˜ï¼Œæ¥è§‚å¯Ÿ æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æƒ…å†µï¼Œä»€ä¹ˆæ—¶å€™è§¦å‘ minor gcï¼Œä»€ä¹ˆæ—¶å€™è§¦å‘ full gc ç­‰æƒ…å†µï¼Œä»€ä¹ˆæ—¶å€™ å¹¸å­˜åŒºæ”¾ä¸ä¸‹ï¼Œç›´æ¥æ™‹å‡è€å¹´ä»£ï¼Œä½¿ç”¨å‰éœ€è¦è®¾ç½® jvm å‚æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Code_10_GCTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_512KB</span> <span class="operator">=</span> <span class="number">512</span> * <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_1MB</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_6MB</span> <span class="operator">=</span> <span class="number">6</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_7MB</span> <span class="operator">=</span> <span class="number">7</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_8MB</span> <span class="operator">=</span> <span class="number">8</span> * <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -Xms20m -Xmx20m -Xmn10m -XX:+UseSerialGC -XX:+PrintGCDetails -verbose:gc</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;<span class="type">byte</span>[]&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">byte</span>[_6MB]);</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">byte</span>[_512KB]);</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">byte</span>[_6MB]);</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">byte</span>[_512KB]);</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">byte</span>[_6MB]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¤§å¯¹è±¡å¤„ç†ç­–ç•¥ï¼š</li></ul><p>å½“é‡åˆ°ä¸€ä¸ªè¾ƒå¤§çš„å¯¹è±¡æ—¶ï¼Œå°±ç®—æ–°ç”Ÿä»£çš„ä¼Šç”¸å›­ä¸ºç©ºï¼Œä¹Ÿæ— æ³•å®¹çº³è¯¥å¯¹è±¡æ—¶ï¼Œä¼šå°†è¯¥å¯¹è±¡ç›´æ¥æ™‹å‡ä¸ºè€å¹´ä»£<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706371753545-75535f45-80d2-489c-8f35-d314afe78f87.png#averageHue=%23e8e5db&clientId=uf95f9f13-d64b-4&from=paste&height=553&id=u38548cc0&originHeight=1106&originWidth=2760&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1337545&status=done&style=none&taskId=u54c391be-757f-44d5-8341-db97e939c9a&title=&width=1380" alt="image.png"></p><ul><li>çº¿ç¨‹å†…å­˜æº¢å‡ºï¼š</li></ul><p>æŸä¸ªçº¿ç¨‹çš„å†…å­˜æº¢å‡ºäº†è€ŒæŠ›å¼‚å¸¸ï¼ˆout of memoryï¼‰ï¼Œä¸ä¼šè®©å…¶ä»–çš„çº¿ç¨‹ç»“æŸè¿è¡Œ<br>è¿™æ˜¯å› ä¸ºå½“ä¸€ä¸ªçº¿ç¨‹æŠ›å‡ºOOMå¼‚å¸¸åï¼Œå®ƒæ‰€å æ®çš„å†…å­˜èµ„æºä¼šå…¨éƒ¨è¢«é‡Šæ”¾æ‰ï¼Œä»è€Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„è¿è¡Œï¼Œè¿›ç¨‹ä¾ç„¶æ­£å¸¸ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706371871415-adbf0b45-1eca-4777-b023-54ef6b489891.png#averageHue=%23e9e6dc&clientId=uf95f9f13-d64b-4&from=paste&height=440&id=ufb6758c1&originHeight=880&originWidth=2612&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1083308&status=done&style=none&taskId=u9cfd524a-0556-40ac-9981-6ac5abb0606&title=&width=1306" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706371900932-82995376-8d3f-41fe-bd9a-ca5458dec7aa.png#averageHue=%23edeae1&clientId=uf95f9f13-d64b-4&from=paste&height=505&id=u0aa26855&originHeight=1010&originWidth=2768&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1449389&status=done&style=none&taskId=u4d7acb62-58d5-4aa4-b142-34e636f4208&title=&width=1384" alt="image.png"></p><h1 id="åƒåœ¾å›æ”¶å™¨"><a href="#åƒåœ¾å›æ”¶å™¨" class="headerlink" title="åƒåœ¾å›æ”¶å™¨"></a>åƒåœ¾å›æ”¶å™¨</h1><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706404931105-79675091-00d1-4596-afff-336934f7f63b.png#averageHue=%23fcfcfc&clientId=uf95f9f13-d64b-4&from=paste&height=350&id=u11683edb&originHeight=700&originWidth=1396&originalType=binary&ratio=2&rotation=0&showTitle=false&size=178508&status=done&style=none&taskId=u3728362f-4a56-439f-85b8-564cf624063&title=&width=698" alt="image.png"> </p><h2 id="ç›¸å…³æ¦‚å¿µï¼š"><a href="#ç›¸å…³æ¦‚å¿µï¼š" class="headerlink" title="ç›¸å…³æ¦‚å¿µï¼š"></a>ç›¸å…³æ¦‚å¿µï¼š</h2><p> åœ¨è°ˆè®ºåƒåœ¾æ”¶é›†å™¨çš„ä¸Šä¸‹æ–‡è¯­å¢ƒä¸­ï¼Œ å®ƒä»¬å¯ä»¥ç†è§£ä¸ºï¼š</p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>å¹¶è¡Œï¼ˆParallelï¼‰ ï¼š<br>å¹¶è¡Œæè¿°çš„æ˜¯å¤šæ¡åƒåœ¾æ”¶é›†å™¨çº¿ç¨‹ä¹‹é—´çš„å…³ç³»ï¼Œ è¯´æ˜åŒä¸€æ—¶é—´æœ‰å¤šæ¡è¿™æ ·çš„çº¿ç¨‹åœ¨ååŒå·¥ä½œï¼Œ é€šå¸¸é»˜è®¤æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹æ˜¯å¤„äºç­‰å¾…çŠ¶æ€ã€‚</p><h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><p>å¹¶å‘ï¼ˆConcurrentï¼‰ ï¼š<br> å¹¶å‘æè¿°çš„æ˜¯åƒåœ¾æ”¶é›†å™¨çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹ä¹‹é—´çš„å…³ç³»ï¼Œ è¯´æ˜åŒä¸€æ—¶é—´åƒåœ¾æ”¶é›†å™¨çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹éƒ½åœ¨è¿è¡Œï¼ˆä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„å¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ã€‚ ç”±äºç”¨æˆ·çº¿ç¨‹å¹¶æœªè¢«å†»ç»“ï¼Œ æ‰€ä»¥ç¨‹åºä»ç„¶èƒ½å“åº”æœåŠ¡è¯·æ±‚ï¼Œ ä½†ç”±äºåƒåœ¾æ”¶é›†å™¨çº¿ç¨‹å ç”¨äº†ä¸€éƒ¨åˆ†ç³»ç»Ÿèµ„æºï¼Œ æ­¤æ—¶åº”ç”¨ç¨‹åºçš„å¤„ç†çš„ååé‡å°†å—åˆ°ä¸€å®šå½±å“ã€‚ </p><h3 id="ååé‡ï¼š"><a href="#ååé‡ï¼š" class="headerlink" title="ååé‡ï¼š"></a>ååé‡ï¼š</h3><p>å³ CPU ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸ CPU æ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ï¼ˆååé‡ &#x3D; è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ &#x2F; ( è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + åƒåœ¾æ”¶é›†æ—¶é—´ )ï¼‰ï¼Œä¹Ÿå°±æ˜¯ã€‚ä¾‹å¦‚ï¼šè™šæ‹Ÿæœºå…±è¿è¡Œ 100 åˆ†é’Ÿï¼Œåƒåœ¾æ”¶é›†å™¨èŠ±æ‰ 1 åˆ†é’Ÿï¼Œé‚£ä¹ˆååé‡å°±æ˜¯ 99% ã€‚</p><h2 id="1ï¼‰ä¸²è¡Œ"><a href="#1ï¼‰ä¸²è¡Œ" class="headerlink" title="1ï¼‰ä¸²è¡Œ"></a>1ï¼‰ä¸²è¡Œ</h2><p>å•çº¿ç¨‹<br>é€‚ç”¨äºå †å†…å­˜è¾ƒå°ï¼Œå¦‚ä¸ªäººç”µè„‘ï¼ˆCPUæ ¸æ•°è¾ƒå°‘ä¹Ÿå¯ä»¥ï¼Œå› ä¸ºå•çº¿ç¨‹ï¼‰<br><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1648902517820-ef16f7d9-6770-4e5a-a046-a0e24fb4d5c5.png#averageHue=%23fafafa&clientId=u64d6ddc7-8e02-4&from=paste&height=405&id=ZMcbG&originHeight=506&originWidth=1284&originalType=binary&ratio=1&rotation=0&showTitle=false&size=138942&status=done&style=none&taskId=u83ad8bce-fe92-4f80-9ae8-05716981832&title=&width=1027.2" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseSerialGC=serial + serialOld</span><br></pre></td></tr></table></figure><h3 id="å®‰å…¨ç‚¹ï¼š"><a href="#å®‰å…¨ç‚¹ï¼š" class="headerlink" title="å®‰å…¨ç‚¹ï¼š"></a>å®‰å…¨ç‚¹ï¼š</h3><p>è®©å…¶ä»–çº¿ç¨‹éƒ½åœ¨è¿™ä¸ªç‚¹åœä¸‹æ¥ï¼Œä»¥å…åƒåœ¾å›æ”¶æ—¶ç§»åŠ¨å¯¹è±¡åœ°å€ï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹æ‰¾ä¸åˆ°è¢«ç§»åŠ¨çš„å¯¹è±¡ã€‚å› ä¸ºæ˜¯ä¸²è¡Œçš„ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªåƒåœ¾å›æ”¶çº¿ç¨‹ã€‚ä¸”åœ¨è¯¥çº¿ç¨‹æ‰§è¡Œå›æ”¶å·¥ä½œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€</p><h3 id="Serial-æ”¶é›†å™¨ï¼š"><a href="#Serial-æ”¶é›†å™¨ï¼š" class="headerlink" title="Serial æ”¶é›†å™¨ï¼š"></a>Serial æ”¶é›†å™¨ï¼š</h3><p>Serial æ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬çš„ã€å‘å±•å†å²æœ€æ‚ ä¹…çš„æ”¶é›†å™¨<br>ç‰¹ç‚¹ï¼šå•çº¿ç¨‹ã€ç®€å•é«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹ç›¸æ¯”ï¼‰ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•ã€‚å¯¹äºé™å®šå•ä¸ª CPU çš„ç¯å¢ƒæ¥è¯´ï¼ŒSerial æ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾æ”¶é›†è‡ªç„¶å¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚æ”¶é›†å™¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°å®ƒç»“æŸï¼ˆStop The Worldï¼‰ï¼</p><h3 id="ParNew-æ”¶é›†å™¨ï¼š"><a href="#ParNew-æ”¶é›†å™¨ï¼š" class="headerlink" title="ParNew æ”¶é›†å™¨ï¼š"></a>ParNew æ”¶é›†å™¨ï¼š</h3><ul><li>ParNew æ”¶é›†å™¨å…¶å®å°±æ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬</li><li>é™¤äº†Serialæ”¶é›†å™¨å¤–ï¼Œ ç›®å‰åªæœ‰å®ƒèƒ½ä¸CMSæ”¶é›†å™¨é…åˆå·¥ä½œã€‚ </li><li>ç‰¹ç‚¹ï¼šå¤šçº¿ç¨‹ã€ParNew æ”¶é›†å™¨é»˜è®¤å¼€å¯çš„æ”¶é›†çº¿ç¨‹æ•°ä¸CPUçš„æ•°é‡ç›¸åŒï¼Œåœ¨ CPU éå¸¸å¤šçš„ç¯å¢ƒä¸­ï¼Œå¯ä»¥ä½¿ç”¨ -XX:ParallelGCThreads å‚æ•°æ¥é™åˆ¶åƒåœ¾æ”¶é›†çš„çº¿ç¨‹æ•°ã€‚å’Œ Serial æ”¶é›†å™¨ä¸€æ ·å­˜åœ¨ Stop The World é—®é¢˜</li></ul><h3 id="Serial-Old-æ”¶é›†å™¨ï¼š"><a href="#Serial-Old-æ”¶é›†å™¨ï¼š" class="headerlink" title="Serial Old æ”¶é›†å™¨ï¼š"></a>Serial Old æ”¶é›†å™¨ï¼š</h3><p>Serial Old æ˜¯ Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬<br>ç‰¹ç‚¹ï¼šåŒæ ·æ˜¯å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œé‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•</p><p>åœ¨æœåŠ¡ç«¯æ¨¡å¼ä¸‹ï¼Œå®ƒä¹Ÿå¯èƒ½æœ‰ä¸¤ç§ç”¨é€”ï¼š ä¸€ç§æ˜¯åœ¨JDK 5ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ä¸Parallel Scavengeæ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼Œ å¦å¤–ä¸€ç§å°±æ˜¯ä½œä¸ºCMSæ”¶é›†å™¨å‘ç”Ÿå¤±è´¥æ—¶çš„åå¤‡é¢„æ¡ˆï¼Œ åœ¨å¹¶å‘æ”¶é›†å‘ç”ŸConcurrent Mode Failureæ—¶ä½¿ç”¨</p><h2 id="ååé‡ä¼˜å…ˆ"><a href="#ååé‡ä¼˜å…ˆ" class="headerlink" title="ååé‡ä¼˜å…ˆ"></a>ååé‡ä¼˜å…ˆ</h2><p><strong>parallelï¼šå¹¶è¡Œçš„   Pauseï¼šåœé¡¿</strong></p><ul><li>å¤šçº¿ç¨‹</li><li>é€‚åˆå †å†…å­˜è¾ƒå¤§ï¼Œéœ€è¦å¤šæ ¸ cpuæ”¯æŒ</li><li>è®©å•ä½æ—¶é—´å†…ï¼ŒSTWï¼ˆstop the worldï¼Œåœæ‰å…¶ä»–æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼‰æ—¶é—´æœ€çŸ­</li><li>JDK1.8é»˜è®¤ä½¿ç”¨çš„åƒåœ¾å›æ”¶å™¨</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1648905756956-5700f0dd-4a7a-4a73-b0b2-844407cd7d14.png#averageHue=%23fbfafa&clientId=u64d6ddc7-8e02-4&from=paste&height=633&id=UuKmC&originHeight=791&originWidth=1371&originalType=binary&ratio=1&rotation=0&showTitle=false&size=332475&status=done&style=none&taskId=u7778844b-e4a1-4067-b788-23755ea24c4&title=&width=1096.8" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€ä¸ªæ˜¯æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶å™¨,å¤åˆ¶ç®—æ³•ï¼›ç¬¬äºŒä¸ªæ˜¯è€å¹´ä»£çš„åƒåœ¾å›æ”¶å™¨ï¼Œæ ‡è®°æ•´ç†ç®—æ³•</span></span><br><span class="line"><span class="comment">//éƒ½æ˜¯å¤šçº¿ç¨‹çš„ï¼Œåªè¦å¼€å¯ä¸€ä¸ªï¼Œå¦å¤–ä¸€ä¸ªå°±ä¼šå¼€å¯</span></span><br><span class="line"><span class="comment">//å·¥ä½œå¼€å¯çš„å›æ”¶çº¿ç¨‹æ•°ç›®ï¼Œä¸cpuæ ¸æ•°æœ‰å…³ã€‚å›æ”¶æ—¶ï¼Œcpuå æœ‰ç‡100%</span></span><br><span class="line">-XX:+UseParallelGC ~ -XX:+UsePrallerOldGC  </span><br><span class="line">-XX:+UseAdaptiveSizePolicy   <span class="comment">//GCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼Œä¼Šç”¸å›­å’Œå¹¸å­˜åŒºå æ¯”</span></span><br><span class="line">-XX:GCTimeRatio=ratio  <span class="comment">// åƒåœ¾å›æ”¶å’Œæ€»æ—¶é—´å æ¯” 1/(1+radio)</span></span><br><span class="line">-XX:MaxGCPauseMillis=ms  <span class="comment">//  åƒåœ¾å›æ”¶æš‚åœ200ms</span></span><br><span class="line">-XX:ParallelGCThreads=n   <span class="comment">//å›æ”¶çº¿ç¨‹æ•° æ§åˆ¶</span></span><br></pre></td></tr></table></figure><h3 id="Parallel-Scavenge-æ”¶é›†å™¨ï¼š"><a href="#Parallel-Scavenge-æ”¶é›†å™¨ï¼š" class="headerlink" title="Parallel Scavenge æ”¶é›†å™¨ï¼š"></a>Parallel Scavenge æ”¶é›†å™¨ï¼š</h3><p>Parallel Scavengeæ”¶é›†å™¨çš„ç‰¹ç‚¹æ˜¯å®ƒçš„å…³æ³¨ç‚¹ä¸å…¶ä»–æ”¶é›†å™¨ä¸åŒï¼Œ CMSç­‰æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½åœ°ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œ è€ŒParallel Scavengeæ”¶é›†å™¨çš„ç›®æ ‡åˆ™æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼ˆThroughputï¼‰ ã€‚ æ‰€è°“ååé‡å°±æ˜¯å¤„ç†å™¨ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸å¤„ç†å™¨æ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ ã€‚</p><p>ä¸ååé‡å…³ç³»å¯†åˆ‡ï¼Œæ•…ä¹Ÿç§°ä¸ºååé‡ä¼˜å…ˆæ”¶é›†å™¨<br>ç‰¹ç‚¹ï¼šå±äºæ–°ç”Ÿä»£æ”¶é›†å™¨ä¹Ÿæ˜¯é‡‡ç”¨å¤åˆ¶ç®—æ³•çš„æ”¶é›†å™¨ï¼ˆç”¨åˆ°äº†æ–°ç”Ÿä»£çš„å¹¸å­˜åŒºï¼‰ï¼Œåˆæ˜¯å¹¶è¡Œçš„å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼ˆä¸ ParNew æ”¶é›†å™¨ç±»ä¼¼ï¼‰<br>è¯¥æ”¶é›†å™¨çš„ç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ã€‚è¿˜æœ‰ä¸€ä¸ªå€¼å¾—å…³æ³¨çš„ç‚¹æ˜¯ï¼šGCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼ˆä¸ ParNew æ”¶é›†å™¨æœ€é‡è¦çš„ä¸€ä¸ªåŒºåˆ«ï¼‰</p><h3 id="GCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼š"><a href="#GCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼š" class="headerlink" title="GCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼š"></a>GCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼š</h3><p>Parallel Scavenge æ”¶é›†å™¨å¯è®¾ç½® -XX:+UseAdptiveSizePolicy å‚æ•°ã€‚<br>å½“å¼€å…³æ‰“å¼€æ—¶ä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ-Xmnï¼‰ã€Eden ä¸ Survivor åŒºçš„æ¯”ä¾‹ï¼ˆ-XX:SurvivorRationï¼‰ã€<br>æ™‹å‡è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„ï¼ˆ-XX:PretenureSizeThresholdï¼‰ç­‰ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è®¾ç½®è¿™äº›å‚æ•°ä»¥æä¾›æœ€ä¼˜çš„åœé¡¿æ—¶é—´å’Œæœ€é«˜çš„ååé‡ï¼Œè¿™ç§è°ƒèŠ‚æ–¹å¼ç§°ä¸º GC çš„è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ã€‚</p><h3 id="Parallel-Scavenge-æ”¶é›†å™¨ä½¿ç”¨ä¸¤ä¸ªå‚æ•°æ§åˆ¶ååé‡ï¼š"><a href="#Parallel-Scavenge-æ”¶é›†å™¨ä½¿ç”¨ä¸¤ä¸ªå‚æ•°æ§åˆ¶ååé‡ï¼š" class="headerlink" title="Parallel Scavenge æ”¶é›†å™¨ä½¿ç”¨ä¸¤ä¸ªå‚æ•°æ§åˆ¶ååé‡ï¼š"></a>Parallel Scavenge æ”¶é›†å™¨ä½¿ç”¨ä¸¤ä¸ªå‚æ•°æ§åˆ¶ååé‡ï¼š</h3><p>XX:MaxGCPauseMillis&#x3D;ms æ§åˆ¶æœ€å¤§çš„åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´ï¼ˆé»˜è®¤200msï¼‰ï¼š<br><strong>å›æ”¶å™¨ä¸€èˆ¬ä¼šè®©å †å˜å°ï¼Œå‡å°‘æ¯æ¬¡åœé¡¿çš„æ—¶é—´</strong><br>XX:GCTimeRatio&#x3D;radio åƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ç‡ï¼Œç›¸å½“äºååé‡çš„å€’æ•°<br><strong>å›æ”¶å™¨ä¸€èˆ¬ä¼šè®©å †å˜å¤§ï¼Œå»å‡å°‘åƒåœ¾å›æ”¶æ¬¡æ•°ï¼Œä»è€Œå‡å°‘æ—¶é—´</strong></p><h3 id="Parallel-Old-æ”¶é›†å™¨"><a href="#Parallel-Old-æ”¶é›†å™¨" class="headerlink" title="Parallel Old æ”¶é›†å™¨"></a>Parallel Old æ”¶é›†å™¨</h3><p>æ˜¯ Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬<br>ç‰¹ç‚¹ï¼šå¤šçº¿ç¨‹ï¼Œé‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•</p><h2 id="å“åº”æ—¶é—´ä¼˜å…ˆ"><a href="#å“åº”æ—¶é—´ä¼˜å…ˆ" class="headerlink" title="å“åº”æ—¶é—´ä¼˜å…ˆ"></a>å“åº”æ—¶é—´ä¼˜å…ˆ</h2><ul><li>CMSï¼ˆConcurrent Mark Sweepï¼‰ æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚ </li><li>CMSä½œä¸ºè€å¹´ä»£çš„æ”¶é›†å™¨ï¼Œæ–°ç”Ÿä»£åªèƒ½é€‰æ‹©ParNewæˆ–è€…Serialæ”¶é›†å™¨ä¸­çš„ä¸€ä¸ªæ¥é…åˆå·¥ä½œã€‚</li><li>å¤šçº¿ç¨‹</li><li>é€‚åˆå †å†…å­˜è¾ƒå¤§ï¼Œéœ€è¦å¤šæ ¸ cpuæ”¯æŒ</li><li>é¢å‘å¹¶å‘è®¾è®¡çš„ç¨‹åºéƒ½å¯¹å¤„ç†å™¨èµ„æºæ¯”è¾ƒæ•æ„Ÿã€‚ åœ¨å¹¶å‘é˜¶æ®µï¼Œ å®ƒè™½ç„¶ä¸ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹åœé¡¿ï¼Œ ä½†å´ä¼šå› ä¸ºå ç”¨äº†ä¸€éƒ¨åˆ†çº¿ç¨‹ï¼ˆæˆ–è€…è¯´å¤„ç†å™¨çš„è®¡ç®—èƒ½åŠ›ï¼‰ è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå˜æ…¢ï¼Œ é™ä½æ€»ååé‡ã€‚</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1648890886592-6db2f622-b3fb-443a-b8fd-7e7f4a023df6.png#averageHue=%23f9f8f8&clientId=u64d6ddc7-8e02-4&from=paste&height=485&id=u5ffb9327&originHeight=606&originWidth=1300&originalType=binary&ratio=1&rotation=0&showTitle=false&size=347954&status=done&style=none&taskId=u34ec76e5-2f38-4258-b48f-49a9f14f81a&title=&width=1040" alt="image.png"></p><h3 id="å‚æ•°è®¾ç½®ï¼š"><a href="#å‚æ•°è®¾ç½®ï¼š" class="headerlink" title="å‚æ•°è®¾ç½®ï¼š"></a>å‚æ•°è®¾ç½®ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€ä¸ªCMSæ˜¯å¹¶å‘æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾å›æ”¶çº¿ç¨‹å¹¶å‘è¿›è¡Œï¼Œè€å¹´ä»£æµ®åŠ¨åƒåœ¾è¿‡å¤šï¼Œé€€åŒ–ä¸º SerialOld</span></span><br><span class="line"><span class="comment">//ç¬¬äºŒä¸ªæ˜¯parnewæ–°ç”Ÿä»£å¤šçº¿ç¨‹å›æ”¶å™¨</span></span><br><span class="line">-XX:+UseConcMarkSweepGC ~ -XX:+UseParNewGC ~ SerialOld</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬ä¸€ä¸ªæ˜¯å¹¶è¡Œçš„åƒåœ¾å›æ”¶çº¿ç¨‹æ•°ï¼Œä¸€èˆ¬è·Ÿcpuæ ¸æ•°ä¸€æ ·ï¼›ç¬¬äºŒä¸ªæ˜¯å¹¶å‘çš„åƒåœ¾å›æ”¶çº¿ç¨‹æ•°,ä¸€èˆ¬è®¾ç½®ä¸ºå¹¶è¡Œçº¿ç¨‹æ•°çš„å››åˆ†ä¹‹ä¸€</span></span><br><span class="line"><span class="comment">//æ¯”å¦‚ï¼šæ ¸æ•°ä¸º4ï¼Œé‚£å°±å ç”¨ä¸€ä¸ªcpuæ ¸è¿›è¡Œåƒåœ¾å›æ”¶ã€‚å…¶ä»–ç”¨äºç”¨æˆ·çº¿ç¨‹</span></span><br><span class="line">-XX:ParallelGCThreads=n ~ -XX:ConcGCThreads=threads</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŒæ ·ä¹Ÿæ˜¯ç”±äºåœ¨åƒåœ¾æ”¶é›†é˜¶æ®µç”¨æˆ·çº¿ç¨‹è¿˜éœ€è¦æŒç»­è¿è¡Œï¼Œé‚£å°±è¿˜éœ€è¦é¢„ç•™è¶³å¤Ÿå†…å­˜ç©ºé—´æä¾›ç»™ç”¨æˆ·çº¿ç¨‹ä½¿ç”¨ï¼Œå› æ­¤CMSæ”¶é›†å™¨ä¸èƒ½åƒå…¶ä»–æ”¶é›†å™¨é‚£æ ·ç­‰å¾…åˆ°è€å¹´ä»£å‡ ä¹å®Œå…¨è¢«å¡«æ»¡äº†å†è¿›è¡Œæ”¶é›†ï¼Œå¿…é¡»é¢„ç•™ä¸€éƒ¨åˆ†ç©ºé—´ä¾›å¹¶å‘æ”¶é›†æ—¶çš„ç¨‹åºè¿ä½œä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="comment">//è®¾ç½®å¾—å¤ªé«˜å°†ä¼šå¾ˆå®¹æ˜“å¯¼è‡´å¤§é‡çš„å¹¶å‘å¤±è´¥äº§ç”Ÿï¼Œæ€§èƒ½åè€Œé™ä½;</span></span><br><span class="line"><span class="comment">//è®¾ç½®å¤ªä½å°†å¯¼è‡´å†…å­˜å›æ”¶é¢‘ç‡å¢åŠ ï¼Œæ€§èƒ½é™ä½</span></span><br><span class="line">-XX:CMSInitiatingOccupancyFraction=percent</span><br><span class="line"></span><br><span class="line"><span class="comment">//é‡æ–°æ ‡è®°å‰å¯¹æ–°ç”Ÿä»£ å…ˆåšä¸€æ¬¡åƒåœ¾å›æ”¶ï¼ˆUseParNewGCï¼‰ï¼Œæ–°ç”Ÿä»£å­˜æ´»å¯¹è±¡å°‘äº†ï¼Œå‡è½»é‡æ–°æ ‡è®°çš„å‹åŠ›</span></span><br><span class="line">-XX:+CMSScavengeBeforeRemark</span><br></pre></td></tr></table></figure><h3 id="CMS-æ”¶é›†å™¨"><a href="#CMS-æ”¶é›†å™¨" class="headerlink" title="CMS æ”¶é›†å™¨"></a>CMS æ”¶é›†å™¨</h3><p>Concurrent Mark Sweepï¼Œä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„è€å¹´ä»£æ”¶é›†å™¨<br>ç‰¹ç‚¹ï¼šåŸºäºæ ‡è®°-æ¸…é™¤ç®—æ³•å®ç°ã€‚å¹¶å‘æ”¶é›†ã€ä½åœé¡¿ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡<br>åº”ç”¨åœºæ™¯ï¼šé€‚ç”¨äºæ³¨é‡æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´æœ€çŸ­ï¼Œç»™ç”¨æˆ·å¸¦æ¥æ›´å¥½çš„ä½“éªŒç­‰åœºæ™¯ä¸‹ã€‚å¦‚ web ç¨‹åºã€b&#x2F;s æœåŠ¡</p><h3 id="CMS-æ”¶é›†å™¨çš„è¿è¡Œè¿‡ç¨‹åˆ†ä¸ºä¸‹åˆ—4æ­¥ï¼š"><a href="#CMS-æ”¶é›†å™¨çš„è¿è¡Œè¿‡ç¨‹åˆ†ä¸ºä¸‹åˆ—4æ­¥ï¼š" class="headerlink" title="CMS æ”¶é›†å™¨çš„è¿è¡Œè¿‡ç¨‹åˆ†ä¸ºä¸‹åˆ—4æ­¥ï¼š"></a>CMS æ”¶é›†å™¨çš„è¿è¡Œè¿‡ç¨‹åˆ†ä¸ºä¸‹åˆ—4æ­¥ï¼š</h3><h4 id="åˆå§‹æ ‡è®°ï¼š"><a href="#åˆå§‹æ ‡è®°ï¼š" class="headerlink" title="åˆå§‹æ ‡è®°ï¼š"></a>åˆå§‹æ ‡è®°ï¼š</h4><p>æ ‡è®° GC Roots èƒ½ç›´æ¥åˆ°çš„å¯¹è±¡ã€‚é€Ÿåº¦å¾ˆå¿«ä½†æ˜¯ä»å­˜åœ¨ Stop The World é—®é¢˜ã€‚</p><h4 id="å¹¶å‘æ ‡è®°ï¼š"><a href="#å¹¶å‘æ ‡è®°ï¼š" class="headerlink" title="å¹¶å‘æ ‡è®°ï¼š"></a>å¹¶å‘æ ‡è®°ï¼š</h4><p>å¹¶å‘æ ‡è®°é˜¶æ®µå°±æ˜¯ä»GC Rootsçš„ç›´æ¥å…³è”å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡å›¾çš„è¿‡ç¨‹ï¼Œ è¿™ä¸ªè¿‡ç¨‹è€—æ—¶è¾ƒé•¿ä½†æ˜¯ä¸éœ€è¦åœé¡¿ç”¨æˆ·çº¿ç¨‹ï¼Œ å¯ä»¥ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸€èµ·å¹¶å‘è¿è¡Œ  ã€‚</p><h4 id="é‡æ–°æ ‡è®°ï¼š"><a href="#é‡æ–°æ ‡è®°ï¼š" class="headerlink" title="é‡æ–°æ ‡è®°ï¼š"></a>é‡æ–°æ ‡è®°ï¼š</h4><p>ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ã€‚ä»ç„¶å­˜åœ¨ Stop The World é—®é¢˜ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´é€šå¸¸ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µç¨é•¿ä¸€äº›ï¼Œ ä½†ä¹Ÿè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µçš„æ—¶é—´çŸ­ã€‚</p><h4 id="å¹¶å‘æ¸…é™¤ï¼š"><a href="#å¹¶å‘æ¸…é™¤ï¼š" class="headerlink" title="å¹¶å‘æ¸…é™¤ï¼š"></a>å¹¶å‘æ¸…é™¤ï¼š</h4><p>å¹¶å‘æ¸…é™¤é˜¶æ®µï¼Œ æ¸…ç†åˆ é™¤æ‰æ ‡è®°é˜¶æ®µåˆ¤æ–­çš„å·²ç»æ­»äº¡çš„å¯¹è±¡ï¼Œ ç”±äºä¸éœ€è¦ç§»åŠ¨å­˜æ´»å¯¹è±¡ï¼Œ æ‰€ä»¥è¿™ä¸ªé˜¶æ®µä¹Ÿæ˜¯å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å¹¶å‘çš„ </p><h3 id="æµ®åŠ¨åƒåœ¾ï¼š"><a href="#æµ®åŠ¨åƒåœ¾ï¼š" class="headerlink" title="æµ®åŠ¨åƒåœ¾ï¼š"></a>æµ®åŠ¨åƒåœ¾ï¼š</h3><p>åœ¨CMSçš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…ç†é˜¶æ®µï¼Œ ç”¨æˆ·çº¿ç¨‹æ˜¯è¿˜åœ¨ç»§ç»­è¿è¡Œçš„ï¼Œ ç¨‹åºåœ¨è¿è¡Œè‡ªç„¶å°±è¿˜ä¼šä¼´éšæœ‰æ–°çš„åƒåœ¾å¯¹è±¡ä¸æ–­äº§ç”Ÿï¼Œ ä½†è¿™ä¸€éƒ¨åˆ†åƒåœ¾å¯¹è±¡æ˜¯å‡ºç°åœ¨æ ‡è®°è¿‡ç¨‹ç»“æŸä»¥åï¼Œ CMSæ— æ³•åœ¨å½“æ¬¡æ”¶é›†ä¸­å¤„ç†æ‰å®ƒä»¬ï¼Œ åªå¥½ç•™å¾…ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†æ—¶å†æ¸…ç†æ‰ã€‚ è¿™ä¸€éƒ¨åˆ†åƒåœ¾å°±ç§°ä¸ºâ€œæµ®åŠ¨åƒåœ¾â€ã€‚ </p><h3 id="å¹¶å‘å¤±è´¥ï¼š"><a href="#å¹¶å‘å¤±è´¥ï¼š" class="headerlink" title="å¹¶å‘å¤±è´¥ï¼š"></a>å¹¶å‘å¤±è´¥ï¼š</h3><h4 id="æµ®åŠ¨åƒåœ¾è¿‡å¤šï¼š"><a href="#æµ®åŠ¨åƒåœ¾è¿‡å¤šï¼š" class="headerlink" title="æµ®åŠ¨åƒåœ¾è¿‡å¤šï¼š"></a>æµ®åŠ¨åƒåœ¾è¿‡å¤šï¼š</h4><p>å¦‚æœå½“ç”¨æˆ·éœ€è¦å­˜å…¥ä¸€ä¸ªå¾ˆå¤§çš„å¯¹è±¡æ—¶ï¼Œæ–°ç”Ÿä»£æ”¾ä¸ä¸‹å»ï¼Œè€å¹´ä»£ç”±äºæµ®åŠ¨åƒåœ¾è¿‡å¤šï¼Œå°±ä¼šé€€åŒ–ä¸º serial Old æ”¶é›†å™¨ï¼Œå°†è€å¹´ä»£åƒåœ¾è¿›è¡Œæ ‡è®°-æ•´ç†ï¼Œå¾ˆè€—è´¹æ—¶é—´ï¼Œæœ¬æ¥æ˜¯å“åº”ä¼˜å…ˆçš„åƒåœ¾å›æ”¶å™¨ï¼Œå“åº”æ—¶é—´å˜å¾—æ›´é•¿äº†ï¼Œè¿™ä¹Ÿæ˜¯CMSå­˜åœ¨çš„é—®é¢˜ã€‚</p><h4 id="å†…å­˜ç¢ç‰‡è¿‡å¤šï¼š"><a href="#å†…å­˜ç¢ç‰‡è¿‡å¤šï¼š" class="headerlink" title="å†…å­˜ç¢ç‰‡è¿‡å¤šï¼š"></a>å†…å­˜ç¢ç‰‡è¿‡å¤šï¼š</h4><p>CMSæ˜¯ä¸€æ¬¾åŸºäºâ€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œ è¿™æ„å‘³ç€æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿã€‚ ç©ºé—´ç¢ç‰‡è¿‡å¤šæ—¶ï¼Œ å°†ä¼šç»™å¤§å¯¹è±¡åˆ†é…å¸¦æ¥å¾ˆå¤§éº»çƒ¦ï¼Œ å¾€å¾€ä¼šå‡ºç°è€å¹´ä»£è¿˜æœ‰å¾ˆå¤šå‰©ä½™ç©ºé—´ï¼Œ ä½†å°±æ˜¯æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ï¼Œ è€Œä¸å¾—ä¸æå‰è§¦å‘ä¸€æ¬¡Full GCçš„æƒ…å†µã€‚ é€€åŒ–ä¸ºSerialOldï¼Œè¿›è¡Œæ ‡è®°æ•´ç†ï¼Œå¾ˆè€—è´¹æ—¶é—´ï¼Œæœ¬æ¥æ˜¯å“åº”ä¼˜å…ˆçš„åƒåœ¾å›æ”¶å™¨ï¼Œå“åº”æ—¶é—´å˜å¾—æ›´é•¿äº†ï¼Œè¿™ä¹Ÿæ˜¯CMSå­˜åœ¨çš„é—®é¢˜ã€‚</p><p>ç”±äºåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤é˜¶æ®µä¸­ï¼Œ åƒåœ¾æ”¶é›†å™¨çº¿ç¨‹éƒ½å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œ æ‰€ä»¥ä»æ€»ä½“ä¸Šæ¥è¯´ï¼Œ CMSæ”¶é›†å™¨çš„å†…å­˜å›æ”¶è¿‡ç¨‹æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å¹¶å‘æ‰§è¡Œçš„ã€‚  </p><h2 id="G1"><a href="#G1" class="headerlink" title="G1"></a>G1</h2><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706410637194-2dbc95a7-b84c-402d-874b-57919eb1efd7.png#averageHue=%23f9f9f8&clientId=ub86ce6bc-f0e5-4&from=paste&height=668&id=u7218fd82&originHeight=1336&originWidth=1768&originalType=binary&ratio=2&rotation=0&showTitle=false&size=544533&status=done&style=none&taskId=ufe5e1cb2-722f-4b3f-bc4b-a6f653613a2&title=&width=884" alt="image.png"><br><strong>ç›¸å…³å‚æ•°</strong>ï¼šJDK8 å¹¶ä¸æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œéœ€è¦å‚æ•°å¼€å¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// G1å¼€å…³</span></span><br><span class="line">-XX:+UseG1GC</span><br><span class="line"><span class="comment">// æ‰€åˆ’åˆ†çš„æ¯ä¸ªå †å†…å­˜å¤§å°ï¼š</span></span><br><span class="line">-XX:G1HeapRegionSize=size</span><br><span class="line"><span class="comment">// åƒåœ¾å›æ”¶æœ€å¤§åœé¡¿æ—¶é—´</span></span><br><span class="line">-XX:MaxGCPauseMillis=time</span><br></pre></td></tr></table></figure><h3 id="å›æ”¶é˜¶æ®µ"><a href="#å›æ”¶é˜¶æ®µ" class="headerlink" title="å›æ”¶é˜¶æ®µ"></a>å›æ”¶é˜¶æ®µ</h3><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706410858075-d732e623-989c-4cc7-8178-1b6b1c57cd1b.png#averageHue=%23faf8f4&clientId=ub86ce6bc-f0e5-4&from=paste&height=548&id=u5ca16fdb&originHeight=1096&originWidth=1560&originalType=binary&ratio=2&rotation=0&showTitle=false&size=379155&status=done&style=none&taskId=ud0fa9d8a-81b3-498e-a14f-4875a606ea3&title=&width=780" alt="image.png"><br><strong>æ–°ç”Ÿä»£ä¼Šç”¸å›­åƒåœ¾å›æ”¶</strong>â€”â€“&gt;<strong>å†…å­˜ä¸è¶³ï¼Œæ–°ç”Ÿä»£å›æ”¶+å¹¶å‘æ ‡è®°</strong>â€”â€“&gt;<strong>å›æ”¶æ–°ç”Ÿä»£ä¼Šç”¸å›­ã€å¹¸å­˜åŒºã€è€å¹´ä»£å†…å­˜</strong>â€”â€”&gt;<strong>æ–°ç”Ÿä»£ä¼Šç”¸å›­åƒåœ¾å›æ”¶</strong>(é‡æ–°å¼€å§‹)ã€‚</p><h3 id="Young-Collection-CM"><a href="#Young-Collection-CM" class="headerlink" title="Young Collection + CM"></a>Young Collection + CM</h3><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706426885157-a745faef-0948-4621-b83d-0196c3b9fa80.png#averageHue=%23f2efec&clientId=u27dd8642-2384-4&from=paste&height=686&id=ud84899dd&originHeight=1372&originWidth=1934&originalType=binary&ratio=2&rotation=0&showTitle=false&size=472988&status=done&style=none&taskId=u3c3bd328-bfb4-45ed-87d2-3a283a1a749&title=&width=967" alt="image.png"></p><h3 id="Mixed-Collection"><a href="#Mixed-Collection" class="headerlink" title="Mixed Collection"></a>Mixed Collection</h3><p>ä¼šå¯¹Eã€S ã€O è¿›è¡Œ<strong>å…¨é¢çš„å›æ”¶</strong>ã€‚</p><ul><li>æœ€ç»ˆæ ‡è®°</li><li><strong>æ‹·è´</strong>å­˜æ´»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  ç”¨äºæŒ‡å®šGCæœ€é•¿çš„åœé¡¿æ—¶é—´</span></span><br><span class="line">-XX:MaxGCPauseMillis=ms</span><br></pre></td></tr></table></figure><p><strong>é—®</strong>ï¼šä¸ºä»€ä¹ˆæœ‰çš„è€å¹´ä»£è¢«æ‹·è´äº†ï¼Œæœ‰çš„æ²¡æ‹·è´ï¼Ÿ<br>å› ä¸ºæŒ‡å®šäº†æœ€å¤§åœé¡¿æ—¶é—´ï¼Œå¦‚æœå¯¹æ‰€æœ‰è€å¹´ä»£éƒ½è¿›è¡Œå›æ”¶ï¼Œè€—æ—¶å¯èƒ½è¿‡é«˜ã€‚ä¸ºäº†ä¿è¯æ—¶é—´ä¸è¶…è¿‡è®¾å®šçš„æœ€å¤§åœé¡¿æ—¶é—´ï¼Œä¼šæ ¹æ®æœ€å¤§åœé¡¿æ—¶é—´ï¼Œæœ‰é€‰æ‹©çš„<strong>å›æ”¶æœ€æœ‰ä»·å€¼çš„è€å¹´ä»£</strong>ï¼ˆå›æ”¶åï¼Œèƒ½å¤Ÿå¾—åˆ°æ›´å¤šå†…å­˜ï¼‰ã€‚<br>G1åœ¨è€å¹´ä»£å†…å­˜ä¸è¶³æ—¶ï¼ˆè€å¹´ä»£æ‰€å å†…å­˜è¶…è¿‡é˜ˆå€¼ï¼‰ï¼š</p><ul><li>å¦‚æœåƒåœ¾äº§ç”Ÿé€Ÿåº¦æ…¢äºåƒåœ¾å›æ”¶é€Ÿåº¦ï¼Œä¸ä¼šè§¦å‘Full GCï¼Œè¿˜æ˜¯å¹¶å‘åœ°è¿›è¡Œæ¸…ç†ã€‚</li><li>å¦‚æœåƒåœ¾äº§ç”Ÿé€Ÿåº¦å¿«äºåƒåœ¾å›æ”¶é€Ÿåº¦ï¼Œä¾¿ä¼šè§¦å‘Full GCã€‚</li></ul><h3 id="FullGCæ¦‚å¿µè§£æ"><a href="#FullGCæ¦‚å¿µè§£æ" class="headerlink" title="FullGCæ¦‚å¿µè§£æ"></a>FullGCæ¦‚å¿µè§£æ</h3><p><strong>SerialGC</strong><br>æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - minor gc<br>è€å¹´ä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - full gc<br><strong>ParallelGC</strong><br>æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - minor gc<br>è€å¹´ä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - full gc<br><strong>CMS</strong><br>æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - minor gc<br>è€å¹´ä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›†ï¼Œéœ€è¦åˆ†2ç§æƒ…å†µï¼Œè¿™é‡Œä¸åšè¯¦ç»†ä»‹ç»<br><strong>G1</strong><br>æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›† - minor gc<br>è€å¹´ä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åƒåœ¾æ”¶é›†ï¼Œéœ€è¦åˆ†2ç§æƒ…å†µï¼Œè¿™é‡Œä¸åšè¯¦ç»†ä»‹ç»</p>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt;&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt;

&lt;h1 id=&quot;å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯å›æ”¶&quot;&gt;&lt;a href=&quot;#å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯å›æ”¶&quot; class=</summary>
      
    
    
    
    <category term="JVM" scheme="https://axdmdyj.github.io/categories/JVM/"/>
    
    
    <category term="JVM" scheme="https://axdmdyj.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>JVMå†…å­˜ç»“æ„</title>
    <link href="https://axdmdyj.github.io/posts/e614237b.html"/>
    <id>https://axdmdyj.github.io/posts/e614237b.html</id>
    <published>2024-01-26T15:55:52.000Z</published>
    <updated>2024-01-26T15:58:26.717Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h1><h2 id="ç¨‹åºè®¡æ•°å™¨ä½œç”¨"><a href="#ç¨‹åºè®¡æ•°å™¨ä½œç”¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨ä½œç”¨"></a>ç¨‹åºè®¡æ•°å™¨ä½œç”¨</h2><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706068166843-cbd811f0-fbc1-4e3a-9098-49bd82b4859f.png#averageHue=%23f6f5f4&clientId=ubb321bbb-5d23-4&from=paste&height=604&id=u1ce3a504&originHeight=1208&originWidth=2710&originalType=binary&ratio=2&rotation=0&showTitle=false&size=857500&status=done&style=none&taskId=u26e39ae6-aeb9-4ab2-837b-0d869bc92dc&title=&width=1355" alt="image.png"></p><h2 id="ç¨‹åºè®¡æ•°å™¨ç‰¹ç‚¹"><a href="#ç¨‹åºè®¡æ•°å™¨ç‰¹ç‚¹" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨ç‰¹ç‚¹"></a>ç¨‹åºè®¡æ•°å™¨ç‰¹ç‚¹</h2><p>ä¼šé€šè¿‡è®¡æ•°å™¨æ¥è®°å½•çº¿ç¨‹å·²ç»æ‰§è¡Œçš„ä½ç½®ã€‚<br>åŠ å…¥çº¿ç¨‹1æ‰§è¡Œåˆ°10çš„æ—¶å€™ï¼Œcpuæ—¶é—´ç‰‡è¢«çº¿ç¨‹2æŠ¢èµ°äº†ï¼Œé‚£ä¹ˆå½“ç¨‹åºè®¡æ•°å™¨å°±ä¼šè®°å½•çº¿ç¨‹1ç°åœ¨æ‰§è¡Œåˆ°äº†10ï¼Œå½“çº¿ç¨‹2æ‰§è¡Œå®Œäº†ï¼Œå°±åˆ‡æ¢å›é“çº¿ç¨‹1çš„10ä½ç½®ç»§ç»­æ‰§è¡Œã€‚<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706068507034-9d51f170-0fa5-4f27-a4f8-a0cb7799e246.png#averageHue=%23fcfbfa&clientId=ubb321bbb-5d23-4&from=paste&height=623&id=u1e352509&originHeight=1246&originWidth=2306&originalType=binary&ratio=2&rotation=0&showTitle=false&size=626019&status=done&style=none&taskId=u6d61bb48-f6d2-4ffc-beb3-b2448fbdac9&title=&width=1153" alt="image.png"></p><ul><li>æ˜¯çº¿ç¨‹ç§æœ‰çš„</li><li>ä¸ä¼šå­˜åœ¨å†…å­˜æº¢å‡º</li></ul><h1 id="æ ˆ"><a href="#æ ˆ" class="headerlink" title="æ ˆ"></a>æ ˆ</h1><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706068849024-af493dac-e10e-4ca3-9a3c-86d0ce525bbf.png#averageHue=%23e2dfd8&clientId=ubb321bbb-5d23-4&from=paste&height=184&id=ue10ac1ae&originHeight=368&originWidth=1636&originalType=binary&ratio=2&rotation=0&showTitle=false&size=332469&status=done&style=none&taskId=u9e0cf4fa-2e21-4828-8d3e-63d77e83bfa&title=&width=818" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2024/jpeg/38717174/1706069201893-7df9fbfe-8a9e-43ad-8740-096786c993e3.jpeg"><br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706068791865-23031138-06fe-45d1-9edc-bf3f30ee7cad.png#averageHue=%23fbfbfb&clientId=ubb321bbb-5d23-4&from=paste&height=516&id=u35efbc41&originHeight=1032&originWidth=1984&originalType=binary&ratio=2&rotation=0&showTitle=false&size=290459&status=done&style=none&taskId=ud43319b0-6887-415b-a60d-3d401963780&title=&width=992" alt="image.png"></p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><ol><li>åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠæ ˆå†…å­˜ï¼Ÿ</li></ol><p>ä¸æ¶‰åŠï¼Œå› ä¸ºæ–¹æ³•æ‰§è¡Œå®Œä¹‹åï¼Œå¯¹åº”çš„æ ˆå¸§å°±ä¼šè‡ªå·±å¼¹å‡ºå›æ”¶ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œåƒåœ¾å›æ”¶æœºåˆ¶ã€‚åƒåœ¾å›æ”¶ä¸€èˆ¬æ˜¯å¯¹å †å†…å­˜çš„å¤„ç†</p><ol start="2"><li>æ ˆåˆ†é…å†…å­˜è¶Šå¤§è¶Šå¥½å˜›ï¼Ÿ</li></ol><p>å¹¶ä¸æ˜¯ï¼Œå› ä¸ºå†…å­˜æ˜¯å›ºå®šçš„ï¼Œå¸§åˆ†é…å†…å­˜çš„å¢å¤šï¼Œä¹Ÿä»£è¡¨ç€çº¿ç¨‹å æœ‰çš„å†…å­˜å°±å‡å°‘ï¼Œçº¿ç¨‹æ•°é‡å‡å°‘ï¼Œä¹Ÿä¼šå‡å°‘ä¸€å®šçš„æ€§èƒ½ã€‚</p><ol start="3"><li>æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ</li></ol><p>éœ€è¦çœ‹å˜é‡æ˜¯å¦æ˜¯çº¿ç¨‹å…±äº«çš„ã€‚è¿˜è¦çœ‹æ˜¯å¦é€ƒç¦»æ–¹æ³•ä½œç”¨èŒƒå›´ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706071725265-0270b390-e87a-4930-9f05-a97b160497b7.png#averageHue=%23f7f4e5&clientId=u31b1620a-440f-4&from=paste&height=153&id=u506c9ea9&originHeight=306&originWidth=1354&originalType=binary&ratio=2&rotation=0&showTitle=false&size=130279&status=done&style=none&taskId=ucfd68fec-9ab2-4da8-86f1-e509ba7a661&title=&width=677" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706069846402-38a6c6b0-0404-4468-8641-5df5dbdb4360.png#averageHue=%23fafafa&clientId=u31b1620a-440f-4&from=paste&height=513&id=ud4fc194c&originHeight=1026&originWidth=1992&originalType=binary&ratio=2&rotation=0&showTitle=false&size=221425&status=done&style=none&taskId=ubf517727-b321-4d5a-aa52-0523f850644&title=&width=996" alt="image.png"></p><h2 id="æ ˆå†…å­˜æº¢å‡º"><a href="#æ ˆå†…å­˜æº¢å‡º" class="headerlink" title="æ ˆå†…å­˜æº¢å‡º"></a>æ ˆå†…å­˜æº¢å‡º</h2><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706080173901-24b69618-3a90-4bf4-ad4a-f05a307a7315.png#averageHue=%23f8f8f7&clientId=u31b1620a-440f-4&from=paste&height=508&id=u4a8690e9&originHeight=1016&originWidth=824&originalType=binary&ratio=2&rotation=0&showTitle=false&size=189249&status=done&style=none&taskId=u712fba70-5fb7-4f6d-84d9-883189ac550&title=&width=412" alt="image.png"></p><ul><li>æ–¹æ³•é€’å½’è°ƒç”¨å¯èƒ½ä¼šé€ æˆæ ˆå†…å­˜æº¢å‡ºï¼Œæ¯”å¦‚æ— é™é€’å½’ã€‚</li></ul><h2 id="çº¿ç¨‹è¯Šæ–­"><a href="#çº¿ç¨‹è¯Šæ–­" class="headerlink" title="çº¿ç¨‹è¯Šæ–­"></a>çº¿ç¨‹è¯Šæ–­</h2><h3 id="CPUå å ç”¨è¿‡å¤š"><a href="#CPUå å ç”¨è¿‡å¤š" class="headerlink" title="CPUå å ç”¨è¿‡å¤š"></a>CPUå å ç”¨è¿‡å¤š</h3><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706167252300-451dad54-a3a3-44ad-a119-32e94568d6a6.png#averageHue=%23000000&clientId=u1de935df-8cd2-4&from=paste&height=78&id=u4fbef33c&originHeight=172&originWidth=1968&originalType=binary&ratio=2.200000047683716&rotation=0&showTitle=false&size=38601&status=done&style=none&taskId=u46abd4f4-0517-41d0-8e46-a7ac3203c25&title=&width=894.5454351567045" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706167298278-43ef52bc-f91a-4f7b-bbea-2956c6317cd5.png#averageHue=%2397958c&clientId=u1de935df-8cd2-4&from=paste&height=96&id=uc1de3923&originHeight=212&originWidth=1982&originalType=binary&ratio=2.200000047683716&rotation=0&showTitle=false&size=246888&status=done&style=none&taskId=u765c10d4-3ffd-4e36-87c2-81711d97423&title=&width=900.9090713824127" alt="image.png"><br>ä½†åªèƒ½æŸ¥çœ‹ç¼–å·ã€‚<br>å®šä½åˆ°å…·ä½“çš„çº¿ç¨‹<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706167387393-72b1f6f0-a593-43d4-969a-1e6e4dfcf9b1.png#averageHue=%23030303&clientId=u1de935df-8cd2-4&from=paste&height=313&id=Mt9F8&originHeight=688&originWidth=1972&originalType=binary&ratio=2.200000047683716&rotation=0&showTitle=false&size=395776&status=done&style=none&taskId=u21508314-d4a5-4661-a2f3-e539d0f7d75&title=&width=896.3636169354781" alt="image.png"><br>é€šè¿‡jstack,å±•ç¤ºå…·ä½“çš„çº¿ç¨‹ã€‚<br>é€šè¿‡çº¿ç¨‹idæ‰¾åˆ°æœ‰é—®é¢˜çš„çº¿ç¨‹ï¼Œç„¶åè¿›å…¥åˆ°é—®é¢˜ä»£ç çš„æºç è¡Œæ•°ã€‚</p><blockquote><p>æ³¨æ„ï¼š éœ€è¦å°†ä¸Šé¢æ“ä½œæŸ¥åˆ°çš„ç¼–å·è½¬åŒ–ä¸º16è¿›åˆ¶ï¼Œè¿›è€ŒæŸ¥æ‰¾åˆ°æœ‰é—®é¢˜çš„çº¿ç¨‹ã€‚<br>jstack ã€è¿›ç¨‹idã€‘ï¼š</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706167818182-03f35511-b555-407f-9e17-62aa41c81700.png#averageHue=%23615a51&clientId=u1de935df-8cd2-4&from=paste&height=400&id=u31352e6f&originHeight=880&originWidth=2812&originalType=binary&ratio=2.200000047683716&rotation=0&showTitle=false&size=1045051&status=done&style=none&taskId=uabba7dc3-c3e1-4b67-9afe-e6e5fff65f6&title=&width=1278.181790477974" alt="image.png"></p><h3 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h3><p>é€šè¿‡jstack è¿›ç¨‹å·<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706168213873-47fdd144-3cc8-47f9-b8cb-2271bcbed257.png#averageHue=%235d554c&clientId=u1de935df-8cd2-4&from=paste&height=529&id=u91f6d248&originHeight=1164&originWidth=2396&originalType=binary&ratio=2.200000047683716&rotation=0&showTitle=false&size=1164260&status=done&style=none&taskId=u8817d1b5-6b16-41f8-9df3-9b30214f32a&title=&width=1089.0908854855" alt="image.png"><br>æ’æŸ¥æ­»é”é—®é¢˜ã€‚</p><h1 id="æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h1><p>nativeæ–¹æ³•ï¼Œç”±Cè¯­è¨€å®ç°ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706080927259-a02dbe3b-0a81-41cd-855c-54ff8b12f893.png#averageHue=%23e3e5bb&clientId=u31b1620a-440f-4&from=paste&height=619&id=u16c6b193&originHeight=1238&originWidth=2122&originalType=binary&ratio=2&rotation=0&showTitle=false&size=608129&status=done&style=none&taskId=u85466131-ecbf-4a0c-9c31-79aa2abbbe8&title=&width=1061" alt="image.png"></p><h1 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h1><h2 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706081006420-8ef6d956-28c9-4246-9250-aa8d6fb83700.png#averageHue=%23fafaf9&clientId=u31b1620a-440f-4&from=paste&height=262&id=u209252e8&originHeight=524&originWidth=1162&originalType=binary&ratio=2&rotation=0&showTitle=false&size=205511&status=done&style=none&taskId=u2f1cbeca-1dff-4c9e-8a46-c29e2e235d0&title=&width=581" alt="image.png"><br> <img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706168543664-9e9d9da2-7137-4830-8bcc-3f99fff5a094.png#averageHue=%23f6f4e7&clientId=u1de935df-8cd2-4&from=paste&height=218&id=udc6d6332&originHeight=480&originWidth=1648&originalType=binary&ratio=2.200000047683716&rotation=0&showTitle=false&size=241833&status=done&style=none&taskId=u55731055-3e36-413a-a254-6bb3e396372&title=&width=749.0908928548013" alt="image.png"><br>è‡ªå®šä¹‰å†…å­˜å¤§å°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//é™åˆ¶</span><br><span class="line"> é™åˆ¶ï¼š-Xms  è§„å®šçš„ç©ºé—´å¤§å°</span><br></pre></td></tr></table></figure><h2 id="å †å†…å­˜è¯Šæ–­"><a href="#å †å†…å­˜è¯Šæ–­" class="headerlink" title="å †å†…å­˜è¯Šæ–­"></a>å †å†…å­˜è¯Šæ–­</h2><ol><li><strong>jps å·¥å…·</strong>æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æœ‰å“ªäº› java è¿›ç¨‹</li><li><strong>jmap å·¥å…·</strong>æŸ¥çœ‹å †å†…å­˜å ç”¨æƒ…å†µ jmap - heap è¿›ç¨‹id</li><li><strong>jconsole å·¥å…·</strong>å›¾å½¢ç•Œé¢çš„ï¼Œå¤šåŠŸèƒ½çš„ç›‘æµ‹å·¥å…·ï¼Œå¯ä»¥è¿ç»­ç›‘æµ‹</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706169692583-4db72f45-c9d2-4e5d-8ab1-4005d723bdb5.png#averageHue=%23fafaf9&clientId=u1de935df-8cd2-4&from=paste&height=299&id=u0d0a30f7&originHeight=658&originWidth=1184&originalType=binary&ratio=2.200000047683716&rotation=0&showTitle=false&size=356227&status=done&style=none&taskId=uc3a5f5e8-731b-4eeb-ac1e-a1334cf88ce&title=&width=538.1818065170417" alt="image.png"></p><h1 id="æ–¹æ³•åŒº"><a href="#æ–¹æ³•åŒº" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h1><h2 id="å®šä¹‰-2"><a href="#å®šä¹‰-2" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>æ–¹æ³•åŒºæ˜¯å„ä¸ª<strong>çº¿ç¨‹å…±äº«</strong>çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯(æ¯”å¦‚classæ–‡ä»¶)ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚ï¼ˆä»€ä¹ˆæ˜¯ç±»ä¿¡æ¯ï¼š<strong>ç±»ç‰ˆæœ¬å·ã€æ–¹æ³•ã€æ¥å£</strong>ã€‚ï¼‰<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706171339614-3e0df9b8-47ad-4cb6-9924-cafece6a3295.png#averageHue=%23e8f1c1&clientId=u1de935df-8cd2-4&from=paste&height=366&id=u5bfb1624&originHeight=806&originWidth=1232&originalType=binary&ratio=2.200000047683716&rotation=0&showTitle=false&size=246267&status=done&style=none&taskId=u7a7a9d8c-9ca2-4fdb-bef2-b2a6bb9758e&title=&width=559.9999878623271" alt="image.png"></p><h2 id="æ–¹æ³•åŒºå†…å­˜æº¢å‡º"><a href="#æ–¹æ³•åŒºå†…å­˜æº¢å‡º" class="headerlink" title="æ–¹æ³•åŒºå†…å­˜æº¢å‡º"></a>æ–¹æ³•åŒºå†…å­˜æº¢å‡º</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:MaxMetaspaceSize=1m</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodOverFlow</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;<span class="comment">//å¯ä»¥ç”¨æ¥åŠ è½½ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚ç </span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">MethodOverFlow</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodOverFlow</span>();</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++,j++) &#123;</span><br><span class="line">                    <span class="comment">//ClassWriter ä½œç”¨æ˜¯ç”Ÿäº§ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚ç </span></span><br><span class="line">                    <span class="type">ClassWriter</span> <span class="variable">cw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassWriter</span>(<span class="number">0</span>);</span><br><span class="line">                    <span class="comment">//ç‰ˆæœ¬å·ï¼Œpublicï¼Œç±»å</span></span><br><span class="line">                    cw.visit(Opcodes.V1_8, Opcodes.ACC_PUBLIC, <span class="string">&quot;Class&quot;</span> + i, <span class="literal">null</span>, <span class="string">&quot;java/lang/Object&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">//è¿”å› byte[]</span></span><br><span class="line">                    <span class="type">byte</span>[] code = cw.toByteArray();</span><br><span class="line">                    <span class="comment">//æ‰§è¡Œç±»çš„åŠ è½½</span></span><br><span class="line">                    test.defineClass(<span class="string">&quot;Class&quot;</span> + i, code, <span class="number">0</span>, code.length);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                System.out.println(j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åœºæ™¯ï¼š<br>Spring<br>Mabatis</p><h2 id="å¸¸é‡æ± "><a href="#å¸¸é‡æ± " class="headerlink" title="å¸¸é‡æ± "></a>å¸¸é‡æ± </h2><p>å­¦ä¼šé˜…è¯»åç¼–è¯‘çš„å­—å­—èŠ‚ç ä¸åœ¨å¸¸é‡æ± çš„å¯¹åº”å…³ç³»ã€‚</p><h2 id="StringTable"><a href="#StringTable" class="headerlink" title="StringTable"></a>StringTable</h2><h3 id="ç†è§£"><a href="#ç†è§£" class="headerlink" title="ç†è§£"></a>ç†è§£</h3><p>å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ä»…æ˜¯ç¬¦å·ï¼Œåªæœ‰åœ¨è¢«ç”¨åˆ°æ—¶æ‰ä¼šè½¬åŒ–ä¸ºå¯¹è±¡<br>åˆ©ç”¨ä¸²æ± çš„æœºåˆ¶ï¼Œæ¥é¿å…é‡å¤åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡<br><strong>å­—ç¬¦ä¸²å˜é‡æ‹¼æ¥çš„åŸç†æ˜¯StringBuilder</strong><br><strong>å­—ç¬¦ä¸²å¸¸é‡æ‹¼æ¥çš„åŸç†æ˜¯ç¼–è¯‘å™¨ä¼˜åŒ–</strong><br><strong>å¯ä»¥ä½¿ç”¨internæ–¹æ³•ï¼Œä¸»åŠ¨å°†ä¸²æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥ä¸²æ± ä¸­</strong><br>1.8 å°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ï¼Œå¦‚æœæœ‰åˆ™å¹¶ä¸ä¼šæ”¾å…¥ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ”¾å…¥ä¸²æ± ï¼Œä¼šæŠŠä¸²æ± ä¸­çš„å¯¹è±¡è¿”å›<br>1.6 å°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ï¼Œå¦‚æœæœ‰åˆ™å¹¶ä¸ä¼šæ”¾å…¥ï¼Œå¦‚æœæ²¡æœ‰ä¼šæŠŠæ­¤å¯¹è±¡å¤åˆ¶ä¸€ä»½ï¼Œæ”¾å…¥ä¸²æ± ï¼Œä¼šæŠŠä¸²æ± ä¸­çš„å¯¹è±¡è¿”å›<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706179848133-12b0a2f5-5396-42bc-abc4-de92d9c118f2.png#averageHue=%23faf9f8&clientId=ubf022d95-0954-4&from=paste&height=576&id=u8cacca97&originHeight=1268&originWidth=1828&originalType=binary&ratio=2.200000047683716&rotation=0&showTitle=false&size=583009&status=done&style=none&taskId=ue49c3e37-4fe6-45b5-8551-37c0797a8f1&title=&width=830.9090728996217" alt="image.png"><br>å…ˆåˆ°ä¸²æ± æ‰¾ï¼Œæ‰¾åˆ°äº†å°±ä¸åˆ›å»ºäº†ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706180110018-ca780935-9ac1-42cd-bde3-5a2bd5366c4f.png#averageHue=%23fbfbfa&clientId=ubf022d95-0954-4&from=paste&height=560&id=u0f191c65&originHeight=1232&originWidth=2602&originalType=binary&ratio=2.200000047683716&rotation=0&showTitle=false&size=730159&status=done&style=none&taskId=ub3ea0cf1-0c1e-4c50-8e15-b1072eb4cc2&title=&width=1182.7272470923501" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706180368897-e61b89f2-211b-4b04-8280-ff356905d069.png#averageHue=%23fcfbf9&clientId=ubf022d95-0954-4&from=paste&height=230&id=u691d4ea0&originHeight=506&originWidth=2588&originalType=binary&ratio=2.200000047683716&rotation=0&showTitle=false&size=286843&status=done&style=none&taskId=u57683fea-a763-42af-baa2-6bce12d8509&title=&width=1176.3636108666417" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706180510319-6b0ce27f-ee0b-4c8c-8dea-8a40c536318d.png#averageHue=%23f3f1e9&clientId=ubf022d95-0954-4&from=paste&height=491&id=u51e85250&originHeight=1080&originWidth=2756&originalType=binary&ratio=2.200000047683716&rotation=0&showTitle=false&size=670056&status=done&style=none&taskId=uefde02df-f82d-4e52-b565-5ee9f18b99d&title=&width=1252.7272455751408" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706195341809-a1ad57f3-9089-476b-910d-edbfe77aec97.png#averageHue=%23f8f7ec&clientId=u515cb933-7cc6-4&from=paste&height=223&id=uf0022656&originHeight=446&originWidth=2190&originalType=binary&ratio=2&rotation=0&showTitle=false&size=343977&status=done&style=none&taskId=u68116973-0802-4c04-bcbc-04dc3870c16&title=&width=1095" alt="image.png"><br>é¢è¯•é—®ç±»ä¼¼çš„è¯å°±æ¯”è¾ƒå®åœ¨å †åŒºè¿˜æ˜¯åœ¨ä¸²æ± ä¸­ã€‚<br>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ£€éªŒè‡ªå·±ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706195621110-c6928310-f606-4f20-b1d0-f4334e89bb82.png#averageHue=%23fcfbfb&clientId=u515cb933-7cc6-4&from=paste&height=405&id=u5989f7a4&originHeight=810&originWidth=2140&originalType=binary&ratio=2&rotation=0&showTitle=false&size=440100&status=done&style=none&taskId=u29bee30c-7bb5-4f72-bce1-1788ec8f1ea&title=&width=1070" alt="image.png"></p><h3 id="StringTable-ä½ç½®"><a href="#StringTable-ä½ç½®" class="headerlink" title="StringTable ä½ç½®"></a>StringTable ä½ç½®</h3><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706197911734-d199a8c1-10e9-4471-ac10-df2007945a32.png#averageHue=%23e9f1c4&clientId=uc914b68f-3c65-4&from=paste&height=688&id=u1927b1ba&originHeight=1376&originWidth=2260&originalType=binary&ratio=2&rotation=0&showTitle=false&size=452452&status=done&style=none&taskId=u4e29a2ec-2027-4a86-902d-6e4ba7beee2&title=&width=1130" alt="image.png"></p><ul><li>ä¸ºä»€ä¹ˆéœ€è¦metaspaceï¼Ÿ</li></ul><p>å› ä¸ºæ°¸ä¹…ä»£çš„å›æ”¶æ•ˆç‡ä¸é«˜ï¼Œå¦‚æœäº§ç”Ÿå¤ªå¤šçš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œå¯èƒ½å°±ä¼šå‡ºç°å†…å­˜ä¸è¶³çš„æƒ…å†µã€‚<br>è€Œåœ¨1.8,StringTableåœ¨å †ä¸­ï¼Œå¯ä»¥é€šè¿‡minorgcæ¥æé«˜å›æ”¶æ•ˆç‡ï¼Œé™ä½å†…å­˜ä¸è¶³çš„æ¦‚ç‡ã€‚</p><p>æ¡ˆä¾‹è¯æ˜ï¼›<br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706198156060-7a8da379-4e89-4f79-92c0-d34b4d5a12a5.png#averageHue=%23fafaf9&clientId=uc914b68f-3c65-4&from=paste&height=543&id=uaaac0896&originHeight=1086&originWidth=2646&originalType=binary&ratio=2&rotation=0&showTitle=false&size=826908&status=done&style=none&taskId=ub15b161e-4df9-4dc6-8627-9a3c58604c3&title=&width=1323" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706198356218-bc8256f0-7e2e-4a71-913c-e2b32e87c480.png#averageHue=%23f9f8f6&clientId=uc914b68f-3c65-4&from=paste&height=454&id=u3efc1940&originHeight=908&originWidth=2730&originalType=binary&ratio=2&rotation=0&showTitle=false&size=775095&status=done&style=none&taskId=u5f2a8059-2f34-4546-ba0a-776b7a5f9c6&title=&width=1365" alt="image.png"></p><h3 id="åƒåœ¾å›æ”¶æœºåˆ¶"><a href="#åƒåœ¾å›æ”¶æœºåˆ¶" class="headerlink" title="åƒåœ¾å›æ”¶æœºåˆ¶"></a>åƒåœ¾å›æ”¶æœºåˆ¶</h3><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706234647220-7cc2df98-1965-4e92-a14a-ac70b4907bcb.png#averageHue=%23f1f1f1&clientId=uc914b68f-3c65-4&from=paste&height=418&id=uaac15721&originHeight=836&originWidth=2144&originalType=binary&ratio=2&rotation=0&showTitle=false&size=405082&status=done&style=none&taskId=u18de8e93-3ccc-468e-ba02-20bca185527&title=&width=1072" alt="image.png"></p><ul><li>å¦‚æœéœ€è¦åŠ å…¥å¾ˆå¤šç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨internèƒ½å¤Ÿå¾ˆå¤§ç¨‹åº¦å‡å°‘å†…å­˜å ç”¨ç©ºé—´ã€‚</li></ul><h1 id="ç›´æ¥å†…å­˜"><a href="#ç›´æ¥å†…å­˜" class="headerlink" title="ç›´æ¥å†…å­˜"></a>ç›´æ¥å†…å­˜</h1><p>ä¸æ•°æ®Javaè™šæ‹Ÿæœºçš„å†…å­˜ç®¡ç†ï¼Œè€Œæ˜¯å±äºç³»ç»Ÿå†…å­˜ã€‚</p><ul><li>å±äºæ“ä½œç³»ç»Ÿï¼Œå¸¸è§äºNIOæ“ä½œæ—¶ï¼Œ<strong>ç”¨äºæ•°æ®ç¼“å†²åŒº</strong></li><li>åˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜ï¼Œä½†è¯»å†™æ€§èƒ½é«˜</li><li>ä¸å—JVMå†…å­˜å›æ”¶ç®¡ç†</li></ul><h3 id="æ¡ˆä¾‹æ¼”ç¤º"><a href="#æ¡ˆä¾‹æ¼”ç¤º" class="headerlink" title="æ¡ˆä¾‹æ¼”ç¤º"></a>æ¡ˆä¾‹æ¼”ç¤º</h3><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706235612677-d46dc5e4-7cd5-434b-88c4-ce7d41f4baaa.png#averageHue=%23eeede1&clientId=ue26e552d-4b6b-4&from=paste&height=538&id=u6942394a&originHeight=1076&originWidth=1554&originalType=binary&ratio=2&rotation=0&showTitle=false&size=753507&status=done&style=none&taskId=u01b78b50-534a-4ca1-b6f2-3c9bd05daa4&title=&width=777" alt="image.png"><br>å¾ˆæ˜æ˜¾directBufferç”¨æ—¶æ›´çŸ­ï¼Œæ•ˆç‡æ›´é«˜ã€‚<br>é‚£ä¹ˆä¸ºä»€ä¹ˆå‘¢ï¼Ÿåé¢ä¼šè®²</p><h3 id="ioå’Œdirectbuffer"><a href="#ioå’Œdirectbuffer" class="headerlink" title="ioå’Œdirectbuffer"></a>ioå’Œdirectbuffer</h3><ul><li>æ–‡ä»¶è¯»å†™æµç¨‹</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706235865500-c5724c71-b197-4feb-a3a4-42d15ed5588b.png#averageHue=%23eae9e5&clientId=ue26e552d-4b6b-4&from=paste&height=583&id=u038a2b19&originHeight=1166&originWidth=1866&originalType=binary&ratio=2&rotation=0&showTitle=false&size=353102&status=done&style=none&taskId=ube228090-155c-49d9-99a6-ff7fff6d756&title=&width=933" alt="image.png"></p><ul><li>ä½¿ç”¨DirectBuffer</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706235923694-f1d96a0b-1b70-46e3-8a3b-9a7d6f225bbb.png#averageHue=%23ededea&clientId=ue26e552d-4b6b-4&from=paste&height=622&id=ucbeaf507&originHeight=1244&originWidth=2070&originalType=binary&ratio=2&rotation=0&showTitle=false&size=414334&status=done&style=none&taskId=u2be3e637-22ac-4316-957e-db6931f15d8&title=&width=1035" alt="image.png"><br>Javaä»£ç å¯ä»¥ç›´æ¥è®¿é—®ã€‚</p><h3 id="ç›´æ¥å†…å­˜é‡Šæ”¾"><a href="#ç›´æ¥å†…å­˜é‡Šæ”¾" class="headerlink" title="ç›´æ¥å†…å­˜é‡Šæ”¾"></a>ç›´æ¥å†…å­˜é‡Šæ”¾</h3><p><img src="https://cdn.nlark.com/yuque/0/2024/png/38717174/1706236547363-6bffad9a-eb9e-44a4-a602-8597e6424207.png#averageHue=%23f7f3e6&clientId=ue26e552d-4b6b-4&from=paste&height=617&id=ufa3892ef&originHeight=1234&originWidth=2748&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1414676&status=done&style=none&taskId=ub05e31e3-fece-4331-986b-7369bad5482&title=&width=1374" alt="image.png"></p><ul><li>ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“</li></ul><p>ä½¿ç”¨äº†Unsafeç±»æ¥å®Œæˆç›´æ¥å†…å­˜çš„åˆ†é…å›æ”¶ï¼Œå›æ”¶éœ€è¦ä¸»åŠ¨è°ƒç”¨freeMemoryæ–¹æ³•ã€‚<br>ByteBufferçš„å®ç°å†…éƒ¨ä½¿ç”¨äº†Cleanerï¼ˆè™šå¼•ç”¨ï¼‰æ¥æ£€æµ‹ByteBufferã€‚ä¸€æ—¦ByteBufferè¢«åƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆä¼šç”±ReferenceHandleræ¥è°ƒç”¨Cleanerçš„cleanæ–¹æ³•è°ƒç”¨freeMemoryæ¥é‡Šæ”¾å†…å­˜ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt;

&lt;h1 id=&quot;ç¨‹åºè®¡æ•°å™¨&quot;&gt;&lt;a href=&quot;#ç¨‹åºè®¡æ•°å™¨&quot; class=&quot;headerlink&quot; title=&quot;ç¨‹åºè®¡æ•°å™¨&quot;&gt;&lt;/a&gt;ç¨‹åºè®¡æ•°å™¨&lt;/h1&gt;&lt;h2 id=&quot;ç¨‹åºè®¡æ•°å™¨</summary>
      
    
    
    
    <category term="JVM" scheme="https://axdmdyj.github.io/categories/JVM/"/>
    
    
    <category term="JVM" scheme="https://axdmdyj.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>JUCå¹¶å‘ç¼–ç¨‹-JMM</title>
    <link href="https://axdmdyj.github.io/posts/13a1a5fd.html"/>
    <id>https://axdmdyj.github.io/posts/13a1a5fd.html</id>
    <published>2024-01-15T00:35:54.000Z</published>
    <updated>2024-01-15T00:42:14.839Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="æœ¬ç« å†…å®¹-ï¼š"><a href="#æœ¬ç« å†…å®¹-ï¼š" class="headerlink" title="æœ¬ç« å†…å®¹ ï¼š"></a>æœ¬ç« å†…å®¹ ï¼š</h1><p> Monitor ä¸»è¦å…³æ³¨çš„æ˜¯è®¿é—®å…±äº«å˜é‡æ—¶ï¼Œä¿è¯ä¸´ç•ŒåŒºä»£ç çš„åŸå­æ€§<br>è¿™ä¸€ç« è¿›ä¸€æ­¥æ·±å…¥å­¦ä¹ <strong>å…±äº«å˜é‡</strong>åœ¨å¤šçº¿ç¨‹é—´çš„ã€å¯è§æ€§ã€‘é—®é¢˜ä¸å¤šæ¡æŒ‡ä»¤æ‰§è¡Œæ—¶çš„ã€æœ‰åºæ€§ã€‘é—®é¢˜ </p><p><strong>JMM</strong> å®šä¹‰äº†ä¸€å¥—åœ¨å¤šçº¿ç¨‹è¯»å†™å…±äº«æ•°æ®æ—¶ï¼ˆæˆå‘˜å˜é‡ã€æ•°ç»„ï¼‰æ—¶ï¼Œå¯¹æ•°æ®çš„<strong>åŸå­æ€§ã€å¯è§æ€§</strong>ã€<strong>æœ‰åºæ€§</strong>çš„<strong>è§„åˆ™å’Œä¿éšœã€‚</strong></p><h1 id="1ã€Java-å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰"><a href="#1ã€Java-å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰" class="headerlink" title="1ã€Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰"></a>1ã€Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰</h1><h2 id="ç†è§£ï¼š"><a href="#ç†è§£ï¼š" class="headerlink" title="ç†è§£ï¼š"></a>ç†è§£ï¼š</h2><ol><li>JMM å³ Java Memory Modelï¼Œä»javaå±‚é¢ï¼Œå®šä¹‰ä¸¤ä¸ªæŠ½è±¡æ¦‚å¿µã€‚</li><li>å®ƒå®šä¹‰äº†<strong>ä¸»å­˜ï¼ˆæ‰€æœ‰çº¿ç¨‹å…±äº«çš„æ•°æ®ï¼Œå³å…±äº«å†…å­˜ï¼‰</strong>ã€<strong>å·¥ä½œå†…å­˜ï¼ˆçº¿ç¨‹ç§æœ‰çš„æ•°æ®ï¼‰</strong>æŠ½è±¡æ¦‚å¿µã€‚</li><li>ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªæŠ½è±¡ï¼Œå› ä¸ºåœ¨åº•å±‚ç‰©ç†ä¸Šéå¸¸å¤åˆ¶ï¼Œå¦‚æœç¨‹åºå‘˜ç›´æ¥é¢å¯¹åº•å±‚ï¼Œé‚£å°±ç–¯äº†ï¼Œåº•å±‚å¯¹åº”ç€ CPU å¯„å­˜å™¨ã€ç¼“å­˜ã€ç¡¬ä»¶å†…å­˜ã€ CPU æŒ‡ä»¤ä¼˜åŒ–ç­‰ã€‚ç»è¿‡æŠ½è±¡ï¼Œå°±å¯ä»¥<strong>ç”¨ç®€å•çš„å…³é”®å­—ï¼Œæ¥æ§åˆ¶</strong>æ˜¯å¦è¦ç¼“å­˜ï¼Ÿæ˜¯å¦è¦ç¦æ­¢æŒ‡ä»¤ä¼˜åŒ–ï¼Ÿ ç­‰ç­‰ã€‚ä¾‹å¦‚ï¼švolatile synç­‰</li></ol><h2 id="JMM-ä½“ç°åœ¨ä»¥ä¸‹ä¸‰æ–¹é¢ï¼š"><a href="#JMM-ä½“ç°åœ¨ä»¥ä¸‹ä¸‰æ–¹é¢ï¼š" class="headerlink" title="JMM ä½“ç°åœ¨ä»¥ä¸‹ä¸‰æ–¹é¢ï¼š"></a>JMM ä½“ç°åœ¨ä»¥ä¸‹ä¸‰æ–¹é¢ï¼š</h2><p>åŸå­æ€§ - ä¿è¯æŒ‡ä»¤<strong>ä¸ä¼šå—åˆ°çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>çš„å½±å“<br>å¯è§æ€§ - ä¿è¯æŒ‡ä»¤<strong>ä¸ä¼šå— cpu ç¼“å­˜</strong>çš„å½±å“<br>æœ‰åºæ€§ - ä¿è¯æŒ‡ä»¤<strong>ä¸ä¼šå— cpu æŒ‡ä»¤å¹¶è¡Œä¼˜åŒ–</strong>çš„å½±å“</p><h1 id="2ã€å¯è§æ€§"><a href="#2ã€å¯è§æ€§" class="headerlink" title="2ã€å¯è§æ€§"></a>2ã€å¯è§æ€§</h1><h2 id="é€€å‡ºä¸å‡ºçš„å¾ªç¯ï¼š"><a href="#é€€å‡ºä¸å‡ºçš„å¾ªç¯ï¼š" class="headerlink" title="é€€å‡ºä¸å‡ºçš„å¾ªç¯ï¼š"></a>é€€å‡ºä¸å‡ºçš„å¾ªç¯ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="variable">run</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span>(run) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;t1 Stop&quot;</span>);</span><br><span class="line">        run = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ†æï¼š"><a href="#åˆ†æï¼š" class="headerlink" title="åˆ†æï¼š"></a>åˆ†æï¼š</h3><p>é¦–å…ˆ t1 çº¿ç¨‹è¿è¡Œï¼Œç„¶åè¿‡ä¸€ç§’ï¼Œä¸»çº¿ç¨‹è®¾ç½® run çš„å€¼ä¸º falseï¼Œæƒ³è®© t1 çº¿ç¨‹åœæ­¢ä¸‹æ¥ï¼Œä½†æ˜¯ t1 çº¿ç¨‹å¹¶æ²¡æœ‰åœï¼Œåˆ†æå¦‚ä¸‹å›¾ï¼š<br><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1649909440350-247e77c9-f82c-4e22-9a4b-f8c0150d1553.png#averageHue=%23eaea9e&clientId=ud10f7835-6559-4&from=paste&id=u403da049&originHeight=1142&originWidth=1043&originalType=url&ratio=1&rotation=0&showTitle=false&size=501369&status=done&style=none&taskId=u1df38cca-f3e4-4926-960a-6fdf1792c4e&title=" alt="image.png"></p><h2 id="è§£å†³æ–¹æ³•ï¼š"><a href="#è§£å†³æ–¹æ³•ï¼š" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h2><h3 id="1-synä¹Ÿå¯è§£å†³å¯è§æ€§é—®é¢˜ï¼š"><a href="#1-synä¹Ÿå¯è§£å†³å¯è§æ€§é—®é¢˜ï¼š" class="headerlink" title="1. synä¹Ÿå¯è§£å†³å¯è§æ€§é—®é¢˜ï¼š"></a>1. synä¹Ÿå¯è§£å†³å¯è§æ€§é—®é¢˜ï¼š</h3><p><strong>åœ¨Javaå†…å­˜æ¨¡å‹ä¸­ï¼Œsynchronizedè§„å®šï¼Œ çº¿ç¨‹åœ¨åŠ é”æ—¶ï¼Œ å…ˆæ¸…ç©ºå·¥ä½œå†…å­˜â†’åœ¨ä¸»å†…å­˜ä¸­æ‹·è´æœ€æ–°å˜é‡çš„å‰¯æœ¬åˆ°å·¥ä½œå†…å­˜  â†’æ‰§è¡Œå®Œä»£ç â†’å°†æ›´æ”¹åçš„å…±äº«å˜é‡çš„å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­â†’é‡Šæ”¾äº’æ–¥é”ã€‚</strong></p><h3 id="2-ä½¿ç”¨volitileï¼šæ¨è"><a href="#2-ä½¿ç”¨volitileï¼šæ¨è" class="headerlink" title="2. ä½¿ç”¨volitileï¼šæ¨è"></a>2. ä½¿ç”¨volitileï¼šæ¨è</h3><ul><li>ä½¿ç”¨ volatile ï¼ˆæ˜“å˜çš„   å…³é”®å­—ï¼‰</li><li>å®ƒ<strong>å¯ä»¥</strong>ç”¨æ¥<strong>ä¿®é¥°æˆå‘˜å˜é‡å’Œé™æ€æˆå‘˜å˜é‡ï¼ˆæ”¾åœ¨ä¸»å­˜ä¸­çš„å˜é‡</strong>ï¼‰ï¼Œ<strong>ä¸èƒ½</strong>ä¿®é¥°<strong>å±€éƒ¨å˜é‡</strong>ï¼Œä»–å¯ä»¥é¿å…çº¿ç¨‹ä»è‡ªå·±çš„å·¥ä½œç¼“å­˜ä¸­æŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œå¿…é¡»åˆ°ä¸»å­˜ä¸­è·å–å®ƒçš„å€¼ï¼Œçº¿ç¨‹æ“ä½œ volatile å˜é‡éƒ½æ˜¯ç›´æ¥æ“ä½œ ä¸»å­˜ï¼Œè§£å†³å¯è§æ€§é—®é¢˜</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨æ˜“å˜å…³é”®å­—</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="keyword">static</span> <span class="type">Boolean</span> <span class="variable">run</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line"><span class="keyword">while</span> (run) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœrunä¸ºçœŸï¼Œåˆ™ä¸€ç›´æ‰§è¡Œ</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;).start(); </span><br><span class="line"></span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;æ”¹å˜runçš„å€¼ä¸ºfalse&quot;</span>);</span><br><span class="line">run = <span class="literal">false</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¯è§æ€§-vs-åŸå­æ€§ï¼š"><a href="#å¯è§æ€§-vs-åŸå­æ€§ï¼š" class="headerlink" title="å¯è§æ€§ vs åŸå­æ€§ï¼š"></a>å¯è§æ€§ vs åŸå­æ€§ï¼š</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1703409850730-6c512767-2f6c-4bdf-8d6c-93a58d2f313d.png#averageHue=%23f7f7f7&clientId=u714f9d90-acae-4&from=paste&height=664&id=uec0d832a&originHeight=1328&originWidth=1988&originalType=binary&ratio=2&rotation=0&showTitle=false&size=612873&status=done&style=none&taskId=u641ce794-2848-4f94-bd7b-f8b76d26535&title=&width=994" alt="image.png"><br>å‰é¢ä¾‹å­ä½“ç°çš„å®é™…å°±æ˜¯<strong>å¯è§æ€§</strong>ï¼Œå®ƒä¿è¯çš„æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹<strong>volatileå˜é‡</strong>çš„ä¿®æ”¹å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ï¼Œ <strong>ä¸èƒ½</strong>ä¿è¯åŸå­æ€§ï¼Œä»…ç”¨åœ¨<strong>ä¸€ä¸ªå†™</strong>çº¿ç¨‹ï¼Œ<strong>å¤šä¸ªè¯»</strong>çº¿ç¨‹çš„æƒ…å†µ</p><ul><li>æ³¨æ„ synchronized è¯­å¥å—æ—¢å¯ä»¥ä¿è¯ä»£ç å—çš„<strong>åŸå­æ€§</strong>ï¼Œä¹ŸåŒæ—¶ä¿è¯ä»£ç å—å†…å˜é‡çš„<strong>å¯è§æ€§</strong>ã€‚</li><li>ä½†ç¼ºç‚¹æ˜¯ synchronized æ˜¯å±äº<strong>é‡é‡çº§</strong>æ“ä½œï¼Œæ€§èƒ½ç›¸å¯¹æ›´ä½ã€‚</li><li>å¦‚æœåœ¨å‰é¢ç¤ºä¾‹çš„<strong>æ­»å¾ªç¯ä¸­åŠ å…¥ System.out.println() <strong>ä¼šå‘ç°</strong>å³ä½¿ä¸åŠ  volatile ä¿®é¥°ç¬¦</strong>ï¼Œçº¿ç¨‹ t ä¹Ÿèƒ½æ­£ç¡®çœ‹åˆ° å¯¹ run å˜é‡çš„ä¿®æ”¹äº†ï¼Œæƒ³ä¸€æƒ³ä¸ºä»€ä¹ˆï¼Ÿ ç­‰çƒŸçš„ç¤ºä¾‹ ä¸ºå•¥æ²¡æœ‰å‡ºç°å¯è§æ€§é—®é¢˜?å’Œsynchrozizedæ˜¯ä¸€ä¸ªé“ç†ã€‚</li></ul><h3 id="å› ä¸º-println-ä½¿ç”¨synå…³é”®å­—ï¼š"><a href="#å› ä¸º-println-ä½¿ç”¨synå…³é”®å­—ï¼š" class="headerlink" title="å› ä¸º println() ä½¿ç”¨synå…³é”®å­—ï¼š"></a>å› ä¸º println() ä½¿ç”¨synå…³é”®å­—ï¼š</h3><p><strong>åœ¨Javaå†…å­˜æ¨¡å‹ä¸­ï¼Œsynchronizedè§„å®šï¼Œçº¿ç¨‹åœ¨åŠ é”æ—¶ï¼Œ å…ˆæ¸…ç©ºå·¥ä½œå†…å­˜â†’åœ¨ä¸»å†…å­˜ä¸­æ‹·è´æœ€æ–°å˜é‡çš„å‰¯æœ¬åˆ°å·¥ä½œå†…å­˜ â†’æ‰§è¡Œå®Œä»£ç â†’å°†æ›´æ”¹åçš„å…±äº«å˜é‡çš„å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­â†’é‡Šæ”¾äº’æ–¥é”ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">println</span><span class="params">(String x)</span> &#123;</span><br><span class="line"><span class="comment">//ä½¿ç”¨äº†synchronizedå…³é”®å­—</span></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            print(x);</span><br><span class="line">            newLine();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>[</p><p>](<a href="https://www.yuque.com/hetayiqixueka/il5kwi/gp6k5c#TmOQN">https://www.yuque.com/hetayiqixueka/il5kwi/gp6k5c#TmOQN</a>)</p><h2 id="ä¸¤é˜¶ç»ˆæ­¢æ¨¡å¼ä¹‹-volatile-ä¼˜åŒ–ï¼š"><a href="#ä¸¤é˜¶ç»ˆæ­¢æ¨¡å¼ä¹‹-volatile-ä¼˜åŒ–ï¼š" class="headerlink" title="ä¸¤é˜¶ç»ˆæ­¢æ¨¡å¼ä¹‹ volatile ä¼˜åŒ–ï¼š"></a>ä¸¤é˜¶ç»ˆæ­¢æ¨¡å¼ä¹‹ volatile ä¼˜åŒ–ï¼š</h2><h3 id="å¯¹-interrupt-å›é¡¾ï¼š"><a href="#å¯¹-interrupt-å›é¡¾ï¼š" class="headerlink" title="å¯¹ interrupt() å›é¡¾ï¼š"></a>å¯¹ interrupt() å›é¡¾ï¼š</h3><p><a href="https://www.yuque.com/hetayiqixueka/il5kwi/gp6k5c#TmOQN">https://www.yuque.com/hetayiqixueka/il5kwi/gp6k5c#TmOQN</a></p><h3 id="åˆ©ç”¨åœæ­¢æ ‡å¿—-ä¼˜åŒ–ï¼š"><a href="#åˆ©ç”¨åœæ­¢æ ‡å¿—-ä¼˜åŒ–ï¼š" class="headerlink" title="åˆ©ç”¨åœæ­¢æ ‡å¿— ä¼˜åŒ–ï¼š"></a>åˆ©ç”¨åœæ­¢æ ‡å¿— ä¼˜åŒ–ï¼š</h3><p>ä¹‹å‰çš„ interrupt() ï¼Œéœ€è¦é‡æ–°è®¾ç½®æ‰“æ–­æ ‡è®°ä¸ºçœŸï¼Œå¾ˆå®¹æ˜“é—æ¼ã€‚<br>ç°åœ¨ä½¿ç”¨ volatile å…³é”®å­—æ¥å®ç°ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test7</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"><span class="type">Monitor</span> <span class="variable">monitor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Monitor</span>();</span><br><span class="line">monitor.start();</span><br><span class="line">Thread.sleep(<span class="number">3500</span>);</span><br><span class="line">monitor.stop();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœæ­¢æ ‡è®°ç”¨ volatile æ˜¯ä¸ºäº†ä¿è¯è¯¥å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§</span></span><br><span class="line"><span class="comment">// æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå³ä¸»çº¿ç¨‹æŠŠå®ƒä¿®æ”¹ä¸º true å¯¹  å­çº¿ç¨‹å¯è§</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Monitor</span> &#123;</span><br><span class="line"></span><br><span class="line">Thread monitor;</span><br><span class="line"><span class="comment">//è®¾ç½®åœæ­¢æ ‡å¿—ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦è¢«ç»ˆæ­¢äº†ã€‚å¿…é¡»ä¸ºvolatileï¼Œå› ä¸ºä¸€ä¸ªçº¿ç¨‹å¯åŠ¨ç›‘æ§ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹æš‚åœç›‘æ§ï¼Œç›¸å½“äºä¸€ä¸ªçº¿ç¨‹è¯»ï¼Œä¸€ä¸ªçº¿ç¨‹å†™ï¼Œå†™çš„æ“ä½œè¦è¢«è¯»çº¿ç¨‹æ„ŸçŸ¥ï¼Œæ‰€ä»¥å¿…é¡»ä¸ºvolatile</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">stop</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯åŠ¨ç›‘æ§å™¨çº¿ç¨‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//è®¾ç½®çº¿æ§å™¨çº¿ç¨‹ï¼Œç”¨äºç›‘æ§çº¿ç¨‹çŠ¶æ€</span></span><br><span class="line">monitor = <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//å¼€å§‹ä¸åœçš„ç›‘æ§</span></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(stop) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;å¤„ç†åç»­ä»»åŠ¡&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;ç›‘æ§å™¨è¿è¡Œä¸­...&quot;</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//çº¿ç¨‹ä¼‘çœ </span></span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123; </span><br><span class="line">System.out.println(<span class="string">&quot;è¢«æ‰“æ–­äº†&quot;</span>); <span class="comment">//ä¸éœ€è¦é‡æ–°è®¾ç½®æ‰“æ–­æ ‡è®°ï¼Œå› ä¸ºä¼˜åŒ–</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">monitor.start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨äºåœæ­¢ç›‘æ§å™¨çº¿ç¨‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//æ‰“æ–­çº¿ç¨‹ï¼Œå°±æ˜¯å½“ç›‘æ§çº¿ç¨‹åœ¨sleepæ—¶ï¼Œé‚£ä¹Ÿä¼šè¢«ç«‹åˆ»ç»ˆæ­¢</span></span><br><span class="line">monitor.interrupt();</span><br><span class="line">        <span class="comment">//ä¿®æ”¹æ ‡è®°</span></span><br><span class="line">stop = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŒæ­¥æ¨¡å¼ä¹‹-çŠ¹è±«æ¨¡å¼ï¼š"><a href="#åŒæ­¥æ¨¡å¼ä¹‹-çŠ¹è±«æ¨¡å¼ï¼š" class="headerlink" title="åŒæ­¥æ¨¡å¼ä¹‹ çŠ¹è±«æ¨¡å¼ï¼š"></a>åŒæ­¥æ¨¡å¼ä¹‹ çŠ¹è±«æ¨¡å¼ï¼š</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰:"></a>å®šä¹‰:</h3><p>Balking ï¼ˆçŠ¹è±«ï¼‰æ¨¡å¼ï¼šç”¨åœ¨ä¸€ä¸ªçº¿ç¨‹å‘ç°å¦ä¸€ä¸ªçº¿ç¨‹æˆ–æœ¬çº¿ç¨‹<strong>å·²ç»åšäº†æŸä¸€ä»¶ç›¸åŒ</strong>çš„äº‹ï¼Œé‚£ä¹ˆæœ¬çº¿ç¨‹å°±æ— éœ€å†åš äº†ï¼Œ<strong>ç›´æ¥ç»“æŸè¿”å›</strong></p><h3 id="å‰é¢volatileä¼˜åŒ–å­˜åœ¨çš„é—®é¢˜ï¼š"><a href="#å‰é¢volatileä¼˜åŒ–å­˜åœ¨çš„é—®é¢˜ï¼š" class="headerlink" title="å‰é¢volatileä¼˜åŒ–å­˜åœ¨çš„é—®é¢˜ï¼š"></a>å‰é¢volatileä¼˜åŒ–å­˜åœ¨çš„é—®é¢˜ï¼š</h3><ul><li>è‹¥å¤šæ¬¡è°ƒç”¨ start() ï¼Œç›‘æ§ç¨‹åºä¼šæœ‰å¤šä¸ªï¼Œæ²¡æœ‰æ„ä¹‰ã€‚</li><li>éœ€è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼ŒæŸä¸ªæ–¹æ³•åªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œä¸‹æ¬¡æ‰§è¡Œçš„æ—¶å€™ç›´æ¥è¿”å›ï¼Œä¸è¦å¾€ä¸‹æ‰§è¡Œï¼Œè¿™å°±æ˜¯çŠ¹è±«æ¨¡å¼</li><li>é˜²æ­¢åå°„ç ´åå•ä¾‹æ—¶å€™ï¼Œä¹Ÿæ˜¯è¿™å¥—è·¯ã€‚</li></ul><h3 id="å®ç°ï¼š"><a href="#å®ç°ï¼š" class="headerlink" title="å®ç°ï¼š"></a>å®ç°ï¼š</h3><ul><li>ç”¨ä¸€ä¸ªæ ‡å¿—æ¥åˆ¤æ–­è¯¥ä»»åŠ¡æ˜¯å¦å·²ç»è¢«æ‰§è¡Œè¿‡äº†</li><li>éœ€è¦é¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œè‹¥ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œåˆ° if(starting) ï¼Œé‚£å°±ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œéœ€è¦åŠ é”å¤„ç†ã€‚æ­¤æ—¶ï¼Œvolitile ä¸èƒ½è§£å†³é—®é¢˜ï¼Œå› ä¸ºä¸èƒ½ä¿è¯åŸå­æ€§<ul><li>å¹¶ä¸”ï¼ŒåŠ é”çš„ä»£ç å—è¦å°½é‡çš„å°ï¼Œä»¥ä¿è¯æ€§èƒ½ã€‚</li><li>åŒé‡æ£€æŸ¥é”æ›´å¥½ï¼Œåœ¨å¤–é¢åŠ ä¸ªifï¼Œå¯ä»¥å‡å°‘é¢‘ç¹è·å–é”çš„æƒ…å†µ</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test7</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"><span class="type">Monitor</span> <span class="variable">monitor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Monitor</span>();</span><br><span class="line">monitor.start();</span><br><span class="line">monitor.start();</span><br><span class="line">Thread.sleep(<span class="number">3500</span>);</span><br><span class="line">monitor.stop();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Monitor</span> &#123;</span><br><span class="line"></span><br><span class="line">Thread monitor;</span><br><span class="line"><span class="comment">//è®¾ç½®æ ‡è®°ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦è¢«ç»ˆæ­¢äº†</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">stop</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//è®¾ç½®æ ‡è®°ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦å·²ç»å¯åŠ¨è¿‡äº†</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">starting</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯åŠ¨ç›‘æ§å™¨çº¿ç¨‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//åŒé‡æ£€æŸ¥é”</span></span><br><span class="line"><span class="keyword">if</span>(!starting)&#123;</span><br><span class="line">            <span class="comment">//ä¸Šé”ï¼Œé¿å…å¤šçº¿ç¨‹è¿è¡Œæ—¶å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜</span></span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (starting) &#123;</span><br><span class="line">                    <span class="comment">//å·²è¢«å¯åŠ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//ç¬¬ä¸€æ¬¡å¯åŠ¨ç›‘è§†å™¨ï¼Œæ”¹å˜æ ‡è®°</span></span><br><span class="line">                starting = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//è®¾ç½®çº¿æ§å™¨çº¿ç¨‹ï¼Œç”¨äºç›‘æ§çº¿ç¨‹çŠ¶æ€</span></span><br><span class="line">monitor = <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//å¼€å§‹ä¸åœçš„ç›‘æ§</span></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(stop) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;å¤„ç†åç»­ä»»åŠ¡&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;ç›‘æ§å™¨è¿è¡Œä¸­...&quot;</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//çº¿ç¨‹ä¼‘çœ </span></span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;è¢«æ‰“æ–­äº†&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">monitor.start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨äºåœæ­¢ç›‘æ§å™¨çº¿ç¨‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//æ‰“æ–­çº¿ç¨‹</span></span><br><span class="line">monitor.interrupt();</span><br><span class="line">stop = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çŠ¹è±«æ¨¡å¼-åº”ç”¨ï¼š"><a href="#çŠ¹è±«æ¨¡å¼-åº”ç”¨ï¼š" class="headerlink" title="çŠ¹è±«æ¨¡å¼ åº”ç”¨ï¼š"></a>çŠ¹è±«æ¨¡å¼ åº”ç”¨ï¼š</h3><p><strong>ä¿è¯ç›‘æ§çº¿ç¨‹åªå¯åŠ¨ä¸€æ¬¡</strong></p><h4 id="å¯¹äºä»¥ä¸‹Tomcatç›‘æ§çº¿ç¨‹ï¼š"><a href="#å¯¹äºä»¥ä¸‹Tomcatç›‘æ§çº¿ç¨‹ï¼š" class="headerlink" title="å¯¹äºä»¥ä¸‹Tomcatç›‘æ§çº¿ç¨‹ï¼š"></a>å¯¹äºä»¥ä¸‹Tomcatç›‘æ§çº¿ç¨‹ï¼š</h4><ul><li>ç›‘æ§çº¿ç¨‹åœæ­¢æ—¶ï¼Œè®¾ starting ä¸ºfalse ï¼Œæ­¤æ—¶ starting å˜é‡æ²¡æœ‰åœ¨åŒæ­¥ä»£ç å—å†…ï¼Œä¸èƒ½ä¿è¯å¯è§æ€§ï¼Œæ‰€ä»¥ä¹ŸåŠ  volatile å…³é”®å­—</li><li>å¦‚æœä¸ä¿è¯å¯è§æ€§é‚£ä¹ˆä¸‹ä¸€æ¬¡ç‚¹å‡» å¼€å§‹ æŒ‰é’®tomcatè¿è¡ŒåŒæ­¥ä»£ç å—é‡Œçš„staringè¿˜æ˜¯trueï¼Œå°±ä¸èƒ½å¯åŠ¨ç›‘æ§çº¿ç¨‹äº†</li><li>é‚£ä¸ºä»€ä¹ˆä¸ç”¨synï¼Ÿå› ä¸ºç”¨synæ€§èƒ½æ¶ˆè€—å¤§ï¼Œä½¿ç”¨ volatile è½»é‡çº§çš„ä¿è¯å¯è§æ€§å³å¯</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.monitor.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.monitor.controller.MonitorController;</span><br><span class="line"><span class="keyword">import</span> cn.itcast.monitor.vo.Info;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yihang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MonitorService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> stop;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> starting;</span><br><span class="line">    <span class="keyword">private</span> Thread monitorThread;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åŒé‡æ£€æŸ¥é”</span></span><br><span class="line">        <span class="keyword">if</span>(!starting)&#123;</span><br><span class="line">            <span class="comment">// ç¼©å°åŒæ­¥èŒƒå›´ï¼Œæå‡æ€§èƒ½</span></span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;è¯¥ç›‘æ§çº¿ç¨‹å·²å¯åŠ¨?(&#123;&#125;)&quot;</span>, starting);</span><br><span class="line">                <span class="keyword">if</span> (starting) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                starting = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”±äºä¹‹å‰çš„ balking æ¨¡å¼ï¼Œä»¥ä¸‹ä»£ç åªå¯èƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œå› æ­¤æ— éœ€äº’æ–¥</span></span><br><span class="line">        monitorThread = <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (!stop) &#123;</span><br><span class="line">                report();</span><br><span class="line">                sleep(<span class="number">2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è¿™é‡Œçš„ç›‘æ§çº¿ç¨‹åªå¯èƒ½å¯åŠ¨ä¸€ä¸ªï¼Œå› æ­¤åªéœ€è¦ç”¨ volatile ä¿è¯ starting çš„å¯è§æ€§</span></span><br><span class="line">            log.info(<span class="string">&quot;ç›‘æ§çº¿ç¨‹å·²åœæ­¢...&quot;</span>);</span><br><span class="line">            starting = <span class="literal">false</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        stop = <span class="literal">false</span>;</span><br><span class="line">        log.info(<span class="string">&quot;ç›‘æ§çº¿ç¨‹å·²å¯åŠ¨...&quot;</span>);</span><br><span class="line">        monitorThread.start(); <span class="comment">//å¯åŠ¨ç›‘æ§çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">report</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Info</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Info</span>();</span><br><span class="line">        info.setTotal(Runtime.getRuntime().totalMemory());</span><br><span class="line">        info.setFree(Runtime.getRuntime().freeMemory());</span><br><span class="line">        info.setMax(Runtime.getRuntime().maxMemory());</span><br><span class="line">        info.setTime(System.currentTimeMillis());</span><br><span class="line">        MonitorController.QUEUE.offer(info);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">(<span class="type">long</span> seconds)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(seconds);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span> &#123;</span><br><span class="line">        stop = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// ä¸åŠ æ‰“æ–­éœ€è¦ç­‰åˆ°ä¸‹ä¸€æ¬¡ sleep ç»“æŸæ‰èƒ½é€€å‡ºå¾ªç¯ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†æ›´å¿«ç»“æŸ</span></span><br><span class="line">        monitorThread.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹ï¼š"><a href="#å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹ï¼š" class="headerlink" title="å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹ï¼š"></a>å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//ä¼˜åŒ–</span></span><br><span class="line">        <span class="keyword">if</span> (INSTANCE != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> INSTANCE;</span><br><span class="line">        &#125;</span><br><span class="line">        INSTANCE = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3ã€æœ‰åºæ€§"><a href="#3ã€æœ‰åºæ€§" class="headerlink" title="3ã€æœ‰åºæ€§"></a>3ã€æœ‰åºæ€§</h1><h2 id="3-1-æŒ‡ä»¤é‡æ’ï¼š"><a href="#3-1-æŒ‡ä»¤é‡æ’ï¼š" class="headerlink" title="3.1 æŒ‡ä»¤é‡æ’ï¼š"></a>3.1 æŒ‡ä»¤é‡æ’ï¼š</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1703465371216-28d49e05-c15d-45af-81b4-a7eeebfae9e5.png#averageHue=%23f7f6f4&clientId=ue31d7846-9f43-4&from=paste&height=334&id=u2ae422e1&originHeight=668&originWidth=2240&originalType=binary&ratio=2&rotation=0&showTitle=false&size=579732&status=done&style=none&taskId=u7714e233-09b2-4cd0-b9c9-c2c9d8e29ed&title=&width=1120" alt="image.png"></p><ul><li>JVM ä¼šåœ¨<strong>ä¸å½±å“ç»“æœæ­£ç¡®æ€§</strong>çš„å‰æä¸‹ï¼Œå¯ä»¥<strong>è°ƒæ•´</strong>è¯­å¥çš„æ‰§è¡Œ<strong>é¡ºåºï¼Œ</strong>è¿™ç§ç‰¹æ€§ç§°ä¹‹ä¸ºã€<strong>æŒ‡ä»¤é‡æ’</strong>ã€</li><li>ä½†æ˜¯åœ¨<strong>å¤šçº¿ç¨‹ä¸‹ã€æŒ‡ä»¤é‡æ’ã€ä¼šå½±å“æ­£ç¡®æ€§ã€‚</strong></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1649924182419-4b9e3d2e-2907-45b6-8bb9-8ad285b2130e.png#averageHue=%23f7f7f6&clientId=ud10f7835-6559-4&from=paste&id=ud4bd176e&originHeight=586&originWidth=1039&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u1ee2594c-eef6-4b2a-91af-a67373d196d&title="></p><h2 id="3-2-é‚£ä¸ºä»€ä¹ˆè¦æœ‰-æŒ‡ä»¤é‡æ’-ä¼˜åŒ–å‘¢ï¼Ÿ"><a href="#3-2-é‚£ä¸ºä»€ä¹ˆè¦æœ‰-æŒ‡ä»¤é‡æ’-ä¼˜åŒ–å‘¢ï¼Ÿ" class="headerlink" title="3.2 é‚£ä¸ºä»€ä¹ˆè¦æœ‰ æŒ‡ä»¤é‡æ’ ä¼˜åŒ–å‘¢ï¼Ÿ"></a>3.2 é‚£ä¸ºä»€ä¹ˆè¦æœ‰ æŒ‡ä»¤é‡æ’ ä¼˜åŒ–å‘¢ï¼Ÿ</h2><p>ä»cpuè§’åº¦ï¼Œçœ‹ CPUæ‰§è¡ŒæŒ‡ä»¤ çš„åŸç†æ¥ç†è§£ä¸€ä¸‹</p><h3 id="æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼š"><a href="#æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼š" class="headerlink" title="æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼š"></a>æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼š</h3><ul><li>ç°ä»£å¤„ç†å™¨ä¼šè®¾è®¡ä¸ºä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå®Œæˆä¸€æ¡æ‰§è¡Œæ—¶é—´é•¿çš„ CPU æŒ‡ä»¤ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Ÿå¯ä»¥æƒ³åˆ°æŒ‡ä»¤è¿˜å¯ä»¥å†åˆ’åˆ†æˆä¸€ä¸ªä¸ªæ›´å°çš„é˜¶æ®µï¼Œä¾‹å¦‚ï¼Œæ¯æ¡æŒ‡ä»¤éƒ½å¯ä»¥åˆ†ä¸ºï¼š <strong>å–æŒ‡ä»¤ - æŒ‡ä»¤è¯‘ç  - æ‰§è¡ŒæŒ‡ä»¤ - å†…å­˜è®¿é—® - æ•°æ®å†™å›</strong> è¿™5 ä¸ªé˜¶æ®µ</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1649926023127-7b8a2fb9-0a75-40d3-b36e-da46caa3dc92.png#averageHue=%23f5f5f5&clientId=ud10f7835-6559-4&from=paste&id=u378d7b24&originHeight=225&originWidth=1145&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u221ed5c8-e766-4ad6-a18c-c759b9aaa32&title="><br>ç°ä»£ CPU æ”¯æŒ<strong>å¤šçº§æŒ‡ä»¤æµæ°´çº¿</strong>ï¼Œä¾‹å¦‚æ”¯æŒåŒæ—¶æ‰§è¡Œ å–æŒ‡ä»¤ - æŒ‡ä»¤è¯‘ç  - æ‰§è¡ŒæŒ‡ä»¤ - å†…å­˜è®¿é—® - æ•°æ®å†™å› çš„å¤„ç†å™¨ï¼Œå°±å¯ä»¥ç§°ä¹‹ä¸º<strong>äº”çº§æŒ‡ä»¤æµæ°´çº¿</strong>ã€‚è¿™æ—¶ CPU å¯ä»¥åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…ï¼ŒåŒæ—¶è¿è¡Œäº”æ¡æŒ‡ä»¤çš„ä¸åŒé˜¶æ®µï¼ˆç›¸å½“äºä¸€æ¡æ‰§è¡Œæ—¶é—´æœ€é•¿çš„å¤æ‚æŒ‡ä»¤ï¼‰ï¼ŒIPC &#x3D; 1ï¼Œæœ¬è´¨ä¸Šï¼Œæµæ°´çº¿æŠ€æœ¯å¹¶ä¸èƒ½ç¼©çŸ­å•æ¡æŒ‡ä»¤çš„æ‰§è¡Œæ—¶é—´ï¼Œä½†å®ƒå˜ç›¸åœ°æé«˜äº†æŒ‡ä»¤åœ°ååç‡ã€‚<br> <img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1649934793764-970b1769-f240-4f1a-82d1-11efd67976a7.png#averageHue=%23f2f2f2&clientId=ud10f7835-6559-4&from=paste&height=291&id=u57f92fc0&originHeight=327&originWidth=1057&originalType=binary&ratio=1&rotation=0&showTitle=false&size=38744&status=done&style=none&taskId=uc37d119c-e9ca-44ee-8944-39215c15db0&title=&width=939.5555555555555" alt="image.png"></p><ul><li>åœ¨ä¸æ”¹å˜ç¨‹åºç»“æœçš„å‰æä¸‹ï¼Œè¿™äº›æŒ‡ä»¤çš„å„ä¸ªé˜¶æ®µå¯ä»¥é€šè¿‡<strong>é‡æ’åº</strong>å’Œ<strong>ç»„åˆ</strong>æ¥å®ç°<strong>æŒ‡ä»¤çº§å¹¶è¡Œ,æé«˜å¹¶å‘åº¦</strong></li><li>æµæ°´çº¿æœ‰æ—¶å€™ä¼šå› ä¸ºæŒ‡ä»¤é—´çš„ä¾èµ–å…³ç³»è¢«é˜»å¡ï¼Œé‡æ’å¯ä»¥å‡å°‘é˜»å¡</li><li>æŒ‡ä»¤é‡æ’çš„<strong>å‰æ</strong>æ˜¯ï¼Œé‡æ’æŒ‡ä»¤<strong>ä¸èƒ½å½±å“ç»“æœ</strong>ï¼Œä¾‹å¦‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯ä»¥é‡æ’çš„ä¾‹å­ </span></span><br><span class="line"><span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>; </span><br><span class="line"><span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">20</span>; </span><br><span class="line">System.out.println( a + b );</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸èƒ½é‡æ’çš„ä¾‹å­ </span></span><br><span class="line"><span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> a - <span class="number">5</span>;</span><br></pre></td></tr></table></figure><h2 id="3-3-å¤šçº¿ç¨‹ä¸‹æŒ‡ä»¤é‡æ’é—®é¢˜ï¼š"><a href="#3-3-å¤šçº¿ç¨‹ä¸‹æŒ‡ä»¤é‡æ’é—®é¢˜ï¼š" class="headerlink" title="3.3 å¤šçº¿ç¨‹ä¸‹æŒ‡ä»¤é‡æ’é—®é¢˜ï¼š"></a>3.3 å¤šçº¿ç¨‹ä¸‹æŒ‡ä»¤é‡æ’é—®é¢˜ï¼š</h2><p><strong>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒæŒ‡ä»¤é‡æ’åºå¯èƒ½å¯¼è‡´å‡ºç°æ„æ–™ä¹‹å¤–çš„ç»“æœ</strong></p><h3 id="é¦–å…ˆçœ‹ä¸€æ®µä»£ç ï¼š"><a href="#é¦–å…ˆçœ‹ä¸€æ®µä»£ç ï¼š" class="headerlink" title="é¦–å…ˆçœ‹ä¸€æ®µä»£ç ï¼š"></a>é¦–å…ˆçœ‹ä¸€æ®µä»£ç ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// volatile ä¿®é¥°çš„å˜é‡ï¼Œå¯ä»¥ç¦ç”¨æŒ‡ä»¤é‡æ’ volatile boolean ready = false; å¯ä»¥é˜²æ­¢å˜é‡ä¹‹å‰çš„ä»£ç è¢«é‡æ’åº</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">ready</span> <span class="operator">=</span> <span class="literal">false</span>; </span><br><span class="line"><span class="comment">// çº¿ç¨‹1 æ‰§è¡Œæ­¤æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actor1</span><span class="params">(I_Result r)</span> &#123;</span><br><span class="line"> <span class="keyword">if</span>(ready) &#123;</span><br><span class="line"> r.r1 = num + num;</span><br><span class="line"> &#125; </span><br><span class="line"> <span class="keyword">else</span> &#123;</span><br><span class="line"> r.r1 = <span class="number">1</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// çº¿ç¨‹2 æ‰§è¡Œæ­¤æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actor2</span><span class="params">(I_Result r)</span> &#123;</span><br><span class="line"> num = <span class="number">2</span>;</span><br><span class="line"> ready = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä»¥ä¸Šçš„ä»£ç -r1-çš„å€¼æœ‰ä¸‰ç§æƒ…å†µï¼š"><a href="#åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä»¥ä¸Šçš„ä»£ç -r1-çš„å€¼æœ‰ä¸‰ç§æƒ…å†µï¼š" class="headerlink" title="åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä»¥ä¸Šçš„ä»£ç  r1 çš„å€¼æœ‰ä¸‰ç§æƒ…å†µï¼š"></a>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä»¥ä¸Šçš„ä»£ç  r1 çš„å€¼æœ‰ä¸‰ç§æƒ…å†µï¼š</h3><p>ç¬¬ä¸€ç§ï¼šçº¿ç¨‹ 2 å…ˆæ‰§è¡Œï¼Œç„¶åçº¿ç¨‹ 1 åæ‰§è¡Œï¼Œr1 çš„ç»“æœä¸º 4ï¼›<br>ç¬¬äºŒç§ï¼šçº¿ç¨‹ 1 å…ˆæ‰§è¡Œï¼Œç„¶åçº¿ç¨‹ 2 åæ‰§è¡Œï¼Œr1 çš„ç»“æœä¸º 1ï¼›<br>ç¬¬ä¸‰ç§ï¼šçº¿ç¨‹ 2 å…ˆæ‰§è¡Œï¼Œä½†æ˜¯å‘é€äº†æŒ‡ä»¤é‡æ’ï¼Œnum &#x3D; 2 ä¸ ready &#x3D; true è¿™ä¸¤è¡Œä»£ç è¯­åºå‘ç”Ÿè£…æ¢ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ready = <span class="literal">true</span>; <span class="comment">// å‰</span></span><br><span class="line">num = <span class="number">2</span>; <span class="comment">// å</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œ ready &#x3D; true åï¼Œçº¿ç¨‹ 1 è¿è¡Œäº†ï¼Œé‚£ä¹ˆ r1 çš„ç»“æœæ˜¯ä¸º 0ã€‚<img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1703466012493-c87d1923-8917-4ab1-b1b4-d17b2726dac1.png#averageHue=%23fdfdfd&clientId=uf81aeecb-5d94-4&from=paste&height=376&id=u5e4903d9&originHeight=752&originWidth=2656&originalType=binary&ratio=2&rotation=0&showTitle=false&size=341401&status=done&style=none&taskId=u4ad2738f-07e0-4639-b082-f6690553e7b&title=&width=1328" alt="image.png"></p><h2 id="3-4-è§£å†³æ–¹æ³•ï¼š"><a href="#3-4-è§£å†³æ–¹æ³•ï¼š" class="headerlink" title="3.4 è§£å†³æ–¹æ³•ï¼š"></a>3.4 è§£å†³æ–¹æ³•ï¼š</h2><p>volatile ä¿®é¥°çš„å˜é‡ï¼Œå¯ä»¥<strong>ç¦ç”¨æŒ‡ä»¤é‡æ’</strong>ï¼Œ<strong>ç¦æ­¢</strong>çš„æ˜¯ åŠ  volatile å…³é”®å­—çš„å˜é‡ <strong>ä¹‹å‰çš„ä»£ç è¿›è¡Œ</strong>é‡æ’åº<br>è¿™é‡Œä¹Ÿå°±æ˜¯readyä¹‹å‰çš„ä»£ç ç¦æ­¢é‡æ’åº</p><h2 id="3-5-volatile-åŸç†ï¼š"><a href="#3-5-volatile-åŸç†ï¼š" class="headerlink" title="3.5 volatile åŸç†ï¼š"></a>3.5 volatile åŸç†ï¼š</h2><p><strong>volatileå¯ä»¥ä¿è¯ å…±äº«å˜é‡çš„å¯è§æ€§ã€æœ‰åºæ€§ï¼Œåº•å±‚å¦‚ä½•å®ç°ï¼Ÿ</strong><br>ç­”ï¼švolatileçš„åº•å±‚å®ç°åŸç†æ˜¯<strong>å†…å­˜å±éšœ</strong>ï¼ŒMemory Barrierï¼ˆMemory Fenceï¼‰</p><ul><li>å¯¹ volatile å˜é‡çš„å†™æŒ‡ä»¤å  ä¼šåŠ å…¥å†™å±éšœ</li><li>å¯¹ volatile å˜é‡çš„è¯»æŒ‡ä»¤å‰  ä¼šåŠ å…¥è¯»å±éšœ</li></ul><h3 id="å…ˆçœ‹ä¸€ä¸‹å†…å­˜å±éšœï¼š"><a href="#å…ˆçœ‹ä¸€ä¸‹å†…å­˜å±éšœï¼š" class="headerlink" title="å…ˆçœ‹ä¸€ä¸‹å†…å­˜å±éšœï¼š"></a>å…ˆçœ‹ä¸€ä¸‹å†…å­˜å±éšœï¼š</h3><ul><li>å¯è§æ€§<ul><li><strong>å†™å±éšœ</strong>ï¼ˆsfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœ<strong>ä¹‹å‰</strong>çš„ï¼Œå¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜å½“ä¸­</li><li><strong>è¯»å±éšœ</strong>ï¼ˆlfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœ<strong>ä¹‹åçš„</strong>ï¼Œå¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­çš„æœ€æ–°æ•°æ®</li></ul></li><li>æœ‰åºæ€§<ul><li>å†™å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†<strong>å†™å±éšœä¹‹å‰</strong>çš„ä»£ç æ’åœ¨å†™å±éšœä¹‹å</li><li>è¯»å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†<strong>è¯»å±éšœä¹‹å</strong>çš„ä»£ç æ’åœ¨è¯»å±éšœä¹‹å‰</li></ul></li></ul><h3 id="å¦‚ä½•ä¿è¯å¯è§æ€§ï¼š"><a href="#å¦‚ä½•ä¿è¯å¯è§æ€§ï¼š" class="headerlink" title="å¦‚ä½•ä¿è¯å¯è§æ€§ï¼š"></a>å¦‚ä½•ä¿è¯å¯è§æ€§ï¼š</h3><ul><li>å†™å±éšœï¼ˆsfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹å‰çš„ï¼Œå¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜å½“ä¸­</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1649936015305-62534166-2f53-470e-a096-cfdaa7ffb4c8.png#averageHue=%23f4f3f1&clientId=u2908829a-b6ac-4&from=paste&id=ua99e1cbf&originHeight=343&originWidth=1157&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=uc0ae16b0-4252-4fb5-9326-11d760cb91d&title="></p><ul><li>è€Œè¯»å±éšœï¼ˆlfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹åï¼Œå¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­çš„æœ€æ–°æ•°æ®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actor1</span><span class="params">(I_Result r)</span> &#123;</span><br><span class="line">    <span class="comment">// è¯»å±éšœ</span></span><br><span class="line">    <span class="comment">// ready æ˜¯ volatile è¯»å–å€¼å¸¦è¯»å±éšœ</span></span><br><span class="line">    <span class="keyword">if</span>(ready) &#123;</span><br><span class="line">        r.r1 = num + num;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        r.r1 = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1649936027298-cdd29306-6019-4fda-a99a-0a65e9efd74c.png#averageHue=%23f8efa9&clientId=u2908829a-b6ac-4&from=paste&id=u18500d7d&originHeight=716&originWidth=1200&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u7a1b9dd7-d32a-42a7-bb17-10b5ce40706&title="></p><h3 id="å¦‚ä½•ä¿è¯æœ‰åºæ€§ï¼š"><a href="#å¦‚ä½•ä¿è¯æœ‰åºæ€§ï¼š" class="headerlink" title="å¦‚ä½•ä¿è¯æœ‰åºæ€§ï¼š"></a>å¦‚ä½•ä¿è¯æœ‰åºæ€§ï¼š</h3><ul><li>å†™å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†å†™å±éšœä¹‹å‰çš„ä»£ç æ’åœ¨å†™å±éšœä¹‹å</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1649936043737-e0f7a843-afc6-42d6-a4df-48923dc4b291.png#averageHue=%23f4f3f1&clientId=u2908829a-b6ac-4&from=paste&id=u53639ad9&originHeight=233&originWidth=760&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u3223ba4b-068a-465b-a7e3-511ab611186&title="></p><ul><li>è¯»å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†è¯»å±éšœä¹‹åçš„ä»£ç æ’åœ¨è¯»å±éšœä¹‹å‰</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1649936055748-fc78c467-778f-469a-ba71-43b1475ed191.png#averageHue=%23f5f4f3&clientId=u2908829a-b6ac-4&from=paste&id=uf680dff8&originHeight=380&originWidth=659&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=ubf0964af-09aa-4dbd-af37-0deb5bf5f35&title="><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1649936066371-31aea7ce-e5ae-404d-9d29-02c4d0a859df.png#averageHue=%23f8efa9&clientId=u2908829a-b6ac-4&from=paste&id=u818c4e63&originHeight=701&originWidth=1201&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u8dcc9f71-b00b-4f7e-8e7c-f8ad5e5a04b&title="></p><h4 id="åªä¿è¯äº†æœ¬çº¿ç¨‹çš„æœ‰åºæ€§ï¼Œçº¿ç¨‹é—´çš„äº¤é”™æ— æ³•ä¿è¯ï¼š"><a href="#åªä¿è¯äº†æœ¬çº¿ç¨‹çš„æœ‰åºæ€§ï¼Œçº¿ç¨‹é—´çš„äº¤é”™æ— æ³•ä¿è¯ï¼š" class="headerlink" title="åªä¿è¯äº†æœ¬çº¿ç¨‹çš„æœ‰åºæ€§ï¼Œçº¿ç¨‹é—´çš„äº¤é”™æ— æ³•ä¿è¯ï¼š"></a>åªä¿è¯äº†æœ¬çº¿ç¨‹çš„æœ‰åºæ€§ï¼Œçº¿ç¨‹é—´çš„äº¤é”™æ— æ³•ä¿è¯ï¼š</h4><ul><li>jvm æ— æ³•æ§åˆ¶çº¿ç¨‹è°ƒåº¦ï¼Œå³çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚æ˜¯ç”±cpuçš„æ—¶é—´ç‰‡å†³å®šçš„ï¼ŒAçº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œäº†ï¼Œåˆ‡æ¢åˆ°Bçº¿ç¨‹ï¼Œåœ¨çº¿ç¨‹é—´çš„ä»£ç å°±ä¼šäº¤é”™æ‰§è¡Œ</li><li>è€Œæœ‰åºæ€§çš„ä¿è¯ä¹Ÿ<strong>åªæ˜¯ä¿è¯äº†æœ¬çº¿ç¨‹å†…</strong>ç›¸å…³ä»£ç ä¸è¢«é‡æ’åº</li></ul><h3 id="ä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™é—®é¢˜ï¼šåŸå­æ€§"><a href="#ä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™é—®é¢˜ï¼šåŸå­æ€§" class="headerlink" title="ä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™é—®é¢˜ï¼šåŸå­æ€§"></a>ä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™é—®é¢˜ï¼šåŸå­æ€§</h3><ul><li>å³ä¸èƒ½ä¿è¯åŸå­æ€§ã€‚å†™å±éšœä»…ä»…æ˜¯ä¿è¯<strong>ä¹‹åçš„è¯»èƒ½å¤Ÿè¯»åˆ°æ–°çš„ç»“æœ</strong>ï¼Œä½†<strong>ä¸èƒ½ä¿è¯å¦å¤–çº¿ç¨‹çš„è¯»è·‘åˆ°å®ƒå‰é¢å»ï¼Œè¿›è€Œä¸èƒ½è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜</strong></li></ul><h2 id="synå¯ä»¥ä¿è¯åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§ï¼Œå‰ææ˜¯å…±äº«å˜é‡å®Œå…¨äº¤ç»™synç®¡ç†ï¼Œä½†synä»£ç å—å†…ä¸èƒ½ç¦ç”¨æŒ‡ä»¤é‡æ’ï¼Œvolatileæ‰å¯ä»¥ç¦ç”¨ï¼ï¼ï¼ï¼å¦‚æœä¸€ä¸ªå…±äº«å˜é‡å®Œå…¨è¢«synæ‰€ç®¡ç†ï¼Œé‚£ä¹ˆå…±äº«å˜é‡åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸ä¼šæœ‰åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§é—®é¢˜ã€‚å› ä¸ºå®Œå…¨ç”±synchronizedç®¡ç†çš„è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨ä»£ç å—å†…ï¼Œä¸€ä¸ªçº¿ç¨‹å°±ç®—æŒ‡ä»¤é‡æ’ä¹Ÿæ²¡é—®é¢˜ã€‚synçš„æœ‰åºæ€§æ˜¯å»ºç«‹åœ¨åŸå­æ€§çš„åŸºç¡€ä¸Šï¼Œä¸volatileå®ç°çš„æœ‰åºæ€§åŸç†ä¸åŒã€‚"><a href="#synå¯ä»¥ä¿è¯åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§ï¼Œå‰ææ˜¯å…±äº«å˜é‡å®Œå…¨äº¤ç»™synç®¡ç†ï¼Œä½†synä»£ç å—å†…ä¸èƒ½ç¦ç”¨æŒ‡ä»¤é‡æ’ï¼Œvolatileæ‰å¯ä»¥ç¦ç”¨ï¼ï¼ï¼ï¼å¦‚æœä¸€ä¸ªå…±äº«å˜é‡å®Œå…¨è¢«synæ‰€ç®¡ç†ï¼Œé‚£ä¹ˆå…±äº«å˜é‡åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸ä¼šæœ‰åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§é—®é¢˜ã€‚å› ä¸ºå®Œå…¨ç”±synchronizedç®¡ç†çš„è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨ä»£ç å—å†…ï¼Œä¸€ä¸ªçº¿ç¨‹å°±ç®—æŒ‡ä»¤é‡æ’ä¹Ÿæ²¡é—®é¢˜ã€‚synçš„æœ‰åºæ€§æ˜¯å»ºç«‹åœ¨åŸå­æ€§çš„åŸºç¡€ä¸Šï¼Œä¸volatileå®ç°çš„æœ‰åºæ€§åŸç†ä¸åŒã€‚" class="headerlink" title="synå¯ä»¥ä¿è¯åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§ï¼Œå‰ææ˜¯å…±äº«å˜é‡å®Œå…¨äº¤ç»™synç®¡ç†ï¼Œä½†synä»£ç å—å†…ä¸èƒ½ç¦ç”¨æŒ‡ä»¤é‡æ’ï¼Œvolatileæ‰å¯ä»¥ç¦ç”¨ï¼ï¼ï¼ï¼å¦‚æœä¸€ä¸ªå…±äº«å˜é‡å®Œå…¨è¢«synæ‰€ç®¡ç†ï¼Œé‚£ä¹ˆå…±äº«å˜é‡åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸ä¼šæœ‰åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§é—®é¢˜ã€‚å› ä¸ºå®Œå…¨ç”±synchronizedç®¡ç†çš„è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨ä»£ç å—å†…ï¼Œä¸€ä¸ªçº¿ç¨‹å°±ç®—æŒ‡ä»¤é‡æ’ä¹Ÿæ²¡é—®é¢˜ã€‚synçš„æœ‰åºæ€§æ˜¯å»ºç«‹åœ¨åŸå­æ€§çš„åŸºç¡€ä¸Šï¼Œä¸volatileå®ç°çš„æœ‰åºæ€§åŸç†ä¸åŒã€‚"></a>synå¯ä»¥ä¿è¯åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§ï¼Œå‰ææ˜¯å…±äº«å˜é‡å®Œå…¨äº¤ç»™synç®¡ç†ï¼Œä½†synä»£ç å—å†…ä¸èƒ½ç¦ç”¨æŒ‡ä»¤é‡æ’ï¼Œvolatileæ‰å¯ä»¥ç¦ç”¨ï¼ï¼ï¼ï¼å¦‚æœä¸€ä¸ªå…±äº«å˜é‡å®Œå…¨è¢«synæ‰€ç®¡ç†ï¼Œé‚£ä¹ˆå…±äº«å˜é‡åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸ä¼šæœ‰åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§é—®é¢˜ã€‚å› ä¸ºå®Œå…¨ç”±synchronizedç®¡ç†çš„è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨ä»£ç å—å†…ï¼Œä¸€ä¸ªçº¿ç¨‹å°±ç®—æŒ‡ä»¤é‡æ’ä¹Ÿæ²¡é—®é¢˜ã€‚synçš„æœ‰åºæ€§æ˜¯å»ºç«‹åœ¨åŸå­æ€§çš„åŸºç¡€ä¸Šï¼Œä¸volatileå®ç°çš„æœ‰åºæ€§åŸç†ä¸åŒã€‚</h2><h2 id="3-6-double-checked-locking-é—®é¢˜"><a href="#3-6-double-checked-locking-é—®é¢˜" class="headerlink" title="3.6 double-checked locking é—®é¢˜:"></a>3.6 double-checked locking é—®é¢˜:</h2><h3 id="æœ€åˆä»£ç ï¼š"><a href="#æœ€åˆä»£ç ï¼š" class="headerlink" title="æœ€åˆä»£ç ï¼š"></a>æœ€åˆä»£ç ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ€å¼€å§‹çš„å•ä¾‹æ¨¡å¼æ˜¯è¿™æ ·çš„</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">// é¦–æ¬¡è®¿é—®ä¼šåŒæ­¥ï¼Œè€Œä¹‹åçš„ä½¿ç”¨å¯ä»¥ä¸ç”¨è¿›å…¥synchronizedï¼Œå‡å°‘æ€§èƒ½æŸè€—</span></span><br><span class="line">       <span class="keyword">synchronized</span>(Singleton.class) &#123;</span><br><span class="line">       <span class="keyword">if</span> (INSTANCE == <span class="literal">null</span>) &#123; <span class="comment">// t1</span></span><br><span class="line">       INSTANCE = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">           <span class="keyword">return</span> INSTANCE;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="åˆ†æï¼š-1"><a href="#åˆ†æï¼š-1" class="headerlink" title="åˆ†æï¼š"></a>åˆ†æï¼š</h4><p>ä¸Šé¢çš„ä»£ç å—çš„æ•ˆç‡æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºå³ä½¿å·²ç»äº§ç”Ÿäº†å•å®ä¾‹ä¹‹åï¼Œä¹‹åè°ƒç”¨äº†getInstance()æ–¹æ³•ä¹‹åè¿˜æ˜¯ä¼šåŠ é”ï¼Œè¿™ä¼šä¸¥é‡å½±å“æ€§èƒ½ï¼å› æ­¤å°±æœ‰äº†æ¨¡å¼å¦‚ä¸‹double-checked lockingï¼š</p><h3 id="æ”¹è¿›1ï¼š"><a href="#æ”¹è¿›1ï¼š" class="headerlink" title="æ”¹è¿›1ï¼š"></a>æ”¹è¿›1ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(INSTANCE == <span class="literal">null</span>) &#123; <span class="comment">// t2</span></span><br><span class="line">            <span class="comment">// é¦–æ¬¡è®¿é—®ä¼šåŒæ­¥ï¼Œè€Œä¹‹åçš„ä½¿ç”¨æ²¡æœ‰ synchronized</span></span><br><span class="line">            <span class="keyword">synchronized</span>(Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (INSTANCE == <span class="literal">null</span>) &#123; <span class="comment">// t1</span></span><br><span class="line">                    INSTANCE = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ†æï¼š-2"><a href="#åˆ†æï¼š-2" class="headerlink" title="åˆ†æï¼š"></a>åˆ†æï¼š</h4><p>æ‡’æƒ°å®ä¾‹åŒ–<br>é¦–æ¬¡ä½¿ç”¨ getInstance() æ‰ä½¿ç”¨ synchron ized åŠ é”ï¼Œåç»­ä½¿ç”¨æ—¶æ— éœ€åŠ é”ã€‚é‡Œé¢çš„ifæ˜¯ä¸ºäº†é˜²æ­¢å‰é¢çš„çº¿ç¨‹é‡å¤åˆ›å»ºå¯¹è±¡ï¼Œè€Œå¤–é¢çš„ifæ˜¯ä¸ºäº†åé¢çš„çº¿ç¨‹é‡å¤åŠ é”,æŸè€—æ€§èƒ½<br><strong>æœ‰éšå«çš„ï¼Œä½†å¾ˆå…³é”®çš„ä¸€ç‚¹ï¼šç¬¬ä¸€ä¸ª if ä½¿ç”¨äº† INSTANCE å˜é‡ï¼Œæ˜¯åœ¨åŒæ­¥å—ä¹‹å¤–ï¼Œ</strong>ä¸èƒ½äº«æœ‰synchronizedä¿è¯çš„åŸå­æ€§ï¼Œå¯è§æ€§ã€æœ‰åºæ€§ï¼Œå¯èƒ½ä¼šç”±äºsynä»£ç å—ä¸­ new è¿‡ç¨‹ äº§ç”ŸæŒ‡ä»¤é‡æ’ å¯¼è‡´è·å–åˆ°ä¸€ä¸ªåŠæˆå“å¯¹è±¡ã€‚</p><h3 id="getInstance-æ–¹æ³•å¯¹åº”çš„å­—èŠ‚ç ä¸ºï¼š"><a href="#getInstance-æ–¹æ³•å¯¹åº”çš„å­—èŠ‚ç ä¸ºï¼š" class="headerlink" title="getInstance æ–¹æ³•å¯¹åº”çš„å­—èŠ‚ç ä¸ºï¼š"></a>getInstance æ–¹æ³•å¯¹åº”çš„å­—èŠ‚ç ä¸ºï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: getstatic #<span class="number">2</span> <span class="comment">// Field INSTANCE:Lcn/itcast/n5/Singleton;</span></span><br><span class="line"><span class="number">3</span>: ifnonnull <span class="number">37</span></span><br><span class="line"><span class="comment">// ldcæ˜¯è·å¾—ç±»å¯¹è±¡</span></span><br><span class="line"><span class="number">6</span>: ldc #<span class="number">3</span> <span class="comment">// class cn/itcast/n5/Singleton</span></span><br><span class="line"><span class="comment">// å¤åˆ¶æ“ä½œæ•°æ ˆæ ˆé¡¶çš„å€¼æ”¾å…¥æ ˆé¡¶, å°†ç±»å¯¹è±¡çš„å¼•ç”¨åœ°å€å¤åˆ¶äº†ä¸€ä»½</span></span><br><span class="line"><span class="number">8</span>: dup</span><br><span class="line"><span class="comment">// æ“ä½œæ•°æ ˆæ ˆé¡¶çš„å€¼å¼¹å‡ºï¼Œå³å°†å¯¹è±¡çš„å¼•ç”¨åœ°å€å­˜åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­</span></span><br><span class="line"><span class="comment">// å°†ç±»å¯¹è±¡çš„å¼•ç”¨åœ°å€å­˜å‚¨äº†ä¸€ä»½ï¼Œæ˜¯ä¸ºäº†å°†æ¥è§£é”ç”¨</span></span><br><span class="line"><span class="number">9</span>: astore_0</span><br><span class="line"><span class="number">10</span>: monitorenter</span><br><span class="line"><span class="number">11</span>: getstatic #<span class="number">2</span> <span class="comment">// Field INSTANCE:Lcn/itcast/n5/Singleton;</span></span><br><span class="line"><span class="number">14</span>: ifnonnull <span class="number">27</span></span><br><span class="line"><span class="comment">// æ–°å»ºä¸€ä¸ªå®ä¾‹</span></span><br><span class="line"><span class="number">17</span>: <span class="keyword">new</span> #<span class="number">3</span> <span class="comment">// class cn/itcast/n5/Singleton</span></span><br><span class="line"><span class="comment">// å¤åˆ¶äº†ä¸€ä¸ªå®ä¾‹çš„å¼•ç”¨</span></span><br><span class="line"><span class="number">20</span>: dup</span><br><span class="line"><span class="comment">// é€šè¿‡è¿™ä¸ªå¤åˆ¶çš„å¼•ç”¨è°ƒç”¨å®ƒçš„æ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="number">21</span>: invokespecial #<span class="number">4</span> <span class="comment">// Method &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line"><span class="comment">// æœ€å¼€å§‹çš„è¿™ä¸ªå¼•ç”¨ç”¨æ¥è¿›è¡Œèµ‹å€¼æ“ä½œ</span></span><br><span class="line"><span class="number">24</span>: putstatic #<span class="number">2</span> <span class="comment">// Field INSTANCE:Lcn/itcast/n5/Singleton;</span></span><br><span class="line"><span class="number">27</span>: aload_0</span><br><span class="line"><span class="number">28</span>: monitorexit</span><br><span class="line"><span class="number">29</span>: goto <span class="number">37</span></span><br><span class="line"><span class="number">32</span>: astore_1</span><br><span class="line"><span class="number">33</span>: aload_0</span><br><span class="line"><span class="number">34</span>: monitorexit</span><br><span class="line"><span class="number">35</span>: aload_1</span><br><span class="line"><span class="number">36</span>: athrow</span><br><span class="line"><span class="number">37</span>: getstatic #<span class="number">2</span> <span class="comment">// Field INSTANCE:Lcn/itcast/n5/Singleton;</span></span><br><span class="line"><span class="number">40</span>: areturn</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å…¶ä¸­ï¼š"><a href="#å…¶ä¸­ï¼š" class="headerlink" title="å…¶ä¸­ï¼š"></a>å…¶ä¸­ï¼š</h4><ul><li>17 è¡¨ç¤ºåˆ›å»ºå¯¹è±¡ï¼Œå°†å¯¹è±¡å¼•ç”¨å…¥æ ˆ &#x2F;&#x2F; new Singleton</li><li>20 è¡¨ç¤ºå¤åˆ¶ä¸€ä»½å¯¹è±¡å¼•ç”¨ &#x2F;&#x2F; å¤åˆ¶äº†å¼•ç”¨åœ°å€åˆ°æ ˆä¸­</li><li>21 è¡¨ç¤ºåˆ©ç”¨ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œè°ƒç”¨æ„é€ æ–¹æ³• &#x2F;&#x2F; æ ¹æ®å¤åˆ¶çš„å¼•ç”¨åœ°å€è°ƒç”¨ æ„é€ æ–¹æ³•()</li><li>24 è¡¨ç¤ºåˆ©ç”¨ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œ**èµ‹å€¼ç»™ static INSTANCE **</li></ul><h4 id="å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæ˜¯æœ‰é—®é¢˜çš„ï¼š"><a href="#å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæ˜¯æœ‰é—®é¢˜çš„ï¼š" class="headerlink" title="å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæ˜¯æœ‰é—®é¢˜çš„ï¼š"></a>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæ˜¯æœ‰é—®é¢˜çš„ï¼š</h4><p>ä¹Ÿè®¸ jvm ä¼šä¼˜åŒ–ä¸ºï¼šåœ¨synä»£ç å—ä¸­å‘ç”Ÿ æŒ‡ä»¤é‡æ’ï¼Œå…ˆæ‰§è¡Œ 24ï¼Œå†æ‰§è¡Œ 21ã€‚   **  **<br><strong>å¹¶ä¸” ä¸¤ä¸ªçº¿ç¨‹ t1ï¼Œt2  æŒ‰å¦‚ä¸‹æ—¶é—´åºåˆ—æ‰§è¡Œï¼š</strong><br><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1649940127913-311c97d3-1655-44fb-b66f-b419e9f0b69e.png#averageHue=%23fafafa&clientId=u2908829a-b6ac-4&from=paste&id=uc746b838&originHeight=820&originWidth=914&originalType=url&ratio=1&rotation=0&showTitle=false&size=141258&status=done&style=none&taskId=ud3ea8fec-dadf-4267-b6fa-66d071b4e0f&title=" alt="image.png"></p><h3 id="æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼š"><a href="#æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼š"></a>æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼š</h3><ol><li>å…³é”®åœ¨äº** 0: getstatic <strong>è¿™è¡Œå­—èŠ‚ç  åœ¨ monitor æ§åˆ¶ä¹‹å¤–ï¼Œå®ƒå°±åƒä¹‹å‰ä¸¾ä¾‹ä¸­ä¸å®ˆè§„åˆ™çš„äººï¼Œ</strong>å¯ä»¥è¶Šè¿‡ monitor è¯»å– INSTANCE å˜é‡çš„å€¼**</li><li>è¿™æ—¶ t1 <strong>è¿˜æœªå®Œå…¨å°†æ„é€ æ–¹æ³•æ‰§è¡Œå®Œæ¯•</strong>ï¼Œå¦‚æœåœ¨æ„é€ æ–¹æ³•ä¸­è¦æ‰§è¡Œå¾ˆå¤šåˆå§‹åŒ–æ“ä½œï¼Œé‚£ä¹ˆ **t2 <strong>æ‹¿åˆ°çš„æ˜¯å°†æ˜¯ä¸€ä¸ª</strong>æœªåˆå§‹åŒ–å®Œæ¯•çš„å•ä¾‹ **</li><li>å¯¹ INSTANCE ä½¿ç”¨ volatile ä¿®é¥°å³å¯ï¼Œ<strong>volatileå¯ä»¥ç¦ç”¨æŒ‡ä»¤é‡æ’</strong>ï¼Œåº•å±‚æ˜¯å†…å­˜å±éšœã€‚ä½†è¦æ³¨æ„åœ¨ JDK 5 ä»¥ä¸Šçš„ç‰ˆæœ¬çš„ volatile æ‰ä¼šçœŸæ­£æœ‰æ•ˆã€‚</li></ol><h4 id="ä»£ç ï¼šåŠ volatileå°±è¡Œäº†"><a href="#ä»£ç ï¼šåŠ volatileå°±è¡Œäº†" class="headerlink" title="ä»£ç ï¼šåŠ volatileå°±è¡Œäº†"></a>ä»£ç ï¼šåŠ volatileå°±è¡Œäº†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">           <span class="comment">//å¯ä»¥åœ¨æ„é€ æ–¹æ³•é‡Œé¢åŠ ä¸ªåˆ¤æ–­ï¼Œå¦‚æœINSTANCE != nullï¼Œå°±æŠ›ä¸ªå¼‚å¸¸ã€‚å› ä¸ºåå°„å¯ä»¥æ‹¿åˆ°ç§æœ‰çš„æ„é€ æ–¹æ³•ï¼Œä»è€Œåˆ›å»ºå¯¹è±¡ã€‚</span></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">           <span class="comment">// å®ä¾‹æ²¡åˆ›å»ºï¼Œæ‰ä¼šè¿›å…¥å†…éƒ¨çš„ synchronizedä»£ç å—</span></span><br><span class="line">           <span class="keyword">if</span> (INSTANCE == <span class="literal">null</span>) &#123;</span><br><span class="line">               <span class="keyword">synchronized</span> (Singleton.class) &#123; <span class="comment">// t2</span></span><br><span class="line">                   <span class="comment">// ä¹Ÿè®¸æœ‰å…¶å®ƒçº¿ç¨‹å·²ç»åˆ›å»ºå®ä¾‹ï¼Œæ‰€ä»¥å†åˆ¤æ–­ä¸€æ¬¡</span></span><br><span class="line">                   <span class="keyword">if</span> (INSTANCE == <span class="literal">null</span>) &#123; <span class="comment">// t1</span></span><br><span class="line">                       INSTANCE = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> INSTANCE;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="å­—èŠ‚ç ä¸Šçœ‹ä¸å‡ºæ¥-volatile-æŒ‡ä»¤çš„æ•ˆæœï¼š"><a href="#å­—èŠ‚ç ä¸Šçœ‹ä¸å‡ºæ¥-volatile-æŒ‡ä»¤çš„æ•ˆæœï¼š" class="headerlink" title="å­—èŠ‚ç ä¸Šçœ‹ä¸å‡ºæ¥ volatile æŒ‡ä»¤çš„æ•ˆæœï¼š"></a>å­—èŠ‚ç ä¸Šçœ‹ä¸å‡ºæ¥ volatile æŒ‡ä»¤çš„æ•ˆæœï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -------------------------------------&gt; åŠ å…¥å¯¹ INSTANCE å˜é‡çš„è¯»å±éšœ</span></span><br><span class="line"><span class="number">0</span>: getstatic #<span class="number">2</span> <span class="comment">// Field INSTANCE:Lcn/itcast/n5/Singleton;</span></span><br><span class="line"><span class="number">3</span>: ifnonnull <span class="number">37</span></span><br><span class="line"><span class="number">6</span>: ldc #<span class="number">3</span> <span class="comment">// class cn/itcast/n5/Singleton</span></span><br><span class="line"><span class="number">8</span>: dup</span><br><span class="line"><span class="number">9</span>: astore_0</span><br><span class="line"><span class="number">10</span>: monitorenter -----------------------&gt; ä¿è¯åŸå­æ€§ã€å¯è§æ€§</span><br><span class="line"><span class="number">11</span>: getstatic #<span class="number">2</span> <span class="comment">// Field INSTANCE:Lcn/itcast/n5/Singleton;</span></span><br><span class="line"><span class="number">14</span>: ifnonnull <span class="number">27</span></span><br><span class="line"><span class="number">17</span>: <span class="keyword">new</span> #<span class="number">3</span> <span class="comment">// class cn/itcast/n5/Singleton</span></span><br><span class="line"><span class="number">20</span>: dup</span><br><span class="line"><span class="number">21</span>: invokespecial #<span class="number">4</span> <span class="comment">// Method &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line"><span class="number">24</span>: putstatic #<span class="number">2</span> <span class="comment">// Field INSTANCE:Lcn/itcast/n5/Singleton;</span></span><br><span class="line"><span class="comment">// -------------------------------------&gt; åŠ å…¥å¯¹ INSTANCE å˜é‡çš„å†™å±éšœ</span></span><br><span class="line"><span class="number">27</span>: aload_0</span><br><span class="line"><span class="number">28</span>: monitorexit ------------------------&gt; ä¿è¯åŸå­æ€§ã€å¯è§æ€§</span><br><span class="line"><span class="number">29</span>: goto <span class="number">37</span></span><br><span class="line"><span class="number">32</span>: astore_1</span><br><span class="line"><span class="number">33</span>: aload_0</span><br><span class="line"><span class="number">34</span>: monitorexit</span><br><span class="line"><span class="number">35</span>: aload_1</span><br><span class="line"><span class="number">36</span>: athrow</span><br><span class="line"><span class="number">37</span>: getstatic #<span class="number">2</span> <span class="comment">// Field INSTANCE:Lcn/itcast/n5/Singleton;</span></span><br><span class="line"><span class="number">40</span>: areturn</span><br></pre></td></tr></table></figure><h5 id="ä»åº•å±‚å†…å­˜å±éšœåˆ†æï¼š"><a href="#ä»åº•å±‚å†…å­˜å±éšœåˆ†æï¼š" class="headerlink" title="ä»åº•å±‚å†…å­˜å±éšœåˆ†æï¼š"></a>ä»åº•å±‚å†…å­˜å±éšœåˆ†æï¼š</h5><p>å¦‚ä¸Šé¢çš„æ³¨é‡Šå†…å®¹æ‰€ç¤ºï¼Œè¯»å†™ volatile å˜é‡æ“ä½œï¼ˆå³getstaticæ“ä½œå’Œputstaticæ“ä½œï¼‰æ—¶ä¼šåŠ å…¥å†…å­˜å±éšœï¼ˆMemory Barrierï¼ˆMemory Fenceï¼‰ï¼‰ï¼Œ<strong>ä¿è¯ä¸‹é¢ä¸¤ç‚¹ï¼š</strong></p><ol><li>å¯è§æ€§<ol><li>å†™å±éšœï¼ˆsfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹å‰çš„ t1 å¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜å½“ä¸­</li><li>è€Œè¯»å±éšœï¼ˆlfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹å t2 å¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­æœ€æ–°æ•°æ®</li></ol></li><li><strong>æœ‰åºæ€§</strong><ol><li>å†™å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†å†™å±éšœä¹‹å‰çš„ä»£ç æ’åœ¨å†™å±éšœä¹‹å</li><li>è¯»å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†è¯»å±éšœä¹‹åçš„ä»£ç æ’åœ¨è¯»å±éšœä¹‹å‰</li></ol></li><li>æ›´åº•å±‚æ˜¯è¯»å†™å˜é‡æ—¶ä½¿ç”¨ lock æŒ‡ä»¤æ¥å¤šæ ¸ CPU ä¹‹é—´çš„å¯è§æ€§ä¸æœ‰åºæ€§</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1649943204849-2a5ee5b4-f5fe-430d-b2ce-5e12249fe9c9.png#averageHue=%23fafafa&clientId=u2908829a-b6ac-4&from=paste&height=783&id=u6bc6a86a&originHeight=881&originWidth=942&originalType=binary&ratio=1&rotation=0&showTitle=false&size=132190&status=done&style=none&taskId=udeada633-0be2-428d-94b2-3ac559e8e79&title=&width=837.3333333333334" alt="image.png"></p><h5 id="volatileæ˜¯ä¿è¯çº¿ç¨‹å†…æŒ‡ä»¤ç¦ç”¨é‡æ’åºï¼Œç®¡ä¸åˆ°çº¿ç¨‹é—´ï¼š"><a href="#volatileæ˜¯ä¿è¯çº¿ç¨‹å†…æŒ‡ä»¤ç¦ç”¨é‡æ’åºï¼Œç®¡ä¸åˆ°çº¿ç¨‹é—´ï¼š" class="headerlink" title="volatileæ˜¯ä¿è¯çº¿ç¨‹å†…æŒ‡ä»¤ç¦ç”¨é‡æ’åºï¼Œç®¡ä¸åˆ°çº¿ç¨‹é—´ï¼š"></a>volatileæ˜¯ä¿è¯çº¿ç¨‹å†…æŒ‡ä»¤ç¦ç”¨é‡æ’åºï¼Œç®¡ä¸åˆ°çº¿ç¨‹é—´ï¼š</h5><p>å°±ç®—cpuè¿™æ ·å­è°ƒåº¦ï¼Œä¹Ÿæ˜¯okçš„ï¼Œæ­¤æ—¶t2çº¿ç¨‹ifï¼ˆ&#x3D;&#x3D;nullï¼‰ åˆ¤æ–­æˆåŠŸ<br><img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1649942964600-1a29b3dc-4b1f-4640-9488-3ec0cac0104d.png#averageHue=%23f8f8f8&clientId=u2908829a-b6ac-4&from=paste&height=757&id=u0c86551f&originHeight=852&originWidth=908&originalType=binary&ratio=1&rotation=0&showTitle=false&size=138939&status=done&style=none&taskId=u040aa0d6-d72a-4788-a3e2-fca26a85a7c&title=&width=807.1111111111111" alt="image.png"></p><h1 id="4ã€happens-beforeï¼š"><a href="#4ã€happens-beforeï¼š" class="headerlink" title="4ã€happens-beforeï¼š"></a>4ã€happens-beforeï¼š</h1><h2 id="å®šä¹‰ï¼š"><a href="#å®šä¹‰ï¼š" class="headerlink" title="å®šä¹‰ï¼š"></a>å®šä¹‰ï¼š</h2><p>happens-before è§„å®šäº†å¯¹å…±äº«å˜é‡çš„<strong>å†™æ“ä½œ</strong>å¯¹å…¶å®ƒçº¿ç¨‹çš„<strong>è¯»æ“ä½œ</strong>å¯è§ï¼Œå®ƒæ˜¯å¯è§æ€§ä¸æœ‰åºæ€§çš„<strong>ä¸€å¥—è§„åˆ™æ€»ç»“</strong>ã€‚æŠ›å¼€ä»¥ä¸‹ happens-before è§„åˆ™ï¼ŒJM </p><h2 id="å‡ ç§è§„åˆ™ï¼š"><a href="#å‡ ç§è§„åˆ™ï¼š" class="headerlink" title="å‡ ç§è§„åˆ™ï¼š"></a>å‡ ç§è§„åˆ™ï¼š</h2><p>ä¸‹é¢è¯´çš„å˜é‡éƒ½æ˜¯æŒ‡æˆå‘˜å˜é‡æˆ–é™æ€æˆå‘˜å˜é‡ï¼Œå³å…±äº«å˜é‡<br>â‘  çº¿ç¨‹A è§£é” m ä¹‹å‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹äºæ¥ä¸‹æ¥å¯¹ m åŠ é”çš„å…¶å®ƒçº¿ç¨‹B å¯¹è¯¥å˜é‡çš„è¯»å¯è§<br>å› ä¸º çº¿ç¨‹A è§£é”å‰å°†xå˜é‡çš„å€¼ä¿å­˜åˆ°äº†ä¸»å†…å­˜ï¼Œåœ¨é‡Šæ”¾é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> x;</span><br><span class="line">   <span class="keyword">static</span> <span class="type">Object</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">   <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">       <span class="keyword">synchronized</span>(m) &#123;</span><br><span class="line">           x = <span class="number">10</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;,<span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">   <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">       <span class="keyword">synchronized</span>(m) &#123;</span><br><span class="line">           System.out.println(x);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;,<span class="string">&quot;t2&quot;</span>).start();</span><br></pre></td></tr></table></figure><p>â‘¡ çº¿ç¨‹å¯¹ volatile å˜é‡çš„å†™ï¼Œå¯¹æ¥ä¸‹æ¥å…¶å®ƒçº¿ç¨‹å¯¹è¯¥å˜é‡çš„è¯»å¯è§<br>volatile ä¿è¯å†™å…¥æ“ä½œæ˜¯å†™å…¥ä¸»å­˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">volatile</span> <span class="keyword">static</span> <span class="type">int</span> x;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line"> x = <span class="number">10</span>;</span><br><span class="line">&#125;,<span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line"> System.out.println(x);</span><br><span class="line">&#125;,<span class="string">&quot;t2&quot;</span>).start();</span><br></pre></td></tr></table></figure><p>â‘¢ çº¿ç¨‹ start å‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹è¯¥çº¿ç¨‹å¼€å§‹åå¯¹è¯¥å˜é‡çš„è¯»å¯è§<br>è¿™æ˜¯å¯åŠ¨çº¿ç¨‹å‰å°†å·¥ä½œå†…å­˜ä¿å­˜åˆ°äº†ä¸»å†…å­˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> x;</span><br><span class="line">x = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line"> System.out.println(x);</span><br><span class="line">&#125;,<span class="string">&quot;t2&quot;</span>).start();</span><br></pre></td></tr></table></figure><p>â‘£ çº¿ç¨‹ç»“æŸå‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹å…¶å®ƒçº¿ç¨‹å¾—çŸ¥å®ƒç»“æŸåçš„è¯»å¯è§ï¼ˆæ¯”å¦‚å…¶å®ƒçº¿ç¨‹è°ƒç”¨ t1.isAlive() æˆ– t1.join()ç­‰å¾…å®ƒç»“æŸï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> x;</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line"> x = <span class="number">10</span>;</span><br><span class="line">&#125;,<span class="string">&quot;t1&quot;</span>);</span><br><span class="line">t1.start();</span><br><span class="line">t1.join();</span><br><span class="line">System.out.println(x);</span><br></pre></td></tr></table></figure><p>â‘¤ çº¿ç¨‹ t1 æ‰“æ–­ t2ï¼ˆinterruptï¼‰å‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹äºå…¶ä»–çº¿ç¨‹å¾—çŸ¥ t2 è¢«æ‰“æ–­åå¯¹å˜é‡çš„è¯»å¯è§ï¼ˆé€šè¿‡t2.interrupted æˆ– t2.isInterruptedï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> x;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">           <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">               <span class="keyword">if</span>(Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">                   System.out.println(x);</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;,<span class="string">&quot;t2&quot;</span>);</span><br><span class="line">       t2.start();</span><br><span class="line">       <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">           sleep(<span class="number">1</span>);</span><br><span class="line">           x = <span class="number">10</span>;</span><br><span class="line">           t2.interrupt();</span><br><span class="line">       &#125;,<span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">       <span class="keyword">while</span>(!t2.isInterrupted()) &#123;</span><br><span class="line">           Thread.<span class="keyword">yield</span>();</span><br><span class="line">       &#125;</span><br><span class="line">       System.out.println(x);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>â‘¥ å¯¹å˜é‡é»˜è®¤å€¼ï¼ˆ0ï¼Œfalseï¼Œnullï¼‰çš„å†™ï¼Œå¯¹å…¶å®ƒçº¿ç¨‹å¯¹è¯¥å˜é‡çš„è¯»å¯è§<br>â‘¦ å…·æœ‰ä¼ é€’æ€§ï¼Œå¦‚æœ x hb-&gt; y å¹¶ä¸” y hb-&gt; z é‚£ä¹ˆæœ‰ x hb-&gt; z ï¼Œé…åˆ volatile çš„é˜²æŒ‡ä»¤é‡æ’ï¼Œæœ‰ä¸‹é¢çš„ä¾‹å­<br>å†™å±éšœä¹‹ä¸Šçš„ä»£ç å¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨éƒ½åŒæ­¥åˆ°ä¸»å­˜ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">volatile</span> <span class="keyword">static</span> <span class="type">int</span> x;</span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> y;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">     y = <span class="number">10</span>;</span><br><span class="line">     x = <span class="number">20</span>;</span><br><span class="line">&#125;,<span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">    <span class="comment">// x=20 å¯¹ t2 å¯è§, åŒæ—¶ y=10 ä¹Ÿå¯¹ t2 å¯è§</span></span><br><span class="line">    System.out.println(x);</span><br><span class="line"> &#125;,<span class="string">&quot;t2&quot;</span>).start();</span><br></pre></td></tr></table></figure><h1 id="volatileæ€»ç»“ï¼š"><a href="#volatileæ€»ç»“ï¼š" class="headerlink" title="volatileæ€»ç»“ï¼š"></a>volatileæ€»ç»“ï¼š</h1><p>volatile<strong>ä¸»è¦ç”¨åœ¨</strong>ä¸€ä¸ªçº¿ç¨‹å†™ å¤šä¸ªçº¿ç¨‹è¯» æ—¶çš„æ¥ä¿è¯å¯è§æ€§ï¼Œå’Œdouble-checked lockingæ¨¡å¼ä¸­ä¿è¯synchronizedä»£ç å—å¤–çš„å…±äº«å˜é‡çš„é‡æ’åºé—®é¢˜ã€‚</p><h1 id="5ã€ç»ƒä¹ ï¼š"><a href="#5ã€ç»ƒä¹ ï¼š" class="headerlink" title="5ã€ç»ƒä¹ ï¼š"></a>5ã€ç»ƒä¹ ï¼š</h1><h2 id="1ï¼‰balking-æ¨¡å¼ä¹ é¢˜ï¼š"><a href="#1ï¼‰balking-æ¨¡å¼ä¹ é¢˜ï¼š" class="headerlink" title="1ï¼‰balking æ¨¡å¼ä¹ é¢˜ï¼š"></a>1ï¼‰balking æ¨¡å¼ä¹ é¢˜ï¼š</h2><p>å¸Œæœ› doInit() æ–¹æ³•ä»…è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä¸‹é¢çš„å®ç°æ˜¯å¦æœ‰é—®é¢˜ï¼Œä¸ºä»€ä¹ˆï¼Ÿ<br>volatile æ— æ³•ä¿è¯åŸå­æ€§ï¼Œå¤šçº¿ç¨‹ä¸‹è‚¯å®šè¦åŠ synchronized<br>volatile å¯ä»¥ä¿å­˜çº¿ç¨‹çš„å¯è§æ€§ï¼Œæœ‰åºæ€§ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯åŸå­æ€§ï¼ŒdoInit æ–¹æ³•æ²¡åŠ é”ï¼Œå¯èƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestVolatile</span> &#123;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">initialized</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (initialized) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        doInit();</span><br><span class="line">        initialized = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doInit</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2ï¼‰çº¿ç¨‹å®‰å…¨å•ä¾‹ä¹ é¢˜"><a href="#2ï¼‰çº¿ç¨‹å®‰å…¨å•ä¾‹ä¹ é¢˜" class="headerlink" title="2ï¼‰çº¿ç¨‹å®‰å…¨å•ä¾‹ä¹ é¢˜:"></a>2ï¼‰çº¿ç¨‹å®‰å…¨å•ä¾‹ä¹ é¢˜:</h2><p>å•ä¾‹æ¨¡å¼æœ‰å¾ˆå¤šå®ç°æ–¹æ³•ï¼Œé¥¿æ±‰ã€æ‡’æ±‰ã€é™æ€å†…éƒ¨ç±»ã€æšä¸¾ç±»ï¼Œè¯•ç€åˆ†ææ¯ç§å®ç°ä¸‹è·å–å•ä¾‹å¯¹è±¡ï¼ˆå³è°ƒç”¨ getInstanceï¼‰æ—¶çš„çº¿ç¨‹å®‰å…¨ï¼Œå¹¶æ€è€ƒæ³¨é‡Šä¸­çš„é—®é¢˜</p><ul><li>é¥¿æ±‰å¼ï¼šç±»åŠ è½½å°±ä¼šå¯¼è‡´è¯¥å•å®ä¾‹å¯¹è±¡è¢«åˆ›å»º<ul><li>é¥¿æ±‰å¼ä¾é ç±»åŠ è½½æ—¶çš„clinité™æ€åˆå§‹åŒ–æ—¶æ‰§è¡Œï¼Œä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œå¯¹å†…å­˜ä¸å‹å¥½ï¼Œç±»å‡†å¤‡é˜¶æ®µç›´æ¥èµ‹å€¼</li></ul></li><li>æ‡’æ±‰å¼ï¼šç±»åŠ è½½ä¸ä¼šå¯¼è‡´è¯¥å•å®ä¾‹å¯¹è±¡è¢«åˆ›å»ºï¼Œè€Œæ˜¯é¦–æ¬¡ä½¿ç”¨è¯¥å¯¹è±¡æ—¶æ‰ä¼šåˆ›å»º</li></ul><h3 id="å®ç°1ï¼šé¥¿æ±‰å¼"><a href="#å®ç°1ï¼šé¥¿æ±‰å¼" class="headerlink" title="å®ç°1ï¼šé¥¿æ±‰å¼"></a>å®ç°1ï¼šé¥¿æ±‰å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é—®é¢˜1ï¼šä¸ºä»€ä¹ˆåŠ  final? é˜²æ­¢å­ç±»ç»§æ‰¿è¿™ä¸ªå•ä¾‹ç±» ç„¶åé‡å†™æ–¹æ³•</span></span><br><span class="line"><span class="comment">// é—®é¢˜2ï¼šå¦‚æœå®ç°äº†åºåˆ—åŒ–æ¥å£, è¿˜è¦åšä»€ä¹ˆæ¥é˜²æ­¢ååºåˆ—åŒ–ç ´åå•ä¾‹?  è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™ä¼šç”Ÿæˆæ–°çš„å¯¹è±¡ï¼Œå°±ç ´åå•ä¾‹äº†ã€‚è¦è§£å†³ç›´æ¥åŠ ä¸ŠreadResolve()æ–¹æ³•å°±è¡Œäº†ï¼Œå¦‚ä¸‹æ‰€ç¤º</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">// é—®é¢˜3ï¼šä¸ºä»€ä¹ˆè®¾ç½®ä¸ºç§æœ‰? é˜²æ­¢å…¶å®ƒç±»ä¸­ä½¿ç”¨newç”Ÿæˆæ–°çš„å®ä¾‹ï¼Œæ˜¯å¦èƒ½é˜²æ­¢åå°„åˆ›å»ºæ–°çš„å®ä¾‹?ä¸èƒ½ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// é—®é¢˜4ï¼šè¿™æ ·åˆå§‹åŒ–æ˜¯å¦èƒ½ä¿è¯å•ä¾‹å¯¹è±¡åˆ›å»ºæ—¶çš„çº¿ç¨‹å®‰å…¨?å¯ä»¥ï¼Œè¿™æ˜¯ç±»å˜é‡ï¼Œæ˜¯jvmåœ¨ç±»åŠ è½½é˜¶æ®µå°±è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œjvmä¿è¯äº†æ­¤æ“ä½œçš„çº¿ç¨‹å®‰å…¨æ€§ã€‚clinitæ–¹æ³•ï¼Œçº¿ç¨‹å®‰å…¨çš„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    <span class="comment">// é—®é¢˜5ï¼šä¸ºä»€ä¹ˆæä¾›é™æ€æ–¹æ³•è€Œä¸æ˜¯ç›´æ¥å°† INSTANCE è®¾ç½®ä¸º public, è¯´å‡ºä½ çŸ¥é“çš„ç†ç”±ã€‚</span></span><br><span class="line">    <span class="comment">//1.æä¾›æ›´å¥½çš„å°è£…æ€§ï¼Œå¯ä»¥è¿›è¡Œæ‡’æƒ°çš„åˆå§‹åŒ–ï¼›  2.æä¾›èŒƒå‹çš„æ”¯æŒ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ–¹æ³•åæ˜¯ï¼šreadResolve()ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢ç±»åœ¨ååºåˆ—åŒ–çš„æ—¶å€™åˆ›å»ºå¯¹è±¡ã€‚</span></span><br><span class="line">    <span class="comment">//å½“ç”¨ååºåˆ—åŒ–åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨readResovle()ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥ç»™å®ƒé‡å†™ï¼Œè®©å®ƒè¿”å›æˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡å°±è¡Œäº†ã€‚</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°2ï¼šæšä¸¾ç±»-é¥¿æ±‰å¼"><a href="#å®ç°2ï¼šæšä¸¾ç±»-é¥¿æ±‰å¼" class="headerlink" title="å®ç°2ï¼šæšä¸¾ç±»-é¥¿æ±‰å¼"></a>å®ç°2ï¼šæšä¸¾ç±»-é¥¿æ±‰å¼<img src="https://cdn.nlark.com/yuque/0/2022/png/25949200/1649985872537-ac83cb76-b326-4fd2-ba85-4467753f110b.png#averageHue=%23faf5f2&clientId=uc3c01388-aa91-4&from=paste&height=610&id=u5a706353&originHeight=686&originWidth=1337&originalType=binary&ratio=1&rotation=0&showTitle=false&size=322387&status=done&style=none&taskId=ub599bb76-9739-468f-8472-d6ffdd76fba&title=&width=1188.4444444444443" alt="image.png"></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é—®é¢˜1ï¼šæšä¸¾å•ä¾‹æ˜¯å¦‚ä½•é™åˆ¶å®ä¾‹ä¸ªæ•°çš„ï¼Ÿ</span></span><br><span class="line">    åˆ›å»ºæšä¸¾ç±»çš„æ—¶å€™å°±å·²ç»å®šä¹‰å¥½äº†ï¼Œæ¯ä¸ªæšä¸¾å¸¸é‡å…¶å®å°±æ˜¯æšä¸¾ç±»çš„ä¸€ä¸ªé™æ€æˆå‘˜å˜é‡</span><br><span class="line"><span class="comment">// é—®é¢˜2ï¼šæšä¸¾å•ä¾‹åœ¨åˆ›å»ºæ—¶æ˜¯å¦æœ‰å¹¶å‘é—®é¢˜ï¼Ÿ</span></span><br><span class="line">    æ²¡æœ‰ï¼Œè¿™æ˜¯é™æ€æˆå‘˜å˜é‡ï¼Œåœ¨ç±»åŠ è½½é˜¶æ®µåˆ›å»ºï¼ŒJVMä¿è¯çº¿ç¨‹å®‰å…¨</span><br><span class="line"><span class="comment">// é—®é¢˜3ï¼šæšä¸¾å•ä¾‹èƒ½å¦è¢«åå°„ç ´åå•ä¾‹ï¼Ÿ</span></span><br><span class="line">    ä¸èƒ½ï¼Œæšä¸¾ç±»å‹ä¸èƒ½é€šè¿‡newInstanceåå°„ï¼ŒClass#newInstance()æ–¹æ³•ä¼šåˆ¤æ–­æ˜¯å¦æ˜¯æšä¸¾ç±»ï¼Œå¦‚æœæ˜¯   ä¼šæŠ›å‡ºå¼‚å¸¸</span><br><span class="line"><span class="comment">// é—®é¢˜4ï¼šæšä¸¾å•ä¾‹èƒ½å¦è¢«ååºåˆ—åŒ–ç ´åå•ä¾‹ï¼Ÿ</span></span><br><span class="line">    æšä¸¾ç±»é»˜è®¤å®ç°äº†åºåˆ—åŒ–æ¥å£ï¼Œæšä¸¾ç±»å·²ç»è€ƒè™‘åˆ°æ­¤é—®é¢˜ï¼Œæ— éœ€æ‹…å¿ƒç ´åå•ä¾‹</span><br><span class="line"><span class="comment">// é—®é¢˜5ï¼šæšä¸¾å•ä¾‹å±äºæ‡’æ±‰å¼è¿˜æ˜¯é¥¿æ±‰å¼ï¼Ÿ</span></span><br><span class="line">    é¥¿æ±‰å¼ï¼Œç±»åŠ è½½æ—¶å°±åˆ›å»ºäº†</span><br><span class="line"><span class="comment">// é—®é¢˜6ï¼šæšä¸¾å•ä¾‹å¦‚æœå¸Œæœ›åŠ å…¥ä¸€äº›å•ä¾‹åˆ›å»ºæ—¶çš„åˆå§‹åŒ–é€»è¾‘è¯¥å¦‚ä½•åšï¼Ÿ</span></span><br><span class="line">    åŠ æ„é€ æ–¹æ³•å°±è¡Œäº†</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">  INSTANCE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°3ï¼šæ‡’æ±‰å¼"><a href="#å®ç°3ï¼šæ‡’æ±‰å¼" class="headerlink" title="å®ç°3ï¼šæ‡’æ±‰å¼"></a>å®ç°3ï¼šæ‡’æ±‰å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// åˆ†æè¿™é‡Œçš„çº¿ç¨‹å®‰å…¨, å¹¶è¯´æ˜æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ</span></span><br><span class="line">    <span class="keyword">synchronized</span>åŠ åœ¨é™æ€æ–¹æ³•ä¸Šï¼Œå¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ç¼ºç‚¹å°±æ˜¯é”çš„èŒƒå›´è¿‡å¤§ï¼Œæ¯æ¬¡è®¿é—®éƒ½ä¼šåŠ é”ï¼Œæ€§èƒ½   æ¯”è¾ƒä½ã€‚</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>( INSTANCE != <span class="literal">null</span> )&#123;</span><br><span class="line">            <span class="keyword">return</span> INSTANCE;</span><br><span class="line">        &#125;</span><br><span class="line">        INSTANCE = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°4ï¼šDCL-æ‡’æ±‰å¼"><a href="#å®ç°4ï¼šDCL-æ‡’æ±‰å¼" class="headerlink" title="å®ç°4ï¼šDCL æ‡’æ±‰å¼"></a>å®ç°4ï¼šDCL æ‡’æ±‰å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">    <span class="comment">// é—®é¢˜1ï¼šè§£é‡Šä¸ºä»€ä¹ˆè¦åŠ  volatile ?</span></span><br><span class="line">        ä¸ºäº†é˜²æ­¢é‡æ’åºé—®é¢˜ï¼Œä¿è¯æ‹¿åˆ°çš„å¯¹è±¡æ˜¯å®Œæ•´æ— ç¼ºçš„</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é—®é¢˜2ï¼šå¯¹æ¯”å®ç°3, è¯´å‡ºè¿™æ ·åšçš„æ„ä¹‰ï¼šæé«˜äº†æ•ˆç‡ï¼Œä¸ç”¨æ¯æ¬¡éƒ½åŠ é”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (INSTANCE != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> INSTANCE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">            <span class="comment">// é—®é¢˜3ï¼šä¸ºä»€ä¹ˆè¿˜è¦åœ¨è¿™é‡ŒåŠ ä¸ºç©ºåˆ¤æ–­, ä¹‹å‰ä¸æ˜¯åˆ¤æ–­è¿‡äº†å—ï¼Ÿ</span></span><br><span class="line">            <span class="comment">//    è¿™æ˜¯ä¸ºäº†é˜²æ­¢ç¬¬ä¸€æ¬¡åˆ¤æ–­æ—¶çš„å¹¶å‘é—®é¢˜ã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (INSTANCE != <span class="literal">null</span>) &#123; <span class="comment">// t2</span></span><br><span class="line">                <span class="keyword">return</span> INSTANCE;</span><br><span class="line">            &#125;</span><br><span class="line">            INSTANCE = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">            <span class="keyword">return</span> INSTANCE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°5ï¼šé™æ€å†…éƒ¨ç±»-æ‡’æ±‰å¼"><a href="#å®ç°5ï¼šé™æ€å†…éƒ¨ç±»-æ‡’æ±‰å¼" class="headerlink" title="å®ç°5ï¼šé™æ€å†…éƒ¨ç±»-æ‡’æ±‰å¼"></a>å®ç°5ï¼šé™æ€å†…éƒ¨ç±»-æ‡’æ±‰å¼</h3><p>é™æ€å†…éƒ¨ç±»æ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™æ‰å®Œæˆç±»åŠ è½½ï¼Œä¸ä¼šå› ä¸ºå¤–éƒ¨ç±»çš„åŠ è½½è€ŒåŠ è½½ã€‚æ­¤ä¾‹æ˜¯è°ƒç”¨getInstance() æ–¹æ³•æ‰å®Œæˆé™æ€å†…éƒ¨ç±»çš„ ç±»åŠ è½½<br>è¿™æ˜¯ é™æ€å†…éƒ¨ç±» å’Œ é™æ€ä»£ç å—ã€é™æ€å˜é‡ çš„åŒºåˆ«</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">    <span class="comment">// é—®é¢˜1ï¼šå±äºæ‡’æ±‰å¼è¿˜æ˜¯é¥¿æ±‰å¼ï¼Ÿ</span></span><br><span class="line">    æ‡’æ±‰å¼ï¼Œè¿™æ˜¯ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œæ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™æ‰å®Œæˆç±»åŠ è½½ï¼Œä¸ä¼šå› ä¸ºå¤–éƒ¨ç±»çš„åŠ è½½è€ŒåŠ è½½ã€‚åœ¨æ²¡æœ‰ è°ƒç”¨getInstanceæ–¹æ³•æ—¶ï¼Œæ˜¯ä¸ä¼šæ‰§è¡ŒLazyHolderå†…éƒ¨ç±»çš„ç±»åŠ è½½æ“ä½œçš„ã€‚</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">LazyHolder</span> &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é—®é¢˜2ï¼šåœ¨åˆ›å»ºæ—¶æ˜¯å¦æœ‰å¹¶å‘é—®é¢˜ï¼Ÿ</span></span><br><span class="line">        è¿™æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œç±»åŠ è½½æ—¶ï¼Œjvmä¿è¯ç±»åŠ è½½æ“ä½œçš„çº¿ç¨‹å®‰å…¨</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LazyHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="6ã€ç»“è®ºï¼š"><a href="#6ã€ç»“è®ºï¼š" class="headerlink" title="6ã€ç»“è®ºï¼š"></a>6ã€ç»“è®ºï¼š</h1><p>æœ¬ç« é‡ç‚¹è®²è§£äº† JMM ä¸­çš„</p><ol><li>å¯è§æ€§ - ç”± JVM ç¼“å­˜ä¼˜åŒ–å¼•èµ·</li><li>æœ‰åºæ€§ - ç”± JVM æŒ‡ä»¤é‡æ’åºä¼˜åŒ–å¼•èµ·</li><li>happens-before è§„åˆ™ ä¸ƒæ¡</li><li>åŸç†æ–¹é¢<ol><li>CPUæŒ‡ä»¤çº§åˆ«å¹¶è¡Œ</li><li>volatile -&gt; å†…å­˜å±éšœ</li></ol></li><li>æ¨¡å¼æ–¹é¢<ol><li>ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼çš„  volatile æ”¹è¿›</li><li>åŒæ­¥æ¨¡å¼ä¹‹ balking(çŠ¹è±«æ¨¡å¼)  â€“&gt; ä¿è¯æŸæ®µä»£ç åªæ‰§è¡Œä¸€æ¬¡</li></ol></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt;

&lt;h1 id=&quot;æœ¬ç« å†…å®¹-ï¼š&quot;&gt;&lt;a href=&quot;#æœ¬ç« å†…å®¹-ï¼š&quot; class=&quot;headerlink&quot; title=&quot;æœ¬ç« å†…å®¹ ï¼š&quot;&gt;&lt;/a&gt;æœ¬ç« å†…å®¹ ï¼š&lt;/h1&gt;&lt;p&gt; Monit</summary>
      
    
    
    
    <category term="JUCå¹¶å‘ç¼–ç¨‹" scheme="https://axdmdyj.github.io/categories/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"/>
    
    
    <category term="JUC" scheme="https://axdmdyj.github.io/tags/JUC/"/>
    
  </entry>
  
  <entry>
    <title>åŠ¨æ€è§„åˆ’ï¼ˆ1ï¼‰</title>
    <link href="https://axdmdyj.github.io/posts/cc7ca809.html"/>
    <id>https://axdmdyj.github.io/posts/cc7ca809.html</id>
    <published>2023-12-22T16:54:02.000Z</published>
    <updated>2024-01-15T00:42:04.021Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="ç†è®ºåŸºç¡€"><a href="#ç†è®ºåŸºç¡€" class="headerlink" title="ç†è®ºåŸºç¡€"></a>ç†è®ºåŸºç¡€</h1><p><strong>å¸¸è§é¢˜å‹:</strong></p><ul><li>èƒŒåŒ…é—®é¢˜</li><li>æ‰“å®¶åŠ«èˆ</li><li>è‚¡ç¥¨é—®é¢˜</li><li>å­åºåˆ—é—®é¢˜</li></ul><p>æ€è§„åˆ’ä¸­æ¯ä¸€ä¸ªçŠ¶æ€ä¸€å®šæ˜¯ç”±ä¸Šä¸€ä¸ªçŠ¶æ€æ¨å¯¼å‡ºæ¥çš„ï¼Œ<strong>è¿™ä¸€ç‚¹å°±åŒºåˆ†äºè´ªå¿ƒ</strong>ï¼Œè´ªå¿ƒæ²¡æœ‰çŠ¶æ€æ¨å¯¼ï¼Œè€Œæ˜¯ä»å±€éƒ¨ç›´æ¥é€‰æœ€ä¼˜çš„ï¼Œ<br>åŠ¨æ€è§„åˆ’ä¸­dp[j]æ˜¯ç”±<code>dp[j-weight[i]]</code>æ¨å¯¼å‡ºæ¥çš„ï¼Œç„¶åå–<code>max(dp[j], dp[j - weight[i]] + value[i])</code>ã€‚<br>ä½†å¦‚æœæ˜¯è´ªå¿ƒå‘¢ï¼Œæ¯æ¬¡æ‹¿ç‰©å“é€‰ä¸€ä¸ªæœ€å¤§çš„æˆ–è€…æœ€å°çš„å°±å®Œäº‹äº†ï¼Œå’Œä¸Šä¸€ä¸ªçŠ¶æ€æ²¡æœ‰å…³ç³»ã€‚<br><strong>è§£é¢˜æ­¥éª¤</strong></p><ol><li>ç¡®å®šdpæ•°ç»„ï¼ˆdp tableï¼‰ä»¥åŠä¸‹æ ‡çš„å«ä¹‰</li><li>ç¡®å®šé€’æ¨å…¬å¼</li><li>dpæ•°ç»„å¦‚ä½•åˆå§‹åŒ–</li><li>ç¡®å®šéå†é¡ºåº</li><li>ä¸¾ä¾‹æ¨å¯¼dpæ•°ç»„</li></ol><p><strong>å¦‚ä½•debug</strong><br>æ‰¾é—®é¢˜çš„æœ€å¥½æ–¹å¼å°±æ˜¯æŠŠdpæ•°ç»„æ‰“å°å‡ºæ¥ï¼Œçœ‹çœ‹ç©¶ç«Ÿæ˜¯ä¸æ˜¯æŒ‰ç…§è‡ªå·±æ€è·¯æ¨å¯¼çš„ï¼<br>åšåŠ¨è§„çš„é¢˜ç›®ï¼Œå†™ä»£ç ä¹‹å‰ä¸€å®šè¦æŠŠçŠ¶æ€è½¬ç§»åœ¨dpæ•°ç»„çš„ä¸Šå…·ä½“æƒ…å†µæ¨¡æ‹Ÿä¸€éï¼Œå¿ƒä¸­æœ‰æ•°ï¼Œç¡®å®šæœ€åæ¨å‡ºçš„æ˜¯æƒ³è¦çš„ç»“æœã€‚</p><ul><li>è¿™é“é¢˜ç›®æˆ‘ä¸¾ä¾‹æ¨å¯¼çŠ¶æ€è½¬ç§»å…¬å¼äº†ä¹ˆï¼Ÿ</li><li>æˆ‘æ‰“å°dpæ•°ç»„çš„æ—¥å¿—äº†ä¹ˆï¼Ÿ</li><li>æ‰“å°å‡ºæ¥äº†dpæ•°ç»„å’Œæˆ‘æƒ³çš„ä¸€æ ·ä¹ˆï¼Ÿ</li></ul><h1 id="æ–æ³¢é‚£å¥‘æ•°åˆ—"><a href="#æ–æ³¢é‚£å¥‘æ•°åˆ—" class="headerlink" title="æ–æ³¢é‚£å¥‘æ•°åˆ—"></a>æ–æ³¢é‚£å¥‘æ•°åˆ—</h1><p>é¢˜ç›®é“¾æ¥: <a href="https://leetcode.cn/problems/fibonacci-number/">https://leetcode.cn/problems/fibonacci-number/</a></p><h2 id="åŠ¨æ€è§„åˆ’äº”éƒ¨æ›²"><a href="#åŠ¨æ€è§„åˆ’äº”éƒ¨æ›²" class="headerlink" title="åŠ¨æ€è§„åˆ’äº”éƒ¨æ›²"></a>åŠ¨æ€è§„åˆ’äº”éƒ¨æ›²</h2><ol><li>ç¡®å®šdpæ•°ç»„ä»¥åŠä¸‹æ ‡çš„å«ä¹‰</li></ol><p>dp[i]çš„å®šä¹‰ä¸ºï¼šç¬¬iä¸ªæ•°çš„æ–æ³¢é‚£å¥‘æ•°å€¼æ˜¯dp[i]</p><ol start="2"><li>ç¡®å®šé€’æ¨å…¬å¼</li></ol><p>å…¥é—¨é¢˜åŸå› :  é€’æ¨å…¬å¼å·²ç»ç»™äº†:** **dp[i] &#x3D; dp[i - 1] + dp[i - 2];</p><ol start="3"><li>dpæ•°ç»„åˆå§‹åŒ–</li></ol><p>é¢˜ç›®ç»™äº†: dp[0] &#x3D; 0; dp[1] &#x3D; 1;</p><ol start="4"><li>ç¡®å®šéå†é¡ºåº</li></ol><p>ä»é€’å½’å…¬å¼dp[i] &#x3D; dp[i - 1] + dp[i - 2];ä¸­å¯ä»¥çœ‹å‡ºï¼Œdp[i]æ˜¯ä¾èµ– dp[i - 1] å’Œ dp[i - 2]ï¼Œé‚£ä¹ˆéå†çš„é¡ºåºä¸€å®šæ˜¯ä»å‰åˆ°åéå†çš„</p><ol start="5"><li>ä¸¾ä¾‹æ¨å¯¼dpæ•°ç»„</li></ol><p>æŒ‰ç…§è¿™ä¸ªé€’æ¨å…¬å¼dp[i] &#x3D; dp[i - 1] + dp[i - 2]ï¼Œæ¨å¯¼ä¸€ä¸‹ï¼Œå½“Nä¸º10çš„æ—¶å€™ï¼Œdpæ•°ç»„åº”è¯¥æ˜¯å¦‚ä¸‹çš„æ•°åˆ—ï¼š<br>0 1 1 2 3 5 8 13 21 34 55</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> :</span><br><span class="line">        <span class="function"><span class="type">int</span> <span class="title">fib</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(n+<span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="keyword">if</span>( n &lt;= <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> n;</span><br><span class="line">        &#125;</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)&#123;</span><br><span class="line">            dp[i] = dp[i<span class="number">-1</span>] + dp[i<span class="number">-2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="çˆ¬æ¥¼æ¢¯"><a href="#çˆ¬æ¥¼æ¢¯" class="headerlink" title="çˆ¬æ¥¼æ¢¯"></a>çˆ¬æ¥¼æ¢¯</h1><p>é¢˜ç›®é“¾æ¥:<br><a href="https://leetcode.cn/problems/climbing-stairs/description/">åŠ›æ‰£ï¼ˆLeetCodeï¼‰å®˜ç½‘ - å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å°</a></p><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>ç¬¬ä¸‰å±‚æ¥¼æ¢¯çš„çŠ¶æ€å¯ä»¥ç”±ç¬¬äºŒå±‚æ¥¼æ¢¯ å’Œ åˆ°ç¬¬ä¸€å±‚æ¥¼æ¢¯çŠ¶æ€æ¨å¯¼å‡ºæ¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥æƒ³åˆ°åŠ¨æ€è§„åˆ’äº†ã€‚</p><h2 id="DPäº”éƒ¨æ›²"><a href="#DPäº”éƒ¨æ›²" class="headerlink" title="DPäº”éƒ¨æ›²"></a>DPäº”éƒ¨æ›²</h2><ul><li><ol><li>ç¡®å®šdpæ•°ç»„ä»¥åŠä¸‹æ ‡å®šä¹‰</li></ol></li></ul><p>dp[i]ï¼š çˆ¬åˆ°ç¬¬iå±‚æ¥¼æ¢¯ï¼Œæœ‰dp[i]ç§æ–¹æ³•</p><ul><li><ol start="2"><li>ç¡®å®šé€’æ¨å…¬å¼</li></ol></li></ul><p>é¦–å…ˆæ˜¯dp[i - 1]ï¼Œä¸Ši-1å±‚æ¥¼æ¢¯ï¼Œæœ‰dp[i - 1]ç§æ–¹æ³•ï¼Œé‚£ä¹ˆå†ä¸€æ­¥è·³ä¸€ä¸ªå°é˜¶ä¸å°±æ˜¯dp[i]äº†ä¹ˆã€‚<br>è¿˜æœ‰å°±æ˜¯dp[i - 2]ï¼Œä¸Ši-2å±‚æ¥¼æ¢¯ï¼Œæœ‰dp[i - 2]ç§æ–¹æ³•ï¼Œé‚£ä¹ˆå†ä¸€æ­¥è·³ä¸¤ä¸ªå°é˜¶ä¸å°±æ˜¯dp[i]äº†ä¹ˆã€‚<br>é‚£ä¹ˆdp[i]å°±æ˜¯ dp[i - 1]ä¸dp[i - 2]ä¹‹å’Œï¼<br>æ‰€ä»¥**dp[i] &#x3D; dp[i - 1] + dp[i - 2] **ã€‚<br>åœ¨æ¨å¯¼dp[i]çš„æ—¶å€™ï¼Œä¸€å®šè¦æ—¶åˆ»æƒ³ç€dp[i]çš„å®šä¹‰ï¼Œå¦åˆ™å®¹æ˜“è·‘åã€‚<br>è¿™ä½“ç°å‡ºç¡®å®šdpæ•°ç»„ä»¥åŠä¸‹æ ‡çš„å«ä¹‰çš„é‡è¦æ€§ï¼</p><ul><li><ol start="3"><li>dpæ•°ç»„å¦‚ä½•åˆå§‹åŒ–</li></ol></li></ul><p>é¢˜ç›®è¯´äº†, næ˜¯ä¸€ä¸ªæ­£æ•´æ•°<br>ä¸è€ƒè™‘dp[0]å¦‚ä½•åˆå§‹åŒ–ï¼Œåªåˆå§‹åŒ–dp[1] &#x3D; 1ï¼Œdp[2] &#x3D; 2ï¼Œç„¶åä»i &#x3D; 3å¼€å§‹é€’æ¨ï¼Œè¿™æ ·æ‰ç¬¦åˆdp[i]çš„å®šä¹‰ã€‚</p><ul><li><ol start="4"><li>ç¡®å®šéå†é¡ºåº</li></ol></li></ul><p>ä»é€’æ¨å…¬å¼dp[i] &#x3D; dp[i - 1] + dp[i - 2];ä¸­å¯ä»¥çœ‹å‡ºï¼Œéå†é¡ºåºä¸€å®šæ˜¯ä»å‰å‘åéå†çš„</p><ul><li><ol start="5"><li>æ¨åˆ°dpæ•°ç»„</li></ol></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697472840603-278be474-e26a-42bf-9b0e-e7f7df782d25.png#averageHue=%23f2f2f2&clientId=u35be678d-fe85-4&from=paste&height=384&id=u4b3a3af1&originHeight=384&originWidth=814&originalType=binary&ratio=1&rotation=0&showTitle=false&size=26258&status=done&style=none&taskId=u507c4ece-7908-43fb-b8b9-d0cffdc4b53&title=&width=814" alt="image.png"><br>è¿™ä¸å°±æ˜¯æ–æ³¢é‚£å¥‘å˜›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">climbStairs</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(n &lt;= <span class="number">1</span>) <span class="keyword">return</span> n;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        dp[<span class="number">2</span>] = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>; i &lt;= n; i++)&#123;</span><br><span class="line">            dp[i] = dp[i-<span class="number">2</span>] + dp[i-<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æœ€é•¿å…¬å…±å­åºåˆ—"><a href="#æœ€é•¿å…¬å…±å­åºåˆ—" class="headerlink" title="æœ€é•¿å…¬å…±å­åºåˆ—"></a>æœ€é•¿å…¬å…±å­åºåˆ—</h1><p>çœ‹ä¸æ‡‚å°±å…ˆçœ‹åŠ¨æ€è§†é¢‘çš„æ¼”ç¤ºï¼Œæ³¨æ„maxçš„å«ä¹‰ã€‚<br>ã€ã€ç®—æ³•æ¼”ç¤ºã€‘åŠ¨æ€è§„åˆ’æ±‚è§£æœ€é•¿å…¬å…±å­åºåˆ—ã€‘<br><a href="https://www.bilibili.com/video/BV1PA411w7CW?vd_source=fcae3ca58a4c2446a58b5aaacbaa4bbe">ã€ç®—æ³•æ¼”ç¤ºã€‘åŠ¨æ€è§„åˆ’æ±‚è§£æœ€é•¿å…¬å…±å­åºåˆ—_å“”å“©å“”å“©_bilibili</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt;

&lt;h1 id=&quot;ç†è®ºåŸºç¡€&quot;&gt;&lt;a href=&quot;#ç†è®ºåŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;ç†è®ºåŸºç¡€&quot;&gt;&lt;/a&gt;ç†è®ºåŸºç¡€&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;å¸¸è§é¢˜å‹:&lt;</summary>
      
    
    
    
    
    <category term="åŠ¨æ€è§„åˆ’" scheme="https://axdmdyj.github.io/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"/>
    
  </entry>
  
  <entry>
    <title>rediså®æˆ˜ç¯‡</title>
    <link href="https://axdmdyj.github.io/posts/6bd5204f.html"/>
    <id>https://axdmdyj.github.io/posts/6bd5204f.html</id>
    <published>2023-11-20T11:17:34.000Z</published>
    <updated>2023-11-20T11:42:25.332Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="çŸ­ä¿¡ç™»å½•"><a href="#çŸ­ä¿¡ç™»å½•" class="headerlink" title="çŸ­ä¿¡ç™»å½•"></a>çŸ­ä¿¡ç™»å½•</h1><h2 id="å‘é€éªŒè¯ç "><a href="#å‘é€éªŒè¯ç " class="headerlink" title="å‘é€éªŒè¯ç "></a>å‘é€éªŒè¯ç </h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1698801356928-1038c401-76d3-4029-9ade-1af6e5c0280f.png#averageHue=%23e9e9e6&clientId=u023eb198-87b4-4&from=paste&height=538&id=u539f0ea2&originHeight=673&originWidth=300&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=94508&status=done&style=none&taskId=ub2bffcf8-da03-4137-8da5-73895a1347d&title=&width=240" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">sendCode</span><span class="params">(String phone, HttpSession session)</span> &#123;</span><br><span class="line">   <span class="comment">// 1. æ£€éªŒæ‰‹æœºå·ç æ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line">    <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone))&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·ç æ— æ•ˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2. ç”ŸæˆéªŒè¯ç </span></span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> RandomUtil.randomNumbers(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. ä¿å­˜åˆ°sessionä¸­</span></span><br><span class="line">    session.setAttribute(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4. å‘é€éªŒè¯ç </span></span><br><span class="line">    log.debug(<span class="string">&quot;å‘é€éªŒè¯ç æˆåŠŸ, éªŒè¯ç æ˜¯:&#123;&#125;&quot;</span>, code);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. è¿”å›æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1698801410162-5c8e46f4-74f7-42f6-8895-eef95eed91e9.png#averageHue=%23fcf6f5&clientId=u023eb198-87b4-4&from=paste&height=474&id=ufa498d0e&originHeight=593&originWidth=1366&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=58225&status=done&style=none&taskId=u603ec55b-759d-49f3-8cbb-8911b4f3cac&title=&width=1092.8" alt="image.png"><br>å°†ç”Ÿæˆçš„éªŒè¯ç æ ¹æ®key-valueçš„å½¢å¼å­˜å…¥redis</p><blockquote><p>è¿™é‡Œæœ‰ä¸€ä¸ªå°ç»†èŠ‚ï¼š<br><strong>è¿™é‡Œè™½ç„¶åç«¯é…ç½®çš„ç«¯å£æ—¶8081ï¼Œä½†è¿™é‡Œçš„è¯·æ±‚ä»ç„¶æ—¶8080ï¼Œæ˜¯å› ä¸ºå‰ç«¯ä½¿ç”¨nginxï¼Œåå‘ä»£ç†ï¼Œè¯·æ±‚å…ˆå‘é€åˆ°äº†nginxæœåŠ¡ï¼Œç„¶ååå‘ä»£ç†å†å»è¯·æ±‚tomcatæœåŠ¡å™¨</strong></p></blockquote><p>è¡¥å……ï¼š</p><blockquote><p>@Resourceæœ‰ä¸¤ä¸ªå±æ€§nameå’Œtypeã€‚Springå°†@Resourceæ³¨è§£çš„nameå±æ€§è§£æä¸ºbeançš„åå­—ï¼Œè€Œtypeå±æ€§åˆ™è§£æä¸ºbeançš„ç±»å‹ã€‚æ‰€ä»¥å¦‚æœä½¿ç”¨nameå±æ€§ï¼Œåˆ™ä½¿ç”¨byNameçš„è‡ªåŠ¨æ³¨å…¥ç­–ç•¥ï¼Œè€Œä½¿ç”¨typeå±æ€§æ—¶åˆ™ä½¿ç”¨byTypeè‡ªåŠ¨æ³¨å…¥ç­–ç•¥ã€‚å¦‚æœæ—¢ä¸æŒ‡å®šnameä¹Ÿä¸æŒ‡å®štypeå±æ€§ï¼Œè¿™æ—¶å°†é€šè¿‡åå°„æœºåˆ¶ä½¿ç”¨byNameè‡ªåŠ¨æ³¨å…¥ç­–ç•¥ã€‚<br>@Autowiredåªæ ¹æ®typeè¿›è¡Œæ³¨å…¥ï¼Œä¸ä¼šå»åŒ¹é…name</p></blockquote><h2 id="çŸ­ä¿¡éªŒè¯ç ç™»å½•å’Œæ³¨å†Œ"><a href="#çŸ­ä¿¡éªŒè¯ç ç™»å½•å’Œæ³¨å†Œ" class="headerlink" title="çŸ­ä¿¡éªŒè¯ç ç™»å½•å’Œæ³¨å†Œ"></a>çŸ­ä¿¡éªŒè¯ç ç™»å½•å’Œæ³¨å†Œ</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1698825277887-0fd5dc23-0660-4ee6-b1dc-3bc7caa0ae8e.png#averageHue=%23eeeaea&clientId=u8fd209ed-60a0-4&from=paste&height=500&id=u90d93351&originHeight=500&originWidth=400&originalType=binary&ratio=1&rotation=0&showTitle=false&size=61551&status=done&style=none&taskId=ub8f396b4-717d-45a7-94b3-93c30f8ce35&title=&width=400" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(LoginFormDTO loginForm, HttpSession session)</span> &#123;</span><br><span class="line">       <span class="comment">// æ£€éªŒæ‰‹æœºæ ¼å¼</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> loginForm.getPhone();</span><br><span class="line">       <span class="keyword">if</span>(RegexUtils.isPhoneInvalid(phone))&#123;</span><br><span class="line">           <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 2. æ ¡éªŒéªŒè¯ç </span></span><br><span class="line">       <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> loginForm.getCode();</span><br><span class="line">       <span class="keyword">if</span> (code==<span class="literal">null</span>  || !code.equals(session.getAttribute(<span class="string">&quot;code&quot;</span>)))&#123;</span><br><span class="line">           <span class="comment">// 3. æ ¡éªŒéªŒè¯ç å¤±è´¥</span></span><br><span class="line">           Result.fail(<span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 3. æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">       <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span>  query().eq(<span class="string">&quot;phone&quot;</span>, phone).one();</span><br><span class="line">       <span class="comment">// ç”¨æˆ·ä¸å­˜åœ¨</span></span><br><span class="line">       <span class="keyword">if</span> (user == <span class="literal">null</span>)&#123;</span><br><span class="line">          user =  createUserWithPhone(phone);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 4. ç”¨æˆ·å­˜åœ¨, ä¿å­˜åˆ°sessionä¸­</span></span><br><span class="line">       session.setAttribute(<span class="string">&quot;user&quot;</span>, user);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> Result.ok();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="ç™»å½•æ ¡éªŒ"><a href="#ç™»å½•æ ¡éªŒ" class="headerlink" title="ç™»å½•æ ¡éªŒ"></a>ç™»å½•æ ¡éªŒ</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1698825445004-a6016290-a7e2-4fe7-9ad2-5baf4d03322f.png#averageHue=%23f5f4f4&clientId=u8fd209ed-60a0-4&from=paste&height=936&id=ubc9ca8c3&originHeight=936&originWidth=2111&originalType=binary&ratio=1&rotation=0&showTitle=false&size=390396&status=done&style=none&taskId=u281196a9-354a-4025-af73-c4739038dc8&title=&width=2111" alt="image.png"><br>è¿™ä¹ˆåšæœ‰é—®é¢˜, å½“Controllerå±‚å¤šçš„æ—¶å€™, è¿™æ ·çš„ä¸šåŠ¡é€»è¾‘å°±éƒ½å¾—é‡å†™,<br>&#x3D;&gt; å¯ä»¥åŠ ä¸€ä¸ªæ‹¦æˆªå™¨æ¥è§£å†³<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1698825629609-6369cd15-7ea9-4cdf-ba2c-80283907b44e.png#averageHue=%23f2ebea&clientId=u8fd209ed-60a0-4&from=paste&height=785&id=uc48a18cc&originHeight=981&originWidth=2229&originalType=binary&ratio=1&rotation=0&showTitle=false&size=299850&status=done&style=none&taskId=u74fe0f76-4930-4709-9978-758d1c82770&title=&width=1783.2" alt="image.png"><br>æ¯ä¸ªç”¨æˆ·å…¶å®å¯¹åº”éƒ½æ˜¯å»æ‰¾tomcatçº¿ç¨‹æ± ä¸­çš„ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆå·¥ä½œçš„ï¼Œ ä½¿ç”¨å®Œæˆåå†è¿›è¡Œå›æ”¶ï¼Œæ—¢ç„¶æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥åœ¨æ¯ä¸ªç”¨æˆ·å»è®¿é—®æˆ‘ä»¬çš„å·¥ç¨‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨threadlocalæ¥åšåˆ°çº¿ç¨‹éš”ç¦»ï¼Œæ¯ä¸ªçº¿ç¨‹æ“ä½œè‡ªå·±çš„ä¸€ä»½æ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmdp.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hmdp.dto.Result;</span><br><span class="line"><span class="keyword">import</span> com.hmdp.dto.UserDTO;</span><br><span class="line"><span class="keyword">import</span> com.hmdp.entity.User;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.hmdp.utils.UserHolder;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> request.getSession().getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">       <span class="keyword">if</span> (user == <span class="literal">null</span>)&#123;</span><br><span class="line">          response.setStatus(<span class="number">401</span>);</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line">        UserHolder.saveUser((UserDTO) user);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é…ç½®:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmdp.config;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hmdp.utils.LoginInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span>  <span class="title class_">LoginInterceptor</span>()).excludePathPatterns(</span><br><span class="line">                <span class="string">&quot;/shop/**&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/voucher/**&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/shop-type/**&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/blog/hot&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/user/code&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/user/login&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/upload/**&quot;</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„éšè—ä¿¡æ¯<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1698828563629-a0f2d4c2-f931-4571-995d-dca9ebd7cd72.png#averageHue=%232c2b2b&clientId=u8fd209ed-60a0-4&from=paste&height=192&id=u967c724b&originHeight=192&originWidth=1256&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22166&status=done&style=none&taskId=u27b2f1ae-fd8f-4669-bf8c-0d819eefc48&title=&width=1256" alt="image.png"></p><blockquote><p>æ³¨æ„BeanUtilå’ŒBeanUtilsåŒºåˆ«</p></blockquote><p>ä½¿ç”¨ThreadLocal</p><blockquote><p><strong>ThreadLocal</strong>ï¼šä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ä¸€ä»½å•ç‹¬å­˜å‚¨ç©ºé—´ï¼Œåªæœ‰åœ¨çº¿ç¨‹å†…æ‰èƒ½è·å–å¯¹åº”çš„å€¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmdp.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hmdp.dto.UserDTO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserHolder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;UserDTO&gt; tl = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(UserDTO userId)</span>&#123;</span><br><span class="line">        tl.set(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UserDTO <span class="title function_">getUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tl.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeUser</span><span class="params">()</span>&#123;</span><br><span class="line">        tl.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1698828260112-414e2510-ddfd-49e5-984f-097b13fee144.png#averageHue=%23fcfaf9&clientId=u8fd209ed-60a0-4&from=paste&height=667&id=u63ffab52&originHeight=667&originWidth=375&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34061&status=done&style=none&taskId=udb64cb68-f96c-40d8-9d43-adfa17565b0&title=&width=375" alt="image.png"></p><h2 id="é›†ç¾¤çš„sessionå…±äº«é—®é¢˜"><a href="#é›†ç¾¤çš„sessionå…±äº«é—®é¢˜" class="headerlink" title="é›†ç¾¤çš„sessionå…±äº«é—®é¢˜"></a>é›†ç¾¤çš„sessionå…±äº«é—®é¢˜</h2><p>å¤šå°tomcatæœåŠ¡å™¨ä¹‹é—´å¹¶ä¸å…±äº«æ•°æ®, å®¹æ˜“é€ æˆåˆ‡æ¢æœåŠ¡å™¨æ•°æ®ä¸¢å¤±çš„é—®é¢˜<br>sessionçš„æ›¿ä»£æ–¹æ¡ˆåº”æ»¡è¶³:</p><ul><li>æ•°æ®å…±äº«</li><li>å†…å­˜å­˜å‚¨</li><li>key valueç»“æ„</li></ul><p>è§£å†³åŠæ³• &#x3D;&gt; redis</p><h2 id="åŸºäºrediså®ç°sessionå…±äº«ç™»å½•"><a href="#åŸºäºrediså®ç°sessionå…±äº«ç™»å½•" class="headerlink" title="åŸºäºrediså®ç°sessionå…±äº«ç™»å½•"></a>åŸºäºrediså®ç°sessionå…±äº«ç™»å½•</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1698829850748-a6352f14-367c-419a-abb1-32da0047725d.png#averageHue=%23c5918e&clientId=u8fd209ed-60a0-4&from=paste&height=1053&id=ueaf61fbb&originHeight=1053&originWidth=1799&originalType=binary&ratio=1&rotation=0&showTitle=false&size=391683&status=done&style=none&taskId=ue0eea36f-38a4-41fc-9fd2-1f329f33447&title=&width=1799" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1698846050148-bff23449-9187-4ead-8533-d7f57e910afd.png#averageHue=%23efeae9&clientId=u5a170d56-888a-4&from=paste&height=1108&id=u1c766697&originHeight=1108&originWidth=2089&originalType=binary&ratio=1&rotation=0&showTitle=false&size=496399&status=done&style=none&taskId=u9056657b-38a3-48ca-8a27-07f62fd1dcb&title=&width=2089" alt="image.png"></p><h2 id="åŸºäºrediså®ç°çŸ­ä¿¡ç™»å½•"><a href="#åŸºäºrediså®ç°çŸ­ä¿¡ç™»å½•" class="headerlink" title="åŸºäºrediså®ç°çŸ­ä¿¡ç™»å½•"></a>åŸºäºrediså®ç°çŸ­ä¿¡ç™»å½•</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699027861571-80106832-60b3-4bee-a610-0de8c9ccd0b1.png#averageHue=%23ece6e6&clientId=uc77679ca-2224-4&from=paste&height=751&id=u5e8e06ac&originHeight=939&originWidth=630&originalType=binary&ratio=1&rotation=0&showTitle=false&size=208747&status=done&style=none&taskId=u69fc68a2-4a66-4abc-ba34-971cb892e11&title=&width=504" alt="image.png"><br>å…ˆç”ŸæˆUUID<br>è½¬æ¢æˆHashMapå­˜å‚¨<br>å­˜å‚¨token<br>è®¾ç½®æœ‰æ•ˆæœŸ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        // 4. ç”¨æˆ·å­˜åœ¨, ä¿å­˜åˆ°sessionä¸­</span></span><br><span class="line"><span class="comment">//        session.setAttribute(&quot;user&quot;, BeanUtil.copyProperties(user, UserDTO.class));</span></span><br><span class="line">        <span class="comment">// ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°Redisä¸­</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        log.debug(<span class="string">&quot;token:&#123;&#125;&quot;</span>,token);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è½¬æ¢HashMapå­˜å‚¨</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.copyProperties(user, UserDTO.class);</span><br><span class="line"></span><br><span class="line">        Map&lt;String,Object&gt; userMap = BeanUtil.beanToMap(userDTO);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">tokenKey</span> <span class="operator">=</span> LOGIN_USER_KEY+token;</span><br><span class="line">        stringRedisTemplate.opsForHash().putAll(tokenKey,userMap);</span><br><span class="line">        <span class="comment">//è®¾ç½®tokenæœ‰æ•ˆæœŸ  </span></span><br><span class="line">        stringRedisTemplate.expire(tokenKey,LOGIN_USER_TTL,TimeUnit.MINUTES);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(token);</span><br></pre></td></tr></table></figure><p><strong>ä½†è¿™æ®µä»£ç æ²¡æœ‰æ›´æ–°tokenæœ‰æ•ˆæœŸ:</strong><br>åœ¨preHandleä¸­å®ç°;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">   <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span>  request.getHeader(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">   <span class="comment">//åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">   <span class="keyword">if</span> (StrUtil.isBlank(token))&#123;</span><br><span class="line">      response.setStatus(<span class="number">401</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// åŸºäºtokenè·å–Hashæ•°æ®çš„ç”¨æˆ·</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">tokenKey</span> <span class="operator">=</span> RedisConstants.LOGIN_USER_KEY+token;</span><br><span class="line">    Map&lt;Object,Object&gt; userMap = stringRedisTemplate.opsForHash().entries(tokenKey);</span><br><span class="line">    <span class="comment">// åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (userMap.isEmpty())&#123;</span><br><span class="line">        response.setStatus(<span class="number">401</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(userMap, <span class="keyword">new</span> <span class="title class_">UserDTO</span>(),<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¿å­˜</span></span><br><span class="line">    UserHolder.saveUser(userDTO);</span><br><span class="line">    <span class="comment">// åˆ·æ–°tokenæœ‰æ•ˆæœŸ</span></span><br><span class="line">    stringRedisTemplate.expire(RedisConstants.LOGIN_USER_KEY, RedisConstants.LOGIN_USER_TTL, TimeUnit.MINUTES);</span><br><span class="line">    <span class="comment">//æ”¾è¡Œ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699031051581-9951aaef-bd4b-4f9d-9379-a1a44e51acfe.png#averageHue=%232c2b2b&clientId=uc77679ca-2224-4&from=paste&height=758&id=ub014d843&originHeight=947&originWidth=1814&originalType=binary&ratio=1&rotation=0&showTitle=false&size=146553&status=done&style=none&taskId=ua7d97c5d-ce29-44e6-a456-623f2a888f5&title=&width=1451.2" alt="image.png"><br><a href="https://blog.csdn.net/qq3434569/article/details/113940767">ä½¿ç”¨Hutoolçš„BeanUtilä¼˜é›…çš„è®²Mapè½¬ä¸ºjavaBean_beanutil mapè½¬å¯¹è±¡-CSDNåšå®¢</a><br>ä½†æ˜¯ä¼šæŠ¥é”™æœåŠ¡å™¨å¼‚å¸¸<br>è§£å†³:<img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699031558738-b9faeca0-1063-41b7-9d18-c10d1aeb77bc.png#averageHue=%232d2c2c&clientId=uc77679ca-2224-4&from=paste&height=561&id=u94138825&originHeight=701&originWidth=1708&originalType=binary&ratio=1&rotation=0&showTitle=false&size=118546&status=done&style=none&taskId=u0b8c18e8-4e47-446b-b156-004339a07a6&title=&width=1366.4" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,Object&gt; userMap = BeanUtil.beanToMap(userDTO,<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(),</span><br><span class="line">               CopyOptions.create().setIgnoreNullValue(<span class="literal">true</span>).setFieldValueEditor((filename, fileValue)-&gt; fileValue.toString())</span><br><span class="line">               );</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ‹¦æˆªå™¨ä¼˜åŒ–"><a href="#æ‹¦æˆªå™¨ä¼˜åŒ–" class="headerlink" title="æ‹¦æˆªå™¨ä¼˜åŒ–"></a>æ‹¦æˆªå™¨ä¼˜åŒ–</h2><p><strong>é—®é¢˜: å¦‚æœç”¨æˆ·è®¿é—®ä¸€äº›ä¸éœ€è¦ç™»å½•çš„ç•Œé¢, é‚£ä¹ˆè¿‡æœŸæ—¶é—´åˆ°äº†ä¹‹å, å°±ä¼šè‡ªåŠ¨é€€å‡ºç™»å½•</strong><br>**è§£å†³åŠæ³•: **</p><hr><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1698916213005-332df564-3b55-43a9-a60f-74d549dcbbbf.png#averageHue=%23e8d7d4&clientId=uc0c97467-78c9-4&from=paste&height=611&id=ud9121bae&originHeight=1222&originWidth=2366&originalType=binary&ratio=2&rotation=0&showTitle=false&size=671865&status=done&style=none&taskId=u1b7bf3be-3c11-424d-9b49-642a36aac1d&title=&width=1183" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefreshIntercepter</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RefreshIntercepter</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span>  request.getHeader(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        <span class="comment">//åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(token))&#123;`</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åŸºäºtokenè·å–Hashæ•°æ®çš„ç”¨æˆ·</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">tokenKey</span> <span class="operator">=</span> RedisConstants.LOGIN_USER_KEY+token;</span><br><span class="line">        Map&lt;Object,Object&gt; userMap = stringRedisTemplate.opsForHash().entries(tokenKey);</span><br><span class="line">        <span class="comment">// åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (userMap.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(userMap, <span class="keyword">new</span> <span class="title class_">UserDTO</span>(),<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¿å­˜</span></span><br><span class="line">        UserHolder.saveUser(userDTO);</span><br><span class="line">        <span class="comment">// åˆ·æ–°tokenæœ‰æ•ˆæœŸ</span></span><br><span class="line">        stringRedisTemplate.expire(RedisConstants.LOGIN_USER_KEY, RedisConstants.LOGIN_USER_TTL, TimeUnit.MINUTES);</span><br><span class="line">        <span class="comment">//æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699033166224-6b311249-d8ac-4919-8bfb-01fde2904928.png#averageHue=%232c2b2b&clientId=uc77679ca-2224-4&from=paste&height=460&id=u7eeb875c&originHeight=575&originWidth=1535&originalType=binary&ratio=1&rotation=0&showTitle=false&size=85465&status=done&style=none&taskId=u5687a791-fddf-43ee-82f9-4c29ac5ba08&title=&width=1228" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699033178566-858b9d04-7fa0-40c5-b495-538b8e77d349.png#averageHue=%232c2c2b&clientId=uc77679ca-2224-4&from=paste&height=382&id=u40b497e8&originHeight=478&originWidth=1259&originalType=binary&ratio=1&rotation=0&showTitle=false&size=56335&status=done&style=none&taskId=uc9b1de4c-840a-493c-9bf1-1db531df6cb&title=&width=1007.2" alt="image.png"></p><h1 id="å•†æˆ·æŸ¥è¯¢ç¼“å­˜"><a href="#å•†æˆ·æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="å•†æˆ·æŸ¥è¯¢ç¼“å­˜"></a>å•†æˆ·æŸ¥è¯¢ç¼“å­˜</h1><h2 id="ä»€ä¹ˆæ˜¯ç¼“å­˜"><a href="#ä»€ä¹ˆæ˜¯ç¼“å­˜" class="headerlink" title="ä»€ä¹ˆæ˜¯ç¼“å­˜"></a>ä»€ä¹ˆæ˜¯ç¼“å­˜</h2><p>ä¸´æ—¶å­˜å‚¨æ•°æ®çš„åœ°æ–¹<br><strong>ç¼“å­˜çš„ä½œç”¨: é™ä½åç«¯è´Ÿè½½,é™ä½å“åº”æ—¶é—´, åº”å¯¹æ›´å¤šçš„å¹¶å‘è¯·æ±‚</strong><br><strong>ç¼“å­˜çš„æˆæœ¬: æ•°æ®ä¸€è‡´æ€§æˆæœ¬, ä»£ç ç»´æŠ¤ä¸‹æˆæœ¬, è¿ç»´æˆæœ¬</strong></p><h2 id="æ·»åŠ ç”¨æˆ·ç¼“å­˜"><a href="#æ·»åŠ ç”¨æˆ·ç¼“å­˜" class="headerlink" title="æ·»åŠ ç”¨æˆ·ç¼“å­˜"></a>æ·»åŠ ç”¨æˆ·ç¼“å­˜</h2><pre><code>  ![image.png](https://cdn.nlark.com/yuque/0/2023/png/38717174/1699082099728-62ad2f9e-259c-4e25-9e18-fcdce88f80cc.png#averageHue=%23f2f1f1&amp;clientId=u603f9972-ee0f-4&amp;from=paste&amp;height=826&amp;id=uec12dec0&amp;originHeight=1032&amp;originWidth=2120&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=398838&amp;status=done&amp;style=none&amp;taskId=u16271973-331e-47ac-b1d3-c7926ef6e65&amp;title=&amp;width=1696)</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">  StringRedisTemplate stringRedisTemplate;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Result <span class="title function_">queryById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">key</span>  <span class="operator">=</span> CACHE_SHOP_KEY +id;</span><br><span class="line">      <span class="comment">// ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">shopJson</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//å¦‚æœå­˜åœ¨, è¿”å›å•†é“ºä¿¡æ¯</span></span><br><span class="line">      <span class="keyword">if</span>(StrUtil.isNotBlank(shopJson))&#123;</span><br><span class="line">          <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> JSONUtil.toBean(shopJson,Shop.class);</span><br><span class="line">          <span class="keyword">return</span>  Result.ok(shop);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//å¦‚æœä¸å­˜åœ¨, æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">      <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> getById(id);</span><br><span class="line">      <span class="comment">// åˆ¤æ–­æ•°æ®åº“ä¿¡æ¯æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//ä¸å­˜åœ¨åˆ™è¿”å›404</span></span><br><span class="line">      <span class="keyword">if</span> (shop == <span class="literal">null</span>)&#123;</span><br><span class="line">          <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº—é“ºä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å­˜åœ¨, åˆ™å°†å•†å“ä¿¡æ¯å†™å…¥redis</span></span><br><span class="line">      stringRedisTemplate.opsForValue().set(key,JSONUtil.toJsonStr(shop));</span><br><span class="line">      <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699084036007-5f956627-b2b8-44ae-9dcb-cb15421c3fe5.png#averageHue=%23a3a2a2&clientId=uae1f6871-ad73-4&from=paste&height=500&id=ub61c05fe&originHeight=625&originWidth=1707&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=151609&status=done&style=none&taskId=uf1d67d00-ee1a-4615-a71f-20d43375455&title=&width=1365.6" alt="image.png"></p><h2 id="ç¼“å­˜æ›´æ–°ç­–ç•¥"><a href="#ç¼“å­˜æ›´æ–°ç­–ç•¥" class="headerlink" title="ç¼“å­˜æ›´æ–°ç­–ç•¥"></a>ç¼“å­˜æ›´æ–°ç­–ç•¥</h2><p>ç”±äºæ•°æ®åº“æ•°æ®æ”¹å˜,è€Œç¼“å­˜ä¸­æ•°æ®æ²¡æœ‰æ”¹å˜,é€ æˆç”¨æˆ·ä»ç¼“å­˜ä¸­å¾—åˆ°çš„æ•°æ®ä¸æ•°æ®åº“ä¸­çš„æ•°æ®ä¸ä¸€è‡´<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699103143774-ea4905f1-7972-4462-a657-662e7c59b612.png#averageHue=%23e1cdcc&clientId=uae1f6871-ad73-4&from=paste&height=598&id=uc5a9af08&originHeight=748&originWidth=2065&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=272856&status=done&style=none&taskId=u4a9bfdfe-d102-4ff0-882b-fe301ffa8f4&title=&width=1652" alt="image.png"><br> <img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699103259583-b9059fb3-2054-4d80-9340-ec3db709035e.png#averageHue=%23f0f0f0&clientId=uae1f6871-ad73-4&from=paste&height=199&id=ud4e5ebb2&originHeight=249&originWidth=1550&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=137644&status=done&style=none&taskId=u733c391e-4a63-4269-868c-1d176ea5381&title=&width=1240" alt="image.png"><br>ç¼“å­˜æ›´æ–°æ˜¯redisä¸ºäº†èŠ‚çº¦å†…å­˜è€Œè®¾è®¡å‡ºæ¥çš„ä¸€ä¸ªä¸œè¥¿ï¼Œä¸»è¦æ˜¯å› ä¸ºå†…å­˜æ•°æ®å®è´µï¼Œå½“æˆ‘ä»¬å‘redisæ’å…¥å¤ªå¤šæ•°æ®ï¼Œæ­¤æ—¶å°±å¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸­çš„æ•°æ®è¿‡å¤šï¼Œæ‰€ä»¥redisä¼šå¯¹éƒ¨åˆ†æ•°æ®è¿›è¡Œæ›´æ–°ï¼Œæˆ–è€…æŠŠä»–å«ä¸ºæ·˜æ±°æ›´åˆé€‚ã€‚<br><strong>å†…å­˜æ·˜æ±°ï¼š</strong>redisè‡ªåŠ¨è¿›è¡Œï¼Œå½“rediså†…å­˜è¾¾åˆ°å’±ä»¬è®¾å®šçš„max-memeryçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è§¦å‘æ·˜æ±°æœºåˆ¶ï¼Œæ·˜æ±°æ‰ä¸€äº›ä¸é‡è¦çš„æ•°æ®(å¯ä»¥è‡ªå·±è®¾ç½®ç­–ç•¥æ–¹å¼),ä½†æ˜¯å½“æ—¶é—´å¾ˆé•¿,ç¼“å­˜å°±ä¸ä¼šè¢«æ›´æ–°<br><strong>è¶…æ—¶å‰”é™¤ï¼š</strong>å½“æˆ‘ä»¬ç»™redisè®¾ç½®äº†è¿‡æœŸæ—¶é—´ttlä¹‹åï¼Œredisä¼šå°†è¶…æ—¶çš„æ•°æ®è¿›è¡Œåˆ é™¤ï¼Œæ–¹ä¾¿å’±ä»¬ç»§ç»­ä½¿ç”¨ç¼“å­˜<br>å¦‚æœåœ¨è®¾ç½®çš„æ—¶é—´å†…,æ•°æ®åº“å‘ç”Ÿå˜åŒ–,ä¹Ÿä¼šå¯¼è‡´æ•°æ®åº“ä¸ä¸€è‡´<br>**ä¸»åŠ¨æ›´æ–°ï¼š åœ¨ä¿®æ”¹æ•°æ®åº“çš„åŒæ—¶,æ›´æ–°ç¼“å­˜ **æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è°ƒç”¨æ–¹æ³•æŠŠç¼“å­˜åˆ æ‰ï¼Œé€šå¸¸ç”¨äºè§£å†³ç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´é—®é¢˜,<br><strong>ä¸»åŠ¨æ›´æ–°ä¸šåŠ¡å®ç°:</strong><br>** **<img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699108883261-845c3698-3df3-4bc3-af21-c6ee09a080bc.png#averageHue=%23f4f3f3&clientId=uae1f6871-ad73-4&from=paste&height=791&id=u99508fb0&originHeight=989&originWidth=2221&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=364799&status=done&style=none&taskId=ueb35e8bf-0e9a-4a31-a62a-732f7099e79&title=&width=1776.8" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699109050443-3b914bfa-4354-40e2-a38e-e6c7188835bd.png#averageHue=%23f5f4f4&clientId=uae1f6871-ad73-4&from=paste&height=751&id=u932f7a09&originHeight=939&originWidth=2206&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=545799&status=done&style=none&taskId=u93e3d3fa-f060-4ce1-b661-eaa94b08374&title=&width=1764.8" alt="image.png"></p><p><strong>ç¼“å­˜å®‰å…¨é—®é¢˜</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699109457009-b58327fb-1853-4230-8fae-c80c6d23bf87.png#averageHue=%23f3f2f2&clientId=uae1f6871-ad73-4&from=paste&height=828&id=u65c2a515&originHeight=1035&originWidth=2001&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=357984&status=done&style=none&taskId=ub9fec107-412a-436c-8def-1419a45a991&title=&width=1600.8" alt="image.png"><br>æ–¹æ¡ˆäºŒç›¸å¯¹æ¥è¯´å‘ç”Ÿæ¦‚ç‡ä½ä¸€äº›, åŒæ—¶ä¹Ÿå¯ä»¥åŠ å…¥è¶…æ—¶æ—¶é—´, ä¸‡ä¸€å‘ç”Ÿæ—§æ•°æ®è¿›å…¥ ç¼“å­˜,ä¹Ÿå¯ä»¥è¿›è¡Œæ¸…é™¤<img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699109497850-cc021bf3-3261-4972-af61-43df6990d8fa.png#averageHue=%23f1f1f1&clientId=uae1f6871-ad73-4&from=paste&height=563&id=uc77f74fc&originHeight=704&originWidth=1252&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=276299&status=done&style=none&taskId=uf8d14cb0-461a-40f3-b58f-de404a6a33a&title=&width=1001.6" alt="image.png"></p><h2 id="å®ç°å•†å“ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´"><a href="#å®ç°å•†å“ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´" class="headerlink" title="å®ç°å•†å“ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´"></a>å®ç°å•†å“ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699150811280-843ac537-e79d-4bef-9afa-eacc07858936.png#averageHue=%232c2b2b&clientId=u8a7806e8-b16d-4&from=paste&height=550&id=u454baf3b&originHeight=687&originWidth=1805&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=106945&status=done&style=none&taskId=udb5f5a95-64d9-4f70-b5fa-552a75064d5&title=&width=1444" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="meta">@Transactional</span></span><br><span class="line">  <span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(Shop shop)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (shop.getId()==<span class="literal">null</span>)&#123;</span><br><span class="line">          <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº—é“ºä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æ›´æ–°æ•°æ®åº“</span></span><br><span class="line">      updateById(shop);</span><br><span class="line">      <span class="comment">//åˆ é™¤ç¼“å­˜</span></span><br><span class="line">      stringRedisTemplate.delete(CACHE_SHOP_KEY+shop.getId());</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> Result.ok();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699150935337-7bba4650-cf0c-4b03-8c06-936b79a49b78.png#averageHue=%23fbfbfb&clientId=u8a7806e8-b16d-4&from=paste&height=716&id=u6d0ceee5&originHeight=895&originWidth=2130&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=170185&status=done&style=none&taskId=uea060b02-c509-4ab6-ab89-910cf0bcb89&title=&width=1704" alt="image.png"><br>å¦‚æœé€šè¿‡å¹¶å‘,æ— é™åˆ°è¾¾æ•°æ®åº“, å°±å®¹æ˜“ç»™æ•°æ®åº“å¼„å®<br><strong>è§£å†³åŠæ³•</strong></p><ol><li><strong>æ•°æ®åº“è¿”å›NUllå¯¹è±¡,ç¼ºç‚¹æ˜¯æœ‰é¢å¤–çš„å†…å­˜æ¶ˆè€—(å¯ä»¥è®¾ç½®TTLè§£å†³)</strong></li></ol><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699151041627-5b3c3aea-5d04-4717-8afc-d6622bd35dc9.png#averageHue=%23fafafa&clientId=u8a7806e8-b16d-4&from=paste&height=576&id=uab32b173&originHeight=720&originWidth=1646&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=172693&status=done&style=none&taskId=u32000052-6e1e-429a-b628-48817bc2525&title=&width=1316.8" alt="image.png"></p><ol start="2"><li><strong>å¸ƒéš†è¿‡æ»¤å™¨</strong></li></ol><p>** **<img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699151188719-0e6360f7-7e8f-4ef4-b388-f2f880690a5a.png#averageHue=%23f7f4f2&clientId=u8a7806e8-b16d-4&from=paste&height=589&id=u8698caf1&originHeight=736&originWidth=641&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=143003&status=done&style=none&taskId=u5dfcd73b-9d0f-4f28-a98c-ee4dc90faa2&title=&width=512.8" alt="image.png"><br>é€šè¿‡å“ˆå¸Œç®—æ³•,å°†è®¡ç®—å‡ºæ¥çš„æ”¾åˆ°å¸ƒéš†è¿‡æ»¤å™¨, ä½†æœ‰ä¸€ç‚¹çš„ç©¿é€é£é™©</p><h2 id="ç¼–ç è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜"><a href="#ç¼–ç è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜" class="headerlink" title="ç¼–ç è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜"></a>ç¼–ç è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699151426970-975a19c5-190a-4cbc-9cb8-7730a4e0eeae.png#averageHue=%23eeeceb&clientId=u8a7806e8-b16d-4&from=paste&height=724&id=ufd2bf6d2&originHeight=905&originWidth=2216&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=489525&status=done&style=none&taskId=ud00847b5-9d3d-4995-92a5-3208ec8b719&title=&width=1772.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699152411753-22724bfd-50be-4397-a9d3-de819dfb08c6.png#averageHue=%232c2b2b&clientId=u8a7806e8-b16d-4&from=paste&height=821&id=ueccd8b74&originHeight=1026&originWidth=1725&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=182832&status=done&style=none&taskId=ucfa5cf87-6015-449d-abdb-63ddb17a991&title=&width=1380" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">key</span>  <span class="operator">=</span> CACHE_SHOP_KEY +id;</span><br><span class="line">      <span class="comment">// ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">shopJson</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//å¦‚æœå­˜åœ¨, è¿”å›å•†é“ºä¿¡æ¯</span></span><br><span class="line">      <span class="keyword">if</span>(StrUtil.isNotBlank(shopJson))&#123;</span><br><span class="line">          <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> JSONUtil.toBean(shopJson,Shop.class);</span><br><span class="line">          <span class="keyword">return</span>  Result.ok(shop);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// åˆ¤æ–­å‘½ä¸­çš„æ˜¯å¦æ˜¯ç©ºå€¼</span></span><br><span class="line">      <span class="keyword">if</span> (shopJson != <span class="literal">null</span>)&#123;</span><br><span class="line">          Result.fail(<span class="string">&quot;åº—é“ºä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//å¦‚æœä¸å­˜åœ¨, æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">      <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> getById(id);</span><br><span class="line">      <span class="comment">// åˆ¤æ–­æ•°æ®åº“ä¿¡æ¯æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//ä¸å­˜åœ¨åˆ™è¿”å›404</span></span><br><span class="line">      <span class="keyword">if</span> (shop == <span class="literal">null</span>)&#123;</span><br><span class="line">          stringRedisTemplate.opsForValue().set(key, <span class="literal">null</span>, CACHE_NULL_TTL,TimeUnit.MINUTES);</span><br><span class="line">          <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº—é“ºä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å­˜åœ¨, åˆ™å°†å•†å“ä¿¡æ¯å†™å…¥redis</span></span><br><span class="line">      stringRedisTemplate.opsForValue().set(key,JSONUtil.toJsonStr(shop), RedisConstants.CACHE_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line">      <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>shopJson !&#x3D; nullæ”¹æˆshopJson&#x3D;&#x3D;â€â€ ä¼šå¥½ç†è§£ä¸€äº›<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699151837524-18fef19d-e4f4-44a6-9d1b-59bd831ed3b5.png#averageHue=%23f3f3f3&clientId=u8a7806e8-b16d-4&from=paste&height=606&id=ua6e3adc9&originHeight=757&originWidth=1159&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=258097&status=done&style=none&taskId=u63150d66-1512-4adc-8e89-cde31dd00fd&title=&width=927.2" alt="image.png"></p><h2 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h2><p>åœ¨åŒä¸€æ—¶æ®µå¤§é‡çš„ç¼“å­˜keyåŒæ—¶å¤±æ•ˆæˆ–è€…redisæœåŠ¡å®•æœº, å¯¼è‡´å¤§é‡è¯·æ±‚æ•°æ®åº“, å¸¦æ¥å·¨å¤§çš„å‹åŠ›<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699156133884-03a9e60a-e486-4753-855f-cb3d665e4f55.png#averageHue=%23f4f1f1&clientId=u8a7806e8-b16d-4&from=paste&height=708&id=u21bd2e8b&originHeight=885&originWidth=2131&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=428063&status=done&style=none&taskId=ud80e8200-7410-4930-a7a7-94d2a5fff06&title=&width=1704.8" alt="image.png"></p><h2 id="2-8-ç¼“å­˜å‡»ç©¿"><a href="#2-8-ç¼“å­˜å‡»ç©¿" class="headerlink" title="2.8 ç¼“å­˜å‡»ç©¿"></a>2.8 ç¼“å­˜å‡»ç©¿</h2><p>æŸä¸€ä¸ªkeyåœ¨åŒä¸€æ—¶é—´å†…è¢«å¤šæ¬¡è®¿é—®,è¿™ä¸ªkeyçªç„¶å¤±æ•ˆäº†, å°±ä¼šåœ¨è¿™ä¸ªæ—¶é—´ç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§çš„å†²å‡»åŠ›<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699164935235-f9e69e3a-9839-4988-bcf3-05fcc8bbe7e5.png#averageHue=%23eee7e0&clientId=u8a7806e8-b16d-4&from=paste&height=634&id=uedae8863&originHeight=792&originWidth=1375&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=184549&status=done&style=none&taskId=u07604b7c-d211-4032-a2fb-2c54e505ba2&title=&width=1100" alt="image.png"><br>çº¿ç¨‹1 æœ¬æ¥æ˜¯æƒ³æŸ¥è¯¢æ•°æ®åº“è½½å…¥ç¼“å­˜, ä½†è¿™æ—¶å€™åŒæ—¶åˆçº¿ç¨‹2, 3, 4 åŒæ—¶è®¿é—®ç¼“å­˜, éƒ½æ²¡æœ‰æŸ¥åˆ°æ•°æ®, é‚£ä¹ˆå°±ä¼šé€ æˆå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®æ•°æ®çš„æƒ…å†µ , ä»è€Œç»™æ•°æ®å¸¦æ¥å·¨å¤§çš„å‹åŠ›.<br><strong>è§£å†³åŠæ³•</strong></p><ul><li><strong>äº’æ–¥é”</strong></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699165112699-f82c55bc-80d4-4901-93de-d12a6cc22f19.png#averageHue=%23f0efee&clientId=u8a7806e8-b16d-4&from=paste&height=885&id=u2a142e12&originHeight=1106&originWidth=858&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=237978&status=done&style=none&taskId=ua33f7dbc-07cd-42f0-ba18-f5706ab877c&title=&width=686.4" alt="image.png"></p><ul><li>ç¼“å­˜è¿‡æœŸ</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699165423813-dc9dfe19-82d4-4c5f-be78-48ffd666753d.png#averageHue=%23eae4e3&clientId=u4e51b1c4-2b80-4&from=paste&height=850&id=u953941fc&originHeight=1062&originWidth=1273&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=295603&status=done&style=none&taskId=ucbf9f236-40c4-4475-ac4c-726224769e3&title=&width=1018.4" alt="image.png"><br>è¿”å›çš„æ˜¯è¿‡æœŸçš„æ•°æ®<br><strong>å¯¹æ¯”</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699165463393-d285571e-7568-4c7e-9424-8f549a8680ba.png#averageHue=%23e5cecd&clientId=u4e51b1c4-2b80-4&from=paste&height=741&id=uedc66771&originHeight=926&originWidth=2075&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=217678&status=done&style=none&taskId=u83a615ea-ced1-49ae-8338-90263514659&title=&width=1660" alt="image.png"></p><h2 id="åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜"><a href="#åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜" class="headerlink" title="åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜"></a>åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699171874898-e4083975-1612-4c7b-b4e8-9ffb2336aa1f.png#averageHue=%23faf7f7&clientId=uad14f619-a4eb-4&from=paste&height=655&id=ud00ad32f&originHeight=819&originWidth=1703&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=266694&status=done&style=none&taskId=uc956f7fb-48f5-4dfc-8727-1924bce78e9&title=&width=1362.4" alt="image.png">åœ¨å¤šä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œçš„æ—¶å€™éœ€è¦è¾¾åˆ°ä¸€ä¸ªæ•ˆæœ, ä¸€ä¸ªæˆåŠŸ, å…¶ä»–å¤±è´¥çš„æ•ˆæœ<img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699172055792-65c7c469-65fa-41f5-92dc-60fef825831e.png#averageHue=%230b2138&clientId=uad14f619-a4eb-4&from=paste&height=526&id=u02efe0ef&originHeight=657&originWidth=998&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=379673&status=done&style=none&taskId=ue71c7007-c3ba-448e-8a7a-5540e3405fc&title=&width=798.4" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span>  <span class="title function_">tryLock</span><span class="params">(String key)</span>&#123;</span><br><span class="line">       <span class="type">Boolean</span> <span class="variable">flag</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="string">&quot;1&quot;</span>, <span class="number">10L</span>, TimeUnit.SECONDS);</span><br><span class="line">       <span class="keyword">return</span> BooleanUtil.isTrue(flag);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">private</span>   <span class="keyword">void</span> <span class="title function_">delLock</span><span class="params">(String key)</span>&#123;</span><br><span class="line">       stringRedisTemplate.delete(key);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Shop <span class="title function_">queryWithMutex</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">key</span>  <span class="operator">=</span> CACHE_SHOP_KEY +id;</span><br><span class="line">       <span class="comment">// ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜ </span></span><br><span class="line">       <span class="type">String</span> <span class="variable">shopJson</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//å¦‚æœå­˜åœ¨, è¿”å›å•†é“ºä¿¡æ¯</span></span><br><span class="line">       <span class="keyword">if</span>(StrUtil.isNotBlank(shopJson))&#123;</span><br><span class="line">           <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> JSONUtil.toBean(shopJson,Shop.class);</span><br><span class="line">           <span class="keyword">return</span> shop;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// åˆ¤æ–­å‘½ä¸­çš„æ˜¯å¦æ˜¯ç©ºå€¼</span></span><br><span class="line">       <span class="keyword">if</span> (shopJson == <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">           Result.fail(<span class="string">&quot;åº—é“ºä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//1.å¦‚æœä¸å­˜åœ¨, å°è¯•è·å–äº’æ–¥é”</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">lock_key</span> <span class="operator">=</span> <span class="string">&quot;lock:shop&quot;</span>+key;</span><br><span class="line">       <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> tryLock(lock_key);</span><br><span class="line">       <span class="comment">// 1.1 åˆ¤æ–­æ˜¯å¦è·å–é”</span></span><br><span class="line">       <span class="comment">//1.2 æ²¡æœ‰è·å¾—äº’æ–¥é”=&gt;  ä¼‘çœ </span></span><br><span class="line">       <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="keyword">if</span> (!flag)&#123;</span><br><span class="line">               Thread.sleep(<span class="number">50</span>);</span><br><span class="line">               <span class="keyword">return</span> queryWithMutex(id);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//1.3 è·å¾—äº’æ–¥é”=&gt; æ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">           shop = getById(id);</span><br><span class="line">           <span class="comment">// åˆ¤æ–­æ•°æ®åº“ä¿¡æ¯æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"></span><br><span class="line">           <span class="comment">//ä¸å­˜åœ¨åˆ™è¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">           <span class="keyword">if</span> (shop == <span class="literal">null</span>)&#123;</span><br><span class="line">               stringRedisTemplate.opsForValue().set(key, <span class="string">&quot;&quot;</span>, CACHE_NULL_TTL,TimeUnit.MINUTES);</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//1.4 å°†å•†é“ºæ•°æ®å†™å…¥redis</span></span><br><span class="line">           stringRedisTemplate.opsForValue().set(key,JSONUtil.toJsonStr(shop), RedisConstants.CACHE_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           <span class="comment">//1.5 é‡Šæ”¾äº’æ–¥é”</span></span><br><span class="line">           delLock(key);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> shop;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ©ç”¨é€»è¾‘è¿‡æœŸæ–¹å¼è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜"><a href="#åˆ©ç”¨é€»è¾‘è¿‡æœŸæ–¹å¼è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜" class="headerlink" title="åˆ©ç”¨é€»è¾‘è¿‡æœŸæ–¹å¼è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜"></a>åˆ©ç”¨é€»è¾‘è¿‡æœŸæ–¹å¼è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699193223625-18f4022d-72dd-473e-86e0-ab6d318323eb.png#averageHue=%23f8f4f4&clientId=uad14f619-a4eb-4&from=paste&height=707&id=u720bf9b2&originHeight=884&originWidth=1892&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=451704&status=done&style=none&taskId=uc3f96aaf-10d2-4b74-a921-dae73e262f4&title=&width=1513.6" alt="image.png"><br><a href="https://blog.csdn.net/u012448904/article/details/84292821">https://blog.csdn.net/u012448904/article/details/84292821</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveShop2RedisData</span><span class="params">(Long id, Long expireTime)</span>&#123;</span><br><span class="line">       <span class="comment">// æŸ¥è¯¢åº—é“ºæ•°æ®</span></span><br><span class="line">       <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> getById(id);</span><br><span class="line">       <span class="comment">//å°è£…é€»è¾‘è¿‡æœŸæ—¶é—´</span></span><br><span class="line">       <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisData</span>();</span><br><span class="line">       redisData.setData(shop);</span><br><span class="line">       redisData.setExpireTime(LocalDateTime.now().plusSeconds(expireTime));</span><br><span class="line">       <span class="comment">// å°†æ•°æ®å†™å…¥redis, å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">      stringRedisTemplate.opsForValue().set(CACHE_SHOP_KEY+id, JSONUtil.toJsonStr(redisData));</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">CACHE_REBUILD_EXECUTOR</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Shop <span class="title function_">queryWithLogicalExpire</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">key</span>  <span class="operator">=</span> CACHE_SHOP_KEY +id;</span><br><span class="line">      <span class="comment">// ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">shopJson</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 1.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//1.1 å¦‚æœä¸å­˜åœ¨</span></span><br><span class="line">      <span class="keyword">if</span> (StrUtil.isBlank(shopJson))&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//1.2å¦‚æœå‘½ä¸­, å…ˆæŠŠJsonååºåˆ—åŒ–ä¸ºå¯¹è±¡</span></span><br><span class="line">      <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span>  JSONUtil.toBean(shopJson, RedisData.class);</span><br><span class="line">      <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> JSONUtil.toBean((JSONObject) redisData.getData(), Shop.class);</span><br><span class="line">      <span class="type">LocalDateTime</span> <span class="variable">expireTime</span> <span class="operator">=</span> redisData.getExpireTime();</span><br><span class="line">      <span class="comment">//2. åˆ¤æ–­ç¼“å­˜æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">      <span class="comment">// 2.1 å¦‚æœæ²¡æœ‰è¿‡æœŸ, è¿”å›å•†å“ä¿¡æ¯</span></span><br><span class="line">     <span class="keyword">if</span> (expireTime.isAfter(LocalDateTime.now()))&#123;</span><br><span class="line">         <span class="keyword">return</span> shop;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// 3. å¦‚æœè¿‡æœŸ, åˆ™éœ€è¦ç¼“å­˜é‡å»º</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> LOCK_SHOP_KEY + id;</span><br><span class="line">      <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line">      <span class="comment">// 3.1 å¦‚æœè·å–åˆ°äº†äº’æ–¥é”</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (isLock)&#123;</span><br><span class="line">              <span class="comment">//å¼€å¯ç‹¬ç«‹çº¿ç¨‹, å®ç°ç¼“å­˜é‡å»º</span></span><br><span class="line">              CACHE_REBUILD_EXECUTOR.submit(()-&gt;&#123;</span><br><span class="line">                  <span class="comment">//é‡å»ºç¼“å­˜</span></span><br><span class="line">                  <span class="built_in">this</span>.saveShop2RedisData(id,<span class="number">20L</span>);</span><br><span class="line">              &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">          delLock(lockKey);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å¦‚æœè¿‡æœŸ, åˆ™ç›´æ¥è¿”å›å•†å“ä¿¡æ¯</span></span><br><span class="line">      <span class="keyword">return</span> shop;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="ç¼“å­˜å·¥å…·å°è£…"><a href="#ç¼“å­˜å·¥å…·å°è£…" class="headerlink" title="ç¼“å­˜å·¥å…·å°è£…"></a>ç¼“å­˜å·¥å…·å°è£…</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699232522556-19d223a8-d12d-4403-85b3-b930bfb9f710.png#averageHue=%23ebebeb&clientId=ud845c73b-0205-4&from=paste&height=336&id=cd6f7&originHeight=672&originWidth=2300&originalType=binary&ratio=2&rotation=0&showTitle=false&size=362660&status=done&style=none&taskId=u169a78f1-9a1c-491f-9414-b91bb3abcdd&title=&width=1150" alt="image.png"><br>å°è£…åçš„<code>CacheClient</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmdp.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.BooleanUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.json.JSONObject;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.json.JSONUtil;</span><br><span class="line"><span class="keyword">import</span> com.hmdp.dto.Result;</span><br><span class="line"><span class="keyword">import</span> com.hmdp.entity.Shop;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.yaml.snakeyaml.events.Event;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.hmdp.utils.RedisConstants.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheClient</span> &#123;</span><br><span class="line">     <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">CACHE_REBUILD_EXECUTOR</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line">     <span class="keyword">public</span> <span class="title function_">CacheClient</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span>&#123;</span><br><span class="line">          <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String key, Object value, Long time, TimeUnit timeUnit)</span>&#123;</span><br><span class="line">          stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(value), time, timeUnit);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// è®¾ç½®é€»è¾‘è¿‡æœŸæ—¶é—´</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span>  <span class="title function_">setWithLogicalExpire</span><span class="params">(String key, Object value, Long time, TimeUnit unit)</span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisData</span>();</span><br><span class="line">          redisData.setData(value);</span><br><span class="line">          redisData.setExpireTime(LocalDateTime.now().plusSeconds(unit.toSeconds(time)));</span><br><span class="line">          <span class="comment">// å†™å…¥redis</span></span><br><span class="line">          stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(value));</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">public</span> &lt;R,ID&gt; R <span class="title function_">queryWithThrough</span><span class="params">(String prefix, ID id, Class&lt;R&gt; type, Function&lt;ID,R&gt; dbFailBack</span></span><br><span class="line"><span class="params">     ,Long time, TimeUnit timeUnit)</span>&#123;</span><br><span class="line">          <span class="type">String</span> <span class="variable">key</span>  <span class="operator">=</span> prefix +id;</span><br><span class="line">          <span class="comment">// ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line">          <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line"></span><br><span class="line">          <span class="comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">//å¦‚æœå­˜åœ¨, è¿”å›å•†é“ºä¿¡æ¯</span></span><br><span class="line">          <span class="keyword">if</span>(StrUtil.isNotBlank(json))&#123;</span><br><span class="line">          <span class="comment">// å­˜åœ¨, ç›´æ¥è¿”å›</span></span><br><span class="line">               <span class="keyword">return</span> JSONUtil.toBean(json, type);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// åˆ¤æ–­å‘½ä¸­çš„æ˜¯å¦æ˜¯ç©ºå€¼</span></span><br><span class="line">          <span class="keyword">if</span> (json == <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">               Result.fail(<span class="string">&quot;åº—é“ºä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">//å¦‚æœä¸å­˜åœ¨, æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">          <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> dbFailBack.apply(id);</span><br><span class="line">          <span class="comment">// åˆ¤æ–­æ•°æ®åº“ä¿¡æ¯æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">//ä¸å­˜åœ¨åˆ™è¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">          <span class="keyword">if</span> (r == <span class="literal">null</span>)&#123;</span><br><span class="line">               stringRedisTemplate.opsForValue().set(key, <span class="string">&quot;&quot;</span>, CACHE_NULL_TTL,TimeUnit.MINUTES);</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// å­˜åœ¨, åˆ™å°†å•†å“ä¿¡æ¯å†™å…¥redis</span></span><br><span class="line">         <span class="built_in">this</span>.set(key,r, time, timeUnit);</span><br><span class="line">          <span class="keyword">return</span> r;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿</span></span><br><span class="line">     <span class="keyword">public</span> &lt;R,ID&gt;R <span class="title function_">queryWithLogicalExpire</span><span class="params">(String prefix, ID id, Class&lt;R&gt; type, Function&lt;ID,R&gt; dbFailBack</span></span><br><span class="line"><span class="params">             ,Long time, TimeUnit timeUnit)</span>&#123;</span><br><span class="line">          <span class="type">String</span> <span class="variable">key</span>  <span class="operator">=</span> prefix +id;</span><br><span class="line">          <span class="comment">// ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line">          <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">          <span class="comment">// 1.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">          <span class="comment">//1.1 å¦‚æœä¸å­˜åœ¨</span></span><br><span class="line">          <span class="keyword">if</span> (StrUtil.isBlank(json))&#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">//1.2å¦‚æœå‘½ä¸­, å…ˆæŠŠJsonååºåˆ—åŒ–ä¸ºå¯¹è±¡</span></span><br><span class="line">          <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span>  JSONUtil.toBean(json, RedisData.class);</span><br><span class="line">          <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> JSONUtil.toBean((JSONObject)redisData.getData(), type);</span><br><span class="line">          <span class="type">LocalDateTime</span> <span class="variable">expireTime</span> <span class="operator">=</span> redisData.getExpireTime();</span><br><span class="line">          <span class="comment">//2. åˆ¤æ–­ç¼“å­˜æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">          <span class="comment">// 2.1 å¦‚æœæ²¡æœ‰è¿‡æœŸ, è¿”å›å•†å“ä¿¡æ¯</span></span><br><span class="line">          <span class="keyword">if</span> (expireTime.isAfter(LocalDateTime.now()))&#123;</span><br><span class="line">               <span class="keyword">return</span> r;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// 3. å¦‚æœè¿‡æœŸ, åˆ™éœ€è¦ç¼“å­˜é‡å»º</span></span><br><span class="line">          <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> LOCK_SHOP_KEY + id;</span><br><span class="line">          <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line">          <span class="comment">// 3.1 å¦‚æœè·å–åˆ°äº†äº’æ–¥é”</span></span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">               <span class="keyword">if</span> (isLock)&#123;</span><br><span class="line">                    <span class="type">R</span> <span class="variable">r1</span> <span class="operator">=</span> dbFailBack.apply(id);</span><br><span class="line">                    <span class="comment">//å¼€å¯ç‹¬ç«‹çº¿ç¨‹, å®ç°ç¼“å­˜é‡å»º</span></span><br><span class="line">                    CACHE_REBUILD_EXECUTOR.submit(()-&gt;&#123;</span><br><span class="line">                         <span class="comment">//é‡å»ºç¼“å­˜</span></span><br><span class="line">                         <span class="built_in">this</span>.setWithLogicalExpire(key,r1,time,timeUnit);</span><br><span class="line">                    &#125;);</span><br><span class="line">               &#125;</span><br><span class="line">          &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">          &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">               <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">               delLock(lockKey);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// å¦‚æœè¿‡æœŸ, åˆ™ç›´æ¥è¿”å›å•†å“ä¿¡æ¯</span></span><br><span class="line">          <span class="keyword">return</span> r;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">public</span> <span class="type">boolean</span>  <span class="title function_">tryLock</span><span class="params">(String key)</span>&#123;</span><br><span class="line">          <span class="type">Boolean</span> <span class="variable">flag</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="string">&quot;1&quot;</span>, <span class="number">10L</span>, TimeUnit.SECONDS);</span><br><span class="line">          <span class="keyword">return</span> BooleanUtil.isTrue(flag);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">private</span>  <span class="keyword">void</span> <span class="title function_">delLock</span><span class="params">(String key)</span>&#123;</span><br><span class="line">          stringRedisTemplate.delete(key);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><dl><dt>é‡Œé¢åˆ†åˆ«å°è£…äº†è§£å†³ç¼“å­˜ç©¿é€å’Œé€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿çš„ä¸¤ä¸ªå‡½æ•°<br>åœ¨é€šè¿‡é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜ä¸­é‡åˆ°å…¥<code>   R r = JSONUtil.toBean((JSONObject)redisData.getData(), type);</code>  <code>redisData</code>ä¸ºç©ºçš„æƒ…å†µ</dt><dd>è§£å†³åŠæ³•<br><a href="https://blog.csdn.net/uiguion/article/details/106047677">JSONObject.toBean()æ–¹æ³•è½¬æˆå¯¹è±¡æŠ¥é”™ï¼Œæˆ–è€…beanå±æ€§å…¨ä¸ºnull-CSDNåšå®¢</a><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699372507632-4139d56e-787c-4399-a44d-abc6640a24fb.png#averageHue=%239c7544&clientId=u03392ae4-edfa-4&from=paste&height=325&id=uaa40b9c8&originHeight=325&originWidth=1401&originalType=binary&ratio=1&rotation=0&showTitle=false&size=53374&status=done&style=none&taskId=uc57e265d-757a-444a-8936-5e6c833c53c&title=&width=1401" alt="image.png"><br>ä¸è¦å°å†™</dd></dl><p>ä½¿ç”¨Rediså·¥å…·ç±»:<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699372542710-3d357c3b-7365-49fd-9a33-4f850fb63e14.png#averageHue=%232d2c2c&clientId=u03392ae4-edfa-4&from=paste&height=374&id=u87a92367&originHeight=374&originWidth=1629&originalType=binary&ratio=1&rotation=0&showTitle=false&size=57706&status=done&style=none&taskId=u4d0ee664-0235-4b98-9707-755d8d45d63&title=&width=1629" alt="image.png"></p><blockquote><p>åœ¨é€»è¾‘è¿‡æœŸä¸­,å°è£…äº†<code>RedisData</code>æ˜¯ä¸ºäº†å°†æ•°æ®å’Œå…¶å¯¹åº”çš„è¿‡æœŸæ—¶é—´å°è£…åˆ°ä¸€èµ·å¤„ç† </p></blockquote><h2 id="ç¼“å­˜æ€»ç»“"><a href="#ç¼“å­˜æ€»ç»“" class="headerlink" title="ç¼“å­˜æ€»ç»“"></a>ç¼“å­˜æ€»ç»“</h2><h1 id="ä¼˜æƒ åˆ¸ç§’æ€"><a href="#ä¼˜æƒ åˆ¸ç§’æ€" class="headerlink" title="ä¼˜æƒ åˆ¸ç§’æ€"></a>ä¼˜æƒ åˆ¸ç§’æ€</h1><h2 id="å…¨å±€å”¯ä¸€ID"><a href="#å…¨å±€å”¯ä¸€ID" class="headerlink" title="å…¨å±€å”¯ä¸€ID"></a>å…¨å±€å”¯ä¸€ID</h2><p>å½“ç”¨æˆ·æŠ¢è´­æ—¶ï¼Œå°±ä¼šç”Ÿæˆè®¢å•å¹¶ä¿å­˜åˆ°tb_voucher_orderè¿™å¼ è¡¨ä¸­ï¼Œè€Œ è®¢å•è¡¨å¦‚æœä½¿ç”¨æ•°æ®åº“è‡ªå¢IDå°±å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ul><li>idçš„è§„å¾‹æ€§å¤ªæ˜æ˜¾</li><li>å—å•è¡¨æ•°æ®é‡çš„é™åˆ¶</li></ul><p>å½“æŠŠè¡¨è¿›è¡Œæ‹†åˆ†, ä¹Ÿä¼šç ´åè¿™ç§å”¯ä¸€æ€§<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699426255848-40136d31-4503-444f-9155-5fafaf1a0bdc.png#averageHue=%23fbf2f2&clientId=u03392ae4-edfa-4&from=paste&height=166&id=u64d05cd3&originHeight=208&originWidth=1134&originalType=binary&ratio=1&rotation=0&showTitle=false&size=19066&status=done&style=none&taskId=ucef96a17-421f-4ead-98a3-0f7b4f44969&title=&width=907.2" alt="image.png"><br>ä¸ºäº†å¢åŠ IDçš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç›´æ¥ä½¿ç”¨Redisè‡ªå¢çš„æ•°å€¼ï¼Œè€Œæ˜¯æ‹¼æ¥ä¸€äº›å…¶å®ƒä¿¡æ¯ï¼š</p><p> æ—¶é—´æˆ³ï¼š31bitï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œå¯ä»¥ä½¿ç”¨69å¹´<br>åºåˆ—å·ï¼š32bitï¼Œç§’å†…çš„è®¡æ•°å™¨ï¼Œæ”¯æŒæ¯ç§’äº§ç”Ÿ2^32ä¸ªä¸åŒID</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisWorker</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼€å§‹æ—¶é—´æˆ³</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">BEGIN_TIMESTAMP</span> <span class="operator">=</span> <span class="number">1640995200L</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åºåˆ—å·çš„ä½æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">COUNT_BITS</span> <span class="operator">=</span> <span class="number">32</span>;</span><br><span class="line">    StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisWorker</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="type">long</span> <span class="title function_">nextId</span><span class="params">(String prefix)</span>&#123;</span><br><span class="line">        <span class="comment">//1.ç”Ÿæˆæ—¶é—´æˆ³</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">        <span class="type">long</span> <span class="variable">nowSecond</span> <span class="operator">=</span> now.toEpochSecond(ZoneOffset.UTC);</span><br><span class="line">        <span class="type">long</span> <span class="variable">timestamp</span> <span class="operator">=</span> nowSecond - BEGIN_TIMESTAMP;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. ç”Ÿæˆåºåˆ—å·,ç²¾ç¡®åˆ°å¤©,ç¡®ä¿åºåˆ—å·ä¸ä¼šè¢«å æ»¡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy:MM:dd&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().increment(<span class="string">&quot;icr:&quot;</span>+prefix+<span class="string">&quot;:&quot;</span>+date);</span><br><span class="line">        <span class="comment">//æ‹¼æ¥å¹¶è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> timestamp&lt;&lt;COUNT_BITS|  ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699451963201-96d090a8-10c9-45e5-a77d-09a80bc9bb70.png#averageHue=%23f3f7f1&clientId=u03392ae4-edfa-4&from=paste&height=464&id=u92c542a6&originHeight=580&originWidth=2065&originalType=binary&ratio=1&rotation=0&showTitle=false&size=372721&status=done&style=none&taskId=u9b6d7e2b-ddcc-439b-8c70-4f17bf917b9&title=&width=1652" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">testIdWorker</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">       <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">300</span>);</span><br><span class="line"></span><br><span class="line">       <span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">           <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">               <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> redisWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">               System.out.println(<span class="string">&quot;id = &quot;</span> + id);</span><br><span class="line">           &#125;</span><br><span class="line">           latch.countDown();</span><br><span class="line">       &#125;;</span><br><span class="line">       <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">300</span>; i++) &#123;</span><br><span class="line">           es.submit(task);</span><br><span class="line">       &#125;</span><br><span class="line">       latch.await();</span><br><span class="line">       <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">       System.out.println(<span class="string">&quot;time = &quot;</span> + (end - begin));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="æ·»åŠ ä¼˜æƒ åˆ¸"><a href="#æ·»åŠ ä¼˜æƒ åˆ¸" class="headerlink" title="æ·»åŠ ä¼˜æƒ åˆ¸"></a>æ·»åŠ ä¼˜æƒ åˆ¸</h2><p>å¹³ä»·åˆ¸<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699453018061-98e0c0ec-7b51-47c7-804a-3ad046f592e0.png#averageHue=%23f6f8f6&clientId=u03392ae4-edfa-4&from=paste&height=394&id=u52d9c459&originHeight=493&originWidth=1525&originalType=binary&ratio=1&rotation=0&showTitle=false&size=584380&status=done&style=none&taskId=u68370840-18ab-4403-9307-b8ec30147fc&title=&width=1220" alt="image.png"><br><strong>ç§’æ€åˆ¸</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699453049584-e0e2bbd2-5e0f-4db2-a0b7-300f056d5300.png#averageHue=%23eef0ed&clientId=u03392ae4-edfa-4&from=paste&height=301&id=ude83893e&originHeight=376&originWidth=1463&originalType=binary&ratio=1&rotation=0&showTitle=false&size=406404&status=done&style=none&taskId=u307cfd87-d489-4177-a9b4-6bdc1093625&title=&width=1170.4" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699452886736-1cc3a40d-139d-4581-a74a-c8c5686c823b.png#averageHue=%23f1ecea&clientId=u03392ae4-edfa-4&from=paste&height=837&id=udf628ffe&originHeight=1046&originWidth=1904&originalType=binary&ratio=1&rotation=0&showTitle=false&size=557282&status=done&style=none&taskId=uf05654fe-beef-48a5-9b31-98eb188f656&title=&width=1523.2" alt="image.png"></p><h2 id="å®ç°ä¼˜æƒ åˆ¸ç§’æ€çš„ä¸‹å•åŠŸèƒ½"><a href="#å®ç°ä¼˜æƒ åˆ¸ç§’æ€çš„ä¸‹å•åŠŸèƒ½" class="headerlink" title="å®ç°ä¼˜æƒ åˆ¸ç§’æ€çš„ä¸‹å•åŠŸèƒ½"></a>å®ç°ä¼˜æƒ åˆ¸ç§’æ€çš„ä¸‹å•åŠŸèƒ½</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699491830080-d020dec5-6734-4da9-b359-0d0d60d22824.png#averageHue=%23faf8f8&clientId=u62c8c1ac-49eb-4&from=paste&height=718&id=ue1b324d1&originHeight=898&originWidth=1497&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=239141&status=done&style=none&taskId=uaacbd06a-3e0a-4874-bab7-52087d33fd3&title=&width=1197.6" alt="image.png"></p><h2 id="åº“å­˜è¶…å–é—®é¢˜"><a href="#åº“å­˜è¶…å–é—®é¢˜" class="headerlink" title="åº“å­˜è¶…å–é—®é¢˜"></a>åº“å­˜è¶…å–é—®é¢˜</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699512912475-448ad530-a79a-493a-9a1b-6ff8dd9c0d1b.png#averageHue=%23ddded5&clientId=ua529897f-17be-4&from=paste&height=143&id=ua95713de&originHeight=286&originWidth=1642&originalType=binary&ratio=2&rotation=0&showTitle=false&size=211099&status=done&style=none&taskId=u58c38c8c-22d1-47c6-893c-b66827e1164&title=&width=821" alt="image.png"><br>åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œ åº“å­˜å˜æˆäº†è´Ÿæ•°<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699512954758-1083414b-371d-4821-8cee-70cde0636ffa.png#averageHue=%23637aa8&clientId=ua529897f-17be-4&from=paste&height=396&id=u4af4cf38&originHeight=792&originWidth=1996&originalType=binary&ratio=2&rotation=0&showTitle=false&size=471026&status=done&style=none&taskId=u99d7ebdc-d14a-4f3a-ad94-da9355b9a8f&title=&width=998" alt="image.png"><br>è¯´æ˜è¿™ä¸€å—çš„é€»è¾‘æ˜¯æœ‰é—®é¢˜çš„<br>å…ˆæŸ¥è¯¢-&gt;åˆ¤æ–­-&gt;å‡åº“å­˜<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699513390567-d0602fd3-5f64-43a2-8adc-94ad44a21d21.png#averageHue=%23f5f5f5&clientId=ua529897f-17be-4&from=paste&height=612&id=ue45a8fd8&originHeight=1224&originWidth=2534&originalType=binary&ratio=2&rotation=0&showTitle=false&size=309881&status=done&style=none&taskId=u5b1e322d-15c6-4a68-a1b6-66f01a9da12&title=&width=1267" alt="image.png"><br><strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br>** **<img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699513646487-c306a577-0758-45bb-aae4-9e238dee5241.png#averageHue=%23f4f3f3&clientId=uaa6d1fb2-8a9a-4&from=paste&height=505&id=u4f34f58b&originHeight=1010&originWidth=2378&originalType=binary&ratio=2&rotation=0&showTitle=false&size=584418&status=done&style=none&taskId=uf944ddba-4b79-47a7-80de-6a14b5bab2b&title=&width=1189" alt="image.png"><br>ä¹è§‚é”ä¸ç”¨å»åŠ é”ï¼Œè€Œæ˜¯åœ¨æ‰§è¡Œæ—¶æ‰åšåˆ¤æ–­ï¼Œå› æ­¤æ€§èƒ½é«˜</p><p><strong>ä¹è§‚é”ï¼š</strong></p><ul><li>**ç‰ˆæœ¬å·æ³•ï¼š **</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699513930001-21760dc2-af8c-4d02-a702-e3c765847dd6.png#averageHue=%23fafafa&clientId=uaa6d1fb2-8a9a-4&from=paste&height=511&id=u581002a7&originHeight=1022&originWidth=2538&originalType=binary&ratio=2&rotation=0&showTitle=false&size=406163&status=done&style=none&taskId=u03c7ed5e-fb7d-47f6-854d-24371d40d2c&title=&width=1269" alt="image.png"><br>é€šè¿‡ç‰ˆæœ¬å·æ¥æŸ¥æ˜¯å¦éœ€è¦-1ï¼Œæ¥é¿å…è¶…å–é—®é¢˜  </p><ul><li><strong>CAS</strong>ä¼˜åŒ–ç‰ˆæœ¬å·</li></ul><p> <img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699514621548-7c59ea00-55dc-4562-a416-74a211905a37.png#averageHue=%23fbfbfb&clientId=uaa6d1fb2-8a9a-4&from=paste&height=540&id=ubb7b39b4&originHeight=1080&originWidth=2496&originalType=binary&ratio=2&rotation=0&showTitle=false&size=373639&status=done&style=none&taskId=u0ffb655f-ec53-4e13-899d-3537570f4bd&title=&width=1248" alt="image.png"> <img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699517224445-eea01797-f3b5-4895-a5f9-3e793409fd3d.png#averageHue=%23f2f7ef&clientId=u757ca0cc-a2af-4&from=paste&height=444&id=u6a5ec8e4&originHeight=888&originWidth=2546&originalType=binary&ratio=2&rotation=0&showTitle=false&size=739428&status=done&style=none&taskId=u690bc5ae-1e68-435d-9b63-fd67f80d615&title=&width=1273" alt="image.png"><br> <strong>ä½†æ˜¯è¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå½“stockä¸ä¸º1çš„æ—¶å€™ï¼Œ çœ‹stockæ¥ç¡®å®šæ‰£ä¸æ‰£å‡ï¼Œå°±ä¼šé€ æˆæ›´å¤šäººæŠ¢ä¸åˆ°ä¼˜æƒ åˆ¸</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699517619198-ba7b27ab-fea1-41bc-a470-87d9fcf71017.png#averageHue=%23f8f8f8&clientId=u757ca0cc-a2af-4&from=paste&height=204&id=u30b15279&originHeight=408&originWidth=1876&originalType=binary&ratio=2&rotation=0&showTitle=false&size=44498&status=done&style=none&taskId=ua120d0fb-d33f-4f68-b8c5-5ffd2253dc6&title=&width=938" alt="image.png">** **<img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699517538369-c1b3a1cc-e780-4aec-a3ac-9d7096938cf4.png#averageHue=%23f0f5eb&clientId=u757ca0cc-a2af-4&from=paste&height=140&id=ua90beb84&originHeight=280&originWidth=1962&originalType=binary&ratio=2&rotation=0&showTitle=false&size=277162&status=done&style=none&taskId=ue5bae5be-56b8-45d4-9984-881f5a5c952&title=&width=981" alt="image.png"><br>å¦‚æœ<code>stock&gt;0</code>,å°±å¯ä»¥è´­ä¹°ä¼˜æƒ åˆ¸</p><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699517838400-7ed70785-bf23-4533-a7c6-fae87940f329.png#averageHue=%23efefef&clientId=u757ca0cc-a2af-4&from=paste&height=333&id=u09d910b9&originHeight=666&originWidth=1222&originalType=binary&ratio=2&rotation=0&showTitle=false&size=232094&status=done&style=none&taskId=u3f41d4e9-e1f4-4df0-a6a8-270e463319b&title=&width=611" alt="image.png"></p><blockquote><p>å¯¹äºæ›´é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œ å…‰è¿™æ ·ä½¿ç”¨ä¹è§‚é”æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œ éœ€è¦è¿›è¡Œè¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œ</p></blockquote><h2 id="ä¸€äººä¸€å•"><a href="#ä¸€äººä¸€å•" class="headerlink" title="ä¸€äººä¸€å•"></a>ä¸€äººä¸€å•</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699518088817-4d0d4240-ae7d-479a-bec9-a4e3bf28bd6f.png#averageHue=%23fbf9f9&clientId=u757ca0cc-a2af-4&from=paste&height=562&id=ufa5d2047&originHeight=1124&originWidth=2036&originalType=binary&ratio=2&rotation=0&showTitle=false&size=361555&status=done&style=none&taskId=ueffa5321-5918-4f42-966e-a1d7dbe937d&title=&width=1018" alt="image.png"><br>äº‹åŠ¡å¤±æ•ˆçš„æƒ…å†µ:<br>åŠ é”<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699693153645-12717c5e-49c8-4d75-92f6-ce805fa03602.png#averageHue=%23f0f5ef&clientId=u2b828817-5288-4&from=paste&height=842&id=u873f76a6&originHeight=842&originWidth=1957&originalType=binary&ratio=1&rotation=0&showTitle=false&size=512561&status=done&style=none&taskId=u89ad8637-7e27-4b78-b23e-60e3f15831a&title=&width=1957" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="meta">@Transactional</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">       <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">       <span class="keyword">synchronized</span> (userId.toString().intern())&#123;</span><br><span class="line">           <span class="type">IVoucherOrderService</span> <span class="variable">proxy</span> <span class="operator">=</span> (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">           <span class="keyword">return</span> proxy.createVoucherOrder(voucherId);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">       <span class="keyword">public</span> Result <span class="title function_">createVoucherOrder</span><span class="params">(Long voucherId)</span>&#123;</span><br><span class="line">           <span class="comment">// 1. æäº¤ä¼˜æƒ åˆ¸id</span></span><br><span class="line">           <span class="comment">//2. æŸ¥è¯¢ä¼˜æƒ åˆ¸ä¿¡æ¯</span></span><br><span class="line">           <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> seckillVoucherService.getById(voucherId);</span><br><span class="line">           <span class="comment">//3. åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">           <span class="comment">//3.1 å¦‚æœæ²¡æœ‰å¼€å§‹, è¿”å›å¼‚å¸¸ç»“æœ</span></span><br><span class="line">           <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now()))&#123;</span><br><span class="line">               Result.fail(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">// 3.2 åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">           <span class="keyword">if</span> (LocalDateTime.now().isAfter(voucher.getEndTime()))&#123;</span><br><span class="line">               Result.fail(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸ&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">// 4. ç§’æ€å¼€å§‹, åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">           <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>)&#123;</span><br><span class="line">               <span class="comment">//4.1 ä¸è¶³, è¿”å›å¼‚å¸¸ç»“æœ</span></span><br><span class="line">               Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">// å®ç°ä¸€äººä¸€å•</span></span><br><span class="line">           <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">           <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>,userId).eq(<span class="string">&quot;voucher_id&quot;</span>,voucherId).count();</span><br><span class="line">           <span class="keyword">if</span> (count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">               Result.fail(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//4.2 å……è¶³, æ‰£å‡åº“å­˜</span></span><br><span class="line">           <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> seckillVoucherService.update().setSql(<span class="string">&quot;stock=stock-1&quot;</span>)</span><br><span class="line">                   .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).gt(<span class="string">&quot;stock&quot;</span>,<span class="number">0</span>) <span class="comment">// å¦‚æœå¤§äº0å°±èƒ½è´­ä¹°ä¼˜æƒ åˆ¸</span></span><br><span class="line">                   .update();</span><br><span class="line">           <span class="keyword">if</span> (!isSuccess)&#123;</span><br><span class="line">               <span class="keyword">return</span>  Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//4.3 åˆ›å»ºè®¢å•</span></span><br><span class="line">           <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">           <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">           voucherOrder.setId(orderId);</span><br><span class="line"></span><br><span class="line">           voucherOrder.setUserId(userId);</span><br><span class="line"></span><br><span class="line">           voucherOrder.setVoucherId(voucherId);</span><br><span class="line">           save(voucherOrder);</span><br><span class="line">           <span class="comment">//4.4 è¿”å›è®¢å•id</span></span><br><span class="line"></span><br><span class="line">           <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/hanjiaqian/article/details/120501741">ã€ç²¾é€‰ã€‘spring äº‹åŠ¡å¤±æ•ˆçš„ 12 ç§åœºæ™¯_spring æˆªè·duplicatekeyexception ä¸æŠ›å¼‚å¸¸_hanjq_codeçš„åšå®¢-CSDNåšå®¢</a></p><h2 id="ä¸€äººä¸€å•å¹¶å‘å®‰å…¨é—®é¢˜"><a href="#ä¸€äººä¸€å•å¹¶å‘å®‰å…¨é—®é¢˜" class="headerlink" title="ä¸€äººä¸€å•å¹¶å‘å®‰å…¨é—®é¢˜"></a>ä¸€äººä¸€å•å¹¶å‘å®‰å…¨é—®é¢˜</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699705699282-d6e5cfc6-d0b1-4692-9045-b3bd7c1752b0.png#averageHue=%23f0eded&clientId=u2b828817-5288-4&from=paste&height=990&id=u2b5403a6&originHeight=990&originWidth=2087&originalType=binary&ratio=1&rotation=0&showTitle=false&size=506190&status=done&style=none&taskId=u76807860-0e90-4ec5-ace9-4f40d89a0bc&title=&width=2087" alt="image.png"><br>ç”±äºç°åœ¨æˆ‘ä»¬éƒ¨ç½²äº†å¤šä¸ªtomcatï¼Œæ¯ä¸ªtomcatéƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„jvmï¼Œé‚£ä¹ˆå‡è®¾åœ¨æœåŠ¡å™¨Açš„tomcatå†…éƒ¨ï¼Œæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹ç”±äºä½¿ç”¨çš„æ˜¯åŒä¸€ä»½ä»£ç ï¼Œé‚£ä¹ˆä»–ä»¬çš„é”å¯¹è±¡æ˜¯åŒä¸€ä¸ªï¼Œæ˜¯å¯ä»¥å®ç°äº’æ–¥çš„ï¼Œä½†æ˜¯å¦‚æœç°åœ¨æ˜¯æœåŠ¡å™¨Bçš„tomcatå†…éƒ¨ï¼Œåˆæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯ä»–ä»¬çš„é”å¯¹è±¡å†™çš„è™½ç„¶å’ŒæœåŠ¡å™¨Aä¸€æ ·ï¼Œä½†æ˜¯é”å¯¹è±¡å´ä¸æ˜¯åŒä¸€ä¸ªï¼Œæ‰€ä»¥çº¿ç¨‹3å’Œçº¿ç¨‹4å¯ä»¥å®ç°äº’æ–¥ï¼Œä½†æ˜¯å´æ— æ³•å’Œçº¿ç¨‹1å’Œçº¿ç¨‹2å®ç°äº’æ–¥ï¼Œè¿™å°±æ˜¯ é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œsyné”å¤±æ•ˆçš„åŸå› ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h1 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h1><h2 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699763384484-e83248bd-53cc-43e6-b5b2-1aa92f9982c2.png#averageHue=%23f4f2f2&clientId=u2b828817-5288-4&from=paste&height=864&id=ufa6eb578&originHeight=1080&originWidth=2262&originalType=binary&ratio=1&rotation=0&showTitle=false&size=482845&status=done&style=none&taskId=uf703bade-d8ba-409f-ba8e-9c0101b0700&title=&width=1809.6" alt="image.png"><br>è®©å¤šä¸ªJVMéƒ½èƒ½çœ‹åˆ°åŒä¸€ä¸ªé”ç›‘è§†å™¨<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699763801336-f81b5646-caff-4432-bfb4-7ddf5afaa5a9.png#averageHue=%23e4d5d5&clientId=u2b828817-5288-4&from=paste&height=1001&id=uc6a8dd14&originHeight=1001&originWidth=2209&originalType=binary&ratio=1&rotation=0&showTitle=false&size=366621&status=done&style=none&taskId=u9cb2dfa0-cdd0-4344-9431-950df9bda81&title=&width=2209" alt="image.png"></p><h2 id="Redisåˆ†å¸ƒå¼é”å®ç°æ€è·¯"><a href="#Redisåˆ†å¸ƒå¼é”å®ç°æ€è·¯" class="headerlink" title="Redisåˆ†å¸ƒå¼é”å®ç°æ€è·¯"></a>Redisåˆ†å¸ƒå¼é”å®ç°æ€è·¯</h2><p><a href="https://blog.csdn.net/huo065000/article/details/119970629">ã€ç²¾é€‰ã€‘redisåˆ†å¸ƒå¼é”(ä¸€ï¼‰set NXå®ç°_å¿ƒå¿ƒå¿µå¿µçš„å°é¼ æ ‡çš„åšå®¢-CSDNåšå®¢</a><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699764476731-6ac1814f-7f3f-4442-b0af-43405c724fd9.png#averageHue=%23102a3d&clientId=u2b828817-5288-4&from=paste&height=298&id=uadcf17e7&originHeight=298&originWidth=1888&originalType=binary&ratio=1&rotation=0&showTitle=false&size=235838&status=done&style=none&taskId=uea343540-7380-459c-bb72-201b12a7257&title=&width=1888" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699764614586-e1387af2-56e8-4cc4-a022-c87c0a93bb55.png#averageHue=%23f9f8f8&clientId=u2b828817-5288-4&from=paste&height=1031&id=u34b6c92a&originHeight=1031&originWidth=2069&originalType=binary&ratio=1&rotation=0&showTitle=false&size=460353&status=done&style=none&taskId=u61d17e47-f8a8-43d1-84b2-2d401efb444&title=&width=2069" alt="image.png"></p><h2 id="å®ç°åˆ†å¸ƒå¼é”åˆçº§ç‰ˆæœ¬"><a href="#å®ç°åˆ†å¸ƒå¼é”åˆçº§ç‰ˆæœ¬" class="headerlink" title="å®ç°åˆ†å¸ƒå¼é”åˆçº§ç‰ˆæœ¬"></a>å®ç°åˆ†å¸ƒå¼é”åˆçº§ç‰ˆæœ¬</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699771133816-3aa47901-f070-4aa4-924f-e0f8dc690bb4.png#averageHue=%23faf9f8&clientId=u2b828817-5288-4&from=paste&height=781&id=uace818c4&originHeight=859&originWidth=769&originalType=binary&ratio=1&rotation=0&showTitle=false&size=188710&status=done&style=none&taskId=u70b504e5-e6d1-4ed9-a8c6-5c9baa37a74&title=&width=699.0908939385221" alt="image.png"></p><ul><li><strong>é”çš„åŸºæœ¬æ¥å£</strong></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699770874269-dc390610-18b3-4234-8c58-280d2c2e64b4.png#averageHue=%23f0f3ee&clientId=u2b828817-5288-4&from=paste&height=415&id=u965c0e3d&originHeight=415&originWidth=1037&originalType=binary&ratio=1&rotation=0&showTitle=false&size=117726&status=done&style=none&taskId=ubc19fde2-7ab1-4e2d-8c5c-37256633aa9&title=&width=1037" alt="image.png"></p><ul><li><strong>SimpleRedisLock</strong></li></ul><p>åˆ©ç”¨setnxæ–¹æ³•è¿›è¡ŒåŠ é”ï¼ŒåŒæ—¶å¢åŠ è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”ï¼Œæ­¤æ–¹æ³•å¯ä»¥ä¿è¯åŠ é”å’Œå¢åŠ è¿‡æœŸæ—¶é—´å…·æœ‰åŸå­æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hmdp.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleRedis</span> <span class="keyword">implements</span> <span class="title class_">ILock</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SimpleRedis</span><span class="params">(String name, StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_PREFIX=<span class="string">&quot;lock :&quot;</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> longTimeSec)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–çº¿ç¨‹æ ‡è¯†</span></span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> Thread.currentThread().getId();</span><br><span class="line">        <span class="comment">//è·å–é”</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">aBoolean</span> <span class="operator">=</span> stringRedisTemplate.opsForValue()</span><br><span class="line">                .setIfAbsent(KEY_PREFIX + name, id + <span class="string">&quot;&quot;</span>, longTimeSec, TimeUnit.SECONDS);</span><br><span class="line">        <span class="comment">// é¿å…è‡ªåŠ¨æ‹†ç®±</span></span><br><span class="line">        <span class="keyword">return</span> Boolean.TRUE.equals(aBoolean) ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unLock</span><span class="params">()</span> &#123;</span><br><span class="line">        stringRedisTemplate.delete(KEY_PREFIX + name);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹ä¸šåŠ¡ä»£ç </li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699771107955-f9d0ac98-aad1-4920-a963-a22da1ace571.png#averageHue=%232c2c2b&clientId=u2b828817-5288-4&from=paste&height=1185&id=u17f30d65&originHeight=1304&originWidth=1210&originalType=binary&ratio=1&rotation=0&showTitle=false&size=174600&status=done&style=none&taskId=uc3445396-9b6e-48fa-b184-5190fc14a44&title=&width=1099.9999761581425" alt="image.png"></p><h2 id="Redisåˆ†å¸ƒå¼é”çš„è¯¯åˆ é—®é¢˜"><a href="#Redisåˆ†å¸ƒå¼é”çš„è¯¯åˆ é—®é¢˜" class="headerlink" title="Redisåˆ†å¸ƒå¼é”çš„è¯¯åˆ é—®é¢˜"></a>Redisåˆ†å¸ƒå¼é”çš„è¯¯åˆ é—®é¢˜</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699771472494-df7802e3-1e3e-48db-a2be-11d3466f206b.png#averageHue=%23fbfafa&clientId=u2b828817-5288-4&from=paste&height=781&id=u7f928350&originHeight=859&originWidth=2200&originalType=binary&ratio=1&rotation=0&showTitle=false&size=326266&status=done&style=none&taskId=u96caefbb-0f03-4002-8df2-fafa9619487&title=&width=1999.9999566511683" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699771503937-7b6b9c51-b148-4087-85f5-5e40d94de5a5.png#averageHue=%23edebeb&clientId=u2b828817-5288-4&from=paste&height=785&id=u69cf30e6&originHeight=864&originWidth=826&originalType=binary&ratio=1&rotation=0&showTitle=false&size=157135&status=done&style=none&taskId=u1afa3fa6-c0ca-4a34-a934-49729056b1e&title=&width=750.9090746335751" alt="image.png"><br>åœ¨é‡Šæ”¾é”ä¹‹å‰å¢åŠ ä¸€å±‚åˆ¤æ–­é€»è¾‘</p><h2 id="è§£å†³é”çš„è¯¯åˆ é—®é¢˜"><a href="#è§£å†³é”çš„è¯¯åˆ é—®é¢˜" class="headerlink" title="è§£å†³é”çš„è¯¯åˆ é—®é¢˜"></a>è§£å†³é”çš„è¯¯åˆ é—®é¢˜</h2><p><a href="https://www.cnblogs.com/jasonboren/p/12939852.html">java UUIDçš„ä½œç”¨å’Œä½¿ç”¨ - jasonå°èœ—ç‰› - åšå®¢å›­</a><br> <img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699771765473-775cddd0-965a-4408-9acc-934cbec110d0.png#averageHue=%23f3f2f2&clientId=u2b828817-5288-4&from=paste&height=498&id=u09492cfa&originHeight=548&originWidth=1267&originalType=binary&ratio=1&rotation=0&showTitle=false&size=240179&status=done&style=none&taskId=u64ef6819-7ec7-4225-bb5c-40c34a513c1&title=&width=1151.8181568531957" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699772446928-2bb328ee-e2f8-4e78-b3b8-1fe4f5b17083.png#averageHue=%232c2c2b&clientId=u2b828817-5288-4&from=paste&height=1118&id=u58788f34&originHeight=1230&originWidth=1596&originalType=binary&ratio=1&rotation=0&showTitle=false&size=206341&status=done&style=none&taskId=u97a17e7e-6ba0-4459-9bfe-bc617761e6c&title=&width=1450.909059461484" alt="image.png"></p><h2 id="åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜"><a href="#åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜" class="headerlink" title="åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜"></a>åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699796424412-f2c361aa-52b8-4395-81ef-b1628281fd56.png#averageHue=%23f5f3f3&clientId=u24e974b6-b49d-4&from=paste&height=866&id=uf39233f4&originHeight=866&originWidth=2162&originalType=binary&ratio=1&rotation=0&showTitle=false&size=504589&status=done&style=none&taskId=ud0a673e8-d152-4459-983c-188bfa3615a&title=&width=2162" alt="image.png"></p><h2 id="Luaè§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜"><a href="#Luaè§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜" class="headerlink" title="Luaè§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜"></a>Luaè§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜</h2><p><a href="https://www.runoob.com/lua/lua-tutorial.html">Lua æ•™ç¨‹ | èœé¸Ÿæ•™ç¨‹</a><br>Redisæä¾›äº†Luaè„šæœ¬åŠŸèƒ½ï¼Œåœ¨ä¸€ä¸ªè„šæœ¬ä¸­ç¼–å†™å¤šæ¡Rediså‘½ä»¤ï¼Œç¡®ä¿å¤šæ¡å‘½ä»¤æ‰§è¡Œæ—¶çš„åŸå­æ€§ã€‚<br>å¯ä»¥ä½¿ç”¨luaå»æ“ä½œredisï¼Œåˆèƒ½ä¿è¯ä»–çš„åŸå­æ€§ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æ‹¿é”æ¯”é”åˆ é”æ˜¯ä¸€ä¸ªåŸå­æ€§åŠ¨ä½œ<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699880933064-77dee115-28f2-45cc-9773-6f6a5e124376.png#averageHue=%23d3d4d2&clientId=u92f804e2-0ef3-4&from=paste&height=638&id=u99462bf3&originHeight=798&originWidth=1620&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=374301&status=done&style=none&taskId=u506ee292-5250-4856-9db0-a03c13e6c4d&title=&width=1296" alt="image.png">  <img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699881087375-df2ee1b5-d8de-4f04-95b3-f1f9f415392f.png#averageHue=%23d4d7ce&clientId=u92f804e2-0ef3-4&from=paste&height=631&id=u56132fa4&originHeight=789&originWidth=1980&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=450447&status=done&style=none&taskId=u711f0716-833b-4d54-abf2-1c92700e50a&title=&width=1584" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699881108549-4fc8f91d-920a-4b92-abba-c1067984756c.png#averageHue=%230e283c&clientId=u92f804e2-0ef3-4&from=paste&height=438&id=ufa0cda3a&originHeight=548&originWidth=1831&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=424857&status=done&style=none&taskId=ucfaaba09-ac69-4b7f-9153-cd3d2cfb9c4&title=&width=1464.8" alt="image.png"><br> <img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699881232331-845d5b44-b145-4e58-9fed-20a28245927a.png#averageHue=%238ac2a2&clientId=u92f804e2-0ef3-4&from=paste&height=275&id=u8841d17e&originHeight=344&originWidth=2182&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=316067&status=done&style=none&taskId=u4b4b0479-e121-4cc0-b8b7-79ba8438af2&title=&width=1745.6" alt="image.png">  <img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699881493990-b8608b49-856e-48fd-8c89-fd9adab0eef6.png#averageHue=%23efefef&clientId=u92f804e2-0ef3-4&from=paste&height=556&id=u217bfdf2&originHeight=695&originWidth=1642&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=460710&status=done&style=none&taskId=ucc2afb76-fb02-468e-8334-95ed95e25b7&title=&width=1313.6" alt="image.png"><br>ä¼˜åŒ–å:<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699881563797-921e1dbf-f656-419e-b0f3-8f047a74ec57.png#averageHue=%23d3dcd0&clientId=u92f804e2-0ef3-4&from=paste&height=353&id=u409c8838&originHeight=441&originWidth=1908&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=409800&status=done&style=none&taskId=ud7f2cc77-b11a-428e-961d-17caf406a5a&title=&width=1526.4" alt="image.png"></p><h2 id="å†æ¬¡æ”¹è¿›Redisçš„åˆ†å¸ƒå¼é”"><a href="#å†æ¬¡æ”¹è¿›Redisçš„åˆ†å¸ƒå¼é”" class="headerlink" title="å†æ¬¡æ”¹è¿›Redisçš„åˆ†å¸ƒå¼é”"></a>å†æ¬¡æ”¹è¿›Redisçš„åˆ†å¸ƒå¼é”</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699881705712-7b360bee-7d40-4dbb-a339-9c6eaebe02a9.png#averageHue=%23ecefe7&clientId=u92f804e2-0ef3-4&from=paste&height=751&id=u9ae334e3&originHeight=939&originWidth=1913&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=592210&status=done&style=none&taskId=u1225738a-2bcb-4bea-bb86-1caaf4d9339&title=&width=1530.4" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699882174692-9e036f2c-ef32-4bea-a179-9bfea183a8e4.png#averageHue=%23f0f5ef&clientId=u92f804e2-0ef3-4&from=paste&height=871&id=u40b269f1&originHeight=1089&originWidth=1722&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=518841&status=done&style=none&taskId=u4c0e6e69-a223-45fc-973e-3393b5e0bb7&title=&width=1377.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699882344511-6207e555-2c39-4f2e-9bdf-ea38db59b776.png#averageHue=%23efefef&clientId=u92f804e2-0ef3-4&from=paste&height=427&id=ufd8c3a1b&originHeight=534&originWidth=1071&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=223373&status=done&style=none&taskId=uad9dd949-1b2c-4817-8c6e-7dcdd58f793&title=&width=856.8" alt="image.png"></p><h2 id="RedissonåŠŸèƒ½ä»‹ç»"><a href="#RedissonåŠŸèƒ½ä»‹ç»" class="headerlink" title="RedissonåŠŸèƒ½ä»‹ç»"></a>RedissonåŠŸèƒ½ä»‹ç»</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1699979826880-5d8dda27-fa55-4c01-96aa-4b8a7b45ac1f.png#averageHue=%23fcfcfc&clientId=ub5bfeee0-49d7-4&from=paste&height=517&id=u83b9b5cf&originHeight=1034&originWidth=2120&originalType=binary&ratio=2&rotation=0&showTitle=false&size=600636&status=done&style=none&taskId=udc199d20-1fa7-4ced-9073-3f467d8844e&title=&width=1060" alt="image.png"></p><h2 id="Redissonå¯é‡å…¥é”åŸç†åŸç†"><a href="#Redissonå¯é‡å…¥é”åŸç†åŸç†" class="headerlink" title="Redissonå¯é‡å…¥é”åŸç†åŸç†"></a>Redissonå¯é‡å…¥é”åŸç†åŸç†</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700018645762-279974a1-1dd6-45ca-9137-7d97dcf1722b.png#averageHue=%23f2f4ef&clientId=u581ad08b-35c6-4&from=paste&height=631&id=u985b8ce9&originHeight=1262&originWidth=2514&originalType=binary&ratio=2&rotation=0&showTitle=false&size=949703&status=done&style=none&taskId=u48284284-8e00-42df-b8e4-fd63c27ab94&title=&width=1257" alt="image.png"><br>é€šè¿‡æ‰§è¡Œä»»åŠ¡å®Œæˆå‡1æ¥å®ç°ã€‚<br>ä½†è¿™ä¹ˆå¤æ‚çš„é€»è¾‘ã€‚ éœ€è¦é€šè¿‡Luaè„šæœ¬æ¥å®ç°ï¼Œç¡®ä¿åŸå­æ€§ã€‚<br>è·å–é”è¿‡ç¨‹ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700018849312-e6676ce5-f980-445b-995c-1946733368bf.png#averageHue=%23eff1eb&clientId=u581ad08b-35c6-4&from=paste&height=614&id=u9a7b9e93&originHeight=1228&originWidth=2530&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1223900&status=done&style=none&taskId=u4de41c11-5b16-4b1b-8219-d5138838503&title=&width=1265" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700019201833-de25b267-f566-4248-b001-6b3219bc861d.png#averageHue=%23eef1eb&clientId=u581ad08b-35c6-4&from=paste&height=595&id=ua4c740d1&originHeight=1190&originWidth=2492&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1177806&status=done&style=none&taskId=ue12f011f-611b-497c-9475-5d181fbae4d&title=&width=1246" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700019729671-7907b6e9-3ce3-46f2-9c2f-15af55b0f90a.png#averageHue=%23e7eee5&clientId=u581ad08b-35c6-4&from=paste&height=538&id=ufe7345c9&originHeight=1076&originWidth=2676&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1379062&status=done&style=none&taskId=uecac0475-8044-4070-baae-172b3f09512&title=&width=1338" alt="image.png"><br>tryLockåº•å±‚å°±æ˜¯ç”¨äº†Luaè„šæœ¬<img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700019806532-f028d6ff-e7b6-4d6a-8d84-bd814933273d.png#averageHue=%23eff5ec&clientId=u581ad08b-35c6-4&from=paste&height=509&id=u15053e07&originHeight=1018&originWidth=2654&originalType=binary&ratio=2&rotation=0&showTitle=false&size=917520&status=done&style=none&taskId=u0fb71384-75f0-4ea9-a6ff-8eb71718abb&title=&width=1327" alt="image.png"><br>æ ¸å¿ƒå°±æ˜¯é€šè¿‡Hashç»“æ„æ¥è®°å½•é”çš„è°ƒç”¨æ¬¡æ•°ã€‚<br> <img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700055978583-286839e3-3017-4406-90df-b6e930f55ab0.png#averageHue=%23f4f2f2&clientId=u50dd14e7-a648-4&from=paste&height=760&id=uca34f263&originHeight=760&originWidth=1843&originalType=binary&ratio=1&rotation=0&showTitle=false&size=316805&status=done&style=none&taskId=u973abdad-f003-4415-a81a-05f0d2801d3&title=&width=1843" alt="image.png"></p><h2 id="åŸºäºredisåˆ†å¸ƒå¼é”ä¼˜åŒ–"><a href="#åŸºäºredisåˆ†å¸ƒå¼é”ä¼˜åŒ–" class="headerlink" title="åŸºäºredisåˆ†å¸ƒå¼é”ä¼˜åŒ–"></a>åŸºäºredisåˆ†å¸ƒå¼é”ä¼˜åŒ–</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700056217601-0c6e7d65-7fab-45c1-9989-38132616d579.png#averageHue=%23f9f0ef&clientId=u50dd14e7-a648-4&from=paste&height=761&id=ub1c7888f&originHeight=951&originWidth=1840&originalType=binary&ratio=1&rotation=0&showTitle=false&size=342512&status=done&style=none&taskId=uf5e10912-f68c-4b07-a9c1-5b60e80ea2a&title=&width=1472" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700056481920-222e2d99-5e68-4a84-86d3-14bae28ffa37.png#averageHue=%23f5e6e5&clientId=u50dd14e7-a648-4&from=paste&height=782&id=u834d1a86&originHeight=977&originWidth=2234&originalType=binary&ratio=1&rotation=0&showTitle=false&size=496050&status=done&style=none&taskId=u16887b86-dff6-4f7c-a321-a688a0d78a0&title=&width=1787.2" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700056738489-ecee9d44-ea43-4c3e-abd0-cb305af85adc.png#averageHue=%23f2f7f1&clientId=u50dd14e7-a648-4&from=paste&height=403&id=u87f6f193&originHeight=504&originWidth=1681&originalType=binary&ratio=1&rotation=0&showTitle=false&size=295692&status=done&style=none&taskId=ufa3ae324-8dce-4a6c-8ff7-33f9d1d079b&title=&width=1344.8" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700057236183-e8f70303-b73e-4043-ae37-5c1415ded4b6.png#averageHue=%23eeeeee&clientId=u50dd14e7-a648-4&from=paste&height=733&id=ua4c7a83f&originHeight=916&originWidth=1222&originalType=binary&ratio=1&rotation=0&showTitle=false&size=391430&status=done&style=none&taskId=ua38b47d1-6d94-4778-9c98-ba092437f32&title=&width=977.6" alt="image.png"></p><h1 id="ç§’æ€ä¼˜åŒ–"><a href="#ç§’æ€ä¼˜åŒ–" class="headerlink" title="ç§’æ€ä¼˜åŒ–"></a>ç§’æ€ä¼˜åŒ–</h1><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700108211115-77067f67-a25b-48e4-8bc2-a573d82fb72d.png#averageHue=%23fbf8f7&clientId=u3efe4494-fe3d-4&from=paste&height=1055&id=u7b2571e0&originHeight=1055&originWidth=2165&originalType=binary&ratio=1&rotation=0&showTitle=false&size=393738&status=done&style=none&taskId=u57881431-e1b4-4e7f-a0f1-14fdc052a34&title=&width=2165" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700108448724-60d6a6e1-e83c-4eda-bff2-8ce93f1286c1.png#averageHue=%23faf7f6&clientId=u3efe4494-fe3d-4&from=paste&height=1002&id=u58a39a79&originHeight=1002&originWidth=2181&originalType=binary&ratio=1&rotation=0&showTitle=false&size=432047&status=done&style=none&taskId=u52738e3a-12a1-4fc3-8241-c320d24c34f&title=&width=2181" alt="image.png"><br>ä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§<img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700108815144-7c7f9c4e-1e85-4a10-878f-e519097dbc39.png#averageHue=%23f4f0f0&clientId=u3efe4494-fe3d-4&from=paste&height=1037&id=u44050025&originHeight=1037&originWidth=2257&originalType=binary&ratio=1&rotation=0&showTitle=false&size=446673&status=done&style=none&taskId=ufd15cf1f-404c-4a32-b5b0-1350b67aec7&title=&width=2257" alt="image.png"><br>ä¸ºé¿å…æ‰€æœ‰æ“ä½œéƒ½åœ¨æ•°æ®åº“ä¸Šæ‰§è¡Œï¼Œåˆ†ç¦»æˆä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹åˆ¤æ–­ç”¨æˆ·çš„è´­ä¹°èµ„æ ¼ï¼Œå‘ç°ç”¨æˆ·æœ‰è´­ä¹°èµ„æ ¼åå†å¼€å¯ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æ¥å¤„ç†è€—æ—¶è¾ƒä¹…çš„å‡åº“å­˜ã€å†™è®¢å•çš„æ“ä½œã€‚<br>å¯ä»¥å°†è€—æ—¶è¾ƒçŸ­çš„ä¸¤æ­¥æ“ä½œæ”¾åˆ° Redis ä¸­ï¼Œåœ¨ Redis ä¸­å¤„ç†å¯¹åº”çš„ç§’æ€èµ„æ ¼çš„åˆ¤æ–­ã€‚Redis çš„æ€§èƒ½æ˜¯æ¯” MySQL è¦å¥½çš„ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦å¼•å…¥å¼‚æ­¥é˜Ÿåˆ—è®°å½•ç›¸å…³çš„ä¿¡æ¯ã€‚<br>rediséƒ¨åˆ†å¤„ç†é€»è¾‘ï¼Œ Luaè„šæœ¬å°è£…æ“ä½œä¿è¯åŸå­æ€§ï¼Œ redisè¿™é‡Œé€‰æ‹©çš„å­˜å‚¨ç±»å‹ä¸ºsetï¼Œå› ä¸ºkeyä¸èƒ½é‡å¤ï¼Œè€Œsetæ°å¥½æ˜¯æ— åºä¸é‡å¤çš„<br><strong>åŸºäºRediså®ç°ç§’æ€èµ„æ ¼åˆ¤æ–­</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700143137919-cce8210f-eb55-4cb3-bb70-da4607a4e40c.png#averageHue=%23f1efef&clientId=u3efe4494-fe3d-4&from=paste&height=524&id=u1b444d16&originHeight=524&originWidth=1353&originalType=binary&ratio=1&rotation=0&showTitle=false&size=275261&status=done&style=none&taskId=u9d3d2a8e-d869-43ab-b8c7-412b7836f55&title=&width=1353" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700142114007-8be488d5-8675-44a7-8b42-e48a81b29293.png#averageHue=%230f263c&clientId=u3efe4494-fe3d-4&from=paste&height=494&id=ubcf455b5&originHeight=494&originWidth=1488&originalType=binary&ratio=1&rotation=0&showTitle=false&size=293776&status=done&style=none&taskId=u2a5cd725-d0d0-47cb-a1a6-437db6b30cd&title=&width=1488" alt="image.png"></p><ul><li>æ–°å¢ä¼˜æƒ åˆ¸åŒæ—¶,å°†ä¼˜æƒ åˆ¸ä¿¡æ¯ä¿å­˜åˆ°Redisä¸­</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700143188577-2b7e916f-5102-4a7a-93e3-eb4ec45367b6.png#averageHue=%232c2c2b&clientId=u3efe4494-fe3d-4&from=paste&height=555&id=u4976e03b&originHeight=555&originWidth=1658&originalType=binary&ratio=1&rotation=0&showTitle=false&size=74949&status=done&style=none&taskId=uf10ee419-96a5-4062-a0f5-89a0a83cfcd&title=&width=1658" alt="image.png"></p><ul><li>åŸºäºLuaè„šæœ¬, åˆ¤æ–­ç§’æ€åº“å­˜,ä¸€äººä¸€å•,å†³å®šç”¨æˆ·æ˜¯å¦æŠ¢è´­æˆåŠŸ</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.1 è®¢å•id</span></span><br><span class="line"><span class="keyword">local</span> voucherId = ARGV[<span class="number">1</span>]</span><br><span class="line"><span class="comment">-- 1.2 ç”¨æˆ·id</span></span><br><span class="line"><span class="keyword">local</span> useId = ARGV[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ•°æ®key</span></span><br><span class="line"><span class="comment">-- 2.1 åº“å­˜key</span></span><br><span class="line"><span class="keyword">local</span> stockKey = <span class="string">&#x27;seckill:stock:&#x27;</span> .. voucherId</span><br><span class="line"><span class="comment">-- 2.2 è®¢å•key</span></span><br><span class="line"><span class="keyword">local</span> orderKey = <span class="string">&#x27;seckill:order:&#x27;</span> .. voucherId</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3.è„šæœ¬ä¸šåŠ¡</span></span><br><span class="line"><span class="comment">-- 3.1 åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ get stockKey</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">tonumber</span>(redis.call(<span class="string">&#x27;get&#x27;</span>,stockKey)) &lt;= <span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- ä¸è¶³è¿”å›1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 3.2 åº“å­˜å……è¶³,sismemberçœ‹userIdæ˜¯å¦å­˜åœ¨äºorderId</span></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&#x27;sismember&#x27;</span>, orderKey, userId) == <span class="number">1</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- 3.3 å¦‚æœå­˜åœ¨,è¯´æ˜ä¸‹å•äº†,è¿”å›2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 3.4 æ‰£å‡åº“å­˜ incrby stockKey -1</span></span><br><span class="line">redis.call(<span class="string">&#x27;incriby&#x27;</span>, stockKey, <span class="number">-1</span>)</span><br><span class="line"><span class="comment">-- 3.5ä¸‹å•(ä¿å­˜ç”¨æˆ·)</span></span><br><span class="line">redis.call(<span class="string">&#x27;sadd&#x27;</span>, orderKey, userId)</span><br></pre></td></tr></table></figure><ul><li>javaä»£ç ä¸­æ‰§è¡Œluaè„šæœ¬ï¼Œå¹¶åˆ¤æ–­ï¼ŒæŠ¢è´­æˆåŠŸçš„ç”Ÿæˆè®¢å•å¹¶å­˜å…¥é˜»å¡é˜Ÿåˆ—<br>é¦–å…ˆæ³¨å…¥è„šæœ¬</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> IVoucherOrderService proxy;<span class="comment">//å®šä¹‰ä»£ç†å¯¹è±¡ï¼Œæå‰å®šä¹‰åé¢ä¼šç”¨åˆ°</span></span><br><span class="line"><span class="comment">//æ³¨å…¥è„šæœ¬</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultRedisScript&lt;Long&gt; SECKILL_SCRIPT;</span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    SECKILL_SCRIPT = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;();</span><br><span class="line">    SECKILL_SCRIPT.setLocation(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;seckill.lua&quot;</span>));</span><br><span class="line">    SECKILL_SCRIPT.setResultType(Long.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œè„šæœ¬ï¼Œä¸”åˆ¤æ–­ä¸æ»¡è¶³çš„è¯·æ±‚ç›´æ¥è¿”å›æç¤ºä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123; <span class="comment">//ä½¿ç”¨luaè„šæœ¬</span></span><br><span class="line">    <span class="comment">//è·å–ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">//1.æ‰§è¡Œluaè„šæœ¬</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> stringRedisTemplate.execute(</span><br><span class="line">            SECKILL_SCRIPT,</span><br><span class="line">            Collections.emptyList(), <span class="comment">//è¿™é‡Œæ˜¯keyæ•°ç»„ï¼Œæ²¡æœ‰keyï¼Œå°±ä¼ çš„ä¸€ä¸ªç©ºé›†åˆ</span></span><br><span class="line">            voucherId.toString(), userId.toString()</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">//2.åˆ¤æ–­ç»“æœæ˜¯0</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> result.intValue();<span class="comment">//Longå‹è½¬ä¸ºintå‹ï¼Œä¾¿äºä¸‹é¢æ¯”è¾ƒ</span></span><br><span class="line">    <span class="keyword">if</span> (r != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">//2.1 ä¸ä¸º0ï¼Œä»£è¡¨æ²¡æœ‰è´­ä¹°èµ„æ ¼</span></span><br><span class="line">        <span class="keyword">return</span>  Result.fail(r == <span class="number">1</span>?<span class="string">&quot;ä¼˜æƒ åˆ¸å·²å”®ç½„&quot;</span>:<span class="string">&quot;ä¸èƒ½é‡å¤è´­ä¹°&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ€åæ˜¯å°†æ»¡è¶³æ¡ä»¶çš„ç»™å­˜æ”¾è¿›é˜»å¡é˜Ÿåˆ—ä¸­<br>åˆ›å»ºä¸€ä¸ªBlockingQueueé˜»å¡é˜Ÿåˆ—</p><blockquote><p><strong>BlockingQueueè¿™ä¸ªé˜»å¡é˜Ÿåˆ—ç‰¹ç‚¹ï¼šå½“ä¸€ä¸ªçº¿ç¨‹å°è¯•ä»é˜Ÿåˆ—è·å–å…ƒç´ çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰å…ƒç´ è¯¥çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰å…ƒç´ æ‰ä¼šè¢«å”¤é†’å¹¶è·å–å…ƒç´ </strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºé˜»å¡é˜Ÿåˆ—  è¿™ä¸ªé˜»å¡é˜Ÿåˆ—ç‰¹ç‚¹ï¼šå½“ä¸€ä¸ªçº¿ç¨‹å°è¯•ä»é˜Ÿåˆ—è·å–å…ƒç´ çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰å…ƒç´ è¯¥çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰å…ƒç´ æ‰ä¼šè¢«å”¤é†’è·å–</span></span><br><span class="line">    <span class="keyword">private</span> BlockingQueue&lt;VoucherOrder&gt; orderTasks = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">1024</span> * <span class="number">1024</span>);<span class="comment">//åˆå§‹åŒ–é˜»å¡é˜Ÿåˆ—çš„å¤§å°</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯å°†æ»¡è¶³æ¡ä»¶çš„è¯·æ±‚ï¼Œç»™ç”Ÿæˆè®¢å•ï¼Œå¹¶æŠŠè®¢å•å¯¹è±¡addåˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œæ¥ä¸Šé¢çš„ä»£ç ï¼Œå®Œæˆæ•´ä¸ªç¬¬ä¸‰æ­¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//2.2 ä¸º0ï¼Œæœ‰è´­ä¹°èµ„æ ¼ï¼ŒæŠŠä¸‹å•ä¿¡æ¯ä¿å­˜åˆ°é˜»å¡é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    <span class="comment">//7.åˆ›å»ºè®¢å•   å‘è®¢å•è¡¨æ–°å¢ä¸€æ¡æ•°æ®ï¼Œé™¤é»˜è®¤å­—æ®µï¼Œå…¶ä»–å­—æ®µçš„å€¼éœ€è¦set</span></span><br><span class="line">    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">    <span class="comment">//7.1è®¢å•id</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    voucherOrder.setId(orderId);</span><br><span class="line">    <span class="comment">//7.2ç”¨æˆ·id</span></span><br><span class="line">    voucherOrder.setUserId(userId);</span><br><span class="line">    <span class="comment">//7.3ä»£é‡‘åˆ¸id</span></span><br><span class="line">    voucherOrder.setVoucherId(voucherId);</span><br><span class="line">    <span class="comment">//æ”¾å…¥é˜»å¡å¯¹åˆ—ä¸­</span></span><br><span class="line">    orderTasks.add(voucherOrder);</span><br><span class="line">    <span class="comment">//è·å–ä»£ç†å¯¹è±¡</span></span><br><span class="line">    proxy = (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">    <span class="comment">//3.è¿”å›è®¢å•id</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>4.å¼€å¯çº¿ç¨‹ä»»åŠ¡ï¼Œå®ç°å¼‚æ­¥ä¸‹å•åŠŸèƒ½<br>é¦–å…ˆåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± <br>å†å®šä¹‰ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼Œä½†æ˜¯æ³¨æ„ï¼Œçº¿ç¨‹ä»»åŠ¡éœ€è¦åœ¨ç”¨æˆ·ç§’æ€è®¢å•ä¹‹å‰å¼€å§‹ï¼Œç”¨æˆ·ä¸€ä½†å¼€å§‹ç§’æ€ï¼Œé˜Ÿåˆ—å°±ä¼šæœ‰æ–°çš„è®¢å•ï¼Œçº¿ç¨‹ä»»åŠ¡å°±åº”è¯¥ç«‹å³å–å‡ºè®¢å•ä¿¡æ¯ï¼Œ<strong>è¿™é‡Œåˆ©ç”¨springæä¾›çš„æ³¨è§£ï¼Œåœ¨ç±»åˆå§‹åŒ–å®Œæ¯•åç«‹å³æ‰§è¡Œçº¿ç¨‹ä»»åŠ¡ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºçº¿ç¨‹æ± </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">SECKILL_ORDER_EXECUTOR</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"><span class="comment">//åˆ©ç”¨springæä¾›çš„æ³¨è§£ï¼Œåœ¨ç±»åˆå§‹åŒ–å®Œæ¯•åç«‹å³æ‰§è¡Œçº¿ç¨‹ä»»åŠ¡</span></span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">    SECKILL_ORDER_EXECUTOR.submit(<span class="keyword">new</span> <span class="title class_">VoucherOrderHandler</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çº¿ç¨‹ä»»åŠ¡ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºçº¿ç¨‹ä»»åŠ¡ï¼Œå†…éƒ¨ç±»æ–¹å¼</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1.è·å–é˜Ÿåˆ—ä¸­çš„è®¢å•ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> orderTasks.take();</span><br><span class="line">            <span class="comment">//2.åˆ›å»ºè®¢å•ï¼Œè¿™æ˜¯è°ƒä¹‹å‰é‚£ä¸ªåˆ›å»ºè®¢å•çš„æ–¹æ³•ï¼Œéœ€è¦ç¨ä½œæ”¹åŠ¨</span></span><br><span class="line">            handleVoucherOrder(voucherOrder);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;å¼‚å¸¸ä¿¡æ¯:&quot;</span>,e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ›å»ºè°ƒç”¨çš„handleVoucherOrderæ–¹æ³•ï¼Œè¿™é‡Œçš„è·å–é”æ“ä½œåªæ˜¯åšæœ€åçš„å…œåº•ï¼Œä»¥é˜²ä¸‡ä¸€ï¼Œå› ä¸ºå‰é¢luaè„šæœ¬éƒ½å·²ç»åˆ¤æ–­è¿‡äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleVoucherOrder</span><span class="params">(VoucherOrder voucherOrder)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> voucherOrder.getUserId();</span><br><span class="line">    <span class="comment">//åˆ›å»ºé”å¯¹è±¡</span></span><br><span class="line">    <span class="type">SimpleRedisLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleRedisLock</span>(<span class="string">&quot;order:&quot;</span> + userId, stringRedisTemplate);</span><br><span class="line">    <span class="comment">//è·å–é”</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock(<span class="number">1200</span>);</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span> (!isLock)&#123;</span><br><span class="line">        log.error(<span class="string">&quot;æ‚¨å·²è´­ä¹°è¿‡è¯¥å•†å“ï¼Œä¸èƒ½é‡å¤è´­ä¹°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        proxy.createVoucherOrder(voucherOrder);<span class="comment">//ä½¿ç”¨ä»£ç†å¯¹è±¡ï¼Œæœ€åç”¨äºæäº¤äº‹åŠ¡</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalStateException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();<span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>createVoucherOrderåˆ›å»ºè®¢å•æ–¹æ³•ï¼Œè¿™é‡Œä¸€äººä¸€å•çš„å…¶å®ä¹Ÿä¸å¿…åˆ¤è¯»äº†ï¼Œluaè„šæœ¬éƒ½å†™å¥½äº†ï¼Œè¿™é‡Œåªæ˜¯å…œåº•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createVoucherOrder</span><span class="params">(VoucherOrder voucherOrder)</span>&#123;</span><br><span class="line">       <span class="type">Long</span> <span class="variable">voucherId</span> <span class="operator">=</span> voucherOrder.getVoucherId();</span><br><span class="line">       <span class="comment">//5.ä¸€äººä¸€å•</span></span><br><span class="line">       <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> voucherOrder.getId();</span><br><span class="line">       <span class="comment">//5.1æŸ¥è¯¢è®¢å•</span></span><br><span class="line">       <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).count();</span><br><span class="line">       <span class="comment">//5.2åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">       <span class="keyword">if</span> (count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">           log.error(<span class="string">&quot;æ‚¨å·²ç»è´­ä¹°è¿‡äº†&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//6.æ‰£å‡åº“å­˜</span></span><br><span class="line">       <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">               .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>)<span class="comment">//set stock = stock -1</span></span><br><span class="line">               .eq(<span class="string">&quot;voucher_id&quot;</span>,voucherId).gt(<span class="string">&quot;stock&quot;</span>,<span class="number">0</span>) <span class="comment">//where id = ? and stock &gt; 0</span></span><br><span class="line">               .update();</span><br><span class="line">       <span class="keyword">if</span> (!success)&#123;</span><br><span class="line">           log.error(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="built_in">this</span>.save(voucherOrder);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ€åæ¥åˆ†æä»¥ä¸‹æ•´ä¸ªä¼˜åŒ–æ€è·¯</p><p>â‘ ç¼–å†™luaè„šæœ¬ï¼Œå¯¹äºè¶…å–é—®é¢˜å’Œä¸€äººä¸€å•è¿›è¡Œè§£å†³å¤„ç†ï¼Œè¶…å–ç”¨CASæ–¹æ³•åˆ¤æ–­åº“å­˜æ˜¯å¦å¤§äº0ï¼Œä¸€äººä¸€å•ç”¨redisçš„seté›†åˆçš„sismenberåˆ¤è¯»è¯¥ä¼˜æƒ åˆ¸ï¼ˆkeyï¼‰ä¸‹çš„ç”¨æˆ·idï¼ˆvalueï¼‰æ˜¯å¦å”¯ä¸€<br>â‘¡Javaä»£ç ä¸­æ³¨å…¥è„šæœ¬ï¼Œå¹¶æ‰§è¡Œè„šæœ¬åˆ¤æ–­è„šæœ¬è¿”å›ç»“æœï¼Œè‹¥ä¸ä¸ºè„šæœ¬ç»“æœ0ï¼Œç›´æ¥è¿”å›é”™è¯¯æç¤º<br>â‘¢è‹¥è„šæœ¬ç»“æœä¸º0ï¼Œä»£è¡¨æœ‰è´­ä¹°ä¼˜æƒ åˆ¸èµ„æ ¼ï¼Œå°†new VoucherOrderåˆ›å»ºè®¢å•å¯¹è±¡ï¼Œå¹¶set orderIdï¼ŒuserIdï¼ŒvoucherIdã€‚å†æŠŠè®¢å•å¯¹è±¡æ”¾å…¥é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œè¿”å›è®¢å•idç»™ç”¨æˆ·<br>â‘£åˆ›å»ºçº¿ç¨‹æ± ï¼Œå¹¶å®šä¹‰çº¿ç¨‹ä»»åŠ¡ï¼Œä½†æ³¨æ„ï¼Œçº¿ç¨‹ä»»åŠ¡å¿…é¡»åœ¨æ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œï¼Œä½¿ç”¨åˆ°springæä¾›çš„æ³¨è§£åœ¨ç±»åˆå§‹åŒ–å®Œæˆåæ‰§è¡Œçº¿ç¨‹ä»»åŠ¡<br>â‘¤çº¿ç¨‹ä»»åŠ¡ä¸­è·å–é˜»å¡é˜Ÿåˆ—çš„è®¢å•å¯¹è±¡ï¼Œç„¶åè°ƒç”¨handleVoucherOrderæ–¹æ³•ä¼ å…¥voucherOrder<br>â‘¥handleVoucherOrderæ–¹æ³•å…¶å®æ˜¯å†æ¬¡è·å–é”ï¼Œè¿™ä¸ªå°±æ˜¯ä¸ªçº¯å…œåº•ï¼Œä½œç”¨ä¸å¤§ã€‚å¹¶åœ¨è·å–é”æˆåŠŸåè°ƒç”¨createVoucherOrderæ–¹æ³•æ‰£å‡åº“å­˜åˆ›å»ºè®¢å•ï¼Œç”±äºéƒ½æ˜¯å¯¹æ•°æ®åº“çš„æ“ä½œï¼Œå› æ­¤è¦æäº¤äº‹åŠ¡</p><h1 id="è¾¾äººæ¢åº—"><a href="#è¾¾äººæ¢åº—" class="headerlink" title="è¾¾äººæ¢åº—"></a>è¾¾äººæ¢åº—</h1><h2 id="å‘å¸ƒæ¢åº—ç¬”è®°"><a href="#å‘å¸ƒæ¢åº—ç¬”è®°" class="headerlink" title="å‘å¸ƒæ¢åº—ç¬”è®°"></a>å‘å¸ƒæ¢åº—ç¬”è®°</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700192287868-9a1187af-243a-48bc-aa09-c915e6be9d49.png#averageHue=%232d2c2b&clientId=uf4fd22ef-b30f-4&from=paste&height=467&id=uf2e5d9c1&originHeight=584&originWidth=1635&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=71962&status=done&style=none&taskId=ud5a1a946-f9b8-4357-b93a-c60d894d2ca&title=&width=1308" alt="image.png"><br>   <img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700192303259-735adad5-6b92-424d-bad0-ad0848be8aaf.png#averageHue=%23fbf9f8&clientId=uf4fd22ef-b30f-4&from=paste&height=649&id=ua57afb52&originHeight=811&originWidth=454&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=55014&status=done&style=none&taskId=u5a954408-ad69-4f84-b89b-0f3dca79db5&title=&width=363.2" alt="fd58151acf51b465fc8430594373e22.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700192308132-1578fabd-b085-4d49-bc95-4ddf6dbff04e.png#averageHue=%23e2d3cb&clientId=uf4fd22ef-b30f-4&from=paste&height=649&id=u121eda6c&originHeight=811&originWidth=454&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=241575&status=done&style=none&taskId=ufda28241-dcd6-4295-a2a3-daae5345516&title=&width=363.2" alt="4542b554a076d20a0a6da9b3a770e93.png"></p><h2 id="æŸ¥çœ‹æ¢åº—ç¬”è®°"><a href="#æŸ¥çœ‹æ¢åº—ç¬”è®°" class="headerlink" title="æŸ¥çœ‹æ¢åº—ç¬”è®°"></a>æŸ¥çœ‹æ¢åº—ç¬”è®°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">queryBlogById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class="line">       <span class="keyword">return</span> blogService.queryBlogById(id);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">  UserServiceImpl userService;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Result <span class="title function_">queryBlogById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">      <span class="comment">// æŸ¥è¯¢blog</span></span><br><span class="line">      <span class="type">Blog</span> <span class="variable">blog</span> <span class="operator">=</span> getById(id);</span><br><span class="line">      <span class="keyword">if</span> (blog == <span class="literal">null</span>)Result.fail(<span class="string">&quot;ç¬”è®°ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">      <span class="comment">//æŸ¥è¯¢è·Ÿç¬”è®°æœ‰å…³çš„ç”¨æˆ·</span></span><br><span class="line">      <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> blog.getUserId();</span><br><span class="line">      <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(userId);</span><br><span class="line">      blog.setName(user.getNickName());</span><br><span class="line">      blog.setIcon(user.getIcon());</span><br><span class="line">      <span class="keyword">return</span> Result.ok(blog);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700193985582-21a43285-d97d-41fb-bb96-008d81a39809.png#averageHue=%23dfd9d4&clientId=u7b8926cd-a983-4&from=paste&height=649&id=ua3a177b0&originHeight=811&originWidth=454&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=223031&status=done&style=none&taskId=ucea36795-d007-4ff6-9d5f-ff0ca06b5a7&title=&width=363.2" alt="image.png"></p><h2 id="å®Œå–„ç‚¹èµåŠŸèƒ½"><a href="#å®Œå–„ç‚¹èµåŠŸèƒ½" class="headerlink" title="å®Œå–„ç‚¹èµåŠŸèƒ½"></a>å®Œå–„ç‚¹èµåŠŸèƒ½</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700194315711-c845fe89-d025-42f0-a3fe-8d28061c0ded.png#averageHue=%23f5f5f5&clientId=u7b8926cd-a983-4&from=paste&height=761&id=ue7aaec9e&originHeight=951&originWidth=1802&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=443516&status=done&style=none&taskId=u76cbef0d-d4c1-44e3-8596-7e873bba294&title=&width=1441.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700198316712-283624f0-1627-4410-a753-5bf72beb9611.png#averageHue=%23f6f5f5&clientId=u7b8926cd-a983-4&from=paste&height=691&id=ufe8821b3&originHeight=864&originWidth=2126&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=469370&status=done&style=none&taskId=u01a71424-ac53-4a05-9b87-257031d9649&title=&width=1700.8" alt="image.png"><br>ä¸ºä»€ä¹ˆé‡‡ç”¨seté›†åˆï¼š<br>å› ä¸ºæˆ‘ä»¬çš„æ•°æ®æ˜¯ä¸èƒ½é‡å¤çš„.<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700222974076-5d45ce71-9321-483f-a627-6dd08c6181cd.png#averageHue=%232b2b2b&clientId=u7b8926cd-a983-4&from=paste&height=516&id=u3e6ea984&originHeight=516&originWidth=1552&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=37622&status=done&style=none&taskId=u9c1bc59f-ab5a-4eaa-87d4-e42e289448a&title=&width=1552" alt="image.png"><br>ä¸æ˜¯æ•°æ®åº“å­—æ®µ,ä½¿æˆ‘ä»¬è‡ªå·±åŠ çš„.</p><h2 id="ç‚¹èµæ’è¡Œæ¦œ"><a href="#ç‚¹èµæ’è¡Œæ¦œ" class="headerlink" title="ç‚¹èµæ’è¡Œæ¦œ"></a>ç‚¹èµæ’è¡Œæ¦œ</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700232547308-8fe2e403-8645-44db-94e9-45b0899fe658.png#averageHue=%23e9e0e0&clientId=u7b8926cd-a983-4&from=paste&height=1022&id=u357df1e0&originHeight=1022&originWidth=1860&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=321342&status=done&style=none&taskId=uff5dce92-5d94-43c9-ad68-921e086026a&title=&width=1860" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700232637405-256dc518-8c4b-4e8c-b74b-6e6cea1bb3fe.png#averageHue=%23072136&clientId=u7b8926cd-a983-4&from=paste&height=631&id=u4fd4e0b9&originHeight=631&originWidth=1910&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=447275&status=done&style=none&taskId=u64a8ae48-4c76-452d-8bd0-12d7bf2e608&title=&width=1910" alt="image.png"><br>ä¿®æ”¹ä»£ç <img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700234060791-0ebd8375-a41f-4e12-bd90-fc92631d084a.png#averageHue=%232c2c2b&clientId=u7b8926cd-a983-4&from=paste&height=1281&id=u4782a1b4&originHeight=1281&originWidth=1511&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=213137&status=done&style=none&taskId=uddafbb8c-4fa0-4209-9c32-52b206e5e6f&title=&width=1511" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">isBlogLike</span><span class="params">(Blog blog)</span> &#123;</span><br><span class="line">       <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">       <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">       <span class="comment">// 2.åˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹èµ</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstants.BLOG_LIKED_KEY + blog.getId();</span><br><span class="line">       <span class="type">Double</span> <span class="variable">score</span> <span class="operator">=</span> stringRedisTemplate.opsForZSet().score(key, userId.toString());</span><br><span class="line">       blog.setIsLike(BooleanUtil.isTrue(score!=<span class="literal">null</span>));</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">likeBlog</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">       <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">       <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">       <span class="comment">// 2.åˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹èµ</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstants.BLOG_LIKED_KEY + id;</span><br><span class="line">       <span class="type">Double</span> <span class="variable">score</span> <span class="operator">=</span> stringRedisTemplate.opsForZSet().score(key, userId.toString());</span><br><span class="line">       <span class="keyword">if</span> ( score == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="comment">//3.å¦‚æœæœªç‚¹èµï¼Œå¯ä»¥ç‚¹èµ</span></span><br><span class="line">           <span class="comment">//3.1 æ•°æ®åº“ç‚¹èµæ•°+1</span></span><br><span class="line">           <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked + 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">           <span class="comment">//3.2 ä¿å­˜ç”¨æˆ·åˆ°Redisçš„seté›†åˆ</span></span><br><span class="line">           <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">               stringRedisTemplate.opsForZSet().add(key, userId.toString(), System.currentTimeMillis());</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="comment">//4.å¦‚æœå·²ç‚¹èµï¼Œå–æ¶ˆç‚¹èµ</span></span><br><span class="line">           <span class="comment">//4.1 æ•°æ®åº“ç‚¹èµæ•°-1</span></span><br><span class="line">           <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked - 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">           <span class="comment">//4.2 æŠŠç”¨æˆ·ä»Redisçš„seté›†åˆç§»é™¤</span></span><br><span class="line">           <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">               stringRedisTemplate.opsForZSet().remove(key, userId.toString());</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> Result.ok();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700236822763-c63a3595-c66d-4c79-8e45-9cc24c3c9a3b.png#averageHue=%23fafafa&clientId=u7b8926cd-a983-4&from=paste&height=619&id=u7e9d0869&originHeight=619&originWidth=1329&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=187179&status=done&style=none&taskId=u2994ebf1-e3c6-4b24-a443-7171bad45eb&title=&width=1329" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700236872571-05c9d8c0-3b3c-45b7-ad7a-b8de86d81275.png#averageHue=%23f9f9f9&clientId=u7b8926cd-a983-4&from=paste&height=663&id=u15fb46a1&originHeight=663&originWidth=1475&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=191782&status=done&style=none&taskId=u5769bd53-1963-4081-b4ce-f7373863462&title=&width=1475" alt="image.png"></p><h1 id="å¥½å‹å…³æ³¨"><a href="#å¥½å‹å…³æ³¨" class="headerlink" title="å¥½å‹å…³æ³¨"></a>å¥½å‹å…³æ³¨</h1><h2 id="å®ç°å…³æ³¨å’Œå–å…³åŠŸèƒ½"><a href="#å®ç°å…³æ³¨å’Œå–å…³åŠŸèƒ½" class="headerlink" title="å®ç°å…³æ³¨å’Œå–å…³åŠŸèƒ½"></a>å®ç°å…³æ³¨å’Œå–å…³åŠŸèƒ½</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700278801806-7cd17c25-2eeb-48d5-bc32-e9c9d92e8740.png#averageHue=%23f7f7f7&clientId=u239d3de8-271e-4&from=paste&height=694&id=ub93a3038&originHeight=694&originWidth=1438&originalType=binary&ratio=1&rotation=0&showTitle=false&size=364764&status=done&style=none&taskId=u03326a0e-5c7c-4ada-baa1-62aa4cf9bb4&title=&width=1438" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Result <span class="title function_">follow</span><span class="params">(Long followUserId, Boolean isFollow)</span> &#123;</span><br><span class="line">      <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">      <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">      <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + userId;</span><br><span class="line">      <span class="comment">// 1.åˆ¤æ–­åˆ°åº•æ˜¯å…³æ³¨è¿˜æ˜¯å–å…³</span></span><br><span class="line">      <span class="keyword">if</span> (isFollow) &#123;</span><br><span class="line">          <span class="comment">// 2.å…³æ³¨ï¼Œæ–°å¢æ•°æ®</span></span><br><span class="line">          <span class="type">Follow</span> <span class="variable">follow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Follow</span>();</span><br><span class="line">          follow.setUserId(userId);</span><br><span class="line">          follow.setFollowUserId(followUserId);</span><br><span class="line">          <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> save(follow);</span><br><span class="line">          <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">              <span class="comment">// æŠŠå…³æ³¨ç”¨æˆ·çš„idï¼Œæ”¾å…¥redisçš„seté›†åˆ sadd userId followerUserId</span></span><br><span class="line">              stringRedisTemplate.opsForSet().add(key, followUserId.toString());</span><br><span class="line">          &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// 3.å–å…³ï¼Œåˆ é™¤ delete from tb_follow where user_id = ? and follow_user_id = ?</span></span><br><span class="line">          <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> remove(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Follow&gt;()</span><br><span class="line">                  .eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;follow_user_id&quot;</span>, followUserId));</span><br><span class="line">          <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">              <span class="comment">// æŠŠå…³æ³¨ç”¨æˆ·çš„idä»Redisé›†åˆä¸­ç§»é™¤</span></span><br><span class="line">              stringRedisTemplate.opsForSet().remove(key, followUserId.toString());</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> Result.ok();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Result <span class="title function_">isFollow</span><span class="params">(Long followUserId)</span> &#123;</span><br><span class="line">      <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">      <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">      <span class="comment">// 2.æŸ¥è¯¢æ˜¯å¦å…³æ³¨ select count(*) from tb_follow where user_id = ? and follow_user_id = ?</span></span><br><span class="line">      <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;follow_user_id&quot;</span>, followUserId).count();</span><br><span class="line">      <span class="comment">// 3.åˆ¤æ–­</span></span><br><span class="line">      <span class="keyword">return</span> Result.ok(count &gt; <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Result <span class="title function_">followCommons</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">      <span class="comment">// 1.è·å–å½“å‰ç”¨æˆ·</span></span><br><span class="line">      <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">      <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + userId;</span><br><span class="line">      <span class="comment">// 2.æ±‚äº¤é›†</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">key2</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + id;</span><br><span class="line">      Set&lt;String&gt; intersect = stringRedisTemplate.opsForSet().intersect(key, key2);</span><br><span class="line">      <span class="keyword">if</span> (intersect == <span class="literal">null</span> || intersect.isEmpty()) &#123;</span><br><span class="line">          <span class="comment">// æ— äº¤é›†</span></span><br><span class="line">          <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 3.è§£æidé›†åˆ</span></span><br><span class="line">      List&lt;Long&gt; ids = intersect.stream().map(Long::valueOf).collect(Collectors.toList());</span><br><span class="line">      <span class="comment">// 4.æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">      List&lt;UserDTO&gt; users = userService.listByIds(ids)</span><br><span class="line">              .stream()</span><br><span class="line">              .map(user -&gt; BeanUtil.copyProperties(user, UserDTO.class))</span><br><span class="line">              .collect(Collectors.toList());</span><br><span class="line">      <span class="keyword">return</span> Result.ok(users);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700278760191-0a31a5e5-4de5-4df2-b30b-d31be97f6836.png#averageHue=%23776141&clientId=u239d3de8-271e-4&from=paste&height=667&id=ub85ab2ae&originHeight=667&originWidth=375&originalType=binary&ratio=1&rotation=0&showTitle=false&size=381847&status=done&style=none&taskId=ub8184d02-201d-4d21-94c8-32944030eec&title=&width=375" alt="image.png"></p><h2 id="å…±åŒå…³æ³¨"><a href="#å…±åŒå…³æ³¨" class="headerlink" title="å…±åŒå…³æ³¨"></a>å…±åŒå…³æ³¨</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700280435793-fb72ba40-d4e0-487c-b6dd-0e1da5cf9353.png#averageHue=%23e7e3df&clientId=u239d3de8-271e-4&from=paste&height=814&id=u4629bab6&originHeight=814&originWidth=1639&originalType=binary&ratio=1&rotation=0&showTitle=false&size=689686&status=done&style=none&taskId=ub478a468-8946-482c-980f-60b696f1351&title=&width=1639" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700280752986-320ed5f4-5fcd-4d5f-90b4-edae3dd270a3.png#averageHue=%23faf9f8&clientId=u239d3de8-271e-4&from=paste&height=602&id=u625ec156&originHeight=602&originWidth=1312&originalType=binary&ratio=1&rotation=0&showTitle=false&size=173418&status=done&style=none&taskId=ud6ac5584-1554-4d53-9570-60c92c538cc&title=&width=1312" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700281004775-9773e98c-2e37-47a5-8ee2-60226f75274e.png#averageHue=%23062135&clientId=u239d3de8-271e-4&from=paste&height=257&id=u584f6121&originHeight=257&originWidth=1316&originalType=binary&ratio=1&rotation=0&showTitle=false&size=115430&status=done&style=none&taskId=u03405a14-a5d9-4f52-8b77-c63fc0c227f&title=&width=1316" alt="image.png"><br>åº”è¯¥æ”¹é€ ä»¥å‰çš„å…³æ³¨æ¥å£,æ¯æ¬¡å…³æ³¨ä¸€ä¸ªäºº, å°±å­˜åˆ°seté›†åˆä¸­, ä»è€Œæ¥æ‰¾å…±åŒå¥½å‹.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">followCommons</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å½“å‰ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + userId;</span><br><span class="line">    <span class="comment">// 2.æ±‚äº¤é›†</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key2</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + id;</span><br><span class="line">    Set&lt;String&gt; intersect = stringRedisTemplate.opsForSet().intersect(key, key2);</span><br><span class="line">    <span class="keyword">if</span> (intersect == <span class="literal">null</span> || intersect.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// æ— äº¤é›†</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.è§£æidé›†åˆ</span></span><br><span class="line">    List&lt;Long&gt; ids = intersect.stream().map(Long::valueOf).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// 4.æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">    List&lt;UserDTO&gt; users = userService.listByIds(ids)</span><br><span class="line">            .stream()</span><br><span class="line">            .map(user -&gt; BeanUtil.copyProperties(user, UserDTO.class))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> Result.ok(users);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700281686178-2beec8e2-4921-4e60-9d1b-3dbead131073.png#averageHue=%23fdfaf9&clientId=u239d3de8-271e-4&from=paste&height=811&id=ufccf59b2&originHeight=811&originWidth=454&originalType=binary&ratio=1&rotation=0&showTitle=false&size=47333&status=done&style=none&taskId=u71095f78-67ca-40cd-b547-2198ac7725c&title=&width=454" alt="image.png"></p><h2 id="å…³æ³¨æ¨é€"><a href="#å…³æ³¨æ¨é€" class="headerlink" title="å…³æ³¨æ¨é€"></a>å…³æ³¨æ¨é€</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700284790050-a87ac7ad-37c8-45a6-a97a-217c7ff84a55.png#averageHue=%23ece1e1&clientId=u239d3de8-271e-4&from=paste&height=747&id=ua6122419&originHeight=747&originWidth=1562&originalType=binary&ratio=1&rotation=0&showTitle=false&size=204743&status=done&style=none&taskId=u931ebda5-1422-465c-8776-dbe2a8d7d36&title=&width=1562" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700284912975-b1b44dcf-fa79-4486-880d-c7e728ec945c.png#averageHue=%23e9e5e3&clientId=u239d3de8-271e-4&from=paste&height=783&id=u630c0be9&originHeight=783&originWidth=1689&originalType=binary&ratio=1&rotation=0&showTitle=false&size=659610&status=done&style=none&taskId=u59cff10f-6c53-4e1f-b2d3-de7c8248ea1&title=&width=1689" alt="image.png"><br>æˆ‘ä»¬çš„ä¸šåŠ¡<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700284953779-20675930-1bba-4136-9abf-0e9e6f7813f7.png#averageHue=%23f6f5f5&clientId=u239d3de8-271e-4&from=paste&height=790&id=u615ca396&originHeight=790&originWidth=1496&originalType=binary&ratio=1&rotation=0&showTitle=false&size=320765&status=done&style=none&taskId=u17e3405f-ece1-4575-a7af-1d81065951a&title=&width=1496" alt="image.png"><br><strong>æ‹‰æ¨¡å¼</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700285079923-6e24b596-9068-4f4d-b758-bb4fdc8a9ac3.png#averageHue=%23fcfcfb&clientId=u239d3de8-271e-4&from=paste&height=774&id=u0e7376e8&originHeight=774&originWidth=1607&originalType=binary&ratio=1&rotation=0&showTitle=false&size=255182&status=done&style=none&taskId=u58815847-18cf-4897-9ae6-49320c7314b&title=&width=1607" alt="image.png"><br><strong>æ¨æ¨¡å¼</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700285123680-ec4a5326-8214-4684-9f7f-d07dfd246f9c.png#averageHue=%23fcfcfc&clientId=u239d3de8-271e-4&from=paste&height=767&id=u79b63f5c&originHeight=767&originWidth=1409&originalType=binary&ratio=1&rotation=0&showTitle=false&size=210966&status=done&style=none&taskId=u4eb2e920-1149-474e-b179-d9e325fd0dc&title=&width=1409" alt="image.png"><br>ç¼ºç‚¹æ˜¯å‘ç»™æ¯ä¸€ä¸ªç²‰ä¸, å†…å­˜å ç”¨å¾ˆé«˜.<br><strong>æ¨æ‹‰ç»“åˆ</strong><br>ç²‰ä¸å°‘-&gt; æ¨æ¨¡å¼<br>ç²‰ä¸å¤š-&gt;æ‹‰æ¨¡å¼<br>  <img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700285260959-e254c589-1fe5-400f-afd6-32a228e3e27a.png#averageHue=%23fbfafa&clientId=u239d3de8-271e-4&from=paste&height=782&id=u451f38b3&originHeight=782&originWidth=1589&originalType=binary&ratio=1&rotation=0&showTitle=false&size=281607&status=done&style=none&taskId=ud1193503-c2e3-4550-810d-c43aadf42f6&title=&width=1589" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700285315021-96ff8b73-54e3-42f3-9887-0d61244668aa.png#averageHue=%23e7dad9&clientId=u239d3de8-271e-4&from=paste&height=730&id=u73c06178&originHeight=730&originWidth=1660&originalType=binary&ratio=1&rotation=0&showTitle=false&size=157594&status=done&style=none&taskId=u07bfb312-1ad0-45a1-b5e4-412fb7ed5c0&title=&width=1660" alt="image.png"></p><h2 id="åŸºäºæ¨æ¨¡å¼å®ç°å…³æ³¨æ¨é€åŠŸèƒ½"><a href="#åŸºäºæ¨æ¨¡å¼å®ç°å…³æ³¨æ¨é€åŠŸèƒ½" class="headerlink" title="åŸºäºæ¨æ¨¡å¼å®ç°å…³æ³¨æ¨é€åŠŸèƒ½."></a>åŸºäºæ¨æ¨¡å¼å®ç°å…³æ³¨æ¨é€åŠŸèƒ½.</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700289493961-b55cfb33-3b8a-405d-be38-74923204e2d3.png#averageHue=%23faf9f8&clientId=u239d3de8-271e-4&from=paste&height=1090&id=ud8164f58&originHeight=1090&originWidth=2163&originalType=binary&ratio=1&rotation=0&showTitle=false&size=333264&status=done&style=none&taskId=u2a2398b4-0278-4287-a678-2513b79acc7&title=&width=2163" alt="image.png"> <img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700289532336-17506c65-7a74-48cb-b271-08c0739c424d.png#averageHue=%23f9f8f7&clientId=u239d3de8-271e-4&from=paste&height=1087&id=u4a4bd886&originHeight=1087&originWidth=2072&originalType=binary&ratio=1&rotation=0&showTitle=false&size=327415&status=done&style=none&taskId=ude5e1872-71c9-4418-b3c4-d5c8cfd29c6&title=&width=2072" alt="image.png">ä¸ä¾èµ–è§’æ ‡<br>ä½¿ç”¨sortedæ¥å®ç°<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700292674877-9e3a48dc-dc13-4505-97cb-8cfcf6751a35.png#averageHue=%23092437&clientId=u239d3de8-271e-4&from=paste&height=320&id=u451267d9&originHeight=320&originWidth=1975&originalType=binary&ratio=1&rotation=0&showTitle=false&size=291864&status=done&style=none&taskId=u1c4f9e33-201b-4bd7-867f-da34c378449&title=&width=1975" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700292757855-54286e90-8db5-41f3-89c9-15c76cd933dd.png#averageHue=%23062135&clientId=u239d3de8-271e-4&from=paste&height=737&id=q78vy&originHeight=737&originWidth=1517&originalType=binary&ratio=1&rotation=0&showTitle=false&size=294942&status=done&style=none&taskId=u5e677409-2aa1-450e-9671-40371b52f00&title=&width=1517" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700293092245-43e5c4b8-a8fe-46d7-afaf-0b17404bbf6c.png#averageHue=%23062135&clientId=u239d3de8-271e-4&from=paste&height=922&id=u174d75a2&originHeight=922&originWidth=1894&originalType=binary&ratio=1&rotation=0&showTitle=false&size=557957&status=done&style=none&taskId=uddb0a0f8-3bb2-438f-9848-7d551401ab4&title=&width=1894" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700293221589-5eb005f4-0ebf-4ec2-b7c8-2a1d3360f855.png#averageHue=%23072236&clientId=u239d3de8-271e-4&from=paste&height=782&id=u52f79ff7&originHeight=782&originWidth=1791&originalType=binary&ratio=1&rotation=0&showTitle=false&size=371832&status=done&style=none&taskId=u6e5fdb5a-2bd8-48b4-ab10-5f202986a7c&title=&width=1791" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700293348844-fb32c3bb-2876-4750-9c42-707dc06e54ba.png#averageHue=%23052035&clientId=u239d3de8-271e-4&from=paste&height=1040&id=u12dd3b88&originHeight=1040&originWidth=2053&originalType=binary&ratio=1&rotation=0&showTitle=false&size=490628&status=done&style=none&taskId=ubea8abf6-2439-449d-a4d0-b0f686b3281&title=&width=2053" alt="image.png"><br><strong>æ€»ç»“:</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700293443441-20ddb32f-62d1-491d-bd6c-99d851ca0791.png#averageHue=%23deddd4&clientId=u239d3de8-271e-4&from=paste&height=647&id=uc2ef59e7&originHeight=647&originWidth=1526&originalType=binary&ratio=1&rotation=0&showTitle=false&size=355611&status=done&style=none&taskId=u586e5a50-8e82-4add-91b6-5e05d8f2a31&title=&width=1526" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700293509310-beb1b064-aa7f-41ba-90cf-ba42c80b120f.png#averageHue=%23e4dddb&clientId=u239d3de8-271e-4&from=paste&height=1041&id=ubbdd503e&originHeight=1041&originWidth=1632&originalType=binary&ratio=1&rotation=0&showTitle=false&size=725755&status=done&style=none&taskId=u3b34c4e8-a8c0-4436-ac54-688f03597d9&title=&width=1632" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700325372958-8f591a79-b9e9-47e8-a2e4-f609a0375182.png#averageHue=%23f1f6f0&clientId=u239d3de8-271e-4&from=paste&height=1165&id=u12e9f56d&originHeight=1165&originWidth=2085&originalType=binary&ratio=1&rotation=0&showTitle=false&size=702953&status=done&style=none&taskId=ue74b11e5-7449-4ddd-99e2-f08a5278a64&title=&width=2085" alt="image.png"></p><h1 id="é™„ä»¶å•†é“º"><a href="#é™„ä»¶å•†é“º" class="headerlink" title="é™„ä»¶å•†é“º"></a>é™„ä»¶å•†é“º</h1><h2 id="GEOæ•°æ®ç»“æ„"><a href="#GEOæ•°æ®ç»“æ„" class="headerlink" title="GEOæ•°æ®ç»“æ„"></a>GEOæ•°æ®ç»“æ„</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700363000628-b5dedeca-c042-4f08-90ad-60df5f7522fd.png#averageHue=%23f1f0e6&clientId=u239d3de8-271e-4&from=paste&height=866&id=u3dc15f61&originHeight=866&originWidth=2131&originalType=binary&ratio=1&rotation=0&showTitle=false&size=753135&status=done&style=none&taskId=u0c009a19-cd8a-4a61-92a9-3fa7fbaf3eb&title=&width=2131" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700363043045-b3ac121e-24a7-4fd9-b399-9e2f6e3d428e.png#averageHue=%230a2339&clientId=u239d3de8-271e-4&from=paste&height=694&id=u23e1efbc&originHeight=694&originWidth=2258&originalType=binary&ratio=1&rotation=0&showTitle=false&size=495603&status=done&style=none&taskId=ufb3cfff0-c609-4166-b553-fb9ddb9ee3c&title=&width=2258" alt="image.png">Â·<img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700363175122-099789de-43e6-4ff0-bb47-877588a426fd.png#averageHue=%23092039&clientId=u239d3de8-271e-4&from=paste&height=490&id=ubc3cbe65&originHeight=490&originWidth=1244&originalType=binary&ratio=1&rotation=0&showTitle=false&size=232721&status=done&style=none&taskId=u23c9cfd6-39d7-43aa-a1c2-dc2dfe8ebb5&title=&width=1244" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700363356088-ccb6e01e-68f1-47a9-8a49-05123ba218ca.png#averageHue=%23092039&clientId=u239d3de8-271e-4&from=paste&height=431&id=ud8d9a339&originHeight=431&originWidth=1949&originalType=binary&ratio=1&rotation=0&showTitle=false&size=259143&status=done&style=none&taskId=u6b0822bd-889a-4a4d-9985-905390c20d5&title=&width=1949" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700363406537-6ed70eb9-89eb-4c9d-ae10-fb97cf024acb.png#averageHue=%230d233b&clientId=u239d3de8-271e-4&from=paste&height=394&id=u54ff8dd6&originHeight=394&originWidth=1333&originalType=binary&ratio=1&rotation=0&showTitle=false&size=283704&status=done&style=none&taskId=ud95865d6-3368-4985-915b-68f16f143d4&title=&width=1333" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700364076459-65d2dc7c-c5b4-4111-b461-e328bce52977.png#averageHue=%23b9c3b1&clientId=u239d3de8-271e-4&from=paste&height=1075&id=u8c317c0a&originHeight=1075&originWidth=2192&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1077835&status=done&style=none&taskId=u0bf4ad10-69a6-425d-8d77-0cf322fc1e7&title=&width=2192" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700364201359-0875e76e-f0f3-458f-8672-83907bafbb8d.png#averageHue=%23e0e6e7&clientId=u239d3de8-271e-4&from=paste&height=765&id=u3093abbb&originHeight=765&originWidth=1790&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1124022&status=done&style=none&taskId=u0a775965-a9cf-415e-907f-cd528f57d9d&title=&width=1790" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700369316288-66b9818b-eed9-44bc-9335-0b965e51cc11.png#averageHue=%23777777&clientId=u239d3de8-271e-4&from=paste&height=612&id=ud6756531&originHeight=612&originWidth=1613&originalType=binary&ratio=1&rotation=0&showTitle=false&size=112120&status=done&style=none&taskId=u27a9d1e8-8e9a-4ec4-876a-f129ec4cbfa&title=&width=1613" alt="image.png"></p><h2 id="æŸ¥æ‰¾é™„è¿‘å•†é“ºåŠŸèƒ½"><a href="#æŸ¥æ‰¾é™„è¿‘å•†é“ºåŠŸèƒ½" class="headerlink" title="æŸ¥æ‰¾é™„è¿‘å•†é“ºåŠŸèƒ½"></a>æŸ¥æ‰¾é™„è¿‘å•†é“ºåŠŸèƒ½</h2><p>å®ç°æ•°æ®çš„å¯¼å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">loadShopData</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢åº—é“ºä¿¡æ¯</span></span><br><span class="line">    List&lt;Shop&gt; list = shopService.list();</span><br><span class="line">    <span class="comment">// 2.æŠŠåº—é“ºåˆ†ç»„ï¼ŒæŒ‰ç…§typeIdåˆ†ç»„ï¼ŒtypeIdä¸€è‡´çš„æ”¾åˆ°ä¸€ä¸ªé›†åˆ</span></span><br><span class="line">    Map&lt;Long, List&lt;Shop&gt;&gt; map = list.stream().collect(Collectors.groupingBy(Shop::getTypeId));</span><br><span class="line">    <span class="comment">// 3.åˆ†æ‰¹å®Œæˆå†™å…¥Redis</span></span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;Long, List&lt;Shop&gt;&gt; entry : map.entrySet()) &#123;</span><br><span class="line">        <span class="comment">// 3.1.è·å–ç±»å‹id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">typeId</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> SHOP_GEO_KEY + typeId;</span><br><span class="line">        <span class="comment">// 3.2.è·å–åŒç±»å‹çš„åº—é“ºçš„é›†åˆ</span></span><br><span class="line">        List&lt;Shop&gt; value = entry.getValue();</span><br><span class="line">        List&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; locations = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(value.size());</span><br><span class="line">        <span class="comment">// 3.3.å†™å…¥redis GEOADD key ç»åº¦ çº¬åº¦ member</span></span><br><span class="line">        <span class="keyword">for</span> (Shop shop : value) &#123;</span><br><span class="line">            <span class="comment">// stringRedisTemplate.opsForGeo().add(key, new Point(shop.getX(), shop.getY()), shop.getId().toString());</span></span><br><span class="line">            locations.add(<span class="keyword">new</span> <span class="title class_">RedisGeoCommands</span>.GeoLocation&lt;&gt;(</span><br><span class="line">                    shop.getId().toString(),</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">Point</span>(shop.getX(), shop.getY())</span><br><span class="line">            ));</span><br><span class="line">        &#125;</span><br><span class="line">        stringRedisTemplate.opsForGeo().add(key, locations);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>SpringDataRedis çš„ 2.3.9 ç‰ˆæœ¬å¹¶ä¸æ”¯æŒ Redis 6.2 æä¾›çš„ GEOSEARCH å‘½ä»¤<br>å› æ­¤æˆ‘ä»¬éœ€è¦æç¤ºå…¶ç‰ˆæœ¬ï¼Œä¿®æ”¹è‡ªå·±çš„ pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.1.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="ç­¾åˆ°åŠŸèƒ½"><a href="#ç­¾åˆ°åŠŸèƒ½" class="headerlink" title="ç­¾åˆ°åŠŸèƒ½"></a>ç­¾åˆ°åŠŸèƒ½</h1><h2 id="bitmapç”¨æ³•"><a href="#bitmapç”¨æ³•" class="headerlink" title="bitmapç”¨æ³•"></a>bitmapç”¨æ³•</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700379557735-4efe8b5e-0d59-414a-9423-17d6142b3451.png#averageHue=%23f3f1ea&clientId=ud7e70bf7-514d-4&from=paste&height=556&id=u7e3a41c0&originHeight=1112&originWidth=2472&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1044266&status=done&style=none&taskId=u11207de4-f623-425e-bdaa-0c7eda7a48c&title=&width=1236" alt="image.png"> <img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700380108867-8b8dbe78-bd4c-465f-a3f8-6d9c3af3316e.png#averageHue=%23f8f8f8&clientId=ud7e70bf7-514d-4&from=paste&height=548&id=ude7763cd&originHeight=1096&originWidth=2306&originalType=binary&ratio=2&rotation=0&showTitle=false&size=345948&status=done&style=none&taskId=u15b9380d-2591-44d6-ba35-ed98945e2a7&title=&width=1153" alt="image.png"> <img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700380440914-1de72eab-f672-4c2d-ad95-33b18e248dca.png#averageHue=%23f3f3f3&clientId=ud7e70bf7-514d-4&from=paste&height=462&id=ua8835d34&originHeight=924&originWidth=2134&originalType=binary&ratio=2&rotation=0&showTitle=false&size=567878&status=done&style=none&taskId=u5f675c73-c2aa-4859-98ee-3ed58201b79&title=&width=1067" alt="image.png"><br> <img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700380779465-409513e1-6552-4131-8344-55b6b794f10e.png#averageHue=%230a2435&clientId=ud7e70bf7-514d-4&from=paste&height=221&id=ud1a26804&originHeight=442&originWidth=1588&originalType=binary&ratio=2&rotation=0&showTitle=false&size=291832&status=done&style=none&taskId=u69122527-cce5-4409-97ff-314e595fe8d&title=&width=794" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700380819411-62c986bb-66ef-4214-8797-eb0e85645e88.png#averageHue=%2310293a&clientId=ud7e70bf7-514d-4&from=paste&height=170&id=u30917650&originHeight=340&originWidth=1920&originalType=binary&ratio=2&rotation=0&showTitle=false&size=238370&status=done&style=none&taskId=u9ab23b8e-4b42-4454-82e6-464bd5d58f6&title=&width=960" alt="image.png"></p><h2 id="å®ç°ç­¾åˆ°åŠŸèƒ½"><a href="#å®ç°ç­¾åˆ°åŠŸèƒ½" class="headerlink" title="å®ç°ç­¾åˆ°åŠŸèƒ½"></a>å®ç°ç­¾åˆ°åŠŸèƒ½</h2><p> <img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700380949589-c9919d6c-a5f2-41a9-b188-d0302c6694e1.png#averageHue=%23f2f2f2&clientId=ud7e70bf7-514d-4&from=paste&height=578&id=u0bf95cbb&originHeight=1156&originWidth=1908&originalType=binary&ratio=2&rotation=0&showTitle=false&size=447500&status=done&style=none&taskId=u9b5261d8-5e1b-4637-9fb9-71a7af9dfb6&title=&width=954" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">sign</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">// 1.è·å–å½“å‰ç™»å½•ç”¨æˆ·</span></span><br><span class="line">       <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">       <span class="comment">// 2.è·å–æ—¥æœŸ</span></span><br><span class="line">       <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">       <span class="comment">// 3.æ‹¼æ¥key</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">keySuffix</span> <span class="operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="string">&quot;:yyyyMM&quot;</span>));</span><br><span class="line">       <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> USER_SIGN_KEY + userId + keySuffix;</span><br><span class="line">       <span class="comment">// 4.è·å–ä»Šå¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©</span></span><br><span class="line">       <span class="type">int</span> <span class="variable">dayOfMonth</span> <span class="operator">=</span> now.getDayOfMonth();</span><br><span class="line">       <span class="comment">// 5.å†™å…¥Redis SETBIT key offset 1</span></span><br><span class="line">       stringRedisTemplate.opsForValue().setBit(key, dayOfMonth - <span class="number">1</span>, <span class="literal">true</span>);</span><br><span class="line">       <span class="keyword">return</span> Result.ok();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="ç­¾åˆ°ç»Ÿè®¡"><a href="#ç­¾åˆ°ç»Ÿè®¡" class="headerlink" title="ç­¾åˆ°ç»Ÿè®¡"></a>ç­¾åˆ°ç»Ÿè®¡</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700399217681-4d4061bc-adb9-4708-add8-bd9d29cf86cc.png#averageHue=%230e283b&clientId=u239d3de8-271e-4&from=paste&height=295&id=u25f36d64&originHeight=295&originWidth=967&originalType=binary&ratio=1&rotation=0&showTitle=false&size=102345&status=done&style=none&taskId=u76fe03cb-82dc-4e64-8fe0-1a1a538f72e&title=&width=967" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">signCount</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å½“å‰ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// 2.è·å–æ—¥æœŸ</span></span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">    <span class="comment">// 3.æ‹¼æ¥key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">keySuffix</span> <span class="operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="string">&quot;:yyyyMM&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> USER_SIGN_KEY + userId + keySuffix;</span><br><span class="line">    <span class="comment">// 4.è·å–ä»Šå¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">dayOfMonth</span> <span class="operator">=</span> now.getDayOfMonth();</span><br><span class="line">    <span class="comment">// 5.è·å–æœ¬æœˆæˆªæ­¢ä»Šå¤©ä¸ºæ­¢çš„æ‰€æœ‰çš„ç­¾åˆ°è®°å½•ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªåè¿›åˆ¶çš„æ•°å­— BITFIELD sign:5:202203 GET u14 0</span></span><br><span class="line">    List&lt;Long&gt; result = stringRedisTemplate.opsForValue().bitField(</span><br><span class="line">            key,</span><br><span class="line">            BitFieldSubCommands.create()</span><br><span class="line">                    .get(BitFieldSubCommands.BitFieldType.unsigned(dayOfMonth)).valueAt(<span class="number">0</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="literal">null</span> || result.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// æ²¡æœ‰ä»»ä½•ç­¾åˆ°ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">num</span> <span class="operator">=</span> result.get(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (num == <span class="literal">null</span> || num == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 6.å¾ªç¯éå†</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// 6.1.è®©è¿™ä¸ªæ•°å­—ä¸1åšä¸è¿ç®—ï¼Œå¾—åˆ°æ•°å­—çš„æœ€åä¸€ä¸ªbitä½  // åˆ¤æ–­è¿™ä¸ªbitä½æ˜¯å¦ä¸º0</span></span><br><span class="line">        <span class="keyword">if</span> ((num &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸º0ï¼Œè¯´æ˜æœªç­¾åˆ°ï¼Œç»“æŸ</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸ä¸º0ï¼Œè¯´æ˜å·²ç­¾åˆ°ï¼Œè®¡æ•°å™¨+1</span></span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æŠŠæ•°å­—å³ç§»ä¸€ä½ï¼ŒæŠ›å¼ƒæœ€åä¸€ä¸ªbitä½ï¼Œç»§ç»­ä¸‹ä¸€ä¸ªbitä½</span></span><br><span class="line">        num &gt;&gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok(count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="UVç»Ÿè®¡"><a href="#UVç»Ÿè®¡" class="headerlink" title="UVç»Ÿè®¡"></a>UVç»Ÿè®¡</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700400801636-d5f48bdc-ddcb-4bd7-b197-5e9845d50821.png#averageHue=%23f3f3f3&clientId=u239d3de8-271e-4&from=paste&height=447&id=u5833066c&originHeight=447&originWidth=1609&originalType=binary&ratio=1&rotation=0&showTitle=false&size=178150&status=done&style=none&taskId=ueef19a98-2e62-4286-a3ac-40a5ba7a3df&title=&width=1609" alt="image.png"><br>ä¸¾è‡ªå·±çš„ä¸ªäººåšå®¢ç½‘ç«™çš„ä¾‹å­:<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700400834771-bf1af00f-3d3f-40ec-ba7b-ee82d8446f49.png#averageHue=%23f7f7f7&clientId=u239d3de8-271e-4&from=paste&height=82&id=u05146455&originHeight=82&originWidth=360&originalType=binary&ratio=1&rotation=0&showTitle=false&size=4969&status=done&style=none&taskId=u84d83b80-b749-4862-b015-344bcfa6604&title=&width=360" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700401716213-68550223-ad11-4850-8639-54483a560d74.png#averageHue=%23a9ac9e&clientId=u239d3de8-271e-4&from=paste&height=743&id=ua6f5d2d9&originHeight=743&originWidth=1651&originalType=binary&ratio=1&rotation=0&showTitle=false&size=517952&status=done&style=none&taskId=ua2ba5f5d-23dc-4194-9a48-ec3fd79b420&title=&width=1651" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700402111007-fec55a72-871e-4ccd-90e8-3a29ca73f275.png#averageHue=%230e283b&clientId=u239d3de8-271e-4&from=paste&height=514&id=u39fc541a&originHeight=514&originWidth=1001&originalType=binary&ratio=1&rotation=0&showTitle=false&size=254600&status=done&style=none&taskId=u69394d77-a7d2-4d5e-a8b6-a85c87c5a85&title=&width=1001" alt="image.png"></p><h2 id="å®ç°UVç»Ÿè®¡"><a href="#å®ç°UVç»Ÿè®¡" class="headerlink" title="å®ç°UVç»Ÿè®¡"></a>å®ç°UVç»Ÿè®¡</h2><p>æ¯ä¸€æ¬¡å……æ»¡å®¹é‡ä¸º1000çš„æ•°ç»„å‘ç»™redis. ä¸èƒ½ä¸€æ¬¡å‘é€100ä¸‡æ¡æ•°æ®å‘€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testHyperLogLog</span><span class="params">()</span> &#123;</span><br><span class="line">    String[] values = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">1000</span>];</span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) &#123;</span><br><span class="line">        j = i % <span class="number">1000</span>;</span><br><span class="line">        values[j] = <span class="string">&quot;user_&quot;</span> + i;</span><br><span class="line">        <span class="keyword">if</span>(j == <span class="number">999</span>)&#123;</span><br><span class="line">            <span class="comment">// å‘é€åˆ°Redis</span></span><br><span class="line">            stringRedisTemplate.opsForHyperLogLog().add(<span class="string">&quot;hl2&quot;</span>, values);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç»Ÿè®¡æ•°é‡</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> stringRedisTemplate.opsForHyperLogLog().size(<span class="string">&quot;hl2&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;count = &quot;</span> + count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1700402938508-b14c9aa3-ca7e-4601-a734-0e8d9ed51826.png#averageHue=%232c2c2b&clientId=u239d3de8-271e-4&from=paste&height=135&id=ub131f0bb&originHeight=135&originWidth=516&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5181&status=done&style=none&taskId=u34cce56e-e5ae-4949-91b7-55d0ed80cf9&title=&width=516" alt="image.png"><br>ä¼šæœ‰ä¸€äº›è¯¯å·®. é—®é¢˜ä¸å¤§</p>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt;

&lt;h1 id=&quot;çŸ­ä¿¡ç™»å½•&quot;&gt;&lt;a href=&quot;#çŸ­ä¿¡ç™»å½•&quot; class=&quot;headerlink&quot; title=&quot;çŸ­ä¿¡ç™»å½•&quot;&gt;&lt;/a&gt;çŸ­ä¿¡ç™»å½•&lt;/h1&gt;&lt;h2 id=&quot;å‘é€éªŒè¯ç &quot;&gt;&lt;a</summary>
      
    
    
    
    <category term="Redis" scheme="https://axdmdyj.github.io/categories/Redis/"/>
    
    
    <category term="Redis" scheme="https://axdmdyj.github.io/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„å¸¸è§é¢è¯•é¢˜ï¼ˆ1ï¼‰</title>
    <link href="https://axdmdyj.github.io/posts/e7c3359a.html"/>
    <id>https://axdmdyj.github.io/posts/e7c3359a.html</id>
    <published>2023-11-11T14:47:19.000Z</published>
    <updated>2023-11-12T08:53:08.568Z</updated>
    
    <content type="html"><![CDATA[<h1 id="day1-é“¾è¡¨"><a href="#day1-é“¾è¡¨" class="headerlink" title="day1-é“¾è¡¨"></a>day1-é“¾è¡¨</h1><ul><li><strong>æè¿°ä¸€ä¸‹é“¾è¡¨çš„æ•°æ®ç»“æ„ï¼Ÿ</strong></li></ul><p>é“¾è¡¨æ˜¯ç”±èŠ‚ç‚¹ç±»ç»„æˆ ,å…¶ä¸­åŒ…æ‹¬å€¼, ä»¥åŠå…¶ä»–èŠ‚ç‚¹çš„å¼•ç”¨ç»„æˆ, é€šè¿‡å¼•ç”¨æŒ‡å‘ , ä¸²æˆä¸€ä¸ªé“¾è¡¨.</p><p>é“¾è¡¨åŒ…å«ä¸‰ç§ç±»å‹:  å•å‘é“¾è¡¨(æ¯ä¸ªèŠ‚ç‚¹åªæœ‰æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨), åŒå‘é“¾è¡¨:(æœ‰ä¸Šä¸€ä¸ªèŠ‚ç‚¹å’Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨),  å¾ªç¯é“¾è¡¨(æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„nextå¼•ç”¨æŒ‡å‘å¤´ç»“ç‚¹,å½¢æˆå¾ªç¯ç»“æ„)</p><ul><li><strong>Java ä¸­ LinkedList ä½¿ç”¨çš„æ˜¯å•å‘é“¾è¡¨ã€åŒå‘é“¾è¡¨è¿˜æ˜¯å¾ªç¯é“¾è¡¨ï¼Ÿ</strong></li></ul><p>LinkedList ä½¿ç”¨çš„æ˜¯åŒå‘é“¾è¡¨,</p><ul><li><strong>é“¾è¡¨ä¸­æ•°æ®çš„æ’å…¥ã€åˆ é™¤ã€è·å–å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ</strong></li></ul><p>æ’å…¥å’Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1) , è·å–å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n)</p><ul><li><strong>ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨é“¾è¡¨æ›´åˆé€‚ï¼Ÿ</strong></li></ul><p> åœ¨éœ€è¦é¢‘ç¹çš„å¢åŠ æˆ–åˆ é™¤èŠ‚ç‚¹çš„åœºæ™¯ä¸‹ä½¿ç”¨é“¾è¡¨æ›´åˆé€‚</p><p>ä¸éœ€è¦é¢„å…ˆåˆ†é…å†…å­˜å¤§å°.</p><p>ä¸éœ€è¦å¿«é€Ÿéšæœºè®¿é—®</p><p>èŠ‚çœå†…å­˜,   ä¸éœ€è¦åˆ†é…è¿ç»­çš„å†…å­˜å—.è¿™åœ¨å†…å­˜ä¼˜å…ˆçš„åµŒå…¥å¼ç³»ç»Ÿæˆ–ç§»åŠ¨è®¾å¤‡å¾ˆæœ‰ç”¨</p><h1 id="day2-æ•°ç»„"><a href="#day2-æ•°ç»„" class="headerlink" title="day2-æ•°ç»„"></a>day2-æ•°ç»„</h1><ol><li><strong>æ•°æ®ç»“æ„ä¸­æœ‰å“ªäº›æ˜¯çº¿æ€§è¡¨æ•°æ®ç»“æ„ï¼Ÿ</strong></li></ol><p>æ•°ç»„: æ¯ä¸ªå…ƒç´ éƒ½æœ‰å”¯ä¸€çš„ç´¢å¼•, åœ¨å†…å­˜ä¸­åœ°å€è¿ç»­</p><p>é“¾è¡¨: åŠ¨æ€æ•°æ®ç»“æ„, ç”±èŠ‚ç‚¹æ„æˆ, æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ç€æ•°æ®å’ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨</p><p>æ ˆ: åªæœ‰æ ˆé¡¶å…ƒç´ å¯ä»¥è¢«è®¿é—®, æ’å…¥å’Œåˆ é™¤æ“ä½œéƒ½å‘ç”Ÿåœ¨æ ˆé¡¶</p><p>é˜Ÿåˆ—: æ’å…¥åœ¨é˜Ÿå°¾, åˆ é™¤åœ¨é˜Ÿé¦–</p><ol><li>æ•°<strong>ç»„çš„å…ƒç´ åˆ é™¤å’Œè·å–ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ</strong></li></ol><p>è·å–æ—¶é—´å¤æ‚åº¦æ˜¯O(1) </p><p>åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯O(1), ä½†æ˜¯åˆ é™¤çš„å…ƒç´ åé¢éƒ½éœ€è¦å‘å‰ç§»åŠ¨, æ‰€ä»¥å¹³å‡æƒ…å†µä¸‹ä¹Ÿæ˜¯O(n)</p><p>åˆ é™¤æ˜¯O(n), è·å–æ˜¯O(1)</p><ol><li>A<strong>rrayList ä¸­é»˜è®¤çš„åˆå§‹åŒ–é•¿åº¦æ˜¯å¤šå°‘ï¼Ÿ</strong></li></ol><p>10</p><ol><li><strong>ArrayList ä¸­æ‰©å®¹çš„èŒƒå›´æ˜¯å¤šå¤§ä¸€æ¬¡ï¼Ÿ</strong></li></ol><p><strong>å…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹,</strong> å¦‚æœæ‰©å®¹,å’‹ä¼šæ‰©å®¹1.5å€ä¸€æ¬¡</p><ol><li>ArrayList æ˜¯å¦‚ä½•å®Œæˆæ‰©å®¹çš„ï¼ŒSystem.arraycopy å„ä¸ªå…¥å‚çš„ä½œç”¨æ˜¯ä»€</li></ol><p> <code>System.arraycopy</code> æ˜¯ Java æ ‡å‡†åº“æä¾›çš„æ•°ç»„æ‹·è´æ–¹æ³•:</p><ul><li><code>src</code>ï¼šåŸæ•°ç»„ï¼Œå³è¦å¤åˆ¶çš„æ•°æ®æºã€‚</li><li><code>srcPos</code>ï¼šä»åŸæ•°ç»„çš„å“ªä¸ªä½ç½®å¼€å§‹å¤åˆ¶ã€‚</li><li><code>dest</code>ï¼šç›®æ ‡æ•°ç»„ï¼Œå³å¤åˆ¶åˆ°çš„ä½ç½®ã€‚</li><li><code>destPos</code>ï¼šä»ç›®æ ‡æ•°ç»„çš„å“ªä¸ªä½ç½®å¼€å§‹ç²˜è´´ã€‚</li><li><code>length</code>ï¼šè¦å¤åˆ¶çš„å…ƒç´ æ•°é‡ã€‚</li></ul><p>åœ¨ <code>ArrayList</code> çš„æƒ…å¢ƒä¸­ï¼Œ<code>src</code> æ˜¯åŸæ•°ç»„ï¼Œ<code>srcPos</code> æ˜¯0ï¼ˆä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹å¤åˆ¶ï¼‰ï¼Œ<code>dest</code> æ˜¯æ–°æ•°ç»„ï¼Œ<code>destPos</code> æ˜¯0ï¼ˆä»ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹ç²˜è´´ï¼‰ï¼Œ<code>length</code> æ˜¯åŸæ•°ç»„ä¸­çš„å…ƒç´ æ•°é‡ã€‚è¿™å°±å®Œæˆäº†åŸæ•°ç»„å…ƒç´ åˆ°æ–°æ•°ç»„çš„å¤åˆ¶æ“ä½œã€‚</p><p>æœ€åï¼Œ<code>ArrayList</code> æ›´æ–°å†…éƒ¨çš„å¼•ç”¨ï¼Œå°†åŸæ•°ç»„å¼•ç”¨æŒ‡å‘æ–°æ•°ç»„ï¼Œä½¿æ–°æ•°ç»„æˆä¸º <code>ArrayList</code> çš„å†…éƒ¨æ•°ç»„ç¼“å†²åŒºã€‚åŸæ•°ç»„å°†è¢«åƒåœ¾å›æ”¶ã€‚ </p><h1 id="day3-é˜Ÿåˆ—"><a href="#day3-é˜Ÿåˆ—" class="headerlink" title="day3-é˜Ÿåˆ—"></a>day3-é˜Ÿåˆ—</h1><p><strong>å•ç«¯é˜Ÿåˆ—å’ŒåŒç«¯é˜Ÿåˆ—ï¼Œåˆ†åˆ«å¯¹åº”çš„å®ç°ç±»æ˜¯å“ªä¸ªï¼Ÿ</strong></p><p><strong>å•ç«¯é˜Ÿåˆ—å¯ä»¥æœ‰é“¾è¡¨(LinkedList)å®ç°æˆ–è€…æ˜¯</strong><code>**ArrayDeque**</code><strong>ç±»å®ç°, ä½¿ç”¨addå’Œremoveæ–¹æ³•æ“ä½œ</strong></p><p><strong>ç®€è¿°å»¶è¿Ÿé˜Ÿåˆ—&#x2F;ä¼˜å…ˆé˜Ÿåˆ—çš„å®ç°æ–¹å¼ä»¥åŠåº”ç”¨åœºæ™¯?</strong></p><p><strong>å»¶è¿Ÿé˜Ÿåˆ—:</strong> </p><p><strong>å®ç°æ–¹å¼</strong>ï¼šå»¶è¿Ÿé˜Ÿåˆ—é€šå¸¸æ˜¯åŸºäºä¼˜å…ˆé˜Ÿåˆ—å®ç°çš„ã€‚åœ¨Javaä¸­ï¼Œå¸¸ç”¨çš„å®ç°ç±»æ˜¯<strong>DelayQueue</strong>ã€‚å®ƒå†…éƒ¨ä½¿ç”¨äº†ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ï¼ˆé€šå¸¸æ˜¯äºŒå‰å †ï¼‰æ¥å­˜å‚¨å…ƒç´ ï¼Œä½†æ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªå»¶è¿Ÿæ—¶é—´ï¼Œé€šè¿‡å»¶è¿Ÿæ—¶é—´ä½œä¸ºæ¡ä»¶æ’åº, åªæœ‰å½“å…ƒç´ çš„å»¶è¿Ÿæ—¶é—´åˆ°è¾¾åï¼Œå®ƒæ‰èƒ½è¢«å–å‡ºã€‚è¿™æ˜¯é€šè¿‡å…ƒç´ çš„<strong>getDelay</strong>æ–¹æ³•æ¥å®ç°çš„ã€‚</p><p>ä¼˜å…ˆé˜Ÿåˆ—: </p><p><strong>ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆPriority Queueï¼‰</strong>ï¼š</p><ul><li><strong>å®ç°æ–¹å¼</strong>ï¼šä¼˜å…ˆé˜Ÿåˆ—å¯ä»¥ä½¿ç”¨å¤šç§æ•°æ®ç»“æ„æ¥å®ç°ï¼Œå…¶ä¸­æœ€å¸¸è§çš„æ˜¯äºŒå‰å †ã€‚åœ¨Javaä¸­ï¼Œ<strong>PriorityQueue</strong>å°±æ˜¯ä¸€ä¸ªäºŒå‰å †å®ç°çš„ä¼˜å…ˆé˜Ÿåˆ—ã€‚å®ƒä½¿ç”¨å°é¡¶å †ï¼ˆæœ€å°å…ƒç´ åœ¨é˜Ÿå¤´ï¼‰æˆ–å¤§é¡¶å †ï¼ˆæœ€å¤§å…ƒç´ åœ¨é˜Ÿå¤´ï¼‰æ¥ç»´æŠ¤å…ƒç´ çš„ä¼˜å…ˆçº§é¡ºåºã€‚å…ƒç´ çš„ä¼˜å…ˆçº§é€šå¸¸ç”±å®ƒä»¬çš„è‡ªç„¶é¡ºåºï¼ˆå®ç°<strong>Comparable</strong>æ¥å£ï¼‰æˆ–è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼ˆå®ç°<strong>Comparator</strong>æ¥å£ï¼‰æ¥å†³å®šã€‚</li></ul><p><strong>å»¶è¿Ÿé˜Ÿåˆ—å’Œä¼˜å…ˆé˜Ÿåˆ—åº”ç”¨åœºæ™¯?</strong></p><p>å»¶è¿Ÿé˜Ÿåˆ—å¸¸ç”¨äºå®ç°å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼Œä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´å¯ä»¥è¢«è®¾ç½®ä¸ºå»¶è¿Ÿæ—¶é—´ï¼Œä»è€Œå®ç°ä»»åŠ¡çš„å»¶è¿Ÿæ‰§è¡Œã€‚</p><p>ä¼˜å…ˆé˜Ÿåˆ—å¸¸ç”¨äºéœ€è¦æŒ‰ç…§ä¼˜å…ˆçº§é¡ºåºå¤„ç†å…ƒç´ çš„åœºæ™¯ï¼Œå¦‚ä»»åŠ¡è°ƒåº¦ã€Dijkstraç®—æ³•ç­‰ã€‚åœ¨ä»»åŠ¡è°ƒåº¦ä¸­ï¼Œä»»åŠ¡çš„ä¼˜å…ˆçº§å¯ä»¥è¡¨ç¤ºä»»åŠ¡çš„ç´§æ€¥ç¨‹åº¦æˆ–é‡è¦æ€§ï¼Œé«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¼šå…ˆè¢«æ‰§è¡Œã€‚</p><h1 id="day4-å †æ ˆ"><a href="#day4-å †æ ˆ" class="headerlink" title="day4-å †æ ˆ"></a>day4-å †æ ˆ</h1><p><strong>å †æ ˆä½¿ç”¨åœºæ™¯?</strong></p><p>éœ€è¦ä½¿ç”¨å…ˆå…¥åå‡ºçš„æ•°æ®ç»“æ„å’Œåœºæ™¯, æ¯”å¦‚:é€’å½’ç®—æ³•(æ¯æ¬¡é€’å½’,è°ƒç”¨ç›¸å…³ä¿¡æ¯å‹å…¥å †æ ˆ), æµè§ˆå™¨å†å², å‡½æ•°è°ƒç”¨ç­‰</p><p><strong>ä¸ºä»€ä¹ˆä¸æ˜¯ç”¨ Stack ç±»ï¼Ÿ</strong></p><p>Stackååˆ†ç²—ç³™å¹¶ä¸”è¿‡æ—¶, æ•ˆç‡ä½ä¸‹</p><p><strong>ArrayDequeæ˜¯åŸºäºä»€ä¹ˆå®ç°çš„?</strong></p><p>åŸºäºæ•°ç»„å®ç°çš„å †æ ˆæ•°æ®ç»“æ„</p><p><strong>ArrayDeque æ•°æ®ç»“æ„ä½¿ç”¨è¿‡ç¨‹å™è¿°ã€‚</strong></p><p>ArrayDequeæ˜¯åŒç«¯é˜Ÿåˆ—, æä¾›ä¸¤ç«¯æ’å…¥å’Œå¼¹å‡ºçš„æ–¹æ³•, æ”¯æŒåœ¨é˜Ÿå¤´å’Œé˜Ÿå°¾æ‰§è¡Œå„ç§æ“ä½œ</p><p><strong>ArrayDequeä¸ºä»€ä¹ˆè¦åˆå§‹åŒ–2çš„næ¬¡å¹‚ä¸ªé•¿åº¦</strong></p><p>ä¸ºäº†ä¾¿äºæ— ç¬¦å·å–æ¨¡(2^n - 1) å¾—åˆ°ç´¢å¼•, æ¯”ä¸€èˆ¬çš„å–æ¨¡è¿ç®—å¿«å¾—å¤š, å‡å°‘æ‰©å®¹æ¬¡æ•°, </p><h1 id="day5-å“ˆå¸Œè¡¨ï¼ˆæ•£åˆ—ï¼‰"><a href="#day5-å“ˆå¸Œè¡¨ï¼ˆæ•£åˆ—ï¼‰" class="headerlink" title="day5-å“ˆå¸Œè¡¨ï¼ˆæ•£åˆ—ï¼‰"></a>day5-å“ˆå¸Œè¡¨ï¼ˆæ•£åˆ—ï¼‰</h1><ul><li><strong>ä»‹ç»ä¸€ä¸‹æ•£åˆ—è¡¨</strong></li></ul><p>æ•£åˆ—è¡¨æ˜¯ä¸€ç§æ•°æ®ç»“æ„, åŸºäºæ•£åˆ—å‡½æ•°, å°†é”®æ˜ å°„åˆ°å­˜å‚¨å€¼æ•°ç»„çš„ç‰¹å®šä½ç½®,  ä»¥ä¾¿åœ¨å¸¸æ•°æ—¶é—´å†…è¿›è¡Œå¿«é€ŸæŸ¥æ‰¾, æ’å…¥, åˆ é™¤æ“ä½œ. é€šå¸¸é€‚ç”¨äºéœ€è¦å¿«é€ŸæŸ¥æ‰¾å’Œæ’å…¥çš„æƒ…å†µ, ç‰¹åˆ«æ˜¯å½“æ•°æ®é›†è¾ƒå¤§ä¸”å……è¶³æ—¶.</p><ul><li><strong>ä¸ºä»€ä¹ˆä½¿ç”¨æ•£åˆ—è¡¨</strong></li></ul><p>èƒ½å¤Ÿå¿«é€ŸæŸ¥æ‰¾å’Œè¾“å…¥, æä¾›äº†å¹³å‡æƒ…å†µO(1)çš„æ—¶é—´å¤æ‚åº¦</p><p>çµæ´»çš„é”®-å€¼æ˜ å°„,</p><ul><li><strong>æ‹‰é“¾å¯»å€å’Œå¼€æ”¾å¯»å€çš„åŒºåˆ«</strong></li></ul><p>æ‹‰é“¾å¯»å€ä¸­, æ¯ä¸ªæ•£åˆ—æ§½(æˆ–å“ˆå¸Œæ¡¶)éƒ½å­˜å‚¨ä¸€ä¸ªé“¾è¡¨, æ•°ç»„æˆ–å…¶ä»–æ•°æ®ç»“æ„. æ¶ˆè€—å†…å­˜</p><p>å¼€æ”¾å¯»å€, æ‰€æœ‰å…ƒç´ éƒ½å­˜å‚¨åœ¨æ•£åˆ—æ§½ä¸­, å¦‚æœå‘ç”Ÿå†²çª, æŸ¥æ‰¾ä¸‹ä¸€ä¸ªå¯ç”¨çš„æ§½, ç›´åˆ°æ‰¾åˆ°ç©ºæ§½, æˆ–éå†æ•´ä¸ªæ•£åˆ—è¡¨. å¯èƒ½ä¼šå¯¼è‡´æ•£åˆ—è¡¨å‡ºç°å †ç§¯, ä½¿å¾—æ€§èƒ½ä¸‹é™</p><ul><li><strong>è¿˜æœ‰å…¶ä»–ä»€ä¹ˆæ–¹å¼å¯ä»¥è§£å†³æ•£åˆ—å“ˆå¸Œç´¢å¼•å†²çª</strong></li></ul><p>é€šè¿‡åˆå¹¶æ•£åˆ—, æœé¹ƒæ•£åˆ—, è·³æˆ¿å­æ•£åˆ—,  ç½—å®¾æ±‰å“ˆå¸Œç®—æ³•ä¹Ÿæ˜¯å¯ä»¥è§£å†³æ•£åˆ—å“ˆå¸Œç´¢å¼•å†²çª</p><ul><li>å¯¹åº”çš„Javaæºç ä¸­ï¼Œå¯¹äºå“ˆå¸Œç´¢å¼•å†²çªæä¾›äº†ä»€ä¹ˆæ ·çš„è§£å†³æ–¹æ¡ˆ</li></ul><p>é€šè¿‡æ‹‰é“¾æ³•, åœ¨å†²çªä½ç½®(ç´¢å¼•ä½ç½®)ä¸Š, æœ‰ä¸€ä¸ªé“¾è¡¨, å°†å…·æœ‰ç›¸åŒç´¢å¼•çš„å…ƒç´ ä¸²èµ·æ¥</p><h1 id="day6-å †-Heap"><a href="#day6-å †-Heap" class="headerlink" title="day6-å † Heap"></a>day6-å † Heap</h1><ul><li><strong>å †çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·ï¼Ÿ</strong></li></ul><p>å †æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ‘å½¢ç»“æ„, é€šå¸¸æ˜¯ä¸€ç§å®Œå…¨äºŒå‰æ ‘. åœ¨å †ä¸­, æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªå€¼, é€šå¸¸ä»çˆ¶èŠ‚ç‚¹-&gt;å­èŠ‚ç‚¹ æˆ–å­èŠ‚ç‚¹-&gt;çˆ¶èŠ‚ç‚¹éƒ½æœ‰ä¸€ç§ç‰¹å®šçš„é¡ºåº </p><ul><li><strong>å †çš„æ•°æ®ç»“æ„ä½¿ç”¨åœºæ™¯ï¼Ÿ</strong></li></ul><p>å¯ä»¥å®ç°ä¸€ç§é«˜æ•ˆçš„æ’åºç®—æ³•-&gt;å †æ’åº</p><p>å¯ä»¥ç”¨ä½œä¼˜å…ˆé˜Ÿåˆ—, å…è®¸é«˜ä¼˜å…ˆçº§çš„å¿«é€Ÿå‡ºé˜Ÿ</p><p>å¯ä»¥å®ç°é«˜æ•ˆçš„æ•°æ®ç»“æ„,æ¯”å¦‚æ–æ³¢é‚£å¥‘å †</p><ul><li><strong>å †çš„æ•°æ®ç»“æ„å®ç°æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</strong></li></ul><p>äºŒå‰å †(æœ€å°å †å’Œæœ€å¤§å †) , äºŒé¡¶å †, åé¢ä¸äº†è§£: æ–æ³¢é‚£å¥‘å †,å·¦åæ ‘.</p><ul><li><strong>æœ€å°å †å’Œæœ€å¤§å †çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></li></ul><p><strong>åœ¨æœ€å°å †ä¸­, æ ¹èŠ‚ç‚¹çš„å€¼æœ€å°, æ¯ä¸€ä¸ªçˆ¶èŠ‚ç‚¹çš„å€¼å°äºç­‰äºå­èŠ‚ç‚¹</strong></p><p><strong>æœ€å¤§å †åˆ™ç›¸å</strong></p><ul><li><strong>æœ‰äº†è§£æ–æ³¢é‚£å¥‘å †å—ï¼Ÿ</strong></li></ul><p>æ–æ³¢é‚£å¥‘å †æ˜¯ä¸€ç§å¤šå‰å †ï¼Œé€šå¸¸ç”¨äºä¸€äº›é«˜çº§çš„å›¾ç®—æ³•å’Œä¼˜åŒ–é—®é¢˜ã€‚ä¸äºŒå‰å †ä¸åŒï¼Œæ–æ³¢é‚£å¥‘å †å…è®¸èŠ‚ç‚¹å…·æœ‰ä»»æ„æ•°é‡çš„å­èŠ‚ç‚¹ï¼Œä½¿å¾—åˆå¹¶æ“ä½œæ›´åŠ é«˜æ•ˆã€‚æ–æ³¢é‚£å¥‘å †çš„æ’å…¥å’Œåˆ é™¤æ“ä½œé€šå¸¸å…·æœ‰åˆ†æ‘Šå¸¸æ•°æ—¶é—´å¤æ‚åº¦ã€‚è¿™ç§å †çš„ä¸€ä¸ªåº”ç”¨æ˜¯æœ€å°ç”Ÿæˆæ ‘ç®—æ³•Primå’ŒDijkstraçš„é«˜æ•ˆå®ç°ã€‚å®ƒè¿˜åœ¨æŸäº›ç¦»çº¿æœ€å°ç”Ÿæˆæ ‘ç®—æ³•ä¸­å¾—åˆ°äº†å¹¿æ³›åº”ç”¨ã€‚</p><h1 id="day7-å­—å…¸æ ‘Trie"><a href="#day7-å­—å…¸æ ‘Trie" class="headerlink" title="day7-å­—å…¸æ ‘Trie"></a>day7-å­—å…¸æ ‘Trie</h1><ul><li><strong>ç®€è¿°å­—å…¸æ ‘çš„æ•°æ®ç»“æ„</strong></li></ul><p>å­—å…¸æ ‘æ˜¯ä¸€ä¸­æ ‘å‹çš„æ•°æ®ç»“æ„, æ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªå­—ç¬¦, ä»æ ¹èŠ‚ç‚¹å¼€å§‹çš„è·¯å¾„ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ä¸². æ ‘çš„åˆ†æ”¯ä»£è¡¨å­—ç¬¦çš„ä¸åŒé€‰æ‹©.</p><ul><li><strong>å™è¿°ä½ æ€ä¹ˆæ¥å®ç°ä¸€ä¸ªå­—å…¸æ ‘</strong></li></ul><p>å…ˆåˆ›å»ºä¸€ä¸ªæ ¹èŠ‚ç‚¹ -&gt; æ’å…¥å­—ç¬¦ä¸², ä»æ ¹èŠ‚ç‚¹å¼€å§‹, æŒ‰ç…§å­—ç¬¦ä¸²æ¯ä¸ªå­—ç¬¦ä¾æ¬¡åˆ›å»ºèŠ‚ç‚¹ . ç›´åˆ°æ„å»ºæ•´ä¸ªå­—ç¬¦ä¸². æœ€åçš„ç»“ç‚¹æ ‡è®°ä¸ºå­—ç¬¦ä¸²çš„ç»“æŸ</p><ul><li><strong>å­—å…¸æ ‘çš„å®é™…ä¸šåŠ¡åœºæ™¯ä¸¾ä¾‹</strong></li></ul><p>æ’åºã€å…¨æ–‡æœç´¢ã€ç½‘ç»œæœç´¢å¼•æ“ã€ç”Ÿç‰©ä¿¡æ¯</p><ul><li><strong>å­—å…¸æ ‘çš„å­˜å…¥å’Œæ£€ç´¢çš„æ—¶é—´å¤æ‚åº¦</strong></li></ul><p>æ’å…¥O(L)  æ£€ç´¢O(L)  Læ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦, éƒ½éœ€è¦éå†å­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦</p><ul><li>è¿˜æœ‰å“ªäº›å­—å…¸æ ‘çš„å®ç°æ–¹å¼</li></ul><p>ã€<a href="https://en.wikipedia.org/wiki/Suffix_tree">åç¼€æ ‘(opens new window)</a>ã€<a href="https://en.wikipedia.org/wiki/Hash_trie">å“ˆå¸Œæ ‘(opens new window)</a>ã€<a href="https://en.wikipedia.org/wiki/HAT-trie">å¸½å­æ ‘(opens new window)</a>ã€‘</p><h1 id="day8-äºŒå‰æ ‘"><a href="#day8-äºŒå‰æ ‘" class="headerlink" title="day8-äºŒå‰æ ‘"></a>day8-äºŒå‰æ ‘</h1><ul><li><strong>äºŒå‰æœç´¢æ ‘ç»“æ„ç®€è¿°&amp;å˜Tçš„å¯èƒ½ä¹Ÿè®©æ‰‹å†™</strong></li></ul><p>äºŒå‰æœç´¢æ ‘æ˜¯ä¸€ç§ç‰¹æ®Šçš„å±æ€§ç»“æ„, æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ªå€¼, å·¦å­èŠ‚ç‚¹çš„å€¼å°äºçˆ¶èŠ‚ç‚¹, å³å­èŠ‚ç‚¹çš„å€¼å¤§äºçˆ¶èŠ‚ç‚¹. æ¯ä¸€ä¸ªå·¦å­æ ‘å’Œå³å­æ ‘åŒæ ·ä¹Ÿæ˜¯ä¸€ä¸ªäºŒå‰æœç´¢æ ‘</p><ul><li><strong>äºŒå‰æœç´¢æ ‘çš„æ’å…¥ã€åˆ é™¤ã€ç´¢å¼•çš„æ—¶é—´å¤æ‚åº¦</strong></li></ul><p>å¹³å‡æƒ…å†µä¸‹, å‡ä¸ºLog(n) æœ€åæƒ…å†µä¸‹å‡ä¸ºO(n)</p><ul><li><strong>äºŒå‰æœç´¢æ ‘åˆ é™¤å«æœ‰åŒå­èŠ‚ç‚¹çš„å…ƒç´ è¿‡ç¨‹å™è¿°</strong></li></ul><ol><li>æ‰¾åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œé€šå¸¸æ‰¾å…¶å³å­æ ‘ä¸­æœ€å°çš„èŠ‚ç‚¹æˆ–å·¦å­æ ‘ä¸­æœ€å¤§çš„èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å‰é©±èŠ‚ç‚¹æˆ–åç»§èŠ‚ç‚¹ã€‚</li><li>å¤åˆ¶è¯¥èŠ‚ç‚¹çš„å€¼åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹ã€‚</li><li>åˆ é™¤æ‰¾åˆ°çš„å‰é©±èŠ‚ç‚¹æˆ–åç»§èŠ‚ç‚¹ï¼Œæ­¤æ—¶å®ƒå¯èƒ½åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹æˆ–æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œè¿™æ˜¯ä¸€ä¸ªé€’å½’æ“ä½œã€‚</li></ol><ul><li><p>äºŒ<strong>å‰æœç´¢æ ‘çš„èŠ‚ç‚¹éƒ½åŒ…æ‹¬äº†å“ªäº›ä¿¡æ¯</strong></p><pre><code>èŠ‚ç‚¹å€¼, å·¦å­æ ‘, å³å­æ ‘</code></pre></li><li><p><strong>ä¸ºä»€ä¹ˆJava HashMap ä¸­è¯´è¿‡çº¢é»‘æ ‘è€Œä¸ä½¿ç”¨äºŒå‰æœç´¢æ ‘</strong></p></li></ul><p>å‡ºäºæ€§èƒ½å’Œå¹³è¡¡çš„è€ƒè™‘, çº¢é»‘æ ‘çš„æ—¶é—´å¤æ‚åº¦èƒ½å¤Ÿç»´æŒåœ¨O(logn)èŒƒå›´å†…</p><p>åŒæ—¶é¿å…äº†æ ‘é€€åŒ–æˆé“¾è¡¨çš„æƒ…å†µ</p><h1 id="day9-AVL"><a href="#day9-AVL" class="headerlink" title="day9-AVL"></a>day9-AVL</h1><ul><li><strong>AVL æ ‘å¹³è¡¡å› å­æ€ä¹ˆè®¡ç®—ï¼Ÿ</strong></li></ul><p>å·¦å­æ ‘çš„é«˜åº¦å‡å»å³å­æ ‘ï¼›</p><ul><li><strong>AVL æ ‘å·¦æ—‹æ“ä½œçš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ</strong></li></ul><p>å°†ä¸€ä¸ªèŠ‚ç‚¹çš„å³å­æ ‘å˜ä¸ºæ–°çš„æ ¹èŠ‚ç‚¹ï¼Œä»¥ä¿æŒ AVL æ ‘çš„å¹³è¡¡æ€§ã€‚å·¦æ—‹æ“ä½œç”¨äºè§£å†³å³å­æ ‘é«˜åº¦è¿‡é«˜çš„æƒ…å†µ</p><ul><li><strong>AVL æ ‘å·¦æ—‹æ“ä½œçš„æµç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ</strong></li></ul><ol><li>å‡è®¾è¦å·¦æ—‹çš„èŠ‚ç‚¹ä¸º Nï¼Œå®ƒçš„å³å­èŠ‚ç‚¹ä¸º Rã€‚</li><li>å°† R çš„å·¦å­èŠ‚ç‚¹å˜ä¸º N çš„å³å­èŠ‚ç‚¹ï¼ŒåŒæ—¶æ›´æ–° N çš„å³å­èŠ‚ç‚¹ä¸º R çš„å·¦å­èŠ‚ç‚¹ã€‚</li><li>å°† N çš„çˆ¶èŠ‚ç‚¹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰æŒ‡å‘ Rï¼Œä»¥åŠå°† R çš„çˆ¶èŠ‚ç‚¹æŒ‡å‘ N çš„åŸçˆ¶èŠ‚ç‚¹ã€‚</li><li>æœ€åï¼Œæ›´æ–° N å’Œ R çš„é«˜åº¦ä¿¡æ¯ã€‚</li></ol><ul><li><strong>AVL æ ‘ä»€ä¹ˆæƒ…å†µä¸‹è¦å·¦æ—‹+å³æ—‹ï¼Ÿ</strong></li></ul><ol><li>å½“ä¸€ä¸ªèŠ‚ç‚¹çš„å¹³è¡¡å› å­ä¸º 2ï¼Œä¸”å…¶å·¦å­æ ‘çš„å¹³è¡¡å› å­ä¸º -1ï¼ˆæˆ–è€…æ˜¯å·¦å­æ ‘çš„å¹³è¡¡å› å­ä¸º 0ï¼‰æ—¶ï¼Œéœ€è¦å…ˆå¯¹å·¦å­æ ‘è¿›è¡Œå·¦æ—‹ï¼Œå†å¯¹å½“å‰èŠ‚ç‚¹è¿›è¡Œå³æ—‹ï¼Œä»¥è¾¾åˆ°å¹³è¡¡ã€‚</li><li>å½“ä¸€ä¸ªèŠ‚ç‚¹çš„å¹³è¡¡å› å­ä¸º -2ï¼Œä¸”å…¶å³å­æ ‘çš„å¹³è¡¡å› å­ä¸º 1ï¼ˆæˆ–è€…æ˜¯å³å­æ ‘çš„å¹³è¡¡å› å­ä¸º 0ï¼‰æ—¶ï¼Œéœ€è¦å…ˆå¯¹å³å­æ ‘è¿›è¡Œå³æ—‹ï¼Œå†å¯¹å½“å‰èŠ‚ç‚¹è¿›è¡Œå·¦æ—‹ï¼Œä»¥è¾¾åˆ°å¹³è¡¡ã€‚</li></ol><ul><li><strong>AVL æ ‘çš„æ’å…¥å’Œè¯»å–çš„æ—¶é—´å¤æ‚åº¦ï¼Ÿ</strong></li></ul><p>AVL æ ‘çš„æ’å…¥å’Œè¯»å–çš„æ—¶é—´å¤æ‚åº¦ä¸º O(log n)ï¼Œå…¶ä¸­ n è¡¨ç¤ºæ ‘ä¸­èŠ‚ç‚¹çš„æ•°é‡ã€‚è¿™æ˜¯å› ä¸º AVL æ ‘é€šè¿‡æ—‹è½¬æ“ä½œæ¥ä¿æŒå¹³è¡¡ï¼Œä½¿å¾—æ ‘çš„é«˜åº¦ä¿æŒåœ¨ O(log n) çš„æ°´å¹³ã€‚å› æ­¤ï¼Œæ’å…¥å’Œè¯»å–æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(log n)ã€‚</p><h1 id="day10-2-3-æ ‘"><a href="#day10-2-3-æ ‘" class="headerlink" title="day10-2-3-æ ‘"></a>day10-2-3-æ ‘</h1><ul><li><p><strong>2-3æ ‘çš„æ•°æ®ç»“æ„æè¿°</strong></p><ul><li><p>æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥åŒ…å« 1 ä¸ªæˆ– 2 ä¸ªå…ƒç´ ã€‚</p></li><li><p>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹åŒ…å« 1 ä¸ªå…ƒç´ ï¼Œå®ƒæœ‰ 2 ä¸ªå­èŠ‚ç‚¹ã€‚</p></li><li><p>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹åŒ…å« 2 ä¸ªå…ƒç´ ï¼Œå®ƒæœ‰ 3 ä¸ªå­èŠ‚ç‚¹ã€‚</p></li></ul></li><li><p>2-3æ ‘ä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šå¯ä»¥å­˜æ”¾å‡ ä¸ªå…ƒç´ </p></li></ul><p>2ä¸ª</p><ul><li><strong>2-3æ ‘æ’å…¥èŠ‚ç‚¹æ—¶é—´å¤æ‚åº¦</strong></li></ul><p>æ—¶é—´å¤æ‚åº¦æ˜¯ O(log n)ï¼Œå…¶ä¸­ n è¡¨ç¤ºæ ‘ä¸­èŠ‚ç‚¹çš„æ•°é‡ã€‚</p><ul><li><strong>2-3æ ‘ä¸€ä¸ªèŠ‚ç‚¹æœ‰3ä¸ªå…ƒç´ ï¼Œå¦‚ä½•è¿ç§»ã€‚<em>éœ€è¦æ—‹è½¬å—</em></strong></li></ul><p>å½“ä¸€ä¸ªèŠ‚ç‚¹å·²ç»åŒ…å« 3 ä¸ªå…ƒç´ æ—¶ï¼Œéœ€è¦è¿›è¡Œåˆ†è£‚æ“ä½œã€‚åˆ†è£‚æ“ä½œä¼šå°†è¿™ä¸ªèŠ‚ç‚¹åˆ†ä¸ºä¸¤ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å« 1 ä¸ªå…ƒç´ ã€‚åˆ†è£‚æ“ä½œçš„è¿‡ç¨‹ä¸éœ€è¦æ—‹è½¬ï¼Œè€Œæ˜¯å°†ä¸­é—´å…ƒç´ ä¸Šç§»ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„çˆ¶èŠ‚ç‚¹ã€‚</p><ul><li><strong>2-3æ ‘ï¼Œä½ èƒ½æ‰‹å†™ä¸€ä¸‹å—</strong>ï¼Ÿ</li></ul><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬è¦æ’å…¥å…ƒç´  7 åˆ°ä¸€ä¸ªå·²ç»åŒ…å«å…ƒç´  4ã€9 çš„èŠ‚ç‚¹ä¸­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Before Insertion:</span><br><span class="line">     4 9</span><br><span class="line"></span><br><span class="line">After Insertion:</span><br><span class="line">    4 7 9</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæ’å…¥å…ƒç´  7 åï¼ŒåŸèŠ‚ç‚¹ä¸­çš„å…ƒç´  4 å’Œ 9 ä¼šå˜æˆä¸¤ä¸ªç‹¬ç«‹çš„èŠ‚ç‚¹ï¼Œä¸­é—´å…ƒç´  7 ä¸Šç§»ï¼Œæˆä¸ºå®ƒä»¬çš„æ–°çˆ¶èŠ‚ç‚¹ã€‚è¿™å°±æ˜¯ 2-3æ ‘çš„åˆ†è£‚æ“ä½œã€‚</p><h1 id="day11-çº¢é»‘æ ‘"><a href="#day11-çº¢é»‘æ ‘" class="headerlink" title="day11-çº¢é»‘æ ‘"></a>day11-çº¢é»‘æ ‘</h1><ul><li><strong>çº¢é»‘æ ‘éƒ½æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ</strong></li></ul><ol><li>æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œç”¨äºç´¢å¼•çš„å®ç°ï¼Œä¾‹å¦‚ InnoDB å­˜å‚¨å¼•æ“ä½¿ç”¨ B+æ ‘ï¼Œè€Œ B+æ ‘æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¢é»‘æ ‘ã€‚</li><li>åœ¨ç¼–ç¨‹è¯­è¨€çš„ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨ä¸­ï¼Œç”¨äºå®ç°ç¬¦å·è¡¨ï¼ˆSymbol Tableï¼‰ã€‚</li><li>åœ¨ Java çš„é›†åˆæ¡†æ¶ä¸­ï¼ŒTreeMap å’Œ TreeSet ä½¿ç”¨çº¢é»‘æ ‘æ¥å®ç°æœ‰åºçš„æ•°æ®ç»“æ„ã€‚</li></ol><ul><li><strong>ç›¸æ¯”äºBSTæ ‘ï¼Œçº¢é»‘æ ‘æœ‰ä»€ä¹ˆç”¨é€”ï¼Ÿ</strong></li></ul><ol><li>è‡ªå¹³è¡¡æ€§ï¼šçº¢é»‘æ ‘èƒ½å¤Ÿè‡ªåŠ¨ç»´æŠ¤å¹³è¡¡ï¼Œç¡®ä¿æ ‘çš„é«˜åº¦ä¿æŒåœ¨è¾ƒä½çš„æ°´å¹³ï¼Œå› æ­¤æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤ç­‰æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(log n)ã€‚</li><li>æœ‰åºæ€§ï¼šçº¢é»‘æ ‘æ˜¯æœ‰åºçš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡ŒèŒƒå›´æŸ¥è¯¢å’Œæœ‰åºéå†ã€‚</li><li>ç¨³å®šæ€§ï¼šæ’å…¥å’Œåˆ é™¤æ“ä½œä¸ä¼šå¯¼è‡´æ ‘çš„å¤§è§„æ¨¡é‡æ„ï¼Œä¿æŒäº†æ•°æ®çš„ç¨³å®šæ€§</li></ol><ul><li><strong>B-æ ‘æ˜¯ä»€ä¹ˆæ„æ€ï¼Œéƒ½åŒ…æ‹¬å“ªäº›ï¼Ÿ</strong></li></ul><p>æ˜¯ä¸€ç§å¹³è¡¡çš„å¤šè·¯æœç´¢æ ‘ï¼Œé€šå¸¸ç”¨äºå¤–éƒ¨å­˜å‚¨ï¼Œä¾‹å¦‚æ•°æ®åº“å’Œæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç´¢å¼•ç»“æ„ã€‚B-æ ‘æ˜¯ä¸€æ£µå¤šå‰æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥åŒ…å«å¤šä¸ªå­èŠ‚ç‚¹ã€‚B-æ ‘çš„ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><ol><li>æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ï¼Œä½¿å¾—æ¯æ¬¡æŸ¥è¯¢æ—¶ç£ç›˜ I&#x2F;O æ¬¡æ•°ä¿æŒè¾ƒä½ã€‚</li><li>æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥åŒ…å«å¤šä¸ªé”®å€¼å¯¹ï¼Œä¸ä»…ä»…åŒ…å« 2 ä¸ªï¼ˆå¦‚çº¢é»‘æ ‘çš„èŠ‚ç‚¹ï¼‰ã€‚</li></ol><ul><li><strong>æ–°å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹åï¼Œä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦æŸ“è‰²ã€ä»€ä¹ˆæƒ…å†µè¦å·¦æ—‹ã€ä»€ä¹ˆæƒ…å†µè¦å·¦æ—‹+å³æ—‹ï¼Ÿ</strong></li></ul><ol><li>å½“æ–°æ’å…¥èŠ‚ç‚¹æ˜¯æ ¹èŠ‚ç‚¹æ—¶ï¼Œéœ€è¦å°†è¯¥èŠ‚ç‚¹æŸ“æˆé»‘è‰²ï¼Œä»¥æ»¡è¶³çº¢é»‘æ ‘æ€§è´¨ã€‚</li><li>å½“æ–°æ’å…¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯é»‘è‰²æ—¶ï¼Œä¸éœ€è¦è¿›è¡Œä»»ä½•æ“ä½œï¼Œçº¢é»‘æ ‘æ€§è´¨ä¸å—å½±å“ã€‚</li><li>å½“æ–°æ’å…¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯çº¢è‰²æ—¶ï¼Œéœ€è¦è¿›è¡ŒæŸ“è‰²å’Œæ—‹è½¬æ“ä½œï¼Œä»¥æ¢å¤çº¢é»‘æ ‘æ€§è´¨ã€‚</li></ol><p>å…·ä½“çš„å·¦æ—‹å’Œå·¦æ—‹+å³æ—‹æ“ä½œä¼šåœ¨ä¸æ»¡è¶³çº¢é»‘æ ‘æ€§è´¨çš„æƒ…å†µä¸‹è¿›è¡Œï¼Œä»¥é‡æ–°å¹³è¡¡æ ‘çš„ç»“æ„ã€‚</p><ul><li><strong>çº¢é»‘æ ‘çš„ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</strong></li></ul><p>çº¢é»‘æ ‘çš„ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><ol><li>æ¯ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²æˆ–é»‘è‰²ã€‚</li><li>æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ã€‚</li><li>æ¯ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆNIL èŠ‚ç‚¹ï¼‰æ˜¯é»‘è‰²ã€‚</li><li>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²ï¼Œé‚£ä¹ˆå®ƒçš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²ã€‚</li><li>ä»ä»»æ„èŠ‚ç‚¹åˆ°å…¶æ¯ä¸ªå¶å­èŠ‚ç‚¹çš„æ‰€æœ‰è·¯å¾„éƒ½åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹ã€‚</li><li>æ²¡æœ‰ä¸¤ä¸ªç›¸é‚»çš„çº¢è‰²èŠ‚ç‚¹ï¼Œå³çº¢é»‘æ ‘ä¸­ä¸å­˜åœ¨è¿ç»­çš„çº¢è‰²èŠ‚ç‚¹ã€‚</li></ol><h1 id="day12-å¹¶æŸ¥é›†"><a href="#day12-å¹¶æŸ¥é›†" class="headerlink" title="day12-å¹¶æŸ¥é›†"></a>day12-å¹¶æŸ¥é›†</h1><ul><li><strong>å¹¶æŸ¥é›†å™è¿°ï¼Ÿ</strong></li></ul><p>å¹¶æŸ¥é›†ï¼ˆDisjoint-Set Unionï¼ŒDSUï¼‰æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œç”¨äºç®¡ç†ä¸€ç³»åˆ—ä¸ç›¸äº¤çš„é›†åˆï¼ˆæˆ–ç§°ä¸ºé›†åˆåˆ†åŒºï¼‰ã€‚å®ƒæ”¯æŒä¸¤ç§ä¸»è¦æ“ä½œï¼šæŸ¥æ‰¾ï¼ˆFindï¼‰å’Œåˆå¹¶ï¼ˆUnionï¼‰ã€‚å¹¶æŸ¥é›†çš„ä¸»è¦ç›®æ ‡æ˜¯ç¡®å®šä¸¤ä¸ªå…ƒç´ æ˜¯å¦å±äºåŒä¸€ä¸ªé›†åˆï¼Œä»¥åŠå°†ä¸¤ä¸ªé›†åˆåˆå¹¶ä¸ºä¸€ä¸ªé›†åˆã€‚</p><ul><li><strong>å¹¶æŸ¥é›†çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ</strong></li></ul><ol><li>è¿é€šæ€§é—®é¢˜ï¼šå¹¶æŸ¥é›†å¸¸ç”¨äºè§£å†³ç½‘ç»œè¿é€šæ€§é—®é¢˜ï¼Œå¦‚åˆ¤æ–­ç½‘ç»œä¸­çš„è®¾å¤‡æ˜¯å¦äº’é€šã€‚</li><li>å›¾çš„è¿é€šåˆ†é‡ï¼šåœ¨å›¾è®ºä¸­ï¼Œå®ƒå¯ç”¨äºæŸ¥æ‰¾å›¾çš„è¿é€šåˆ†é‡ã€‚</li><li>é›†åˆçš„åˆå¹¶ï¼šåœ¨ç®—æ³•å’Œæ•°æ®ç»“æ„ä¸­ï¼Œç”¨äºåˆå¹¶ä¸ç›¸äº¤çš„é›†åˆï¼Œä¾‹å¦‚ Kruskal ç®—æ³•ä¸­ç”¨äºæœ€å°ç”Ÿæˆæ ‘çš„æ„å»º</li></ol><ul><li><strong>å¹¶æŸ¥é›†æ€ä¹ˆåˆå¹¶å…ƒç´ ï¼Ÿ</strong></li></ul><p>åˆå¹¶å…ƒç´ ï¼š åˆå¹¶ä¸¤ä¸ªå…ƒç´ çš„é›†åˆé€šå¸¸æ˜¯é€šè¿‡å°†å…¶ä¸­ä¸€ä¸ªå…ƒç´ çš„æ ¹èŠ‚ç‚¹è¿æ¥åˆ°å¦ä¸€ä¸ªå…ƒç´ çš„æ ¹èŠ‚ç‚¹æ¥å®ç°ã€‚</p><ul><li>å¹¶æŸ¥é›†åˆå¹¶å…ƒç´ çš„ä¼˜åŒ–ç­–ç•¥ï¼Ÿ</li></ul><ol><li>â€œUnion by Rankâ€ï¼ˆæŒ‰ç§©åˆå¹¶ï¼‰ï¼šå°†è¾ƒçŸ­çš„æ ‘åˆå¹¶åˆ°è¾ƒé«˜çš„æ ‘ä¸Šã€‚æ¯ä¸ªæ ‘çš„èŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ªç§©ï¼ˆæˆ–è€…ç§°ä¸ºæ·±åº¦ï¼‰ï¼Œåˆå¹¶æ—¶å°†ç§©è¾ƒå°çš„æ ‘è¿æ¥åˆ°ç§©è¾ƒå¤§çš„æ ‘ä¸Šï¼Œä»¥ç¡®ä¿æ ‘çš„é«˜åº¦ä¸ä¼šè¿‡å¤§ã€‚</li><li>â€œPath Compressionâ€ï¼ˆè·¯å¾„å‹ç¼©ï¼‰ï¼šåœ¨æŸ¥æ‰¾æ ¹èŠ‚ç‚¹æ—¶ï¼Œå°†éå†è¿‡çš„èŠ‚ç‚¹éƒ½ç›´æ¥è¿æ¥åˆ°æ ¹èŠ‚ç‚¹ï¼Œä»¥å‡å°åç»­æŸ¥æ‰¾æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ã€‚è¿™æ˜¯é€šè¿‡é€’å½’æˆ–å¾ªç¯æ–¹å¼å®ç°çš„ã€‚</li></ol><ul><li><strong>å¦‚ä½•å‹ç¼©è·¯å¾„ï¼Ÿ</strong></li></ul><p>è·¯å¾„å‹ç¼©æ˜¯æŒ‡åœ¨æŸ¥æ‰¾æ ¹èŠ‚ç‚¹æ—¶ï¼Œå°†æ²¿é€”çš„èŠ‚ç‚¹ç›´æ¥è¿æ¥åˆ°æ ¹èŠ‚ç‚¹ï¼Œä»¥å‡å°æ ‘çš„é«˜åº¦ï¼Œä»è€Œæé«˜åç»­æ“ä½œçš„æ•ˆç‡ã€‚è·¯å¾„å‹ç¼©å¯ä»¥é€šè¿‡é€’å½’æˆ–è¿­ä»£æ–¹å¼å®ç°ã€‚</p><p>åœ¨è·¯å¾„å‹ç¼©ä¸­ï¼Œå½“æŸ¥æ‰¾æ ¹èŠ‚ç‚¹æ—¶ï¼Œä¼šå°†å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ç›´æ¥æ›´æ–°ä¸ºæ ¹èŠ‚ç‚¹ã€‚è¿™æ ·ï¼Œåœ¨åç»­æŸ¥æ‰¾æ“ä½œä¸­ï¼Œæ²¿é€”çš„èŠ‚ç‚¹éƒ½ä¼šæŒ‡å‘æ ¹èŠ‚ç‚¹ï¼Œä»è€ŒåŠ é€ŸæŸ¥æ‰¾æ“ä½œã€‚</p><h1 id="day13-å›¾"><a href="#day13-å›¾" class="headerlink" title="day13-å›¾"></a>day13-å›¾</h1><ul><li><strong>å›¾çš„ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</strong></li></ul><ol><li>ç¤¾äº¤ç½‘ç»œï¼šå›¾å¯ç”¨äºè¡¨ç¤ºç¤¾äº¤ç½‘ç»œä¸­çš„ç”¨æˆ·å’Œä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼Œå¦‚æœ‹å‹å…³ç³»ã€å…³æ³¨å…³ç³»ç­‰ã€‚</li><li>åœ°å›¾å’Œå¯¼èˆªç³»ç»Ÿï¼šåœ°å›¾åº”ç”¨å¯ä»¥ä½¿ç”¨å›¾æ¥è¡¨ç¤ºé“è·¯ã€åŸå¸‚å’Œå¯¼èˆªè·¯å¾„ï¼Œä»¥å¸®åŠ©ç”¨æˆ·æ‰¾åˆ°æœ€çŸ­è·¯å¾„ã€‚</li><li>ç½‘ç»œæ‹“æ‰‘ï¼šåœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼Œå›¾å¯ç”¨äºè¡¨ç¤ºç½‘ç»œæ‹“æ‰‘ç»“æ„ï¼ŒåŒ…æ‹¬è·¯ç”±å™¨ã€äº¤æ¢æœºå’Œè¿æ¥ã€‚</li><li>ä»»åŠ¡è°ƒåº¦ï¼šå›¾å¯ä»¥è¡¨ç¤ºä»»åŠ¡å’Œå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œç”¨äºä»»åŠ¡è°ƒåº¦å’Œä¼˜åŒ–ã€‚</li><li>æ¨èç³»ç»Ÿï¼šç”¨äºç”Ÿæˆç”¨æˆ·å’Œé¡¹ç›®ä¹‹é—´çš„å…³ç³»å›¾ï¼Œä»¥æä¾›ä¸ªæ€§åŒ–æ¨èã€‚</li><li>æ•°æ®åˆ†æï¼šåœ¨æ•°æ®åˆ†æä¸­ï¼Œå›¾å¯ä»¥ç”¨äºè¡¨ç¤ºæ•°æ®ä¹‹é—´çš„å…³ç³»ï¼Œä»¥è¿›è¡Œå…³è”æ€§åˆ†æå’Œå¯è§†åŒ–ã€‚</li><li>è¯­ä¹‰ç½‘ç»œï¼šå›¾å¯ç”¨äºæ„å»ºè¯­ä¹‰ç½‘ç»œï¼Œç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†å’ŒçŸ¥è¯†è¡¨ç¤ºã€‚</li><li>æ¸¸æˆå¼€å‘ï¼šå›¾å¯ç”¨äºè¡¨ç¤ºæ¸¸æˆä¸­çš„åœ°å›¾ã€ä»»åŠ¡å’Œè§’è‰²ä¹‹é—´çš„å…³ç³»ã€‚</li></ol><ul><li><strong>å›¾æœ‰çš„åˆ†ç±»ï¼Ÿ</strong></li></ul><ol><li>æœ‰å‘å›¾ï¼ˆDirected Graphï¼‰ï¼šå›¾ä¸­çš„è¾¹å…·æœ‰æ–¹å‘ï¼Œè¡¨ç¤ºä»ä¸€ä¸ªé¡¶ç‚¹åˆ°å¦ä¸€ä¸ªé¡¶ç‚¹çš„æœ‰å‘å…³ç³»ã€‚</li><li>æ— å‘å›¾ï¼ˆUndirected Graphï¼‰ï¼šå›¾ä¸­çš„è¾¹æ²¡æœ‰æ–¹å‘ï¼Œè¡¨ç¤ºä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´çš„æ— å‘å…³ç³»ã€‚</li><li>å¸¦æƒå›¾ï¼ˆWeighted Graphï¼‰ï¼šå›¾ä¸­çš„è¾¹å¸¦æœ‰æƒé‡æˆ–æˆæœ¬ï¼Œè¡¨ç¤ºä¸åŒè·¯å¾„çš„æˆæœ¬ã€‚</li><li>æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼ŒDirected Acyclic Graphï¼‰ï¼šæœ‰å‘å›¾ä¸­ä¸å­˜åœ¨å½¢æˆç¯çš„è·¯å¾„ã€‚</li><li>è¿é€šå›¾ï¼ˆConnected Graphï¼‰ï¼šæ— å‘å›¾ä¸­çš„ä»»æ„ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´éƒ½å­˜åœ¨è·¯å¾„ã€‚</li><li>æ— ç¯å›¾ï¼ˆAcyclic Graphï¼‰ï¼šå›¾ä¸­ä¸å­˜åœ¨å½¢æˆç¯çš„è·¯å¾„ã€‚</li></ol><ul><li><strong>å›¾æ€ä¹ˆå­˜æ”¾æƒé‡å€¼ï¼Ÿ</strong></li></ul><p>æƒé‡é€šå¸¸å­˜æ”¾åœ¨å›¾çš„è¾¹ä¸Šï¼Œæ¯æ¡è¾¹éƒ½å¯ä»¥å…·æœ‰ä¸€ä¸ªæƒé‡å€¼ï¼Œç”¨äºè¡¨ç¤ºè¿æ¥ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´çš„æˆæœ¬æˆ–è·ç¦»ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨é‚»æ¥çŸ©é˜µæˆ–é‚»æ¥è¡¨ç­‰æ•°æ®ç»“æ„æ¥å­˜å‚¨å¸¦æƒå›¾çš„æƒé‡ä¿¡æ¯ã€‚</p><ul><li><strong>å›¾çš„å¹¿åº¦éå†</strong></li></ul><p>å›¾çš„å¹¿åº¦éå†ï¼ˆBreadth-First Searchï¼ŒBFSï¼‰ï¼š BFS æ˜¯ä¸€ç§ç”¨äºéå†å›¾çš„ç®—æ³•ï¼Œå®ƒä»èµ·å§‹é¡¶ç‚¹å¼€å§‹ï¼Œé¦–å…ˆè®¿é—®èµ·å§‹é¡¶ç‚¹çš„æ‰€æœ‰ç›¸é‚»é¡¶ç‚¹ï¼Œç„¶åé€å±‚æ‰©å±•ï¼Œä¾æ¬¡è®¿é—®æ›´è¿œçš„é¡¶ç‚¹ã€‚BFS å¯ç”¨äºæŸ¥æ‰¾æœ€çŸ­è·¯å¾„ã€è¿é€šæ€§æ£€æŸ¥å’Œæ‹“æ‰‘æ’åºç­‰ä»»åŠ¡ã€‚</p><ul><li><strong>å›¾çš„æ·±åº¦éå†</strong></li></ul><p>DFS æ˜¯ä¸€ç§é€’å½’æˆ–æ ˆçš„æ–¹å¼æ¥éå†å›¾çš„ç®—æ³•ï¼Œå®ƒä»èµ·å§‹é¡¶ç‚¹å¼€å§‹ï¼Œé¦–å…ˆè®¿é—®ä¸€ä¸ªç›¸é‚»é¡¶ç‚¹ï¼Œç„¶åé€’å½’åœ°è®¿é—®è¿™ä¸ªç›¸é‚»é¡¶ç‚¹çš„æœªè®¿é—®é‚»å±…ï¼Œç›´åˆ°åˆ°è¾¾æœ€è¿œçš„é¡¶ç‚¹ï¼Œç„¶åå›æº¯å¹¶ç»§ç»­éå†å…¶ä»–åˆ†æ”¯ã€‚DFS å¯ç”¨äºæŸ¥æ‰¾è·¯å¾„ã€æ‹“æ‰‘æ’åºå’Œè¿é€šæ€§æ£€æŸ¥ç­‰ä»»åŠ¡ã€‚</p><h1 id="day14-å¸ƒéš†è¿‡æ»¤å™¨"><a href="#day14-å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="day14-å¸ƒéš†è¿‡æ»¤å™¨"></a>day14-å¸ƒéš†è¿‡æ»¤å™¨</h1><ul><li><strong>å¸ƒéš†è¿‡æ»¤å™¨çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ</strong></li></ul><ol><li>æ•°æ®ç¼“å­˜ï¼šç”¨äºå¿«é€Ÿæ£€æŸ¥æŸä¸ªæ•°æ®æ˜¯å¦åœ¨ç¼“å­˜ä¸­ï¼Œä»è€Œé¿å…æŸ¥è¯¢æ•°æ®åº“æˆ–ç£ç›˜æ“ä½œã€‚</li><li>é˜²æ­¢ç¼“å­˜ç©¿é€ï¼šç”¨äºæ£€æŸ¥è¯·æ±‚çš„æ•°æ®æ˜¯å¦æœ‰æ•ˆï¼Œé¿å…é¢‘ç¹è¯·æ±‚ä¸å­˜åœ¨çš„æ•°æ®ã€‚</li><li>ç½‘é¡µçˆ¬è™«å»é‡ï¼šç”¨äºæ£€æŸ¥å·²ç»çˆ¬å–çš„ç½‘é¡µ URLï¼Œé¿å…é‡å¤çˆ¬å–ã€‚</li><li>é‚®ä»¶æœåŠ¡å™¨ï¼šç”¨äºæ£€æŸ¥ç”µå­é‚®ä»¶åœ°å€æ˜¯å¦æœ‰æ•ˆï¼Œé˜²æ­¢åƒåœ¾é‚®ä»¶åœ°å€ã€‚</li><li>æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ï¼šç”¨äºåŠ é€Ÿæ•°æ®åº“æŸ¥è¯¢æ“ä½œï¼Œåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨äºæ•°æ®åº“è¡¨ä¸­ã€‚</li><li>æ‹¦æˆªå™¨è¿‡æ»¤ï¼šç”¨äºæ‹¦æˆªæ¶æ„è¯·æ±‚ï¼Œæ£€æŸ¥æ˜¯å¦åœ¨é»‘åå•ä¸­ã€‚</li></ol><ul><li><strong>å¸ƒéš†è¿‡æ»¤å™¨çš„å®ç°åŸç†å’Œæ–¹å¼ï¼Ÿ</strong></li></ul><p>å¸ƒéš†è¿‡æ»¤å™¨çš„åŸºæœ¬æ€æƒ³æ˜¯ä½¿ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°ï¼ˆé€šå¸¸ç§°ä¸ºå“ˆå¸Œç®—æ³•ï¼‰ï¼Œå°†å…ƒç´ æ˜ å°„åˆ°ä½æ•°ç»„ï¼ˆBit Arrayï¼‰ä¸­çš„å¤šä¸ªä½ä¸Šã€‚å½“æ£€æŸ¥æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨æ—¶ï¼Œè®¡ç®—å®ƒçš„å“ˆå¸Œå€¼ï¼Œç„¶åæŸ¥çœ‹ä½æ•°ç»„ä¸Šå¯¹åº”ä½ç½®çš„ä½æ˜¯å¦éƒ½ä¸º1ã€‚å¦‚æœæ‰€æœ‰å“ˆå¸Œå€¼å¯¹åº”çš„ä½éƒ½ä¸º1ï¼Œè¯´æ˜å…ƒç´ å¯èƒ½å­˜åœ¨ï¼›å¦‚æœæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä½ä¸º0ï¼Œè¯´æ˜å…ƒç´ è‚¯å®šä¸å­˜åœ¨ã€‚</p><ul><li><strong>å¦‚ä½•æé«˜å¸ƒéš†è¿‡æ»¤å™¨çš„å‡†ç¡®æ€§</strong>ï¼Ÿ</li></ul><p>å…³äºæé«˜å¸ƒéš†è¿‡æ»¤å™¨çš„å‡†ç¡®æ€§ï¼š</p><ul><li><p>å¢åŠ å“ˆå¸Œå‡½æ•°çš„æ•°é‡ï¼šä½¿ç”¨æ›´å¤šçš„å“ˆå¸Œå‡½æ•°å¯ä»¥å‡å°ç¢°æ’çš„æ¦‚ç‡ï¼Œæé«˜å‡†ç¡®æ€§ã€‚ä½†éœ€è¦æƒè¡¡æ—¶é—´å’Œç©ºé—´å¼€é”€ã€‚</p></li><li><p>åŠ¨æ€è°ƒæ•´å¸ƒéš†è¿‡æ»¤å™¨çš„å¤§å°ï¼šæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µï¼ŒåŠ¨æ€è°ƒæ•´å¸ƒéš†è¿‡æ»¤å™¨çš„å¤§å°ï¼Œä»¥é™ä½è¯¯åˆ¤ç‡ã€‚</p></li><li><p><strong>æœ‰å“ªäº›ä¸­å“ˆå¸Œè®¡ç®—æ–¹å¼ï¼Ÿ</strong></p></li></ul><ol><li>å“ˆå¸Œå‡½æ•°ï¼šåº”ç”¨å•ä¸€å“ˆå¸Œå‡½æ•°ï¼Œè®¡ç®—å…ƒç´ çš„å“ˆå¸Œå€¼ã€‚</li><li>å¤šå“ˆå¸Œå‡½æ•°ï¼šåº”ç”¨å¤šä¸ªå“ˆå¸Œå‡½æ•°ï¼Œè®¡ç®—å¤šä¸ªå“ˆå¸Œå€¼ã€‚</li></ol><ul><li><strong>éƒ½æœ‰å“ªäº›ç±»å‹çš„å¸ƒéš†è¿‡æ»¤å™¨å®ç°ï¼Ÿ<em>Google å¼€æºçš„ Guava ä¸­è‡ªå¸¦çš„å¸ƒéš†è¿‡æ»¤å™¨ã€Redis ä¸­çš„å¸ƒéš†è¿‡æ»¤å™¨</em></strong></li></ul><ol><li>åŸºæœ¬å¸ƒéš†è¿‡æ»¤å™¨ï¼šå®ç°åŸºæœ¬çš„å¸ƒéš†è¿‡æ»¤å™¨åŠŸèƒ½ï¼Œä¾‹å¦‚åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ã€‚</li><li>å¯åŠ¨æ€æ‰©å±•çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼šæ”¯æŒåŠ¨æ€æ·»åŠ å…ƒç´ å’Œè‡ªåŠ¨æ‰©å±•ä½æ•°ç»„å¤§å°ï¼Œä»¥é€‚åº”ä¸æ–­å˜åŒ–çš„æ•°æ®ã€‚</li><li>å¯åºåˆ—åŒ–çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼šæ”¯æŒå°†å¸ƒéš†è¿‡æ»¤å™¨åºåˆ—åŒ–åˆ°æ–‡ä»¶æˆ–å†…å­˜ï¼Œä»¥ä¾¿åç»­åŠ è½½å’Œä½¿ç”¨ã€‚</li><li>æ”¯æŒåˆ é™¤æ“ä½œçš„å¸ƒéš†è¿‡æ»¤å™¨ï¼šæ”¯æŒä»å¸ƒéš†è¿‡æ»¤å™¨ä¸­åˆ é™¤å…ƒç´ ï¼Œé€šå¸¸éœ€è¦é¢å¤–çš„ä½æ•°ç»„æ ‡è®°åˆ é™¤ã€‚</li><li>é«˜çº§æ€§èƒ½å¸ƒéš†è¿‡æ»¤å™¨ï¼šä¼˜åŒ–è¿‡çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼Œæä¾›æ›´é«˜çš„æ€§èƒ½å’Œä½è¯¯åˆ¤ç‡ã€‚</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;day1-é“¾è¡¨&quot;&gt;&lt;a href=&quot;#day1-é“¾è¡¨&quot; class=&quot;headerlink&quot; title=&quot;day1-é“¾è¡¨&quot;&gt;&lt;/a&gt;day1-é“¾è¡¨&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æè¿°ä¸€ä¸‹é“¾è¡¨çš„æ•°æ®ç»“æ„ï¼Ÿ&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;</summary>
      
    
    
    
    <category term="é¢è¯•é¢˜" scheme="https://axdmdyj.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
    
    <category term="é¢è¯•é¢˜" scheme="https://axdmdyj.github.io/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>MySQLç´¢å¼•</title>
    <link href="https://axdmdyj.github.io/posts/43a71ae4.html"/>
    <id>https://axdmdyj.github.io/posts/43a71ae4.html</id>
    <published>2023-10-22T08:08:27.000Z</published>
    <updated>2023-11-12T14:07:13.163Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>ç´¢å¼•æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„(æœ‰åº)</p><p>æ²¡æœ‰ç´¢å¼•æŸ¥è¯¢æ˜¯è¿™æ ·çš„: å…¨è¡¨æ‰«æ</p><h2 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h2><h3 id="B-Tree"><a href="#B-Tree" class="headerlink" title="B-Tree"></a>B-Tree</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697437417364-8d8105ad-4ba4-4eb2-b0a0-03fc4e6df378.png#averageHue=%23f9f6f6&clientId=ub0c7b248-a611-4&from=paste&height=638&id=ub90d0c3e&originHeight=798&originWidth=1706&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=251862&status=done&style=none&taskId=u2d4d25b1-7027-437c-aafe-b5df1e37e57&title=&width=1364.8" alt="image.png"></p><h3 id="B-Tree-1"><a href="#B-Tree-1" class="headerlink" title="B+Tree"></a>B+Tree</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697443711444-131662e6-8679-4186-81d6-704ff0f51eb0.png#averageHue=%23f6f5f5&clientId=u6b1bb508-8493-4&from=paste&height=607&id=YodY8&originHeight=759&originWidth=1586&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=315620&status=done&style=none&taskId=uc461ed19-3335-4486-8589-13a86d5c098&title=&width=1268.8" alt="image.png"></p><ul><li>ç»¿è‰²æ•°æ®åªèµ·åˆ°ç´¢å¼•æ•°æ®çš„ä½œç”¨ , ä¸å­˜å‚¨æ•°æ®</li><li>å¶å­èŠ‚ç‚¹ä¸²æˆé“¾è¡¨ , æ˜¯æ•°æ®å­˜å‚¨éƒ¨åˆ†.</li><li><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697443984864-4a477896-bd36-455e-a407-60c101a7f555.png#averageHue=%23dce7d6&clientId=u6b1bb508-8493-4&from=paste&height=339&id=ufbcb7e46&originHeight=424&originWidth=945&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=126447&status=done&style=none&taskId=u35e5ae07-56f3-4338-9f05-a190c9755f6&title=&width=756" alt="image.png"></li><li>ä¸B-TreeåŒºåˆ« :  æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šå‡ºç°åœ¨å¶å­èŠ‚ç‚¹</li><li>å¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå•å‘é“¾è¡¨</li></ul><p> MySQLç´¢å¼•æ•°æ®ç»“æ„å¯¹ç»å…¸çš„B+Treeè¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨åŸB+Treeçš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹ çš„é“¾è¡¨æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºæŒ‡é’ˆçš„B+Treeï¼Œæé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ï¼Œåˆ©äºæ’åºã€‚<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697444276488-09120785-2657-42a9-9925-53d0619f68dc.png#averageHue=%23f2ede8&clientId=u6b1bb508-8493-4&from=paste&height=416&id=uf5f45247&originHeight=520&originWidth=1539&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=294290&status=done&style=none&taskId=u70b1d1d8-f04c-4974-a9cb-6651592ba68&title=&width=1231.2" alt="image.png"></p><h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><p>é€šè¿‡hashç®—æ³•, å°†é”®å€¼æ˜ å°„ä¸ºæ–°çš„å€¼ &#x3D; &gt;æ˜ å°„åˆ°å¯¹åº”çš„æ§½ä½ä¸Š&#x3D;&gt; ç„¶åå­˜å‚¨åœ¨Hashè¡¨ä¸­<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697444572450-4aea757f-86e2-4c8d-b744-e862765069e8.png#averageHue=%23f5efe5&clientId=u6b1bb508-8493-4&from=paste&height=434&id=u666020a6&originHeight=542&originWidth=1534&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=302505&status=done&style=none&taskId=uc9ab2e99-548b-4af5-8445-3cfde6fc46a&title=&width=1227.2" alt="image.png"><br> ç‰¹ç‚¹<br>A. Hashç´¢å¼•åªèƒ½ç”¨äºå¯¹ç­‰æ¯”è¾ƒ(&#x3D;ï¼Œin)ï¼Œä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆbetweenï¼Œ&gt;ï¼Œ&lt; ï¼Œâ€¦ï¼‰<br>B. æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºæ“ä½œ<br>C. æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œé€šå¸¸(ä¸å­˜åœ¨hashå†²çªçš„æƒ…å†µ)åªéœ€è¦ä¸€æ¬¡æ£€ç´¢å°±å¯ä»¥äº†ï¼Œæ•ˆç‡é€šå¸¸è¦é«˜äºB+treeç´¢ å¼• </p><p>3). å­˜å‚¨å¼•æ“æ”¯æŒ åœ¨MySQLä¸­ï¼Œæ”¯æŒhashç´¢å¼•çš„æ˜¯Memoryå­˜å‚¨å¼•æ“ã€‚ è€ŒInnoDBä¸­å…·æœ‰è‡ªé€‚åº”hashåŠŸèƒ½ï¼Œhashç´¢å¼•æ˜¯ InnoDBå­˜å‚¨å¼•æ“æ ¹æ®B+Treeç´¢å¼•åœ¨æŒ‡å®šæ¡ä»¶ä¸‹è‡ªåŠ¨æ„å»ºçš„ã€‚  </p><blockquote><p>ä¸ºä»€ä¹ˆInnoDBé€‰æ‹©B+Tree<br>A. ç›¸å¯¹äºäºŒå‰æ ‘ï¼Œå±‚çº§æ›´å°‘ï¼Œæœç´¢æ•ˆç‡é«˜ï¼›<br>B. å¯¹äºB-treeï¼Œæ— è®ºæ˜¯å¶å­èŠ‚ç‚¹è¿˜æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œéƒ½ä¼šä¿å­˜æ•°æ®ï¼Œè¿™æ ·å¯¼è‡´ä¸€é¡µä¸­å­˜å‚¨ çš„é”®å€¼å‡å°‘ï¼ŒæŒ‡é’ˆè·Ÿç€å‡å°‘ï¼Œè¦åŒæ ·ä¿å­˜å¤§é‡æ•°æ®ï¼Œåªèƒ½å¢åŠ æ ‘çš„é«˜åº¦ï¼Œå¯¼è‡´æ€§èƒ½é™ä½ï¼›<br>C. ç›¸å¯¹Hashç´¢å¼•ï¼ŒB+treeæ”¯æŒèŒƒå›´åŒ¹é…åŠæ’åºæ“ä½œï¼›  </p></blockquote><h2 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697444999652-117b0c26-7038-4de0-a5e2-dfd093facf5d.png#averageHue=%23e7cfcc&clientId=u6b1bb508-8493-4&from=paste&height=446&id=u93f416de&originHeight=558&originWidth=1523&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=183134&status=done&style=none&taskId=ub6850173-1ad3-48a6-9ccc-de53b929adb&title=&width=1218.4" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697445141094-0a4c3eea-9f99-4b1c-ba8e-8a77fce822b1.png#averageHue=%23eddddb&clientId=u6b1bb508-8493-4&from=paste&height=553&id=u299359e6&originHeight=691&originWidth=1576&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=275391&status=done&style=none&taskId=u2b520549-168f-40a4-8949-7f94b9c0377&title=&width=1260.8" alt="image.png"></p><h3 id="èšé›†ç´¢å¼•-åªè®°å½•è¡Œæ•°æ®"><a href="#èšé›†ç´¢å¼•-åªè®°å½•è¡Œæ•°æ®" class="headerlink" title="èšé›†ç´¢å¼•,  åªè®°å½•è¡Œæ•°æ®"></a>èšé›†ç´¢å¼•,  åªè®°å½•è¡Œæ•°æ®<img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697445628081-f59bedaf-446b-46dc-8af8-18daa0581c47.png#averageHue=%23f0eeee&clientId=u5e2abf71-e359-4&from=paste&height=618&id=ua1c3d749&originHeight=773&originWidth=1693&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=281978&status=done&style=none&taskId=ub8ca1228-49d6-48af-b5bd-6b3e5d18ec6&title=&width=1354.4" alt="image.png"></h3><h3 id="äºŒçº§ç´¢å¼•"><a href="#äºŒçº§ç´¢å¼•" class="headerlink" title="äºŒçº§ç´¢å¼•"></a>äºŒçº§ç´¢å¼•</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697445734692-3c072d16-a075-43e4-aeb4-fb5c5fb793bc.png#averageHue=%23e8dec1&clientId=u5e2abf71-e359-4&from=paste&height=338&id=ub114f59e&originHeight=423&originWidth=1555&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=238492&status=done&style=none&taskId=u9163f980-7b39-449b-9c9d-3c4cde08702&title=&width=1244" alt="image.png"><br>æŒ‚çš„æ˜¯å¯¹åº”çš„ID<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697448926127-7b8a1baa-0c36-4505-a446-a1a2d4183fe5.png#averageHue=%23f4f2f0&clientId=ubdf98a65-1189-4&from=paste&height=672&id=ucfb9eb53&originHeight=840&originWidth=1715&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=352181&status=done&style=none&taskId=u7610ec8c-e0a3-4fd7-9c06-37dd88bd595&title=&width=1372" alt="image.png">äºŒçº§ç´¢å¼•å…ˆæ¯”è¾ƒé¦–å­—æ¯å­—å…¸åº, ç„¶åç±»ä¼¼äºäºŒå‰æœç´¢æ ‘çš„æ–¹å¼, æ‰¾åˆ°Arm, ç„¶åæ‰¾åˆ°Armå¯¹åº”çš„ID, ç„¶åé€šè¿‡èšé›†ç´¢å¼• , æ‰¾åˆ°å¯¹åº”çš„è¡Œæ•°æ® </p><h3 id="æ€è€ƒé¢˜"><a href="#æ€è€ƒé¢˜" class="headerlink" title="æ€è€ƒé¢˜"></a>æ€è€ƒé¢˜</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697449229318-a68abfbe-30c7-49d2-83ca-935eb47afa30.png#averageHue=%23fbf8eb&clientId=ubdf98a65-1189-4&from=paste&height=322&id=u50a3c153&originHeight=403&originWidth=985&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=108846&status=done&style=none&taskId=ufd1af7a9-40ce-44b7-aa91-f4cdff3b9d7&title=&width=788" alt="image.png"><br>æ ¹æ®idæŸ¥è¯¢æ•ˆç‡é«˜, å› ä¸ºæ ¹æ®nameæŸ¥è¯¢è¿˜éœ€è¦å†å›è¡¨æŸ¥è¯¢ä¸€æ¬¡<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697449696009-901f1fe7-ed3e-4f1e-84da-1395db31827b.png#averageHue=%23f8f5f3&clientId=u620327ff-a504-4&from=paste&height=686&id=u21c71159&originHeight=858&originWidth=1075&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=332973&status=done&style=none&taskId=u47212048-dffd-4257-9714-bdc195dd13c&title=&width=860" alt="image.png"></p><h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697513868605-78d440ee-778b-4e80-8107-59531f751bcf.png#averageHue=%23fcfbf4&clientId=uc6163d93-4653-4&from=paste&height=448&id=u63cf337a&originHeight=560&originWidth=1651&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=127224&status=done&style=none&taskId=ud8bcd8da-569d-49d4-9e87-9759427d1f7&title=&width=1320.8" alt="image.png"><br><code>table_name</code>ç´¢å¼•å…³è”çš„è¡¨å</p><h2 id="SQLæ€§èƒ½åˆ†æ"><a href="#SQLæ€§èƒ½åˆ†æ" class="headerlink" title="SQLæ€§èƒ½åˆ†æ"></a>SQLæ€§èƒ½åˆ†æ</h2><h3 id="ä¸»è¦ä¼˜åŒ–æŸ¥è¯¢è¯­å¥"><a href="#ä¸»è¦ä¼˜åŒ–æŸ¥è¯¢è¯­å¥" class="headerlink" title="ä¸»è¦ä¼˜åŒ–æŸ¥è¯¢è¯­å¥"></a>ä¸»è¦ä¼˜åŒ–æŸ¥è¯¢è¯­å¥</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697514779029-a166174a-9d80-483d-bfbf-a14d53141ca0.png#averageHue=%23c8cec2&clientId=uc6163d93-4653-4&from=paste&height=618&id=u69ab3ef6&originHeight=773&originWidth=1623&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=410883&status=done&style=none&taskId=u3191e591-9069-4bdc-9bcf-584fdb9176c&title=&width=1298.4" alt="image.png"><br>æ ¹æ®å…·ä½“æƒ…å†µæ¥ä¼˜åŒ–<img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697514735225-5f6ba41b-d78c-48fe-8e63-3ac304599545.png#averageHue=%23f8f7ef&clientId=uc6163d93-4653-4&from=paste&height=546&id=u9edf7543&originHeight=683&originWidth=1560&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=268391&status=done&style=none&taskId=ubad0e591-fff0-4612-a033-1129260e42b&title=&width=1248" alt="image.png"></p><h3 id="æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="æ…¢æŸ¥è¯¢æ—¥å¿—:"></a>æ…¢æŸ¥è¯¢æ—¥å¿—:</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697514995074-cd4ae302-2472-445d-9768-317a0be604ba.png#averageHue=%23223c52&clientId=uc6163d93-4653-4&from=paste&height=162&id=uf6378d7f&originHeight=202&originWidth=832&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=137570&status=done&style=none&taskId=ucfe5611c-a82b-4137-a319-3a8c5646f92&title=&width=665.6" alt="image.png"></p><ul><li>profileè¯¦æƒ…</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697525427978-61a7ad86-a089-4cda-aa0a-ddba0fa3179b.png#averageHue=%23f8f7f4&clientId=uc6163d93-4653-4&from=paste&height=303&id=uf5129e08&originHeight=379&originWidth=1585&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=111939&status=done&style=none&taskId=u4650e16b-d288-4a96-9c2a-881950ca6b8&title=&width=1268" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697525688275-e50b74c6-0b07-469f-9243-99c1338efc5c.png#averageHue=%2328465e&clientId=uc6163d93-4653-4&from=paste&height=465&id=ucba8e3c8&originHeight=581&originWidth=876&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=486349&status=done&style=none&taskId=uc8ef2d5d-f666-4158-adf5-df76f24b3a8&title=&width=700.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697525715668-cf6877f2-72d2-450b-8d82-c4b3f72d3119.png#averageHue=%23fbfae9&clientId=uc6163d93-4653-4&from=paste&height=471&id=uc89509c3&originHeight=589&originWidth=1389&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=168075&status=done&style=none&taskId=uca4f44fe-f87a-44bd-8db3-45ce8673918&title=&width=1111.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697525753543-26688226-f0bd-4746-956b-dba5f4baa23d.png#averageHue=%23254258&clientId=uc6163d93-4653-4&from=paste&height=544&id=u70540ae7&originHeight=680&originWidth=575&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=380080&status=done&style=none&taskId=uc0028d62-081a-4459-abe3-0356904aea6&title=&width=460" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697525764568-3d3c8fb1-4737-4e6d-b42f-e8dee43c9455.png#averageHue=%2327455c&clientId=uc6163d93-4653-4&from=paste&height=557&id=u28a38675&originHeight=696&originWidth=876&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=666156&status=done&style=none&taskId=u8bf66c3c-c74b-4126-85f3-1c0284a425b&title=&width=700.8" alt="image.png"></p><h3 id="explainæ‰§è¡Œè®¡åˆ’"><a href="#explainæ‰§è¡Œè®¡åˆ’" class="headerlink" title="explainæ‰§è¡Œè®¡åˆ’"></a>explainæ‰§è¡Œè®¡åˆ’</h3><p><code>EXPLAIN SELECT å­—æ®µåˆ—è¡¨ FROM è¡¨å WHERE æ¡ä»¶;</code><br>æ‰§è¡Œè®¡åˆ’å„å­—æ®µçš„å«ä¹‰:<br><strong>id: è¡¨ç¤ºæ“ä½œè¡¨çš„é¡ºåº, å¦‚æœidç›¸åŒ, ä»ä¸Šå¾€ä¸‹æ‰§è¡Œ, ä¸åŒ, è¶Šå¤§è¶Šå…ˆæ‰§è¡Œ</strong><br>å¤šå¯¹å¤š, éœ€è¦ä¸€å¼ å…³è”è¡¨<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697853987915-09ad0eb6-7f58-4dde-bb64-e421ffb41f9a.png#averageHue=%23fbfbfa&clientId=u25ea9246-9b61-4&from=paste&height=552&id=ub81b8e17&originHeight=552&originWidth=1288&originalType=binary&ratio=1&rotation=0&showTitle=false&size=148675&status=done&style=none&taskId=u94c689df-5d8f-4a8c-8c02-4ec4f165535&title=&width=1288" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697854069854-b84728f3-faa5-4367-b963-ad2c0b28c498.png#averageHue=%23254157&clientId=u25ea9246-9b61-4&from=paste&height=539&id=ude6c43a3&originHeight=539&originWidth=2547&originalType=binary&ratio=1&rotation=0&showTitle=false&size=757435&status=done&style=none&taskId=u774ba924-6b8a-4ecd-8947-acca5dfeb66&title=&width=2547" alt="image.png"><br>æ‰§è¡Œé¡ºåº - &gt; s &gt; sc &gt; c :  åŸå› : s å’Œ cè¡¨ç›´æ¥æ²¡æœ‰å…³ç³», æ˜¯é€šè¿‡ä¸­é—´è¡¨æ¥è”ç³»èµ·æ¥çš„<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697854395110-40a3aa0d-6551-4798-bc3e-29fcef50a0ee.png#averageHue=%2329465d&clientId=u25ea9246-9b61-4&from=paste&height=1283&id=u682b7bf4&originHeight=1283&originWidth=2439&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1037047&status=done&style=none&taskId=u1c0f3f94-f5e3-4b4c-8869-453cbe771ba&title=&width=2439" alt="image.png"><br><strong>idå€¼è¶Šå¤§è¶Šå…ˆè¢«æ‰§è¡Œ</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697854530990-d90f1c28-8a03-48f5-b5c5-a722c6e5d64d.png#averageHue=%23243e54&clientId=u25ea9246-9b61-4&from=paste&height=445&id=u26b59710&originHeight=445&originWidth=2488&originalType=binary&ratio=1&rotation=0&showTitle=false&size=750365&status=done&style=none&taskId=u1b789646-7da8-4eba-a336-d2d837505b7&title=&width=2488" alt="image.png"><br>**type:  è¡¨ç¤ºè¿æ¥ç±»å‹ï¼Œæ€§èƒ½ç”±å¥½åˆ°å·®çš„è¿æ¥ç±»å‹ä¸ºNULLã€systemã€constã€ eq_refã€refã€rangeã€ indexã€all ã€‚  **<br>ä½¿ç”¨ä¸»é”®æˆ–è€…å”¯ä¸€ç´¢å¼•,åˆ™ä¸ºconst  ,  éå”¯ä¸€æ€§ç´¢å¼•,ref<br>ä¼˜åŒ–çš„æ—¶å€™å°½é‡å¾€å‰ä¼˜åŒ–<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697855001399-cf48d894-c0b4-4c50-b888-c3d42cd25701.png#averageHue=%232d4d65&clientId=u25ea9246-9b61-4&from=paste&height=301&id=u590f66a9&originHeight=301&originWidth=1964&originalType=binary&ratio=1&rotation=0&showTitle=false&size=419333&status=done&style=none&taskId=u1e57cc80-5941-4b74-aaa4-1277eda09e0&title=&width=1964" alt="image.png"> possible_key æ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸Šçš„ç´¢å¼•ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªã€‚<br> key å®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œå¦‚æœä¸ºNULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚<br> key_len è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œ è¯¥å€¼ä¸ºç´¢å¼•å­—æ®µæœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿ åº¦ï¼Œåœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„å‰æä¸‹ï¼Œ é•¿åº¦è¶ŠçŸ­è¶Šå¥½ ã€‚<br> filtered è¡¨ç¤ºè¿”å›ç»“æœçš„è¡Œæ•°å éœ€è¯»å–è¡Œæ•°çš„ç™¾åˆ†æ¯”ï¼Œ filtered çš„å€¼è¶Šå¤§è¶Šå¥½ã€‚  </p><h2 id="ç´¢å¼•ä½¿ç”¨"><a href="#ç´¢å¼•ä½¿ç”¨" class="headerlink" title="ç´¢å¼•ä½¿ç”¨"></a>ç´¢å¼•ä½¿ç”¨</h2><h3 id="éªŒè¯ç´¢å¼•å¯¹æŸ¥è¯¢æ•ˆç‡æå‡"><a href="#éªŒè¯ç´¢å¼•å¯¹æŸ¥è¯¢æ•ˆç‡æå‡" class="headerlink" title="éªŒè¯ç´¢å¼•å¯¹æŸ¥è¯¢æ•ˆç‡æå‡"></a>éªŒè¯ç´¢å¼•å¯¹æŸ¥è¯¢æ•ˆç‡æå‡</h3><p>ä¸»é”®é»˜è®¤æœ‰ä¸»é”®ç´¢å¼•,æ‰€ä»¥é€šè¿‡idæŸ¥, ä¸€èˆ¬æ€§èƒ½éƒ½å¾ˆé«˜<br>åˆ›å»ºç´¢å¼•çš„è¿‡ç¨‹ä¼šæ„å»ºb+æ ‘çš„ç»“æ„, é€šè¿‡åˆ›å»ºç´¢å¼•, æ¥æå‡å…¶ä»–å­—æ®µçš„æ€§èƒ½(æå‡çš„æ•ˆç‡å¾ˆå¤§)<img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697856551655-d3850b96-3080-46bc-87bb-0bef50105c55.png#averageHue=%232c4c63&clientId=ub7edcc15-1ad4-4&from=paste&height=175&id=u92a725f1&originHeight=175&originWidth=875&originalType=binary&ratio=1&rotation=0&showTitle=false&size=118021&status=done&style=none&taskId=uf068183e-18bc-4194-8e35-760ce890edc&title=&width=875" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697856610898-70a3d29d-589f-4fcd-883f-5104aa4b9ff0.png#averageHue=%23faf9f4&clientId=ub7edcc15-1ad4-4&from=paste&height=946&id=u5849e0b6&originHeight=946&originWidth=1188&originalType=binary&ratio=1&rotation=0&showTitle=false&size=272654&status=done&style=none&taskId=u5c08f6f7-389a-475a-9c7a-7163defd7fb&title=&width=1188" alt="image.png"></p><h3 id="ç´¢å¼•çš„ä½¿ç”¨è§„åˆ™"><a href="#ç´¢å¼•çš„ä½¿ç”¨è§„åˆ™" class="headerlink" title="ç´¢å¼•çš„ä½¿ç”¨è§„åˆ™"></a>ç´¢å¼•çš„ä½¿ç”¨è§„åˆ™</h3><h4 id="ç´¢å¼•å¤±æ•ˆ"><a href="#ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="ç´¢å¼•å¤±æ•ˆ"></a>ç´¢å¼•å¤±æ•ˆ</h4><ul><li>æœ€å·¦å‰ç¼€æ³•åˆ™</li></ul><p>æŸ¥è¯¢ä»ç´¢å¼•çš„å·¦åˆ—å¼€å§‹, å¦‚æœè·³è¿‡äº†æŸä¸€åˆ—, ç´¢å¼•å°†éƒ¨åˆ†å¤±æ•ˆ(åé¢çš„å­—æ®µç´¢å¼•å¤±æ•ˆ)<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697879994898-42362556-c8bf-4c70-8ebb-570e6ad68a1c.png#averageHue=%2326435a&clientId=u685b6605-3101-4&from=paste&height=566&id=uc5265242&originHeight=566&originWidth=2250&originalType=binary&ratio=1&rotation=0&showTitle=false&size=574262&status=done&style=none&taskId=u942da6ce-8769-4699-83c1-a04e627aeb8&title=&width=2250" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697880275790-bdbdef21-33bf-443e-9dd3-ba205d998ca8.png#averageHue=%2327445b&clientId=u685b6605-3101-4&from=paste&height=1110&id=u9d924d78&originHeight=1110&originWidth=2198&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1381450&status=done&style=none&taskId=u7eb565c5-5364-4d7d-a0fa-4fbd11dd2c8&title=&width=2198" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697880380063-e1ce9437-142c-4faf-85ce-257b6e94c995.png#averageHue=%2321384d&clientId=u685b6605-3101-4&from=paste&height=333&id=ueaee8639&originHeight=333&originWidth=2323&originalType=binary&ratio=1&rotation=0&showTitle=false&size=475688&status=done&style=none&taskId=u487a36a8-d919-4265-a713-db42f749e84&title=&width=2323" alt="image.png"></p><ul><li>èŒƒå›´æŸ¥è¯¢</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697880643880-701eae3c-50ac-4687-ac54-21c397f737a7.png#averageHue=%232b4b62&clientId=u685b6605-3101-4&from=paste&height=501&id=u2116031c&originHeight=501&originWidth=2330&originalType=binary&ratio=1&rotation=0&showTitle=false&size=580087&status=done&style=none&taskId=ufe65903b-5b4c-4b3d-80dd-34e07b5eb9d&title=&width=2330" alt="image.png"></p><ul><li>åˆ—è¿ç®—</li></ul><p>åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œåˆ—è¿ç®—å¤±æ•ˆ<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697880915008-cee11519-63c4-4ee8-8ec2-1dd34f2acca4.png#averageHue=%2327445b&clientId=u17655d80-6043-4&from=paste&height=1017&id=u05e57083&originHeight=1017&originWidth=2233&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1277150&status=done&style=none&taskId=uc7f1a9ff-2d92-4abf-a3f2-46153d73812&title=&width=2233" alt="image.png"></p><ul><li>å­—ç¬¦ä¸²ä¸åŠ å¼•å·, ç´¢å¼•ä¹Ÿå°†ä¼šå¤±æ•ˆ</li><li>æ¨¡ç³ŠæŸ¥è¯¢å¤±æ•ˆ</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697881172670-01c93ada-42b2-4f9a-87e3-e0cb25bcd2be.png#averageHue=%23faf9ec&clientId=u17655d80-6043-4&from=paste&height=477&id=u95498bd0&originHeight=477&originWidth=1469&originalType=binary&ratio=1&rotation=0&showTitle=false&size=236774&status=done&style=none&taskId=ua7267f2c-b7d8-4764-9e0d-14496901b88&title=&width=1469" alt="image.png"></p><ul><li>orè¿æ¥</li></ul><p>å¦‚æœorè¿æ¥ä¸€ä¾§æœ‰ç´¢å¼• ä¸€ä¾§ æ²¡æœ‰ç´¢å¼•, é‚£ä¹ˆä¸¤ä¸ªå­—æ®µçš„ç´¢å¼•å°†éƒ½ä¼šå¤±æ•ˆ</p><ul><li>æ•°æ®åˆ†å¸ƒå½±å“</li></ul><p>å½“éœ€è¦æŸ¥è¯¢çš„æ•°æ®æ»¡è¶³ç»å¤§éƒ¨åˆ†, å°±å¯èƒ½ä¸èµ°ç´¢å¼•,ç›´æ¥å…¨è¡¨æ‰«æ<br>å¦‚æœå¾ˆç¨€å°‘, å¤¸å¼ ä¸€ç‚¹, 10086ä¸ªäººä¸­æŸ¥è¯¢ä¸€ä¸ªäºº ,  å°±éœ€è¦ç”¨ç´¢å¼•æ¥æé«˜æŸ¥è¯¢æ•ˆç‡</p><h4 id="SQLæç¤º"><a href="#SQLæç¤º" class="headerlink" title="SQLæç¤º"></a>SQLæç¤º</h4><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697882026874-381e6707-8395-49f9-86ff-5a7040dea5d0.png#averageHue=%23fbfaf3&clientId=u17655d80-6043-4&from=paste&height=854&id=ud711b89c&originHeight=854&originWidth=2051&originalType=binary&ratio=1&rotation=0&showTitle=false&size=362308&status=done&style=none&taskId=uc455ca61-757f-4be1-8ced-fb754a98287&title=&width=2051" alt="image.png"><br>use indexæ˜¯ä¸€ä¸ªå»ºè®®, å»ºè®®æ•°æ®åº“ç”¨å“ªä¸ªç´¢å¼•<br><code>force</code>æ˜¯å¼ºåˆ¶æ•°æ®åº“ç”¨å“ªä¸ªç´¢å¼•</p><h4 id="è¦†ç›–ç´¢å¼•"><a href="#è¦†ç›–ç´¢å¼•" class="headerlink" title="è¦†ç›–ç´¢å¼•"></a>è¦†ç›–ç´¢å¼•</h4><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697957985982-211eeb29-dfa6-49bb-9bbc-49427ea642dc.png#averageHue=%23f6eee8&clientId=uea2f1f1a-6e6d-4&from=paste&height=1109&id=u5149ec54&originHeight=1109&originWidth=2282&originalType=binary&ratio=1&rotation=0&showTitle=false&size=520759&status=done&style=none&taskId=ud658fdf5-5930-4cb5-92c1-bce81a44a5f&title=&width=2282" alt="image.png"><br><strong>æ€è€ƒ:</strong><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697958171025-b1f59855-435b-403a-857b-6a913d30a3e0.png#averageHue=%23f8f8f6&clientId=uea2f1f1a-6e6d-4&from=paste&height=536&id=uacb71684&originHeight=536&originWidth=1372&originalType=binary&ratio=1&rotation=0&showTitle=false&size=175796&status=done&style=none&taskId=u60ee8599-b196-4987-9cf9-e2658d6b4a0&title=&width=1372" alt="image.png"><br>å¦‚æœé€šè¿‡æŸ¥æ‰¾<code>username</code>, ä½†æ²¡æœ‰passwordå­—æ®µ, éœ€è¦è¿›è¡Œå›è¡¨æŸ¥è¯¢æ•ˆç‡é™ä½, æ•ˆç‡æå‡çš„åŠæ³•å°±æ˜¯å°†<code>username</code>å’Œ <code>password</code>å»ºç«‹ä¸€ä¸ªè”åˆç´¢å¼•.<br>æ³¨æ„æœ€å·¦åŒ¹é…åŸåˆ™<br><a href="https://zhuanlan.zhihu.com/p/115778804">é¢è¯•å®˜:è°ˆè°ˆä½ å¯¹mysqlè”åˆç´¢å¼•çš„è®¤è¯†?</a></p><h4 id="å‰ç¼€ç´¢å¼•"><a href="#å‰ç¼€ç´¢å¼•" class="headerlink" title="å‰ç¼€ç´¢å¼•"></a>å‰ç¼€ç´¢å¼•</h4><p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨å‰ç¼€ç´¢å¼•?</strong><br>å½“å­—æ®µè¿‡äºåºå¤§, åˆ›å»ºå­—æ®µç´¢å¼•, ä¼šå‡ºç°æµªè´¹å¤§é‡ç£ç›˜IOçš„æƒ…å†µ<br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697959021633-4d6e5da6-fe0c-431b-843c-e717f7caa976.png#averageHue=%232c4f67&clientId=uea2f1f1a-6e6d-4&from=paste&height=682&id=u36ba95e4&originHeight=682&originWidth=1633&originalType=binary&ratio=1&rotation=0&showTitle=false&size=518215&status=done&style=none&taskId=udd25767d-8cd7-4226-aa43-1decf1d5288&title=&width=1633" alt="image.png"><br><strong>è§£å†³</strong><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697959302180-b04133e2-091a-4aa0-b27d-fa93ba40c6e2.png#averageHue=%23f8f8f2&clientId=uea2f1f1a-6e6d-4&from=paste&height=918&id=u4788766e&originHeight=918&originWidth=2169&originalType=binary&ratio=1&rotation=0&showTitle=false&size=399957&status=done&style=none&taskId=u301a5bb3-7e6b-476b-9405-1d68d6bd9de&title=&width=2169" alt="image.png"><br><strong>å‰ç¼€ç´¢å¼•ç†è§£</strong></p><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697959532132-45b9741c-0fb3-4a90-8c45-8ee0c58c7e22.png#averageHue=%23faf4f1&clientId=uea2f1f1a-6e6d-4&from=paste&height=1035&id=uf12f9ee0&originHeight=1035&originWidth=2147&originalType=binary&ratio=1&rotation=0&showTitle=false&size=666032&status=done&style=none&taskId=u4a6aedd1-3293-4108-92cc-b45bfdb7d62&title=&width=2147" alt="image.png"></p><h4 id="å•åˆ—ç´¢å¼•-è”åˆç´¢å¼•"><a href="#å•åˆ—ç´¢å¼•-è”åˆç´¢å¼•" class="headerlink" title="å•åˆ—ç´¢å¼•&amp;è”åˆç´¢å¼•"></a>å•åˆ—ç´¢å¼•&amp;è”åˆç´¢å¼•</h4><p><strong>å•åˆ—ç´¢å¼•:</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697961112156-fdba0645-2e31-4a81-8317-86ce6e883a4e.png#averageHue=%232c4f67&clientId=uea2f1f1a-6e6d-4&from=paste&height=361&id=u75b42efc&originHeight=361&originWidth=1467&originalType=binary&ratio=1&rotation=0&showTitle=false&size=246535&status=done&style=none&taskId=uab69ea71-c91c-4540-83b7-984dbff661f&title=&width=1467" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697961275207-91793406-bb71-49c0-8458-34fcef0d64c9.png#averageHue=%23f7b2a8&clientId=uea2f1f1a-6e6d-4&from=paste&height=65&id=u3b7ac2ad&originHeight=65&originWidth=1504&originalType=binary&ratio=1&rotation=0&showTitle=false&size=107495&status=done&style=none&taskId=uc7d01b3a-fd34-44ac-9882-a0fbcedb6f9&title=&width=1504" alt="image.png"><br><strong>è”åˆç´¢å¼•</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697961242787-5872fb46-3ff3-42f7-b383-6b295f095349.png#averageHue=%2327445b&clientId=uea2f1f1a-6e6d-4&from=paste&height=1103&id=uaac3630b&originHeight=1103&originWidth=2497&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1615661&status=done&style=none&taskId=u593cca6d-2e38-4451-b521-0cd8ceb0427&title=&width=2497" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697961369813-9cdad172-da8a-421b-8660-d3cea4f6cecd.png#averageHue=%23faf4ef&clientId=uea2f1f1a-6e6d-4&from=paste&height=869&id=u09631a09&originHeight=869&originWidth=2099&originalType=binary&ratio=1&rotation=0&showTitle=false&size=506370&status=done&style=none&taskId=u0f79300d-8f37-43c9-9f27-06c651a419c&title=&width=2099" alt="image.png"><br>å¯¹äºphoneå’Œnameçš„é¡ºåºä¹Ÿæ˜¯è¦è€ƒè™‘çš„</p><h4 id="è®¾è®¡åŸåˆ™"><a href="#è®¾è®¡åŸåˆ™" class="headerlink" title="è®¾è®¡åŸåˆ™"></a>è®¾è®¡åŸåˆ™</h4><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697961597390-c4c56736-64c5-466f-94f4-8310b9c67a3a.png#averageHue=%23f7f6f6&clientId=uea2f1f1a-6e6d-4&from=paste&height=939&id=ub06dcec8&originHeight=939&originWidth=2138&originalType=binary&ratio=1&rotation=0&showTitle=false&size=505716&status=done&style=none&taskId=ub7440d06-ea8c-47ce-a420-3817cd3ca9b&title=&width=2138" alt="image.png"></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/38717174/1697961756225-f626ce84-e6bf-4183-a086-9a996e2f61f8.png#averageHue=%23fcfbf1&clientId=uea2f1f1a-6e6d-4&from=paste&height=1058&id=uc47b7fe4&originHeight=1058&originWidth=1223&originalType=binary&ratio=1&rotation=0&showTitle=false&size=279613&status=done&style=none&taskId=u00913f09-d35d-4cb5-b541-e33bf5a853f&title=&width=1223" alt="image.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt;

&lt;h1 id=&quot;ç´¢å¼•&quot;&gt;&lt;a href=&quot;#ç´¢å¼•&quot; class=&quot;headerlink&quot; title=&quot;ç´¢å¼•&quot;&gt;&lt;/a&gt;ç´¢å¼•&lt;/h1&gt;&lt;h2 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot;</summary>
      
    
    
    
    <category term="MySQL" scheme="https://axdmdyj.github.io/categories/MySQL/"/>
    
    
    <category term="MySQL" scheme="https://axdmdyj.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC</title>
    <link href="https://axdmdyj.github.io/posts/ae0f95e0.html"/>
    <id>https://axdmdyj.github.io/posts/ae0f95e0.html</id>
    <published>2023-10-14T17:09:13.000Z</published>
    <updated>2023-11-21T06:50:38.395Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h1><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul><li><a href="#%E4%B8%80SpringMVC%E7%AE%80%E4%BB%8B%E5%92%8C%E4%BD%93%E9%AA%8C">ä¸€ã€SpringMVCç®€ä»‹å’Œä½“éªŒ</a><ul><li><a href="#11-%E4%BB%8B%E7%BB%8D">1.1 ä»‹ç»</a></li><li><a href="#12-%E4%B8%BB%E8%A6%81%E4%BD%9C%E7%94%A8">1.2 ä¸»è¦ä½œç”¨</a></li><li><a href="#13-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E5%92%8C%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B%E7%90%86%E8%A7%A3">1.3 æ ¸å¿ƒç»„ä»¶å’Œè°ƒç”¨æµç¨‹ç†è§£</a></li><li><a href="#14-%E5%BF%AB%E9%80%9F%E4%BD%93%E9%AA%8C">1.4 å¿«é€Ÿä½“éªŒ</a></li></ul></li><li><a href="#%E4%BA%8CSpringMVC%E6%8E%A5%E6%94%B6%E6%95%B0%E6%8D%AE">äºŒã€SpringMVCæ¥æ”¶æ•°æ®</a><ul><li><a href="#21-%E8%AE%BF%E9%97%AE%E8%B7%AF%E5%BE%84%E8%AE%BE%E7%BD%AE">2.1 è®¿é—®è·¯å¾„è®¾ç½®</a></li><li><a href="#22-%E6%8E%A5%E6%94%B6%E5%8F%82%E6%95%B0%E9%87%8D%E7%82%B9">2.2 æ¥æ”¶å‚æ•°ï¼ˆé‡ç‚¹ï¼‰</a><ul><li><a href="#221-param-%E5%92%8C-json%E5%8F%82%E6%95%B0%E6%AF%94%E8%BE%83">2.2.1 param å’Œ jsonå‚æ•°æ¯”è¾ƒ</a></li><li><a href="#222-param%E5%8F%82%E6%95%B0%E6%8E%A5%E6%94%B6">2.2.2 paramå‚æ•°æ¥æ”¶</a></li><li><a href="#223-%E8%B7%AF%E5%BE%84-%E5%8F%82%E6%95%B0%E6%8E%A5%E6%94%B6">2.2.3 è·¯å¾„ å‚æ•°æ¥æ”¶</a></li><li><a href="#224-json%E5%8F%82%E6%95%B0%E6%8E%A5%E6%94%B6">2.2.4 jsonå‚æ•°æ¥æ”¶</a></li></ul></li><li><a href="#23-%E6%8E%A5%E6%94%B6Cookie%E6%95%B0%E6%8D%AE">2.3 æ¥æ”¶Cookieæ•°æ®</a></li><li><a href="#24-%E6%8E%A5%E6%94%B6%E8%AF%B7%E6%B1%82%E5%A4%B4%E6%95%B0%E6%8D%AE">2.4 æ¥æ”¶è¯·æ±‚å¤´æ•°æ®</a></li><li><a href="#25-%E5%8E%9F%E7%94%9FApi%E5%AF%B9%E8%B1%A1%E6%93%8D%E4%BD%9C">2.5 åŸç”ŸApiå¯¹è±¡æ“ä½œ</a></li><li><a href="#26-%E5%85%B1%E4%BA%AB%E5%9F%9F%E5%AF%B9%E8%B1%A1%E6%93%8D%E4%BD%9C">2.6 å…±äº«åŸŸå¯¹è±¡æ“ä½œ</a><ul><li><a href="#261-%E5%B1%9E%E6%80%A7%E5%85%B1%E4%BA%AB%E5%9F%9F%E4%BD%9C%E7%94%A8%E5%9B%9E%E9%A1%BE">2.6.1 å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸä½œç”¨å›é¡¾</a></li><li><a href="#262-Request%E7%BA%A7%E5%88%AB%E5%B1%9E%E6%80%A7%E5%85%B1%E4%BA%AB%E5%9F%9F">2.6.2 Requestçº§åˆ«å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸ</a></li><li><a href="#263-Session%E7%BA%A7%E5%88%AB%E5%B1%9E%E6%80%A7%E5%85%B1%E4%BA%AB%E5%9F%9F">2.6.3 Sessionçº§åˆ«å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸ</a></li><li><a href="#264-Application%E7%BA%A7%E5%88%AB%E5%B1%9E%E6%80%A7%E5%85%B1%E4%BA%AB%E5%9F%9F">2.6.4 Applicationçº§åˆ«å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸ</a></li></ul></li></ul></li><li><a href="#%E4%B8%89SpringMVC%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE">ä¸‰ã€SpringMVCå“åº”æ•°æ®</a><ul><li><a href="#31-handler%E6%96%B9%E6%B3%95%E5%88%86%E6%9E%90">3.1 handleræ–¹æ³•åˆ†æ</a></li><li><a href="#32-%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC%E6%8E%A7%E5%88%B6">3.2 é¡µé¢è·³è½¬æ§åˆ¶</a><ul><li><a href="#321-%E5%BF%AB%E9%80%9F%E8%BF%94%E5%9B%9E%E6%A8%A1%E6%9D%BF%E8%A7%86%E5%9B%BE">3.2.1 å¿«é€Ÿè¿”å›æ¨¡æ¿è§†å›¾</a></li><li><a href="#322-%E8%BD%AC%E5%8F%91%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91">3.2.2 è½¬å‘å’Œé‡å®šå‘</a></li></ul></li><li><a href="#33-%E8%BF%94%E5%9B%9EJSON%E6%95%B0%E6%8D%AE%E9%87%8D%E7%82%B9">3.3 è¿”å›JSONæ•°æ®ï¼ˆé‡ç‚¹ï¼‰</a><ul><li><a href="#331-%E5%89%8D%E7%BD%AE%E5%87%86%E5%A4%87">3.3.1 å‰ç½®å‡†å¤‡</a></li><li><a href="#332-ResponseBody">3.3.2 @ResponseBody</a></li><li><a href="#333-RestController">3.3.3 @RestController</a></li></ul></li><li><a href="#34-%E8%BF%94%E5%9B%9E%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%A4%84%E7%90%86">3.4 è¿”å›é™æ€èµ„æºå¤„ç†</a></li></ul></li><li><a href="#%E5%9B%9BRESTFul%E9%A3%8E%E6%A0%BC%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E6%88%98">å››ã€RESTFulé£æ ¼è®¾è®¡å’Œå®æˆ˜</a><ul><li><a href="#41-RESTFul%E9%A3%8E%E6%A0%BC%E6%A6%82%E8%BF%B0">4.1 RESTFulé£æ ¼æ¦‚è¿°</a><ul><li><a href="#411-RESTFul%E9%A3%8E%E6%A0%BC%E7%AE%80%E4%BB%8B">4.1.1 RESTFulé£æ ¼ç®€ä»‹</a></li><li><a href="#412-RESTFul%E9%A3%8E%E6%A0%BC%E7%89%B9%E7%82%B9">4.1.2 RESTFulé£æ ¼ç‰¹ç‚¹</a></li><li><a href="#413-RESTFul%E9%A3%8E%E6%A0%BC%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83">4.1.3 RESTFulé£æ ¼è®¾è®¡è§„èŒƒ</a></li><li><a href="#414-RESTFul%E9%A3%8E%E6%A0%BC%E5%A5%BD%E5%A4%84">4.1.4 RESTFulé£æ ¼å¥½å¤„</a></li></ul></li><li><a href="#42-RESTFul%E9%A3%8E%E6%A0%BC%E5%AE%9E%E6%88%98">4.2 RESTFulé£æ ¼å®æˆ˜</a><ul><li><a href="#421-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90">4.2.1 éœ€æ±‚åˆ†æ</a></li><li><a href="#422-RESTFul%E9%A3%8E%E6%A0%BC%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1">4.2.2 RESTFulé£æ ¼æ¥å£è®¾è®¡</a></li><li><a href="#423-%E5%90%8E%E5%8F%B0%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0">4.2.3 åå°æ¥å£å®ç°</a></li></ul></li></ul></li><li><a href="#%E4%BA%94SpringMVC%E5%85%B6%E4%BB%96%E6%89%A9%E5%B1%95">äº”ã€SpringMVCå…¶ä»–æ‰©å±•</a><ul><li><a href="#51-%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6">5.1 å…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶</a><ul><li><a href="#511-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F">5.1.1 å¼‚å¸¸å¤„ç†ä¸¤ç§æ–¹å¼</a></li><li><a href="#512-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E5%BC%82%E5%B8%B8%E5%A3%B0%E6%98%8E%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86">5.1.2 åŸºäºæ³¨è§£å¼‚å¸¸å£°æ˜å¼‚å¸¸å¤„ç†</a></li></ul></li><li><a href="#52-%E6%8B%A6%E6%88%AA%E5%99%A8%E4%BD%BF%E7%94%A8">5.2 æ‹¦æˆªå™¨ä½¿ç”¨</a><ul><li><a href="#521-%E6%8B%A6%E6%88%AA%E5%99%A8%E6%A6%82%E5%BF%B5">5.2.1 æ‹¦æˆªå™¨æ¦‚å¿µ</a></li><li><a href="#522-%E6%8B%A6%E6%88%AA%E5%99%A8%E4%BD%BF%E7%94%A8">5.2.2 æ‹¦æˆªå™¨ä½¿ç”¨</a></li></ul></li><li><a href="#53-%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C">5.3 å‚æ•°æ ¡éªŒ</a></li></ul></li><li><a href="#%E5%85%ADSpringMVC%E6%80%BB%E7%BB%93">å…­ã€SpringMVCæ€»ç»“</a></li></ul><h2 id="ä¸€ã€SpringMVCç®€ä»‹å’Œä½“éªŒ"><a href="#ä¸€ã€SpringMVCç®€ä»‹å’Œä½“éªŒ" class="headerlink" title="ä¸€ã€SpringMVCç®€ä»‹å’Œä½“éªŒ"></a>ä¸€ã€SpringMVCç®€ä»‹å’Œä½“éªŒ</h2><h3 id="1-1-ä»‹ç»"><a href="#1-1-ä»‹ç»" class="headerlink" title="1.1 ä»‹ç»"></a>1.1 ä»‹ç»</h3><p><a href="https://docs.spring.io/spring-framework/reference/web/webmvc.html">https://docs.spring.io/spring-framework/reference/web/webmvc.html</a></p><p>Spring Web MVCæ˜¯åŸºäºServlet APIæ„å»ºçš„åŸå§‹Webæ¡†æ¶ï¼Œä»ä¸€å¼€å§‹å°±åŒ…å«åœ¨Spring Frameworkä¸­ã€‚æ­£å¼åç§°â€œSpring Web MVCâ€æ¥è‡ªå…¶æºæ¨¡å—çš„åç§°ï¼ˆ <code>spring-webmvc</code> ï¼‰ï¼Œä½†å®ƒé€šå¸¸è¢«ç§°ä¸ºâ€œSpring MVCâ€ã€‚</p><p>åœ¨æ§åˆ¶å±‚æ¡†æ¶å†ç»Strustã€WebWorkã€Strust2ç­‰è¯¸å¤šäº§å“çš„å†ä»£æ›´è¿­ä¹‹åï¼Œç›®å‰ä¸šç•Œæ™®éé€‰æ‹©äº†SpringMVCä½œä¸ºJava EEé¡¹ç›®è¡¨è¿°å±‚å¼€å‘çš„<strong>é¦–é€‰æ–¹æ¡ˆ</strong>ã€‚ä¹‹æ‰€ä»¥èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ˜¯å› ä¸ºSpringMVCå…·å¤‡å¦‚ä¸‹æ˜¾è‘—ä¼˜åŠ¿ï¼š</p><ul><li><strong>Spring å®¶æ—åŸç”Ÿäº§å“</strong>ï¼Œä¸IOCå®¹å™¨ç­‰åŸºç¡€è®¾æ–½æ— ç¼å¯¹æ¥</li><li>è¡¨è¿°å±‚å„ç»†åˆ†é¢†åŸŸéœ€è¦è§£å†³çš„é—®é¢˜<strong>å…¨æ–¹ä½è¦†ç›–</strong>ï¼Œæä¾›<strong>å…¨é¢è§£å†³æ–¹æ¡ˆ</strong></li><li><strong>ä»£ç æ¸…æ–°ç®€æ´</strong>ï¼Œå¤§å¹…åº¦æå‡å¼€å‘æ•ˆç‡</li><li>å†…éƒ¨ç»„ä»¶åŒ–ç¨‹åº¦é«˜ï¼Œå¯æ’æ‹”å¼ç»„ä»¶<strong>å³æ’å³ç”¨</strong>ï¼Œæƒ³è¦ä»€ä¹ˆåŠŸèƒ½é…ç½®ç›¸åº”ç»„ä»¶å³å¯</li><li><strong>æ€§èƒ½å“è‘—</strong>ï¼Œå°¤å…¶é€‚åˆç°ä»£å¤§å‹ã€è¶…å¤§å‹äº’è”ç½‘é¡¹ç›®è¦æ±‚</li></ul><p>åŸç”ŸServlet APIå¼€å‘ä»£ç ç‰‡æ®µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span><br><span class="line">                                                        <span class="keyword">throws</span> ServletException, IOException &#123;  </span><br><span class="line">    <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">&quot;userName=&quot;</span>+userName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸºäºSpringMVCå¼€å‘ä»£ç ç‰‡æ®µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/user/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(<span class="meta">@RequestParam(&quot;userName&quot;)</span> String userName,Sting password)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    log.debug(<span class="string">&quot;userName=&quot;</span>+userName);</span><br><span class="line">    <span class="comment">//è°ƒç”¨ä¸šåŠ¡å³å¯</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;result&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-ä¸»è¦ä½œç”¨"><a href="#1-2-ä¸»è¦ä½œç”¨" class="headerlink" title="1.2 ä¸»è¦ä½œç”¨"></a>1.2 ä¸»è¦ä½œç”¨</h3><p><img src="/../../../ProTool/img/img1/202310150052058.png"></p><p>SSMæ¡†æ¶æ„å»ºèµ·å•ä½“é¡¹ç›®çš„æŠ€æœ¯æ ˆéœ€æ±‚ï¼å…¶ä¸­çš„SpringMVCè´Ÿè´£è¡¨è¿°å±‚ï¼ˆæ§åˆ¶å±‚ï¼‰å®ç°ç®€åŒ–ï¼</p><p>SpringMVCçš„ä½œç”¨ä¸»è¦è¦†ç›–çš„æ˜¯è¡¨è¿°å±‚ï¼Œä¾‹å¦‚ï¼š</p><ul><li>è¯·æ±‚æ˜ å°„</li><li>æ•°æ®è¾“å…¥</li><li>è§†å›¾ç•Œé¢</li><li>è¯·æ±‚åˆ†å‘</li><li>è¡¨å•å›æ˜¾</li><li>ä¼šè¯æ§åˆ¶</li><li>è¿‡æ»¤æ‹¦æˆª</li><li>å¼‚æ­¥äº¤äº’</li><li>æ–‡ä»¶ä¸Šä¼ </li><li>æ–‡ä»¶ä¸‹è½½</li><li>æ•°æ®æ ¡éªŒ</li><li>ç±»å‹è½¬æ¢</li><li>ç­‰ç­‰ç­‰</li></ul><p><strong>æœ€ç»ˆæ€»ç»“ï¼š</strong></p><ol><li>ç®€åŒ–å‰ç«¯å‚æ•°æ¥æ”¶( å½¢å‚åˆ—è¡¨ )</li><li>ç®€åŒ–åç«¯æ•°æ®å“åº”(è¿”å›å€¼)</li><li>ä»¥åŠå…¶ä»–â€¦â€¦</li></ol><h3 id="1-3-æ ¸å¿ƒç»„ä»¶å’Œè°ƒç”¨æµç¨‹ç†è§£"><a href="#1-3-æ ¸å¿ƒç»„ä»¶å’Œè°ƒç”¨æµç¨‹ç†è§£" class="headerlink" title="1.3 æ ¸å¿ƒç»„ä»¶å’Œè°ƒç”¨æµç¨‹ç†è§£"></a>1.3 æ ¸å¿ƒç»„ä»¶å’Œè°ƒç”¨æµç¨‹ç†è§£</h3><p>Spring MVCä¸è®¸å¤šå…¶ä»–Webæ¡†æ¶ä¸€æ ·ï¼Œæ˜¯å›´ç»•å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼è®¾è®¡çš„ï¼Œå…¶ä¸­ä¸­å¤® <code>Servlet</code>  <code>DispatcherServlet</code> åšæ•´ä½“è¯·æ±‚å¤„ç†è°ƒåº¦ï¼</p><p>é™¤äº†<code>DispatcherServlet</code>SpringMVCè¿˜ä¼šæä¾›å…¶ä»–ç‰¹æ®Šçš„ç»„ä»¶åä½œå®Œæˆè¯·æ±‚å¤„ç†å’Œå“åº”å‘ˆç°ã€‚</p><p><strong>SpringMVCå¤„ç†è¯·æ±‚æµç¨‹ï¼š</strong></p><p><img src="/../../../ProTool/img/img1/image_tmdw8dA_0q.png"></p><p><strong>SpringMVCæ¶‰åŠç»„ä»¶ç†è§£ï¼š</strong></p><ol><li>DispatcherServlet :  SpringMVCæä¾›ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨web.xmlé…ç½®ä½¿å…¶ç”Ÿæ•ˆï¼Œå®ƒæ˜¯æ•´ä¸ªæµç¨‹å¤„ç†çš„æ ¸å¿ƒï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ç»è¿‡å®ƒçš„å¤„ç†å’Œåˆ†å‘ï¼[ CEO ]</li><li>HandlerMapping :  SpringMVCæä¾›ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡ŒIoCé…ç½®ä½¿å…¶åŠ å…¥IoCå®¹å™¨æ–¹å¯ç”Ÿæ•ˆï¼Œå®ƒå†…éƒ¨ç¼“å­˜handler(controlleræ–¹æ³•)å’Œhandlerè®¿é—®è·¯å¾„æ•°æ®ï¼Œè¢«DispatcherServletè°ƒç”¨ï¼Œç”¨äºæŸ¥æ‰¾è·¯å¾„å¯¹åº”çš„handlerï¼[ç§˜ä¹¦]</li><li>HandlerAdapter : SpringMVCæä¾›ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡ŒIoCé…ç½®ä½¿å…¶åŠ å…¥IoCå®¹å™¨æ–¹å¯ç”Ÿæ•ˆï¼Œå®ƒå¯ä»¥å¤„ç†è¯·æ±‚å‚æ•°å’Œå¤„ç†å“åº”æ•°æ®æ•°æ®ï¼Œæ¯æ¬¡DispatcherServletéƒ½æ˜¯é€šè¿‡handlerAdapteré—´æ¥è°ƒç”¨handlerï¼Œä»–æ˜¯handlerå’ŒDispatcherServletä¹‹é—´çš„é€‚é…å™¨ï¼[ç»ç†]</li><li>Handler : handleråˆç§°å¤„ç†å™¨ï¼Œä»–æ˜¯Controllerç±»å†…éƒ¨çš„æ–¹æ³•ç®€ç§°ï¼Œæ˜¯ç”±æˆ‘ä»¬è‡ªå·±å®šä¹‰ï¼Œç”¨æ¥æ¥æ”¶å‚æ•°ï¼Œå‘åè°ƒç”¨ä¸šåŠ¡ï¼Œæœ€ç»ˆè¿”å›å“åº”ç»“æœï¼[æ‰“å·¥äºº]</li><li>ViewResovler : SpringMVCæä¾›ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡ŒIoCé…ç½®ä½¿å…¶åŠ å…¥IoCå®¹å™¨æ–¹å¯ç”Ÿæ•ˆï¼è§†å›¾è§£æå™¨ä¸»è¦ä½œç”¨ç®€åŒ–æ¨¡ç‰ˆè§†å›¾é¡µé¢æŸ¥æ‰¾çš„ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œå‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œåç«¯åªè¿”å›JSONæ•°æ®ï¼Œä¸è¿”å›é¡µé¢ï¼Œé‚£å°±ä¸éœ€è¦è§†å›¾è§£æå™¨ï¼æ‰€ä»¥ï¼Œè§†å›¾è§£æå™¨ï¼Œç›¸å¯¹å…¶ä»–çš„ç»„ä»¶ä¸æ˜¯å¿…é¡»çš„ï¼[è´¢åŠ¡]</li></ol><h3 id="1-4-å¿«é€Ÿä½“éªŒ"><a href="#1-4-å¿«é€Ÿä½“éªŒ" class="headerlink" title="1.4 å¿«é€Ÿä½“éªŒ"></a>1.4 å¿«é€Ÿä½“éªŒ</h3><ol><li><p>ä½“éªŒåœºæ™¯éœ€æ±‚</p><p><img src="/../../../ProTool/img/img1/image_JrHCHOxu_n.png"></p></li><li><p>é…ç½®åˆ†æ</p><ol><li>DispatcherServletï¼Œè®¾ç½®å¤„ç†æ‰€æœ‰è¯·æ±‚ï¼</li><li>HandlerMapping,HandlerAdapter,Handleréœ€è¦åŠ å…¥åˆ°IoCå®¹å™¨ï¼Œä¾›DSè°ƒç”¨ï¼</li><li>Handlerè‡ªå·±å£°æ˜ï¼ˆControllerï¼‰éœ€è¦é…ç½®åˆ°HandlerMappingä¸­ä¾›DSæŸ¥æ‰¾ï¼</li></ol></li><li><p>å‡†å¤‡é¡¹ç›®</p><ol><li><p>åˆ›å»ºé¡¹ç›®</p><p>springmvc-base-quick</p><p>æ³¨æ„ï¼šéœ€è¦è½¬æˆmaven&#x2F;webç¨‹åºï¼ï¼</p></li><li><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>6.0.6<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet.api</span>&gt;</span>9.1.0<span class="tag">&lt;/<span class="name">servlet.api</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- springiocç›¸å…³ä¾èµ–  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- webç›¸å…³ä¾èµ–  --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- åœ¨ pom.xml ä¸­å¼•å…¥ Jakarta EE Web API çš„ä¾èµ– --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        åœ¨ Spring Web MVC 6 ä¸­ï¼ŒServlet API è¿ç§»åˆ°äº† Jakarta EE APIï¼Œå› æ­¤åœ¨é…ç½® DispatcherServlet æ—¶éœ€è¦ä½¿ç”¨</span></span><br><span class="line"><span class="comment">         Jakarta EE æä¾›çš„ç›¸åº”ç±»åº“å’Œå‘½åç©ºé—´ã€‚é”™è¯¯ä¿¡æ¯ â€œâ€˜org.springframework.web.servlet.DispatcherServletâ€™</span></span><br><span class="line"><span class="comment">         is not assignable to â€˜javax.servlet.Servlet,jakarta.servlet.Servletâ€™â€ è¡¨æ˜ä½ ä½¿ç”¨äº†æ—§ç‰ˆæœ¬çš„</span></span><br><span class="line"><span class="comment">         Servlet APIï¼Œæ²¡æœ‰æ›´æ–°åˆ° Jakarta EE è§„èŒƒã€‚</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.platform<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.jakartaee-web-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;servlet.api&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- springwebmvcç›¸å…³ä¾èµ–  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol></li><li><p>Controllerå£°æ˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//handlers</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * handlerå°±æ˜¯controllerå†…éƒ¨çš„å…·ä½“æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RequestMapping</span>(&quot;/springmvc/hello&quot;) å°±æ˜¯ç”¨æ¥å‘handlerMappingä¸­æ³¨å†Œçš„æ–¹æ³•æ³¨è§£!</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@ResponseBody</span> ä»£è¡¨å‘æµè§ˆå™¨ç›´æ¥è¿”å›æ•°æ®!</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/springmvc/hello&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;HelloController.hello&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello springmvc!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>Spring MVCæ ¸å¿ƒç»„ä»¶é…ç½®ç±»</p><blockquote><p>å£°æ˜springmvcæ¶‰åŠç»„ä»¶ä¿¡æ¯çš„é…ç½®ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//<span class="doctag">TODO:</span> SpringMVCå¯¹åº”ç»„ä»¶çš„é…ç½®ç±» [å£°æ˜SpringMVCéœ€è¦çš„ç»„ä»¶ä¿¡æ¯]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span> å¯¼å…¥handlerMappingå’ŒhandlerAdapterçš„ä¸‰ç§æ–¹å¼</span></span><br><span class="line"> <span class="comment">//1.è‡ªåŠ¨å¯¼å…¥handlerMappingå’ŒhandlerAdapter [æ¨è]</span></span><br><span class="line"> <span class="comment">//2.å¯ä»¥ä¸æ·»åŠ ,springmvcä¼šæ£€æŸ¥æ˜¯å¦é…ç½®handlerMappingå’ŒhandlerAdapter,æ²¡æœ‰é…ç½®é»˜è®¤åŠ è½½</span></span><br><span class="line"> <span class="comment">//3.ä½¿ç”¨@Beanæ–¹å¼é…ç½®handlerMapperå’ŒhandlerAdapter</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span>     </span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.atguigu.controller&quot;)</span> <span class="comment">//<span class="doctag">TODO:</span> è¿›è¡Œcontrolleræ‰«</span></span><br><span class="line"><span class="comment">//WebMvcConfigurer springMvcè¿›è¡Œç»„ä»¶é…ç½®çš„è§„èŒƒ,é…ç½®ç»„ä»¶,æä¾›å„ç§æ–¹æ³•! å‰æœŸå¯ä»¥å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HandlerMapping <span class="title function_">handlerMapping</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RequestMappingHandlerMapping</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HandlerAdapter <span class="title function_">handlerAdapter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RequestMappingHandlerAdapter</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>SpringMVCç¯å¢ƒæ­å»º</p><blockquote><p>å¯¹äºä½¿ç”¨åŸºäº Java çš„ Spring é…ç½®çš„åº”ç”¨ç¨‹åºï¼Œå»ºè®®è¿™æ ·åšï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//<span class="doctag">TODO:</span> SpringMVCæä¾›çš„æ¥å£,æ˜¯æ›¿ä»£web.xmlçš„æ–¹æ¡ˆ,æ›´æ–¹ä¾¿å®ç°å®Œå…¨æ³¨è§£æ–¹å¼ssmå¤„ç†!</span></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span> Springmvcæ¡†æ¶ä¼šè‡ªåŠ¨æ£€æŸ¥å½“å‰ç±»çš„å®ç°ç±»,ä¼šè‡ªåŠ¨åŠ è½½ getRootConfigClasses / getServletConfigClasses æä¾›çš„é…ç½®ç±»</span></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span> getServletMappings è¿”å›çš„åœ°å€ è®¾ç½®DispatherServletå¯¹åº”å¤„ç†çš„åœ°å€</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWebAppInitializer</span> <span class="keyword">extends</span> <span class="title class_">AbstractAnnotationConfigDispatcherServletInitializer</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æŒ‡å®šservice / mapperå±‚çš„é…ç½®ç±»</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æŒ‡å®šspringmvcçš„é…ç½®ç±»</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>&lt;?&gt;[] &#123; SpringMvcConfig.class &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è®¾ç½®dispatcherServletçš„å¤„ç†è·¯å¾„!</span></span><br><span class="line"><span class="comment">   * ä¸€èˆ¬æƒ…å†µä¸‹ä¸º / ä»£è¡¨å¤„ç†æ‰€æœ‰è¯·æ±‚!</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[] &#123; <span class="string">&quot;/&quot;</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨æµ‹è¯•</p><p>æ³¨æ„ï¼š tomcatåº”è¯¥æ˜¯10+ç‰ˆæœ¬ï¼æ–¹å¯æ”¯æŒ Jakarta EE API!</p><p><img src="/../../../ProTool/img/img1/image_196iViHp_T.png"></p></li></ol><h2 id="äºŒã€SpringMVCæ¥æ”¶æ•°æ®"><a href="#äºŒã€SpringMVCæ¥æ”¶æ•°æ®" class="headerlink" title="äºŒã€SpringMVCæ¥æ”¶æ•°æ®"></a>äºŒã€SpringMVCæ¥æ”¶æ•°æ®</h2><h3 id="2-1-è®¿é—®è·¯å¾„è®¾ç½®"><a href="#2-1-è®¿é—®è·¯å¾„è®¾ç½®" class="headerlink" title="2.1 è®¿é—®è·¯å¾„è®¾ç½®"></a>2.1 è®¿é—®è·¯å¾„è®¾ç½®</h3><p>@RequestMappingæ³¨è§£çš„ä½œç”¨å°±æ˜¯å°†è¯·æ±‚çš„ URL åœ°å€å’Œå¤„ç†è¯·æ±‚çš„æ–¹å¼ï¼ˆhandleræ–¹æ³•ï¼‰å…³è”èµ·æ¥ï¼Œå»ºç«‹æ˜ å°„å…³ç³»ã€‚</p><p>SpringMVC æ¥æ”¶åˆ°æŒ‡å®šçš„è¯·æ±‚ï¼Œå°±ä¼šæ¥æ‰¾åˆ°åœ¨æ˜ å°„å…³ç³»ä¸­å¯¹åº”çš„æ–¹æ³•æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚</p><ol><li><p><strong>ç²¾å‡†è·¯å¾„åŒ¹é…</strong></p><p>åœ¨@RequestMappingæ³¨è§£æŒ‡å®š URL åœ°å€æ—¶ï¼Œä¸ä½¿ç”¨ä»»ä½•é€šé…ç¬¦ï¼ŒæŒ‰ç…§è¯·æ±‚åœ°å€è¿›è¡Œç²¾ç¡®åŒ¹é…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç²¾å‡†è®¾ç½®è®¿é—®åœ°å€ /user/login</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &#123;&quot;/user/login&quot;&#125;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserController.login&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login success!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç²¾å‡†è®¾ç½®è®¿é—®åœ°å€ /user/register</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &#123;&quot;/user/register&quot;&#125;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">register</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserController.register&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;register success!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><strong>æ¨¡ç³Šè·¯å¾„åŒ¹é…</strong></p><p>åœ¨@RequestMappingæ³¨è§£æŒ‡å®š URL åœ°å€æ—¶ï¼Œé€šè¿‡ä½¿ç”¨é€šé…ç¬¦ï¼ŒåŒ¹é…å¤šä¸ªç±»ä¼¼çš„åœ°å€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  è·¯å¾„è®¾ç½®ä¸º /product/*  </span></span><br><span class="line"><span class="comment">     *    /* ä¸ºå•å±‚ä»»æ„å­—ç¬¦ä¸²  /product/a  /product/aaa å¯ä»¥è®¿é—®æ­¤handler  </span></span><br><span class="line"><span class="comment">     *    /product/a/a ä¸å¯ä»¥</span></span><br><span class="line"><span class="comment">     *  è·¯å¾„è®¾ç½®ä¸º /product/** </span></span><br><span class="line"><span class="comment">     *   /** ä¸ºä»»æ„å±‚ä»»æ„å­—ç¬¦ä¸²  /product/a  /product/aaa å¯ä»¥è®¿é—®æ­¤handler  </span></span><br><span class="line"><span class="comment">     *   /product/a/a ä¹Ÿå¯ä»¥è®¿é—®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/product/*&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">show</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ProductController.show&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;product show!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å•å±‚åŒ¹é…å’Œå¤šå±‚åŒ¹é…ï¼š</span><br><span class="line">  /*ï¼šåªèƒ½åŒ¹é…URLåœ°å€ä¸­çš„ä¸€å±‚ï¼Œå¦‚æœæƒ³å‡†ç¡®åŒ¹é…ä¸¤å±‚ï¼Œé‚£ä¹ˆå°±å†™â€œ/*/*â€ä»¥æ­¤ç±»æ¨ã€‚</span><br><span class="line">  /**ï¼šå¯ä»¥åŒ¹é…URLåœ°å€ä¸­çš„å¤šå±‚ã€‚</span><br><span class="line">å…¶ä¸­æ‰€è°“çš„ä¸€å±‚æˆ–å¤šå±‚æ˜¯æŒ‡ä¸€ä¸ªURLåœ°å€å­—ç¬¦ä¸²è¢«â€œ/â€åˆ’åˆ†å‡ºæ¥çš„å„ä¸ªå±‚æ¬¡</span><br><span class="line">è¿™ä¸ªçŸ¥è¯†ç‚¹è™½ç„¶å¯¹äº@RequestMappingæ³¨è§£æ¥è¯´å®ç”¨æ€§ä¸å¤§ï¼Œä½†æ˜¯å°†æ¥é…ç½®æ‹¦æˆªå™¨çš„æ—¶å€™ä¹Ÿéµå¾ªè¿™ä¸ªè§„åˆ™ã€‚</span><br></pre></td></tr></table></figure></li><li><p><strong>ç±»å’Œæ–¹æ³•çº§åˆ«åŒºåˆ«</strong></p><p><code>@RequestMapping</code> æ³¨è§£å¯ä»¥ç”¨äºç±»çº§åˆ«å’Œæ–¹æ³•çº§åˆ«ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><ol><li>è®¾ç½®åˆ°ç±»çº§åˆ«ï¼š<code>@RequestMapping</code> æ³¨è§£å¯ä»¥è®¾ç½®åœ¨æ§åˆ¶å™¨ç±»ä¸Šï¼Œç”¨äºæ˜ å°„æ•´ä¸ªæ§åˆ¶å™¨çš„é€šç”¨è¯·æ±‚è·¯å¾„ã€‚è¿™æ ·ï¼Œå¦‚æœæ§åˆ¶å™¨ä¸­çš„å¤šä¸ªæ–¹æ³•éƒ½éœ€è¦æ˜ å°„åŒä¸€è¯·æ±‚è·¯å¾„ï¼Œå°±ä¸éœ€è¦åœ¨æ¯ä¸ªæ–¹æ³•ä¸Šéƒ½æ·»åŠ æ˜ å°„è·¯å¾„ã€‚</li><li>è®¾ç½®åˆ°æ–¹æ³•çº§åˆ«ï¼š<code>@RequestMapping</code> æ³¨è§£ä¹Ÿå¯ä»¥å•ç‹¬è®¾ç½®åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸Šï¼Œç”¨äºæ›´ç»†ç²’åº¦åœ°æ˜ å°„è¯·æ±‚è·¯å¾„å’Œå¤„ç†æ–¹æ³•ã€‚å½“å¤šä¸ªæ–¹æ³•å¤„ç†åŒä¸€ä¸ªè·¯å¾„çš„ä¸åŒæ“ä½œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³•çº§åˆ«çš„ <code>@RequestMapping</code> æ³¨è§£è¿›è¡Œæ›´ç²¾ç»†çš„æ˜ å°„ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.æ ‡è®°åˆ°handleræ–¹æ³•</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/login&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/register&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/logout&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.ä¼˜åŒ–æ ‡è®°ç±»+handleræ–¹æ³•</span></span><br><span class="line"><span class="comment">//ç±»ä¸Š</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="comment">//handleræ–¹æ³•ä¸Š</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/register&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/logout&quot;)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><strong>é™„å¸¦è¯·æ±‚æ–¹å¼é™åˆ¶</strong></p><p>HTTP åè®®å®šä¹‰äº†å…«ç§è¯·æ±‚æ–¹å¼ï¼Œåœ¨ SpringMVC ä¸­å°è£…åˆ°äº†ä¸‹é¢è¿™ä¸ªæšä¸¾ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">RequestMethod</span> &#123;</span><br><span class="line">  GET, HEAD, POST, PUT, PATCH, DELETE, OPTIONS, TRACE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼š@RequestMapping(â€œ&#x2F;logoutâ€) ä»»ä½•è¯·æ±‚æ–¹å¼éƒ½å¯ä»¥è®¿é—®ï¼</p><p>å¦‚æœéœ€è¦ç‰¹å®šæŒ‡å®šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç²¾å‡†è®¾ç½®è®¿é—®åœ°å€ /user/login</span></span><br><span class="line"><span class="comment">     * method = RequestMethod.POST å¯ä»¥æŒ‡å®šå•ä¸ªæˆ–è€…å¤šä¸ªè¯·æ±‚æ–¹å¼!</span></span><br><span class="line"><span class="comment">     * æ³¨æ„:è¿èƒŒè¯·æ±‚æ–¹å¼ä¼šå‡ºç°405å¼‚å¸¸!</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &#123;&quot;/user/login&quot;&#125; , method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserController.login&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login success!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç²¾å‡†è®¾ç½®è®¿é—®åœ°å€ /user/register</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &#123;&quot;/user/register&quot;&#125;,method = &#123;RequestMethod.POST,RequestMethod.GET&#125;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">register</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserController.register&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;register success!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè¿èƒŒè¯·æ±‚æ–¹å¼ï¼Œä¼šå‡ºç°405å¼‚å¸¸ï¼ï¼ï¼</p></li><li><p><strong>è¿›é˜¶æ³¨è§£</strong></p><p>è¿˜æœ‰ <code>@RequestMapping</code> çš„ HTTP æ–¹æ³•ç‰¹å®šå¿«æ·æ–¹å¼å˜ä½“ï¼š</p><ul><li><code>@GetMapping</code></li><li><code>@PostMapping</code></li><li><code>@PutMapping</code></li><li><code>@DeleteMapping</code></li><li><code>@PatchMapping</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value=&quot;/login&quot;,method=RequestMethod.GET)</span></span><br><span class="line">||</span><br><span class="line"><span class="meta">@GetMapping(value=&quot;/login&quot;)</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè¿›é˜¶æ³¨è§£åªèƒ½æ·»åŠ åˆ°handleræ–¹æ³•ä¸Šï¼Œæ— æ³•æ·»åŠ åˆ°ç±»ä¸Šï¼</p></li><li><p><strong>å¸¸è§é…ç½®é—®é¢˜</strong></p><p>å‡ºç°åŸå› ï¼šå¤šä¸ª handler æ–¹æ³•æ˜ å°„äº†åŒä¸€ä¸ªåœ°å€ï¼Œå¯¼è‡´ SpringMVC åœ¨æ¥æ”¶åˆ°è¿™ä¸ªåœ°å€çš„è¯·æ±‚æ—¶è¯¥æ‰¾å“ªä¸ª handler æ–¹æ³•å¤„ç†ã€‚</p><blockquote><p>There is already â€˜demo03MappingMethodHandlerâ€™ bean method com.atguigu.mvc.handler.Demo03MappingMethodHandler#empGet() <strong>mapped</strong>.</p></blockquote></li></ol><h3 id="2-2-æ¥æ”¶å‚æ•°ï¼ˆé‡ç‚¹ï¼‰"><a href="#2-2-æ¥æ”¶å‚æ•°ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="2.2 æ¥æ”¶å‚æ•°ï¼ˆé‡ç‚¹ï¼‰"></a>2.2 æ¥æ”¶å‚æ•°ï¼ˆé‡ç‚¹ï¼‰</h3><h4 id="2-2-1-param-å’Œ-jsonå‚æ•°æ¯”è¾ƒ"><a href="#2-2-1-param-å’Œ-jsonå‚æ•°æ¯”è¾ƒ" class="headerlink" title="2.2.1 param å’Œ jsonå‚æ•°æ¯”è¾ƒ"></a>2.2.1 param å’Œ jsonå‚æ•°æ¯”è¾ƒ</h4><p>åœ¨ HTTP è¯·æ±‚ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸åŒçš„å‚æ•°ç±»å‹ï¼Œå¦‚ param ç±»å‹å’Œ JSON ç±»å‹ã€‚ä¸‹é¢å¯¹è¿™ä¸¤ç§å‚æ•°ç±»å‹è¿›è¡ŒåŒºåˆ«å’Œå¯¹æ¯”ï¼š</p><ol><li><p>å‚æ•°ç¼–ç ï¼š &#x20;</p><p>param ç±»å‹çš„å‚æ•°ä¼šè¢«ç¼–ç ä¸º ASCII ç ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ <code>name=john doe</code>ï¼Œåˆ™ä¼šè¢«ç¼–ç ä¸º <code>name=john%20doe</code>ã€‚è€Œ JSON ç±»å‹çš„å‚æ•°ä¼šè¢«ç¼–ç ä¸º UTF-8ã€‚</p></li><li><p>å‚æ•°é¡ºåºï¼š &#x20;</p><p>param ç±»å‹çš„å‚æ•°æ²¡æœ‰é¡ºåºé™åˆ¶ã€‚ä½†æ˜¯ï¼ŒJSON ç±»å‹çš„å‚æ•°æ˜¯æœ‰åºçš„ã€‚JSON é‡‡ç”¨é”®å€¼å¯¹çš„å½¢å¼è¿›è¡Œä¼ é€’ï¼Œå…¶ä¸­é”®å€¼å¯¹æ˜¯æœ‰åºæ’åˆ—çš„ã€‚</p></li><li><p>æ•°æ®ç±»å‹ï¼š &#x20;</p><p>param ç±»å‹çš„å‚æ•°ä»…æ”¯æŒå­—ç¬¦ä¸²ç±»å‹ã€æ•°å€¼ç±»å‹å’Œå¸ƒå°”ç±»å‹ç­‰ç®€å•æ•°æ®ç±»å‹ã€‚è€Œ JSON ç±»å‹çš„å‚æ•°åˆ™æ”¯æŒæ›´å¤æ‚çš„æ•°æ®ç±»å‹ï¼Œå¦‚æ•°ç»„ã€å¯¹è±¡ç­‰ã€‚</p></li><li><p>åµŒå¥—æ€§ï¼š &#x20;</p><p>param ç±»å‹çš„å‚æ•°ä¸æ”¯æŒåµŒå¥—ã€‚ä½†æ˜¯ï¼ŒJSON ç±»å‹çš„å‚æ•°æ”¯æŒåµŒå¥—ï¼Œå¯ä»¥ä¼ é€’æ›´ä¸ºå¤æ‚çš„æ•°æ®ç»“æ„ã€‚</p></li><li><p>å¯è¯»æ€§ï¼š &#x20;</p><p>param ç±»å‹çš„å‚æ•°æ ¼å¼æ¯” JSON ç±»å‹çš„å‚æ•°æ›´åŠ ç®€å•ã€æ˜“è¯»ã€‚ä½†æ˜¯ï¼ŒJSON æ ¼å¼åœ¨ä¼ é€’åµŒå¥—æ•°æ®ç»“æ„æ—¶æ›´åŠ æ¸…æ™°æ˜“æ‡‚ã€‚</p></li></ol><p>æ€»çš„æ¥è¯´ï¼Œparam ç±»å‹çš„å‚æ•°é€‚ç”¨äºå•ä¸€çš„æ•°æ®ä¼ é€’ï¼Œè€Œ JSON ç±»å‹çš„å‚æ•°åˆ™æ›´é€‚ç”¨äºæ›´å¤æ‚çš„æ•°æ®ç»“æ„ä¼ é€’ã€‚æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚ï¼Œéœ€è¦é€‰æ‹©åˆé€‚çš„å‚æ•°ç±»å‹ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¸¸è§çš„åšæ³•æ˜¯ï¼šåœ¨ GET è¯·æ±‚ä¸­é‡‡ç”¨ param ç±»å‹çš„å‚æ•°ï¼Œè€Œåœ¨ POST è¯·æ±‚ä¸­é‡‡ç”¨ JSON ç±»å‹çš„å‚æ•°ä¼ é€’ã€‚</p><p><img src="/../../../ProTool/img/img1/202310150100732.png" alt="image-20231007134256617"></p><h4 id="2-2-2-paramå‚æ•°æ¥æ”¶"><a href="#2-2-2-paramå‚æ•°æ¥æ”¶" class="headerlink" title="2.2.2 paramå‚æ•°æ¥æ”¶"></a>2.2.2 paramå‚æ•°æ¥æ”¶</h4><ol><li><p><strong>ç›´æ¥æ¥å€¼</strong></p><p>å®¢æˆ·ç«¯è¯·æ±‚</p><p><img src="/../../../ProTool/img/img1/image_3SOeT8tvvW.png"></p><p><strong>handleræ¥æ”¶å‚æ•°</strong></p><p>åªè¦å½¢å‚æ•°åå’Œç±»å‹ä¸ä¼ é€’å‚æ•°ç›¸åŒï¼Œå³å¯è‡ªåŠ¨æ¥æ”¶!</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;param&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParamController</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‰ç«¯è¯·æ±‚: http://localhost:8080/param/value?name=xx&amp;age=18</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * å¯ä»¥åˆ©ç”¨å½¢å‚åˆ—è¡¨,ç›´æ¥æ¥æ”¶å‰ç«¯ä¼ é€’çš„paramå‚æ•°!</span></span><br><span class="line"><span class="comment">     *    è¦æ±‚: å‚æ•°å = å½¢å‚å</span></span><br><span class="line"><span class="comment">     *          ç±»å‹ç›¸åŒ</span></span><br><span class="line"><span class="comment">     * å‡ºç°ä¹±ç æ­£å¸¸ï¼Œjsonæ¥æ”¶å…·ä½“è§£å†³ï¼ï¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿”å›å‰ç«¯æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(value=&quot;/value&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">setupForm</span><span class="params">(String name,<span class="type">int</span> age)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;name = &quot;</span> + name + <span class="string">&quot;, age = &quot;</span> + age);</span><br><span class="line">        <span class="keyword">return</span> name + age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>@RequestParamæ³¨è§£</strong></p><p>å¯ä»¥ä½¿ç”¨ <code>@RequestParam</code> æ³¨é‡Šå°† Servlet è¯·æ±‚å‚æ•°ï¼ˆå³æŸ¥è¯¢å‚æ•°æˆ–è¡¨å•æ•°æ®ï¼‰ç»‘å®šåˆ°æ§åˆ¶å™¨ä¸­çš„æ–¹æ³•å‚æ•°ã€‚</p><p><code>@RequestParam</code>ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>æŒ‡å®šç»‘å®šçš„è¯·æ±‚å‚æ•°å</li><li>è¦æ±‚è¯·æ±‚å‚æ•°å¿…é¡»ä¼ é€’</li><li>ä¸ºè¯·æ±‚å‚æ•°æä¾›é»˜è®¤å€¼<br>åŸºæœ¬ç”¨æ³•ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‰ç«¯è¯·æ±‚: http://localhost:8080/param/data?name=xx&amp;stuAge=18</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  ä½¿ç”¨<span class="doctag">@RequestParam</span>æ³¨è§£æ ‡è®°handleræ–¹æ³•çš„å½¢å‚</span></span><br><span class="line"><span class="comment"> *  æŒ‡å®šå½¢å‚å¯¹åº”çš„è¯·æ±‚å‚æ•°<span class="doctag">@RequestParam</span>(è¯·æ±‚å‚æ•°åç§°)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(value=&quot;/data&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">paramForm</span><span class="params">(<span class="meta">@RequestParam(&quot;name&quot;)</span> String name, </span></span><br><span class="line"><span class="params">                        <span class="meta">@RequestParam(&quot;stuAge&quot;)</span> <span class="type">int</span> age)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;name = &quot;</span> + name + <span class="string">&quot;, age = &quot;</span> + age);</span><br><span class="line">    <span class="keyword">return</span> name+age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ­¤æ‰¹æ³¨çš„æ–¹æ³•å‚æ•°æ˜¯å¿…éœ€çš„ï¼Œä½†æ‚¨å¯ä»¥é€šè¿‡å°† <code>@RequestParam</code> æ‰¹æ³¨çš„ <code>required</code> æ ‡å¿—è®¾ç½®ä¸º <code>false</code>ï¼</p><p>å¦‚æœæ²¡æœ‰æ²¡æœ‰è®¾ç½®éå¿…é¡»ï¼Œä¹Ÿæ²¡æœ‰ä¼ é€’å‚æ•°ä¼šå‡ºç°ï¼š</p><p><img src="/../../../ProTool/img/img1/image_vIkYCRMSZL.png"></p><p>å°†å‚æ•°è®¾ç½®éå¿…é¡»ï¼Œå¹¶ä¸”è®¾ç½®é»˜è®¤å€¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value=&quot;/data&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">paramForm</span><span class="params">(<span class="meta">@RequestParam(&quot;name&quot;)</span> String name, </span></span><br><span class="line"><span class="params">                        <span class="meta">@RequestParam(value = &quot;stuAge&quot;,required = false,defaultValue = &quot;18&quot;)</span> <span class="type">int</span> age)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;name = &quot;</span> + name + <span class="string">&quot;, age = &quot;</span> + age);</span><br><span class="line">    <span class="keyword">return</span> name+age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><strong>ç‰¹æ®Šåœºæ™¯æ¥å€¼</strong></p><ol><li><p>ä¸€åå¤šå€¼</p><p>å¤šé€‰æ¡†ï¼Œæäº¤çš„æ•°æ®çš„æ—¶å€™ä¸€ä¸ªkeyå¯¹åº”å¤šä¸ªå€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é›†åˆè¿›è¡Œæ¥æ”¶ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‰ç«¯è¯·æ±‚: http://localhost:8080/param/mul?hbs=åƒ&amp;hbs=å–</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  ä¸€åå¤šå€¼,å¯ä»¥ä½¿ç”¨é›†åˆæ¥æ”¶å³å¯!ä½†æ˜¯éœ€è¦ä½¿ç”¨<span class="doctag">@RequestParam</span>æ³¨è§£æŒ‡å®š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(value=&quot;/mul&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">mulForm</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;String&gt; hbs)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;hbs = &quot;</span> + hbs);</span><br><span class="line">    <span class="keyword">return</span> hbs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å®ä½“æ¥æ”¶</p><p>Spring MVC æ˜¯ Spring æ¡†æ¶æä¾›çš„ Web æ¡†æ¶ï¼Œå®ƒå…è®¸å¼€å‘è€…ä½¿ç”¨å®ä½“å¯¹è±¡æ¥æ¥æ”¶ HTTP è¯·æ±‚ä¸­çš„å‚æ•°ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥åœ¨æ–¹æ³•å†…éƒ¨ç›´æ¥ä½¿ç”¨å¯¹è±¡çš„å±æ€§æ¥è®¿é—®è¯·æ±‚å‚æ•°ï¼Œè€Œä¸éœ€è¦æ¯ä¸ªå‚æ•°éƒ½å†™ä¸€éã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨å®ä½“å¯¹è±¡æ¥æ”¶å‚æ•°çš„ç¤ºä¾‹ï¼š</p><p>å®šä¹‰ä¸€ä¸ªç”¨äºæ¥æ”¶å‚æ•°çš„å®ä½“ç±»ï¼š</p><p>ä½œç”¨<br>    ä½œç”¨ï¼šå°†æ–¹æ³•çš„è¿”å›å€¼ï¼Œä»¥ç‰¹å®šçš„æ ¼å¼å†™å…¥åˆ°responseçš„bodyåŒºåŸŸï¼Œè¿›è€Œå°†æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚<br><br>    å½“æ–¹æ³•ä¸Šé¢æ²¡æœ‰å†™ResponseBody,åº•å±‚ä¼šå°†æ–¹æ³•çš„è¿”å›å€¼å°è£…ä¸ºModelAndViewå¯¹è±¡ã€‚<br><br>    å¦‚æœè¿”å›å€¼æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆç›´æ¥å°†å­—ç¬¦ä¸²å†™åˆ°å®¢æˆ·ç«¯ï¼›å¦‚æœæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¼šå°†å¯¹è±¡è½¬åŒ–ä¸ºjsonä¸²ï¼Œç„¶åå†™åˆ°å®¢æˆ·ç«¯ã€‚</p><hr><p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œæ˜¥é£åŒ–ä½œç§‹é›¨ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/jiahao1186/article/details/91980316">https://blog.csdn.net/jiahao1186/article/details/91980316</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// getter å’Œ setter ç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ§åˆ¶å™¨ä¸­ï¼Œä½¿ç”¨å®ä½“å¯¹è±¡æ¥æ”¶ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;param&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParamController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/user&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">addUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">// åœ¨è¿™é‡Œå¯ä»¥ä½¿ç”¨ user å¯¹è±¡çš„å±æ€§æ¥æ¥æ”¶è¯·æ±‚å‚æ•°</span></span><br><span class="line">        System.out.println(<span class="string">&quot;user = &quot;</span> + user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå°†è¯·æ±‚å‚æ•°nameå’Œageæ˜ å°„åˆ°å®ä½“ç±»å±æ€§ä¸Šï¼è¦æ±‚å±æ€§åå¿…é¡»ç­‰äºå‚æ•°åï¼å¦åˆ™æ— æ³•æ˜ å°„ï¼</p><p>ä½¿ç”¨postmanä¼ é€’å‚æ•°æµ‹è¯•ï¼š</p><p><img src="/../../../ProTool/img/img1/image_5BkbhZjtyX.png"></p></li></ol></li></ol><h4 id="2-2-3-è·¯å¾„-å‚æ•°æ¥æ”¶"><a href="#2-2-3-è·¯å¾„-å‚æ•°æ¥æ”¶" class="headerlink" title="2.2.3 è·¯å¾„ å‚æ•°æ¥æ”¶"></a>2.2.3 è·¯å¾„ å‚æ•°æ¥æ”¶</h4><p><img src="/../../../ProTool/img/img1/image-20231013232602723.png" alt="image-20231013232602723"></p><p>è·¯å¾„ä¼ é€’å‚æ•°æ˜¯ä¸€ç§åœ¨ URL è·¯å¾„ä¸­ä¼ é€’å‚æ•°çš„æ–¹å¼ã€‚åœ¨ RESTful çš„ Web åº”ç”¨ç¨‹åºä¸­ï¼Œç»å¸¸ä½¿ç”¨è·¯å¾„ä¼ é€’å‚æ•°æ¥è¡¨ç¤ºèµ„æºçš„å”¯ä¸€æ ‡è¯†ç¬¦æˆ–æ›´å¤æ‚çš„è¡¨ç¤ºæ–¹å¼ã€‚è€Œ Spring MVC æ¡†æ¶æä¾›äº† <strong><code>@PathVariable</code> æ³¨è§£æ¥å¤„ç†è·¯å¾„ä¼ é€’å‚æ•°ã€‚</strong></p><p><code>@PathVariable</code> æ³¨è§£å…è®¸å°† URL ä¸­çš„å ä½ç¬¦æ˜ å°„åˆ°æ§åˆ¶å™¨æ–¹æ³•ä¸­çš„å‚æ•°ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å°† <code>/user/&#123;id&#125;</code> è·¯å¾„ä¸‹çš„ <code>&#123;id&#125;</code> æ˜ å°„åˆ°æ§åˆ¶å™¨æ–¹æ³•çš„ä¸€ä¸ªå‚æ•°ä¸­ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>@PathVariable</code> æ³¨è§£æ¥å®ç°ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>@PathVariable</code> æ³¨è§£å¤„ç†è·¯å¾„ä¼ é€’å‚æ•°çš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ¨æ€è·¯å¾„è®¾è®¡: /user/&#123;åŠ¨æ€éƒ¨åˆ†&#125;/&#123;åŠ¨æ€éƒ¨åˆ†&#125;   åŠ¨æ€éƒ¨åˆ†ä½¿ç”¨&#123;&#125;åŒ…å«å³å¯! &#123;&#125;å†…éƒ¨åŠ¨æ€æ ‡è¯†!</span></span><br><span class="line"><span class="comment"> * å½¢å‚åˆ—è¡¨å–å€¼: <span class="doctag">@PathVariable</span> Long id  å¦‚æœå½¢å‚å = &#123;åŠ¨æ€æ ‡è¯†&#125; è‡ªåŠ¨èµ‹å€¼!</span></span><br><span class="line"><span class="comment"> *              <span class="doctag">@PathVariable</span>(&quot;åŠ¨æ€æ ‡è¯†&quot;) Long id  å¦‚æœå½¢å‚å != &#123;åŠ¨æ€æ ‡è¯†&#125; å¯ä»¥é€šè¿‡æŒ‡å®šåŠ¨æ€æ ‡è¯†èµ‹å€¼!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è®¿é—®æµ‹è¯•:  /param/user/1/root  -&gt; id = 1  uname = root</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/user/&#123;id&#125;/&#123;name&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id, </span></span><br><span class="line"><span class="params">                      <span class="meta">@PathVariable(&quot;name&quot;)</span> String uname)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;id = &quot;</span> + id + <span class="string">&quot;, uname = &quot;</span> + uname);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;user_detail&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-2-4-jsonå‚æ•°æ¥æ”¶"><a href="#2-2-4-jsonå‚æ•°æ¥æ”¶" class="headerlink" title="2.2.4 jsonå‚æ•°æ¥æ”¶"></a>2.2.4 jsonå‚æ•°æ¥æ”¶</h4><p>å‰ç«¯ä¼ é€’ JSON æ•°æ®æ—¶ï¼ŒSpring MVC æ¡†æ¶å¯ä»¥ä½¿ç”¨ <code>@RequestBody</code> æ³¨è§£æ¥å°† JSON æ•°æ®è½¬æ¢ä¸º Java å¯¹è±¡ã€‚<code>@RequestBody</code> æ³¨è§£è¡¨ç¤ºå½“å‰æ–¹æ³•å‚æ•°çš„å€¼åº”è¯¥ä»è¯·æ±‚ä½“ä¸­è·å–ï¼Œå¹¶ä¸”éœ€è¦æŒ‡å®š value å±æ€§æ¥æŒ‡ç¤ºè¯·æ±‚ä½“åº”è¯¥æ˜ å°„åˆ°å“ªä¸ªå‚æ•°ä¸Šã€‚å…¶ä½¿ç”¨æ–¹å¼å’Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><ol><li><p>å‰ç«¯å‘é€ JSON æ•°æ®çš„ç¤ºä¾‹ï¼šï¼ˆä½¿ç”¨postmanæµ‹è¯•ï¼‰</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¼ ä¸‰&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ç”·&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>å®šä¹‰ä¸€ä¸ªç”¨äºæ¥æ”¶ JSON æ•°æ®çš„ Java ç±»ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">  <span class="keyword">private</span> String gender;</span><br><span class="line">  <span class="comment">// getter å’Œ setter ç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åœ¨æ§åˆ¶å™¨ä¸­ï¼Œä½¿ç”¨ <code>@RequestBody</code> æ³¨è§£æ¥æ¥æ”¶ JSON æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º Java å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/person&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">addPerson</span><span class="params">(<span class="meta">@RequestBody</span> Person person)</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨è¿™é‡Œå¯ä»¥ä½¿ç”¨ person å¯¹è±¡æ¥æ“ä½œ JSON æ•°æ®ä¸­åŒ…å«çš„å±æ€§</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>@RequestBody</code> æ³¨è§£å°†è¯·æ±‚ä½“ä¸­çš„ JSON æ•°æ®æ˜ å°„åˆ° <code>Person</code> ç±»å‹çš„ <code>person</code> å‚æ•°ä¸Šï¼Œå¹¶å°†å…¶ä½œä¸ºä¸€ä¸ªå¯¹è±¡æ¥ä¼ é€’ç»™ <code>addPerson()</code> æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p><p><img src="/../../../ProTool/img/img1/image-20231013233612291.png" alt="image-20231013233612291"></p></li><li><p>å®Œå–„é…ç½®</p><p>æµ‹è¯•ï¼š</p><p><img src="/../../../ProTool/img/img1/image_-vKMBKKMSZ.png"></p><p>é—®é¢˜ï¼š</p><p>org.springframework.web.HttpMediaTypeNotSupportedException: Content-Type â€˜application&#x2F;json;charset&#x3D;UTF-8â€™ is not supported]</p><p><img src="/../../../ProTool/img/img1/202310150101981.png"></p><p>åŸå› ï¼š</p><ul><li>ä¸æ”¯æŒjsonæ•°æ®ç±»å‹å¤„ç†</li><li>æ²¡æœ‰jsonç±»å‹å¤„ç†çš„å·¥å…·ï¼ˆjacksonï¼‰<br>è§£å†³ï¼š<br>springmvc handlerAdpateré…ç½®jsonè½¬åŒ–å™¨,é…ç½®ç±»éœ€è¦æ˜ç¡®ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//<span class="doctag">TODO:</span> SpringMVCå¯¹åº”ç»„ä»¶çš„é…ç½®ç±» [å£°æ˜SpringMVCéœ€è¦çš„ç»„ä»¶ä¿¡æ¯]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span> å¯¼å…¥handlerMappingå’ŒhandlerAdapterçš„ä¸‰ç§æ–¹å¼</span></span><br><span class="line"> <span class="comment">//1.è‡ªåŠ¨å¯¼å…¥handlerMappingå’ŒhandlerAdapter [æ¨è]</span></span><br><span class="line"> <span class="comment">//2.å¯ä»¥ä¸æ·»åŠ ,springmvcä¼šæ£€æŸ¥æ˜¯å¦é…ç½®handlerMappingå’ŒhandlerAdapter,æ²¡æœ‰é…ç½®é»˜è®¤åŠ è½½</span></span><br><span class="line"> <span class="comment">//3.ä½¿ç”¨@Beanæ–¹å¼é…ç½®handlerMapperå’ŒhandlerAdapter</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span>  <span class="comment">//jsonæ•°æ®å¤„ç†,å¿…é¡»ä½¿ç”¨æ­¤æ³¨è§£,å› ä¸ºä»–ä¼šåŠ å…¥jsonå¤„ç†å™¨</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.atguigu.controller&quot;)</span> <span class="comment">//<span class="doctag">TODO:</span> è¿›è¡Œcontrolleræ‰«æ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//WebMvcConfigurer springMvcè¿›è¡Œç»„ä»¶é…ç½®çš„è§„èŒƒ,é…ç½®ç»„ä»¶,æä¾›å„ç§æ–¹æ³•! å‰æœŸå¯ä»¥å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br></pre></td></tr></table></figure><p> }<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pom.xml åŠ å…¥jacksonä¾èµ–</span><br><span class="line">```xml</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.15.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p></li><li><p><strong>@EnableWebMvcæ³¨è§£è¯´æ˜</strong></p><p>@EnableWebMvcæ³¨è§£æ•ˆæœç­‰åŒäºåœ¨ XML é…ç½®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>&lt;mvc:annotation-driven&gt;</code> å…ƒç´ ï¼æˆ‘ä»¬æ¥è§£æ<code>&lt;mvc:annotation-driven&gt;</code>å¯¹åº”çš„è§£æå·¥ä½œï¼</p><p>è®©æˆ‘ä»¬æ¥æŸ¥çœ‹ä¸‹<code>&lt;mvc:annotation-driven&gt;</code>å…·ä½“çš„åŠ¨ä½œï¼</p><ul><li><p>å…ˆæŸ¥çœ‹<code>&lt;mvc:annotation-driven&gt;</code>æ ‡ç­¾æœ€ç»ˆå¯¹åº”è§£æçš„Javaç±»</p><p><img src="/../../../ProTool/img/img1/image_WJXPabVDSl.png"></p></li><li><p>æŸ¥çœ‹è§£æç±»ä¸­å…·ä½“çš„åŠ¨ä½œå³å¯</p><p>æ‰“å¼€æºç ï¼šorg.springframework.web.servlet.config.MvcNamespaceHandler</p><p><img src="/../../../ProTool/img/img1/image_37KWhccu6c.png"></p><p>æ‰“å¼€æºç ï¼šorg.springframework.web.servlet.config.AnnotationDrivenBeanDefinitionParser</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AnnotationDrivenBeanDefinitionParser</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionParser</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">HANDLER_MAPPING_BEAN_NAME</span> <span class="operator">=</span> RequestMappingHandlerMapping.class.getName();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">HANDLER_ADAPTER_BEAN_NAME</span> <span class="operator">=</span> RequestMappingHandlerAdapter.class.getName();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> AnnotationDrivenBeanDefinitionParser.class.getClassLoader();</span><br><span class="line">    javaxValidationPresent = ClassUtils.isPresent(<span class="string">&quot;jakarta.validation.Validator&quot;</span>, classLoader);</span><br><span class="line">    romePresent = ClassUtils.isPresent(<span class="string">&quot;com.rometools.rome.feed.WireFeed&quot;</span>, classLoader);</span><br><span class="line">    jaxb2Present = ClassUtils.isPresent(<span class="string">&quot;jakarta.xml.bind.Binder&quot;</span>, classLoader);</span><br><span class="line">    jackson2Present = ClassUtils.isPresent(<span class="string">&quot;com.fasterxml.jackson.databind.ObjectMapper&quot;</span>, classLoader) &amp;&amp;</span><br><span class="line">            ClassUtils.isPresent(<span class="string">&quot;com.fasterxml.jackson.core.JsonGenerator&quot;</span>, classLoader);</span><br><span class="line">    jackson2XmlPresent = ClassUtils.isPresent(<span class="string">&quot;com.fasterxml.jackson.dataformat.xml.XmlMapper&quot;</span>, classLoader);</span><br><span class="line">    jackson2SmilePresent = ClassUtils.isPresent(<span class="string">&quot;com.fasterxml.jackson.dataformat.smile.SmileFactory&quot;</span>, classLoader);</span><br><span class="line">    jackson2CborPresent = ClassUtils.isPresent(<span class="string">&quot;com.fasterxml.jackson.dataformat.cbor.CBORFactory&quot;</span>, classLoader);</span><br><span class="line">    gsonPresent = ClassUtils.isPresent(<span class="string">&quot;com.google.gson.Gson&quot;</span>, classLoader);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><pre><code> @Override @Nullable public BeanDefinition parse(Element element, ParserContext context) &#123;   //handlerMappingåŠ å…¥åˆ°iocå®¹å™¨   readerContext.getRegistry().registerBeanDefinition(HANDLER_MAPPING_BEAN_NAME, handlerMappingDef);   //æ·»åŠ jacksonè½¬åŒ–å™¨   addRequestBodyAdvice(handlerAdapterDef);   addResponseBodyAdvice(handlerAdapterDef);   //handlerAdapteråŠ å…¥åˆ°iocå®¹å™¨   readerContext.getRegistry().registerBeanDefinition(HANDLER_ADAPTER_BEAN_NAME, handlerAdapterDef);   return null; &#125; //å…·ä½“æ·»åŠ jacksonè½¬åŒ–å¯¹è±¡æ–¹æ³• protected void addRequestBodyAdvice(RootBeanDefinition beanDef) &#123;   if (jackson2Present) &#123;     beanDef.getPropertyValues().add(&quot;requestBodyAdvice&quot;,         new RootBeanDefinition(JsonViewRequestBodyAdvice.class));   &#125; &#125; protected void addResponseBodyAdvice(RootBeanDefinition beanDef) &#123;   if (jackson2Present) &#123;     beanDef.getPropertyValues().add(&quot;responseBodyAdvice&quot;,         new RootBeanDefinition(JsonViewResponseBodyAdvice.class));   &#125; &#125;</code></pre>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 2.3 æ¥æ”¶Cookieæ•°æ®</span><br><span class="line"></span><br><span class="line">å¯ä»¥ä½¿ç”¨ `@CookieValue` æ³¨é‡Šå°† HTTP Cookie çš„å€¼ç»‘å®šåˆ°æ§åˆ¶å™¨ä¸­çš„æ–¹æ³•å‚æ•°ã€‚</span><br><span class="line"></span><br><span class="line">è€ƒè™‘ä½¿ç”¨ä»¥ä¸‹ cookie çš„è¯·æ±‚ï¼š</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">JSESSIONID=415A4AC178C59DACE0B2C9CA727CDD84</span><br></pre></td></tr></table></figure></li></ul></li></ol><p>ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•è·å– cookie å€¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/demo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(<span class="meta">@CookieValue(&quot;JSESSIONID&quot;)</span> String cookie)</span> &#123; </span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-4-æ¥æ”¶è¯·æ±‚å¤´æ•°æ®"><a href="#2-4-æ¥æ”¶è¯·æ±‚å¤´æ•°æ®" class="headerlink" title="2.4 æ¥æ”¶è¯·æ±‚å¤´æ•°æ®"></a>2.4 æ¥æ”¶è¯·æ±‚å¤´æ•°æ®</h3><p>å¯ä»¥ä½¿ç”¨ <code>@RequestHeader</code> æ‰¹æ³¨å°†è¯·æ±‚æ ‡å¤´ç»‘å®šåˆ°æ§åˆ¶å™¨ä¸­çš„æ–¹æ³•å‚æ•°ã€‚</p><p>è¯·è€ƒè™‘ä»¥ä¸‹å¸¦æœ‰æ ‡å¤´çš„è¯·æ±‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Host                    localhost:<span class="number">8080</span></span><br><span class="line">Accept                  text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span></span><br><span class="line">Accept-Language         fr,en-gb;q=<span class="number">0.7</span>,en;q=<span class="number">0.3</span></span><br><span class="line">Accept-Encoding         gzip,deflate</span><br><span class="line">Accept-Charset          ISO-<span class="number">8859</span>-<span class="number">1</span>,utf-<span class="number">8</span>;q=<span class="number">0.7</span>,*;q=<span class="number">0.7</span></span><br><span class="line">Keep-Alive              <span class="number">300</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„ç¤ºä¾‹è·å– <code>Accept-Encoding</code> å’Œ <code>Keep-Alive</code> æ ‡å¤´çš„å€¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/demo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@RequestHeader(&quot;Accept-Encoding&quot;)</span> String encoding, </span></span><br><span class="line"><span class="params">    <span class="meta">@RequestHeader(&quot;Keep-Alive&quot;)</span> <span class="type">long</span> keepAlive)</span> &#123; </span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-5-åŸç”ŸApiå¯¹è±¡æ“ä½œ"><a href="#2-5-åŸç”ŸApiå¯¹è±¡æ“ä½œ" class="headerlink" title="2.5 åŸç”ŸApiå¯¹è±¡æ“ä½œ"></a>2.5 åŸç”ŸApiå¯¹è±¡æ“ä½œ</h3><p><img src="/../../../ProTool/img/img1/image-20231014000823019.png" alt="image-20231014000823019"></p><p><a href="https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-controller/ann-methods/arguments.html">https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-controller/ann-methods/arguments.html</a></p><p>ä¸‹è¡¨æè¿°äº†æ”¯æŒçš„æ§åˆ¶å™¨æ–¹æ³•å‚æ•°</p><table><thead><tr><th>Controller method argument æ§åˆ¶å™¨æ–¹æ³•å‚æ•°</th><th>Description</th></tr></thead><tbody><tr><td><code>jakarta.servlet.ServletRequest</code>, <code>jakarta.servlet.ServletResponse</code></td><td>è¯·æ±‚&#x2F;å“åº”å¯¹è±¡</td></tr><tr><td><code>jakarta.servlet.http.HttpSession</code></td><td>å¼ºåˆ¶å­˜åœ¨ä¼šè¯ã€‚å› æ­¤ï¼Œè¿™æ ·çš„å‚æ•°æ°¸è¿œä¸ä¼šä¸º <code>null</code> ã€‚</td></tr><tr><td><code>java.io.InputStream</code>, <code>java.io.Reader</code></td><td>ç”¨äºè®¿é—®ç”± Servlet API å…¬å¼€çš„åŸå§‹è¯·æ±‚æ­£æ–‡ã€‚</td></tr><tr><td><code>java.io.OutputStream</code>, <code>java.io.Writer</code></td><td>ç”¨äºè®¿é—®ç”± Servlet API å…¬å¼€çš„åŸå§‹å“åº”æ­£æ–‡ã€‚</td></tr><tr><td><code>@PathVariable</code></td><td>æ¥æ”¶è·¯å¾„å‚æ•°æ³¨è§£</td></tr><tr><td><code>@RequestParam</code></td><td>ç”¨äºè®¿é—® Servlet è¯·æ±‚å‚æ•°ï¼ŒåŒ…æ‹¬å¤šéƒ¨åˆ†æ–‡ä»¶ã€‚å‚æ•°å€¼å°†è½¬æ¢ä¸ºå£°æ˜çš„æ–¹æ³•å‚æ•°ç±»å‹ã€‚</td></tr><tr><td><code>@RequestHeader</code></td><td>ç”¨äºè®¿é—®è¯·æ±‚æ ‡å¤´ã€‚æ ‡å¤´å€¼å°†è½¬æ¢ä¸ºå£°æ˜çš„æ–¹æ³•å‚æ•°ç±»å‹ã€‚</td></tr><tr><td><code>@CookieValue</code></td><td>ç”¨äºè®¿é—®Cookieã€‚Cookie å€¼å°†è½¬æ¢ä¸ºå£°æ˜çš„æ–¹æ³•å‚æ•°ç±»å‹ã€‚</td></tr><tr><td><code>@RequestBody</code></td><td>ç”¨äºè®¿é—® HTTP è¯·æ±‚æ­£æ–‡ã€‚æ­£æ–‡å†…å®¹é€šè¿‡ä½¿ç”¨ <code>HttpMessageConverter</code> å®ç°è½¬æ¢ä¸ºå£°æ˜çš„æ–¹æ³•å‚æ•°ç±»å‹ã€‚</td></tr><tr><td><code>java.util.Map</code>, <code>org.springframework.ui.Model</code>, <code>org.springframework.ui.ModelMap</code></td><td>å…±äº«åŸŸå¯¹è±¡ï¼Œå¹¶åœ¨è§†å›¾å‘ˆç°è¿‡ç¨‹ä¸­å‘æ¨¡æ¿å…¬å¼€ã€‚</td></tr><tr><td><code>Errors</code>, <code>BindingResult</code></td><td>éªŒè¯å’Œæ•°æ®ç»‘å®šä¸­çš„é”™è¯¯ä¿¡æ¯è·å–å¯¹è±¡ï¼</td></tr></tbody></table><p>è·å–åŸç”Ÿå¯¹è±¡ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¦‚æœæƒ³è¦è·å–è¯·æ±‚æˆ–è€…å“åº”å¯¹è±¡,æˆ–è€…ä¼šè¯ç­‰,å¯ä»¥ç›´æ¥åœ¨å½¢å‚åˆ—è¡¨ä¼ å…¥,å¹¶ä¸”ä¸åˆ†å…ˆåé¡ºåº!</span></span><br><span class="line"><span class="comment"> * æ³¨æ„: æ¥æ”¶åŸç”Ÿå¯¹è±¡,å¹¶ä¸å½±å“å‚æ•°æ¥æ”¶!</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;api&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">api</span><span class="params">(HttpSession session , HttpServletRequest request,</span></span><br><span class="line"><span class="params">                  HttpServletResponse response)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">    System.out.println(<span class="string">&quot;method = &quot;</span> + method);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;api&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-6-å…±äº«åŸŸå¯¹è±¡æ“ä½œ"><a href="#2-6-å…±äº«åŸŸå¯¹è±¡æ“ä½œ" class="headerlink" title="2.6 å…±äº«åŸŸå¯¹è±¡æ“ä½œ"></a>2.6 å…±äº«åŸŸå¯¹è±¡æ“ä½œ</h3><h4 id="2-6-1-å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸä½œç”¨å›é¡¾"><a href="#2-6-1-å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸä½œç”¨å›é¡¾" class="headerlink" title="2.6.1 å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸä½œç”¨å›é¡¾"></a>2.6.1 å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸä½œç”¨å›é¡¾</h4><p>åœ¨ JavaWeb ä¸­ï¼Œå…±äº«åŸŸæŒ‡çš„æ˜¯åœ¨ Servlet ä¸­å­˜å‚¨æ•°æ®ï¼Œä»¥ä¾¿åœ¨åŒä¸€ Web åº”ç”¨ç¨‹åºçš„å¤šä¸ªç»„ä»¶ä¸­è¿›è¡Œå…±äº«å’Œè®¿é—®ã€‚å¸¸è§çš„å…±äº«åŸŸæœ‰å››ç§ï¼š<code>ServletContext</code>ã€<code>HttpSession</code>ã€<code>HttpServletRequest</code>ã€<code>PageContext</code>ã€‚</p><ol><li><code>ServletContext</code> å…±äº«åŸŸï¼š<code>ServletContext</code> å¯¹è±¡å¯ä»¥åœ¨æ•´ä¸ª Web åº”ç”¨ç¨‹åºä¸­å…±äº«æ•°æ®ï¼Œæ˜¯æœ€å¤§çš„å…±äº«åŸŸã€‚ä¸€èˆ¬å¯ä»¥ç”¨äºä¿å­˜æ•´ä¸ª Web åº”ç”¨ç¨‹åºçš„å…¨å±€é…ç½®ä¿¡æ¯ï¼Œä»¥åŠæ‰€æœ‰ç”¨æˆ·éƒ½å…±äº«çš„æ•°æ®ã€‚åœ¨ <code>ServletContext</code> ä¸­ä¿å­˜çš„æ•°æ®æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li><li><code>HttpSession</code> å…±äº«åŸŸï¼š<code>HttpSession</code> å¯¹è±¡å¯ä»¥åœ¨åŒä¸€ç”¨æˆ·å‘å‡ºçš„å¤šä¸ªè¯·æ±‚ä¹‹é—´å…±äº«æ•°æ®ï¼Œä½†åªèƒ½åœ¨åŒä¸€ä¸ªä¼šè¯ä¸­ä½¿ç”¨ã€‚æ¯”å¦‚ï¼Œå¯ä»¥å°†ç”¨æˆ·ç™»å½•çŠ¶æ€ä¿å­˜åœ¨ <code>HttpSession</code> ä¸­ï¼Œè®©ç”¨æˆ·åœ¨å¤šä¸ªé¡µé¢é—´ä¿æŒç™»å½•çŠ¶æ€ã€‚</li><li><code>HttpServletRequest</code> å…±äº«åŸŸï¼š<code>HttpServletRequest</code> å¯¹è±¡å¯ä»¥åœ¨åŒä¸€ä¸ªè¯·æ±‚çš„å¤šä¸ªå¤„ç†å™¨æ–¹æ³•ä¹‹é—´å…±äº«æ•°æ®ã€‚æ¯”å¦‚ï¼Œå¯ä»¥å°†è¯·æ±‚çš„å‚æ•°å’Œå±æ€§å­˜å‚¨åœ¨ <code>HttpServletRequest</code> ä¸­ï¼Œè®©å¤„ç†å™¨æ–¹æ³•ä¹‹é—´å¯ä»¥è®¿é—®è¿™äº›æ•°æ®ã€‚</li><li><code>PageContext</code> å…±äº«åŸŸï¼š<code>PageContext</code> å¯¹è±¡æ˜¯åœ¨ JSP é¡µé¢Servlet åˆ›å»ºæ—¶è‡ªåŠ¨åˆ›å»ºçš„ã€‚å®ƒå¯ä»¥åœ¨ JSP çš„å„ä¸ªä½œç”¨åŸŸä¸­å…±äº«æ•°æ®ï¼ŒåŒ…æ‹¬<code>pageScope</code>ã€<code>requestScope</code>ã€<code>sessionScope</code>ã€<code>applicationScope</code> ç­‰ä½œç”¨åŸŸã€‚</li></ol><p>å…±äº«åŸŸçš„ä½œç”¨æ˜¯æä¾›äº†æ–¹ä¾¿å®ç”¨çš„æ–¹å¼åœ¨åŒä¸€ Web åº”ç”¨ç¨‹åºçš„å¤šä¸ªç»„ä»¶ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥å°†æ•°æ®ä¿å­˜åœ¨ä¸åŒçš„å…±äº«åŸŸä¸­ï¼Œæ ¹æ®éœ€è¦è¿›è¡Œé€‰æ‹©å’Œä½¿ç”¨ã€‚</p><p><img src="/../../../ProTool/img/img1/img010_VQ5ta0PT96.png"></p><h4 id="2-6-2-Requestçº§åˆ«å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸ"><a href="#2-6-2-Requestçº§åˆ«å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸ" class="headerlink" title="2.6.2 Requestçº§åˆ«å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸ"></a>2.6.2 Requestçº§åˆ«å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸ</h4><ol><li><p>ä½¿ç”¨ Model ç±»å‹çš„å½¢å‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/attr/request/model&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testAttrRequestModel</span><span class="params">(</span></span><br><span class="line"><span class="params">    </span></span><br><span class="line"><span class="params">        // åœ¨å½¢å‚ä½ç½®å£°æ˜Modelç±»å‹å˜é‡ï¼Œç”¨äºå­˜å‚¨æ¨¡å‹æ•°æ®</span></span><br><span class="line"><span class="params">        Model model)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å°†æ•°æ®å­˜å…¥æ¨¡å‹ï¼ŒSpringMVC ä¼šå¸®æˆ‘ä»¬æŠŠæ¨¡å‹æ•°æ®å­˜å…¥è¯·æ±‚åŸŸ</span></span><br><span class="line">    <span class="comment">// å­˜å…¥è¯·æ±‚åŸŸè¿™ä¸ªåŠ¨ä½œä¹Ÿè¢«ç§°ä¸ºæš´éœ²åˆ°è¯·æ±‚åŸŸ</span></span><br><span class="line">    model.addAttribute(<span class="string">&quot;requestScopeMessageModel&quot;</span>,<span class="string">&quot;i am very happy[model]&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;target&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ ModelMap ç±»å‹çš„å½¢å‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/attr/request/model/map&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testAttrRequestModelMap</span><span class="params">(</span></span><br><span class="line"><span class="params">    </span></span><br><span class="line"><span class="params">        // åœ¨å½¢å‚ä½ç½®å£°æ˜ModelMapç±»å‹å˜é‡ï¼Œç”¨äºå­˜å‚¨æ¨¡å‹æ•°æ®</span></span><br><span class="line"><span class="params">        ModelMap modelMap)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å°†æ•°æ®å­˜å…¥æ¨¡å‹ï¼ŒSpringMVC ä¼šå¸®æˆ‘ä»¬æŠŠæ¨¡å‹æ•°æ®å­˜å…¥è¯·æ±‚åŸŸ</span></span><br><span class="line">    <span class="comment">// å­˜å…¥è¯·æ±‚åŸŸè¿™ä¸ªåŠ¨ä½œä¹Ÿè¢«ç§°ä¸ºæš´éœ²åˆ°è¯·æ±‚åŸŸ</span></span><br><span class="line">    modelMap.addAttribute(<span class="string">&quot;requestScopeMessageModelMap&quot;</span>,<span class="string">&quot;i am very happy[model map]&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;target&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ Map ç±»å‹çš„å½¢å‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/attr/request/map&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testAttrRequestMap</span><span class="params">(</span></span><br><span class="line"><span class="params">    </span></span><br><span class="line"><span class="params">        // åœ¨å½¢å‚ä½ç½®å£°æ˜Mapç±»å‹å˜é‡ï¼Œç”¨äºå­˜å‚¨æ¨¡å‹æ•°æ®</span></span><br><span class="line"><span class="params">        Map&lt;String, Object&gt; map)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å°†æ•°æ®å­˜å…¥æ¨¡å‹ï¼ŒSpringMVC ä¼šå¸®æˆ‘ä»¬æŠŠæ¨¡å‹æ•°æ®å­˜å…¥è¯·æ±‚åŸŸ</span></span><br><span class="line">    <span class="comment">// å­˜å…¥è¯·æ±‚åŸŸè¿™ä¸ªåŠ¨ä½œä¹Ÿè¢«ç§°ä¸ºæš´éœ²åˆ°è¯·æ±‚åŸŸ</span></span><br><span class="line">    map.put(<span class="string">&quot;requestScopeMessageMap&quot;</span>, <span class="string">&quot;i am very happy[map]&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;target&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨åŸç”Ÿ request å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/attr/request/original&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testAttrOriginalRequest</span><span class="params">(</span></span><br><span class="line"><span class="params">    </span></span><br><span class="line"><span class="params">        // æ‹¿åˆ°åŸç”Ÿå¯¹è±¡ï¼Œå°±å¯ä»¥è°ƒç”¨åŸç”Ÿæ–¹æ³•æ‰§è¡Œå„ç§æ“ä½œ</span></span><br><span class="line"><span class="params">        HttpServletRequest request)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    request.setAttribute(<span class="string">&quot;requestScopeMessageOriginal&quot;</span>, <span class="string">&quot;i am very happy[original]&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;target&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ ModelAndView å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/attr/request/mav&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">testAttrByModelAndView</span><span class="params">()</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºModelAndViewå¯¹è±¡</span></span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">    <span class="comment">// 2.å­˜å…¥æ¨¡å‹æ•°æ®</span></span><br><span class="line">    modelAndView.addObject(<span class="string">&quot;requestScopeMessageMAV&quot;</span>, <span class="string">&quot;i am very happy[mav]&quot;</span>);</span><br><span class="line">    <span class="comment">// 3.è®¾ç½®è§†å›¾åç§°</span></span><br><span class="line">    modelAndView.setViewName(<span class="string">&quot;target&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="2-6-3-Sessionçº§åˆ«å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸ"><a href="#2-6-3-Sessionçº§åˆ«å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸ" class="headerlink" title="2.6.3 Sessionçº§åˆ«å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸ"></a>2.6.3 Sessionçº§åˆ«å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/attr/session&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testAttrSession</span><span class="params">(HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">//ç›´æ¥å¯¹sessionå¯¹è±¡æ“ä½œ,å³å¯¹ä¼šè¯èŒƒå›´æ“ä½œ!</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;target&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-6-4-Applicationçº§åˆ«å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸ"><a href="#2-6-4-Applicationçº§åˆ«å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸ" class="headerlink" title="2.6.4 Applicationçº§åˆ«å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸ"></a>2.6.4 Applicationçº§åˆ«å±æ€§ï¼ˆå…±äº«ï¼‰åŸŸ</h4><p>è§£é‡Šï¼šspringmvcä¼šåœ¨åˆå§‹åŒ–å®¹å™¨çš„æ—¶å€™ï¼Œè®²servletContextå¯¹è±¡å­˜å‚¨åˆ°iocå®¹å™¨ä¸­ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ServletContext servletContext;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/attr/application&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">attrApplication</span><span class="params">()</span> &#123;</span><br><span class="line">    </span><br><span class="line">    servletContext.setAttribute(<span class="string">&quot;appScopeMsg&quot;</span>, <span class="string">&quot;i am hungry...&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;target&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€SpringMVCå“åº”æ•°æ®"><a href="#ä¸‰ã€SpringMVCå“åº”æ•°æ®" class="headerlink" title="ä¸‰ã€SpringMVCå“åº”æ•°æ®"></a>ä¸‰ã€SpringMVCå“åº”æ•°æ®</h2><h3 id="3-1-handleræ–¹æ³•åˆ†æ"><a href="#3-1-handleræ–¹æ³•åˆ†æ" class="headerlink" title="3.1 handleræ–¹æ³•åˆ†æ"></a>3.1 handleræ–¹æ³•åˆ†æ</h3><p>ç†è§£handleræ–¹æ³•çš„ä½œç”¨å’Œç»„æˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> ä¸€ä¸ªcontrollerçš„æ–¹æ³•æ˜¯æ§åˆ¶å±‚çš„ä¸€ä¸ªå¤„ç†å™¨,æˆ‘ä»¬ç§°ä¸ºhandler</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> handleréœ€è¦ä½¿ç”¨<span class="doctag">@RequestMapping</span>/<span class="doctag">@GetMapping</span>ç³»åˆ—,å£°æ˜è·¯å¾„,åœ¨HandlerMappingä¸­æ³¨å†Œ,ä¾›DSæŸ¥æ‰¾!</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> handlerä½œç”¨æ€»ç»“:</span></span><br><span class="line"><span class="comment"> *       1.æ¥æ”¶è¯·æ±‚å‚æ•°(param,json,pathVariable,å…±äº«åŸŸç­‰) </span></span><br><span class="line"><span class="comment"> *       2.è°ƒç”¨ä¸šåŠ¡é€»è¾‘ </span></span><br><span class="line"><span class="comment"> *       3.å“åº”å‰ç«¯æ•°æ®(é¡µé¢ï¼ˆä¸è®²è§£æ¨¡ç‰ˆé¡µé¢è·³è½¬ï¼‰,json,è½¬å‘å’Œé‡å®šå‘ç­‰)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> handlerå¦‚ä½•å¤„ç†å‘¢</span></span><br><span class="line"><span class="comment"> *       1.æ¥æ”¶å‚æ•°: handler(å½¢å‚åˆ—è¡¨: ä¸»è¦çš„ä½œç”¨å°±æ˜¯ç”¨æ¥æ¥æ”¶å‚æ•°)</span></span><br><span class="line"><span class="comment"> *       2.è°ƒç”¨ä¸šåŠ¡: &#123; æ–¹æ³•ä½“  å¯ä»¥å‘åè°ƒç”¨ä¸šåŠ¡æ–¹æ³• service.xx() &#125;</span></span><br><span class="line"><span class="comment"> *       3.å“åº”æ•°æ®: return è¿”å›ç»“æœ,å¯ä»¥å¿«é€Ÿå“åº”å‰ç«¯æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">handler</span><span class="params">(ç®€åŒ–è¯·æ±‚å‚æ•°æ¥æ”¶)</span>&#123;</span><br><span class="line">    è°ƒç”¨ä¸šåŠ¡æ–¹æ³•</span><br><span class="line">    è¿”å›çš„ç»“æœ ï¼ˆé¡µé¢è·³è½¬ï¼Œè¿”å›æ•°æ®ï¼ˆjsonï¼‰ï¼‰</span><br><span class="line">    <span class="keyword">return</span> ç®€åŒ–å“åº”å‰ç«¯æ•°æ®;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼š è¯·æ±‚æ•°æ®æ¥æ”¶ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡handlerçš„å½¢å‚åˆ—è¡¨</p><p>&#x20;            å‰ç«¯æ•°æ®å“åº”ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡handlerçš„returnå…³é”®å­—å¿«é€Ÿå¤„ç†ï¼</p><p>&#x20;       springmvcç®€åŒ–äº†å‚æ•°æ¥æ”¶å’Œå“åº”ï¼</p><h3 id="3-2-é¡µé¢è·³è½¬æ§åˆ¶"><a href="#3-2-é¡µé¢è·³è½¬æ§åˆ¶" class="headerlink" title="3.2 é¡µé¢è·³è½¬æ§åˆ¶"></a>3.2 é¡µé¢è·³è½¬æ§åˆ¶</h3><h4 id="3-2-1-å¿«é€Ÿè¿”å›æ¨¡æ¿è§†å›¾"><a href="#3-2-1-å¿«é€Ÿè¿”å›æ¨¡æ¿è§†å›¾" class="headerlink" title="3.2.1 å¿«é€Ÿè¿”å›æ¨¡æ¿è§†å›¾"></a>3.2.1 å¿«é€Ÿè¿”å›æ¨¡æ¿è§†å›¾</h4><ol><li><p>å¼€å‘æ¨¡å¼å›é¡¾</p><p>åœ¨ Web å¼€å‘ä¸­ï¼Œæœ‰ä¸¤ç§ä¸»è¦çš„å¼€å‘æ¨¡å¼ï¼šå‰åç«¯åˆ†ç¦»å’Œæ··åˆå¼€å‘ã€‚</p><p><img src="/../../../ProTool/img/img1/202310150104483.png" alt="image-20231014082655185"></p><p><strong>å‰åç«¯åˆ†ç¦»æ¨¡å¼ï¼š[é‡ç‚¹]</strong></p><p>æŒ‡å°†å‰ç«¯çš„ç•Œé¢å’Œåç«¯çš„ä¸šåŠ¡é€»è¾‘é€šè¿‡æ¥å£åˆ†ç¦»å¼€å‘çš„ä¸€ç§æ–¹å¼ã€‚å¼€å‘äººå‘˜ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯æ ˆå’Œæ¡†æ¶ï¼Œå‰ç«¯å¼€å‘äººå‘˜ä¸»è¦è´Ÿè´£é¡µé¢çš„å‘ˆç°å’Œç”¨æˆ·äº¤äº’ï¼Œåç«¯å¼€å‘äººå‘˜ä¸»è¦è´Ÿè´£ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®å­˜å‚¨ã€‚å‰åç«¯é€šä¿¡é€šè¿‡ API æ¥å£å®Œæˆï¼Œæ•°æ®æ ¼  å¼ä¸€èˆ¬ä½¿ç”¨ JSON æˆ– XMLã€‚å‰åç«¯åˆ†ç¦»æ¨¡å¼å¯ä»¥æé«˜å¼€å‘æ•ˆç‡ï¼ŒåŒæ—¶ä¹Ÿæœ‰åŠ©äºä»£ç é‡ç”¨å’Œç»´æŠ¤ã€‚</p><p>æ··åˆå¼€å‘æ¨¡å¼ï¼š</p><p>æŒ‡å°†å‰ç«¯å’Œåç«¯çš„ä»£ç é›†æˆåœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œå…±äº«ç›¸åŒçš„æŠ€æœ¯æ ˆå’Œæ¡†æ¶ã€‚è¿™ç§æ¨¡å¼åœ¨å°å‹é¡¹ç›®ä¸­æ¯”è¾ƒå¸¸è§ï¼Œå¯ä»¥å‡å°‘å­¦ä¹ æˆæœ¬å’Œéƒ¨ç½²éš¾åº¦ã€‚ä½†æ˜¯ï¼Œåœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œè¿™ç§æ¨¡å¼ä¼šå¯¼è‡´ä»£ç è€¦åˆæ€§å¾ˆé«˜ï¼Œç»´æŠ¤å’Œå‡çº§éš¾åº¦è¾ƒå¤§ã€‚</p><p>å¯¹äºæ··åˆå¼€å‘ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åŠ¨æ€é¡µé¢æŠ€æœ¯ï¼ŒåŠ¨æ€å±•ç¤ºJavaçš„å…±äº«åŸŸæ•°æ®ï¼ï¼</p></li><li><p><strong>jspæŠ€æœ¯äº†è§£</strong></p><p>JSPï¼ˆJavaServer Pagesï¼‰æ˜¯ä¸€ç§åŠ¨æ€ç½‘é¡µå¼€å‘æŠ€æœ¯ï¼Œå®ƒæ˜¯ç”± Sun å…¬å¸æå‡ºçš„ä¸€ç§åŸºäº Java æŠ€æœ¯çš„ Web é¡µé¢åˆ¶ä½œæŠ€æœ¯ï¼Œå¯ä»¥åœ¨ HTML æ–‡ä»¶ä¸­åµŒå…¥ Java ä»£ç ï¼Œä½¿å¾—ç”ŸæˆåŠ¨æ€å†…å®¹çš„ç¼–å†™æ›´åŠ ç®€å•ã€‚</p><p>JSP æœ€ä¸»è¦çš„ä½œç”¨æ˜¯ç”ŸæˆåŠ¨æ€é¡µé¢ã€‚å®ƒå…è®¸å°† Java ä»£ç åµŒå…¥åˆ° HTML é¡µé¢ä¸­ï¼Œä»¥ä¾¿ä½¿ç”¨ Java è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ã€å¤„ç†è¡¨å•æ•°æ®å’Œç”Ÿæˆ HTML ç­‰åŠ¨æ€å†…å®¹ã€‚å¦å¤–ï¼ŒJSP è¿˜å¯ä»¥ä¸ Servlet ç»“åˆä½¿ç”¨ï¼Œå®ç°æ›´åŠ å¤æ‚çš„ Web åº”ç”¨ç¨‹åºå¼€å‘ã€‚</p><p>JSP çš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><ol><li>ç®€å•ï¼šJSP é€šè¿‡å°† Java ä»£ç åµŒå…¥åˆ° HTML é¡µé¢ä¸­ï¼Œä½¿å¾—ç”ŸæˆåŠ¨æ€å†…å®¹çš„ç¼–å†™æ›´åŠ ç®€å•ã€‚</li><li>é«˜æ•ˆï¼šJSP é¦–æ¬¡è¿è¡Œæ—¶ä¼šè¢«è½¬æ¢ä¸º Servletï¼Œç„¶åç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œä»è€Œå¯ä»¥å¯ç”¨ Just-in-Timeï¼ˆJITï¼‰ç¼–è¯‘å™¨ï¼Œå®ç°æ›´é«˜æ•ˆçš„è¿è¡Œã€‚</li><li>å¤šæ ·åŒ–ï¼šJSP æ”¯æŒå¤šç§æ ‡å‡†æ ‡ç­¾åº“ï¼ŒåŒ…æ‹¬ JSTLï¼ˆJavaServer Pages æ ‡å‡†æ ‡ç­¾åº“ï¼‰ã€ELï¼ˆè¡¨è¾¾å¼è¯­è¨€ï¼‰ç­‰ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´åŠ æ–¹ä¾¿çš„å¤„ç†å¸¸è§çš„ Web å¼€å‘éœ€æ±‚ã€‚<br>æ€»ä¹‹ï¼ŒJSP æ˜¯ä¸€ç§ç®€å•é«˜æ•ˆã€å¤šæ ·åŒ–çš„åŠ¨æ€ç½‘é¡µå¼€å‘æŠ€æœ¯ï¼Œå®ƒå¯ä»¥æ–¹ä¾¿åœ°ç”ŸæˆåŠ¨æ€é¡µé¢å’Œä¸ Servlet ç»“åˆä½¿ç”¨ï¼Œæ˜¯ Java Web å¼€å‘ä¸­å¸¸ç”¨çš„æŠ€æœ¯ä¹‹ä¸€ã€‚</li></ol></li><li><p>å‡†å¤‡jspé¡µé¢å’Œä¾èµ–</p><p>pom.xmlä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- jspéœ€è¦ä¾èµ–! jstl--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.servlet.jsp.jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.servlet.jsp.jstl-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>jspé¡µé¢åˆ›å»º</p><p>å»ºè®®ä½ç½®ï¼š&#x2F;WEB-INF&#x2F;ä¸‹ï¼Œé¿å…å¤–éƒ¨ç›´æ¥è®¿é—®ï¼</p><p>ä½ç½®ï¼š&#x2F;WEB-INF&#x2F;views&#x2F;home.jsp</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">        &lt;!-- å¯ä»¥è·å–å…±äº«åŸŸçš„æ•°æ®,åŠ¨æ€å±•ç¤º! jsp== åå°vue --&gt;</span><br><span class="line">        $&#123;msg&#125;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>å¿«é€Ÿå“åº”æ¨¡ç‰ˆé¡µé¢</p><ol><li><p>é…ç½®jspè§†å›¾è§£æå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebMvc</span>  <span class="comment">//jsonæ•°æ®å¤„ç†,å¿…é¡»ä½¿ç”¨æ­¤æ³¨è§£,å› ä¸ºä»–ä¼šåŠ å…¥jsonå¤„ç†å™¨</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.atguigu.controller&quot;)</span> <span class="comment">//<span class="doctag">TODO:</span> è¿›è¡Œcontrolleræ‰«æ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//WebMvcConfigurer springMvcè¿›è¡Œç»„ä»¶é…ç½®çš„è§„èŒƒ,é…ç½®ç»„ä»¶,æä¾›å„ç§æ–¹æ³•! å‰æœŸå¯ä»¥å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é…ç½®jspå¯¹åº”çš„è§†å›¾è§£æå™¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureViewResolvers</span><span class="params">(ViewResolverRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//å¿«é€Ÿé…ç½®jspæ¨¡æ¿è¯­è¨€å¯¹åº”çš„</span></span><br><span class="line">        registry.jsp(<span class="string">&quot;/WEB-INF/views/&quot;</span>,<span class="string">&quot;.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>handlerè¿”å›è§†å›¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  è·³è½¬åˆ°æäº¤æ–‡ä»¶é¡µé¢  /save/jump</span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> *  å¦‚æœè¦è¿”å›jspé¡µé¢!</span></span><br><span class="line"><span class="comment"> *     1.æ–¹æ³•è¿”å›å€¼æ”¹æˆå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line"><span class="comment"> *     2.è¿”å›é€»è¾‘è§†å›¾åå³å¯    </span></span><br><span class="line"><span class="comment"> *         &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/views/&quot;/&gt;</span></span><br><span class="line"><span class="comment"> *            + é€»è¾‘è§†å›¾å +</span></span><br><span class="line"><span class="comment"> *         &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;jump&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">jumpJsp</span><span class="params">(Model model)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;FileController.jumpJsp&quot;</span>);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;request data!!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;home&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li></ol><h4 id="3-2-2-è½¬å‘å’Œé‡å®šå‘"><a href="#3-2-2-è½¬å‘å’Œé‡å®šå‘" class="headerlink" title="3.2.2 è½¬å‘å’Œé‡å®šå‘"></a>3.2.2 è½¬å‘å’Œé‡å®šå‘</h4><p>åœ¨ Spring MVC ä¸­ï¼ŒHandler æ–¹æ³•è¿”å›å€¼æ¥å®ç°å¿«é€Ÿè½¬å‘ï¼Œå¯ä»¥ä½¿ç”¨ <code>redirect</code> æˆ–è€… <code>forward</code> å…³é”®å­—æ¥å®ç°é‡å®šå‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/redirect-demo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">redirectDemo</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// é‡å®šå‘åˆ° /demo è·¯å¾„ </span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/demo&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/forward-demo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">forwardDemo</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è½¬å‘åˆ° /demo è·¯å¾„</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;forward:/demo&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨æ„ï¼š è½¬å‘å’Œé‡å®šå‘åˆ°é¡¹ç›®ä¸‹èµ„æºè·¯å¾„éƒ½æ˜¯ç›¸åŒï¼Œéƒ½ä¸éœ€è¦æ·»åŠ é¡¹ç›®æ ¹è·¯å¾„ï¼å¡«å†™é¡¹ç›®ä¸‹è·¯å¾„å³å¯ï¼</span></span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼š</p><ul><li>å°†æ–¹æ³•çš„è¿”å›å€¼ï¼Œè®¾ç½®Stringç±»å‹</li><li>è½¬å‘ä½¿ç”¨forwardå…³é”®å­—ï¼Œé‡å®šå‘ä½¿ç”¨redirectå…³é”®å­—</li><li>å…³é”®å­—: &#x2F;è·¯å¾„</li><li>æ³¨æ„ï¼šå¦‚æœæ˜¯é¡¹ç›®ä¸‹çš„èµ„æºï¼Œè½¬å‘å’Œé‡å®šå‘éƒ½ä¸€æ ·éƒ½æ˜¯é¡¹ç›®ä¸‹è·¯å¾„ï¼éƒ½ä¸éœ€è¦æ·»åŠ é¡¹ç›®æ ¹è·¯å¾„ï¼</li></ul><h3 id="3-3-è¿”å›JSONæ•°æ®ï¼ˆé‡ç‚¹ï¼‰"><a href="#3-3-è¿”å›JSONæ•°æ®ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="3.3 è¿”å›JSONæ•°æ®ï¼ˆé‡ç‚¹ï¼‰"></a>3.3 è¿”å›JSONæ•°æ®ï¼ˆé‡ç‚¹ï¼‰</h3><h4 id="3-3-1-å‰ç½®å‡†å¤‡"><a href="#3-3-1-å‰ç½®å‡†å¤‡" class="headerlink" title="3.3.1 å‰ç½®å‡†å¤‡"></a>3.3.1 å‰ç½®å‡†å¤‡</h4><p>å¯¼å…¥jacksonä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.15.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ jsonæ•°æ®è½¬åŒ–å™¨</p><p>@EnableWebMvc&#x20;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//<span class="doctag">TODO:</span> SpringMVCå¯¹åº”ç»„ä»¶çš„é…ç½®ç±» [å£°æ˜SpringMVCéœ€è¦çš„ç»„ä»¶ä¿¡æ¯]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span> å¯¼å…¥handlerMappingå’ŒhandlerAdapterçš„ä¸‰ç§æ–¹å¼</span></span><br><span class="line"> <span class="comment">//1.è‡ªåŠ¨å¯¼å…¥handlerMappingå’ŒhandlerAdapter [æ¨è]</span></span><br><span class="line"> <span class="comment">//2.å¯ä»¥ä¸æ·»åŠ ,springmvcä¼šæ£€æŸ¥æ˜¯å¦é…ç½®handlerMappingå’ŒhandlerAdapter,æ²¡æœ‰é…ç½®é»˜è®¤åŠ è½½</span></span><br><span class="line"> <span class="comment">//3.ä½¿ç”¨@Beanæ–¹å¼é…ç½®handlerMapperå’ŒhandlerAdapter</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span>  <span class="comment">//jsonæ•°æ®å¤„ç†,å¿…é¡»ä½¿ç”¨æ­¤æ³¨è§£,å› ä¸ºä»–ä¼šåŠ å…¥jsonå¤„ç†å™¨</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.atguigu.controller&quot;)</span> <span class="comment">//<span class="doctag">TODO:</span> è¿›è¡Œcontrolleræ‰«æ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//WebMvcConfigurer springMvcè¿›è¡Œç»„ä»¶é…ç½®çš„è§„èŒƒ,é…ç½®ç»„ä»¶,æä¾›å„ç§æ–¹æ³•! å‰æœŸå¯ä»¥å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-3-2-ResponseBody"><a href="#3-3-2-ResponseBody" class="headerlink" title="3.3.2 @ResponseBody"></a>3.3.2 @ResponseBody</h4><ol><li><p>æ–¹æ³•ä¸Šä½¿ç”¨@ResponseBody</p><p>å¯ä»¥åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ <code>@ResponseBody</code>æ³¨è§£ï¼Œç”¨äºå°†æ–¹æ³•è¿”å›çš„å¯¹è±¡åºåˆ—åŒ–ä¸º JSON æˆ– XML æ ¼å¼çš„æ•°æ®ï¼Œå¹¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚åœ¨å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­ä½¿ç”¨ï¼</p><p>æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/accounts/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">handle</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“æ¥è¯´ï¼Œ<code>@ResponseBody</code> æ³¨è§£å¯ä»¥ç”¨æ¥æ ‡è¯†æ–¹æ³•æˆ–è€…æ–¹æ³•è¿”å›å€¼ï¼Œè¡¨ç¤ºæ–¹æ³•çš„è¿”å›å€¼æ˜¯è¦ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ç”±è§†å›¾è§£æå™¨æ¥è§£æå¹¶æ¸²æŸ“ç”Ÿæˆå“åº”ä½“ï¼ˆviewResolveræ²¡ç”¨ï¼‰ã€‚</p><p><img src="/../../../ProTool/img/img1/image-20231014084004267.png" alt="image-20231014084004267"></p><p>æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/user/detail&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="meta">@RequestBody</span> User userParam)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;userParam = &quot;</span> + userParam);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setAge(<span class="number">18</span>);</span><br><span class="line">    user.setName(<span class="string">&quot;John&quot;</span>);</span><br><span class="line">    <span class="comment">//è¿”å›çš„å¯¹è±¡,ä¼šä½¿ç”¨jacksonçš„åºåˆ—åŒ–å·¥å…·,è½¬æˆjsonè¿”å›ç»™å‰ç«¯!</span></span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿”å›ç»“æœï¼š</p><p><img src="/../../../ProTool/img/img1/image_GfNTc3Ei41.png"></p></li><li><p>ç±»ä¸Šä½¿ç”¨@ResponseBody</p><p>å¦‚æœç±»ä¸­æ¯ä¸ªæ–¹æ³•ä¸Šéƒ½æ ‡è®°äº† @ResponseBody æ³¨è§£ï¼Œé‚£ä¹ˆè¿™äº›æ³¨è§£å°±å¯ä»¥æå–åˆ°ç±»ä¸Šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span>  <span class="comment">//responseBodyå¯ä»¥æ·»åŠ åˆ°ç±»ä¸Š,ä»£è¡¨é»˜è®¤ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½ç”Ÿæ•ˆ!</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;param&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParamController</span> &#123;</span><br></pre></td></tr></table></figure></li></ol><h4 id="3-3-3-RestController"><a href="#3-3-3-RestController" class="headerlink" title="3.3.3 @RestController"></a>3.3.3 @RestController</h4><p>ç±»ä¸Šçš„ @ResponseBody æ³¨è§£å¯ä»¥å’Œ @Controller æ³¨è§£åˆå¹¶ä¸º @RestController æ³¨è§£ã€‚æ‰€ä»¥ä½¿ç”¨äº† @RestController æ³¨è§£å°±ç›¸å½“äºç»™ç±»ä¸­çš„æ¯ä¸ªæ–¹æ³•éƒ½åŠ äº† @ResponseBody æ³¨è§£ã€‚</p><p>RestControlleræºç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RestController &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The value may indicate a suggestion for a logical component name,</span></span><br><span class="line"><span class="comment">   * to be turned into a Spring bean in case of an autodetected component.</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> the suggested component name, if any (or empty String otherwise)</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@since</span> 4.0.1</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@AliasFor(annotation = Controller.class)</span></span><br><span class="line">  String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-è¿”å›é™æ€èµ„æºå¤„ç†"><a href="#3-4-è¿”å›é™æ€èµ„æºå¤„ç†" class="headerlink" title="3.4 è¿”å›é™æ€èµ„æºå¤„ç†"></a>3.4 è¿”å›é™æ€èµ„æºå¤„ç†</h3><ol><li><p><strong>é™æ€èµ„æºæ¦‚å¿µ</strong></p><p>èµ„æºæœ¬èº«å·²ç»æ˜¯å¯ä»¥ç›´æ¥æ‹¿åˆ°æµè§ˆå™¨ä¸Šä½¿ç”¨çš„ç¨‹åº¦äº†ï¼Œ<strong>ä¸éœ€è¦åœ¨æœåŠ¡å™¨ç«¯åšä»»ä½•è¿ç®—ã€å¤„ç†</strong>ã€‚å…¸å‹çš„é™æ€èµ„æºåŒ…æ‹¬ï¼š</p><ul><li>çº¯HTMLæ–‡ä»¶</li><li>å›¾ç‰‡</li><li>CSSæ–‡ä»¶</li><li>JavaScriptæ–‡ä»¶</li><li>â€¦â€¦</li></ul></li><li><p><strong>é™æ€èµ„æºè®¿é—®å’Œé—®é¢˜è§£å†³</strong></p><ul><li><p>webåº”ç”¨åŠ å…¥é™æ€èµ„æº</p><p><img src="/../../../ProTool/img/img1/image_4ZDfBKo7ze.png"></p></li><li><p>æ‰‹åŠ¨æ„å»ºç¡®ä¿ç¼–è¯‘</p><p><img src="/../../../ProTool/img/img1/image_WNWOVOea6e.png"></p><p><img src="/../../../ProTool/img/img1/image_jkHB39M3Xa.png"></p><p><img src="/../../../ProTool/img/img1/image_iUBYDKRqy5.png"></p></li><li><p>è®¿é—®é™æ€èµ„æº</p><p><img src="/../../../ProTool/img/img1/image_k7bhHrwvx1.png"></p></li><li><p>é—®é¢˜åˆ†æ</p><ul><li>DispatcherServlet çš„ url-pattern é…ç½®çš„æ˜¯â€œ&#x2F;â€</li><li>url-pattern é…ç½®â€œ&#x2F;â€è¡¨ç¤ºæ•´ä¸ª Web åº”ç”¨èŒƒå›´å†…æ‰€æœ‰è¯·æ±‚éƒ½ç”± SpringMVC æ¥å¤„ç†</li><li>å¯¹ SpringMVC æ¥è¯´ï¼Œå¿…é¡»æœ‰å¯¹åº”çš„ @RequestMapping æ‰èƒ½æ‰¾åˆ°å¤„ç†è¯·æ±‚çš„æ–¹æ³•</li><li>ç°åœ¨ images&#x2F;mi.jpg è¯·æ±‚æ²¡æœ‰å¯¹åº”çš„ @RequestMapping æ‰€ä»¥è¿”å› 404</li></ul></li><li><p>é—®é¢˜è§£å†³</p><p>åœ¨ SpringMVC é…ç½®é…ç½®ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebMvc</span>  <span class="comment">//jsonæ•°æ®å¤„ç†,å¿…é¡»ä½¿ç”¨æ­¤æ³¨è§£,å› ä¸ºä»–ä¼šåŠ å…¥jsonå¤„ç†å™¨</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.atguigu.controller&quot;)</span> <span class="comment">//<span class="doctag">TODO:</span> è¿›è¡Œcontrolleræ‰«æ</span></span><br><span class="line"><span class="comment">//WebMvcConfigurer springMvcè¿›è¡Œç»„ä»¶é…ç½®çš„è§„èŒƒ,é…ç½®ç»„ä»¶,æä¾›å„ç§æ–¹æ³•! å‰æœŸå¯ä»¥å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é…ç½®jspå¯¹åº”çš„è§†å›¾è§£æå™¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureViewResolvers</span><span class="params">(ViewResolverRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//å¿«é€Ÿé…ç½®jspæ¨¡æ¿è¯­è¨€å¯¹åº”çš„</span></span><br><span class="line">        registry.jsp(<span class="string">&quot;/WEB-INF/views/&quot;</span>,<span class="string">&quot;.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å¼€å¯é™æ€èµ„æºå¤„ç† &lt;mvc:default-servlet-handler/&gt;</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> &#123;</span><br><span class="line">        configurer.enable();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¬¡æµ‹è¯•è®¿é—®å›¾ç‰‡ï¼š</p><p><img src="/../../../ProTool/img/img1/image_mrBsYbjiMM.png"></p></li><li><p>æ–°çš„é—®é¢˜ï¼šå…¶ä»–åŸæœ¬æ­£å¸¸çš„handlerè¯·æ±‚è®¿é—®ä¸äº†äº†</p><p>handleræ— æ³•è®¿é—®</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@EnableWebMvc  //jsonæ•°æ®å¤„ç†,å¿…é¡»ä½¿ç”¨æ­¤æ³¨è§£,å› ä¸ºä»–ä¼šåŠ å…¥jsonå¤„ç†å™¨</span><br></pre></td></tr></table></figure></li></ul></li></ol><h2 id="å››ã€RESTFulé£æ ¼è®¾è®¡å’Œå®æˆ˜"><a href="#å››ã€RESTFulé£æ ¼è®¾è®¡å’Œå®æˆ˜" class="headerlink" title="å››ã€RESTFulé£æ ¼è®¾è®¡å’Œå®æˆ˜"></a>å››ã€RESTFulé£æ ¼è®¾è®¡å’Œå®æˆ˜</h2><h3 id="4-1-RESTFulé£æ ¼æ¦‚è¿°"><a href="#4-1-RESTFulé£æ ¼æ¦‚è¿°" class="headerlink" title="4.1 RESTFulé£æ ¼æ¦‚è¿°"></a>4.1 RESTFulé£æ ¼æ¦‚è¿°</h3><h4 id="4-1-1-RESTFulé£æ ¼ç®€ä»‹"><a href="#4-1-1-RESTFulé£æ ¼ç®€ä»‹" class="headerlink" title="4.1.1 RESTFulé£æ ¼ç®€ä»‹"></a>4.1.1 RESTFulé£æ ¼ç®€ä»‹</h4><p><img src="/../../../ProTool/img/img1/image_wEi6we5MJQ.png"></p><p>RESTfulï¼ˆRepresentational State Transferï¼‰æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ï¼Œç”¨äºè®¾è®¡ç½‘ç»œåº”ç”¨ç¨‹åºå’ŒæœåŠ¡ä¹‹é—´çš„é€šä¿¡ã€‚å®ƒæ˜¯ä¸€ç§åŸºäºæ ‡å‡† HTTP æ–¹æ³•çš„ç®€å•å’Œè½»é‡çº§çš„é€šä¿¡åè®®ï¼Œå¹¿æ³›åº”ç”¨äºç°ä»£çš„WebæœåŠ¡å¼€å‘ã€‚</p><p>é€šè¿‡éµå¾ª RESTful æ¶æ„çš„è®¾è®¡åŸåˆ™ï¼Œå¯ä»¥æ„å»ºå‡ºæ˜“äºç†è§£ã€å¯æ‰©å±•ã€æ¾è€¦åˆå’Œå¯é‡ç”¨çš„ Web æœåŠ¡ã€‚RESTful API çš„ç‰¹ç‚¹æ˜¯ç®€å•ã€æ¸…æ™°ï¼Œå¹¶ä¸”æ˜“äºä½¿ç”¨å’Œç†è§£ï¼Œå®ƒä»¬ä½¿ç”¨æ ‡å‡†çš„ HTTP æ–¹æ³•å’ŒçŠ¶æ€ç è¿›è¡Œé€šä¿¡ï¼Œä¸éœ€è¦é¢å¤–çš„åè®®å’Œä¸­é—´ä»¶ã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼ŒRESTful æ˜¯ä¸€ç§åŸºäº HTTP å’Œæ ‡å‡†åŒ–çš„è®¾è®¡åŸåˆ™çš„è½¯ä»¶æ¶æ„é£æ ¼ï¼Œç”¨äºè®¾è®¡å’Œå®ç°å¯é ã€å¯æ‰©å±•å’Œæ˜“äºé›†æˆçš„ Web æœåŠ¡å’Œåº”ç”¨ç¨‹åºï¼</p><p><img src="/../../../ProTool/img/img1/image_X8M-XfzI_A.png"></p><p>å­¦ä¹ RESTfulè®¾è®¡åŸåˆ™å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½å»è®¾è®¡HTTPåè®®çš„APIæ¥å£ï¼ï¼</p><p><img src="/../../../ProTool/img/img1/202310141244518.png" alt="image-20231014124402358"></p><p><img src="/../../../ProTool/img/img1/202310150104795.png" alt="image-20231014124717765"></p><h4 id="4-1-2-RESTFulé£æ ¼ç‰¹ç‚¹"><a href="#4-1-2-RESTFulé£æ ¼ç‰¹ç‚¹" class="headerlink" title="4.1.2 RESTFulé£æ ¼ç‰¹ç‚¹"></a>4.1.2 RESTFulé£æ ¼ç‰¹ç‚¹</h4><ol><li>æ¯ä¸€ä¸ªURIä»£è¡¨1ç§èµ„æºï¼ˆURI æ˜¯åè¯ï¼‰ï¼›</li><li>å®¢æˆ·ç«¯ä½¿ç”¨GETã€POSTã€PUTã€DELETE 4ä¸ªè¡¨ç¤ºæ“ä½œæ–¹å¼çš„åŠ¨è¯å¯¹æœåŠ¡ç«¯èµ„æºè¿›è¡Œæ“ä½œï¼šGETç”¨æ¥è·å–èµ„æºï¼ŒPOSTç”¨æ¥æ–°å»ºèµ„æºï¼ˆä¹Ÿå¯ä»¥ç”¨äºæ›´æ–°èµ„æºï¼‰ï¼ŒPUTç”¨æ¥æ›´æ–°èµ„æºï¼ŒDELETEç”¨æ¥åˆ é™¤èµ„æºï¼›</li><li>èµ„æºçš„è¡¨ç°å½¢å¼æ˜¯XMLæˆ–è€…<strong>JSON</strong>ï¼›</li><li>å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„äº¤äº’åœ¨è¯·æ±‚ä¹‹é—´æ˜¯æ— çŠ¶æ€çš„ï¼Œä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„æ¯ä¸ªè¯·æ±‚éƒ½å¿…é¡»åŒ…å«ç†è§£è¯·æ±‚æ‰€å¿…éœ€çš„ä¿¡æ¯ã€‚</li><li><img src="/../../../ProTool/img/img1/202310150104952.png" alt="image-20231014125525831"></li></ol><h4 id="4-1-3-RESTFulé£æ ¼è®¾è®¡è§„èŒƒ"><a href="#4-1-3-RESTFulé£æ ¼è®¾è®¡è§„èŒƒ" class="headerlink" title="4.1.3 RESTFulé£æ ¼è®¾è®¡è§„èŒƒ"></a>4.1.3 <strong>RESTFulé£æ ¼è®¾è®¡è§„èŒƒ</strong></h4><ol><li><p><strong>HTTPåè®®è¯·æ±‚æ–¹å¼è¦æ±‚</strong></p><p>REST é£æ ¼ä¸»å¼ åœ¨é¡¹ç›®è®¾è®¡ã€å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå…·ä½“çš„æ“ä½œç¬¦åˆ<strong>HTTPåè®®å®šä¹‰çš„è¯·æ±‚æ–¹å¼çš„è¯­ä¹‰</strong>ã€‚</p><table><thead><tr><th>æ“ä½œ</th><th>è¯·æ±‚æ–¹å¼</th></tr></thead><tbody><tr><td>æŸ¥è¯¢æ“ä½œ</td><td>GET</td></tr><tr><td>ä¿å­˜æ“ä½œ</td><td>POST</td></tr><tr><td>åˆ é™¤æ“ä½œ</td><td>DELETE</td></tr><tr><td>æ›´æ–°æ“ä½œ</td><td>PUT</td></tr></tbody></table></li><li><p><strong>URLè·¯å¾„é£æ ¼è¦æ±‚</strong></p><p>RESTé£æ ¼ä¸‹æ¯ä¸ªèµ„æºéƒ½åº”è¯¥æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œä¾‹å¦‚ä¸€ä¸ª URIï¼ˆç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼‰æˆ–è€…ä¸€ä¸ª URLï¼ˆç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼‰ã€‚èµ„æºçš„æ ‡è¯†ç¬¦åº”è¯¥èƒ½æ˜ç¡®åœ°è¯´æ˜è¯¥èµ„æºçš„ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿåº”è¯¥æ˜¯å¯è¢«ç†è§£å’Œè§£é‡Šçš„ï¼</p><p>ä½¿ç”¨URL+è¯·æ±‚æ–¹å¼ç¡®å®šå…·ä½“çš„åŠ¨ä½œï¼Œä»–ä¹Ÿæ˜¯ä¸€ç§æ ‡å‡†çš„HTTPåè®®è¯·æ±‚ï¼</p><table><thead><tr><th>æ“ä½œ</th><th>ä¼ ç»Ÿé£æ ¼</th><th>REST é£æ ¼</th></tr></thead><tbody><tr><td>ä¿å­˜</td><td>&#x2F;CRUD&#x2F;saveEmp</td><td>URL åœ°å€ï¼š&#x2F;CRUD&#x2F;emp&#xA;è¯·æ±‚æ–¹å¼ï¼šPOST</td></tr><tr><td>åˆ é™¤</td><td>&#x2F;CRUD&#x2F;removeEmp?empId&#x3D;2</td><td>URL åœ°å€ï¼š&#x2F;CRUD&#x2F;emp&#x2F;2&#xA;è¯·æ±‚æ–¹å¼ï¼šDELETE</td></tr><tr><td>æ›´æ–°</td><td>&#x2F;CRUD&#x2F;updateEmp</td><td>URL åœ°å€ï¼š&#x2F;CRUD&#x2F;emp&#xA;è¯·æ±‚æ–¹å¼ï¼šPUT</td></tr><tr><td>æŸ¥è¯¢</td><td>&#x2F;CRUD&#x2F;editEmp?empId&#x3D;2</td><td>URL åœ°å€ï¼š&#x2F;CRUD&#x2F;emp&#x2F;2&#xA;è¯·æ±‚æ–¹å¼ï¼šGET</td></tr></tbody></table></li></ol><ul><li><p>æ€»ç»“</p><p>æ ¹æ®æ¥å£çš„å…·ä½“åŠ¨ä½œï¼Œé€‰æ‹©å…·ä½“çš„HTTPåè®®è¯·æ±‚æ–¹å¼</p><p>è·¯å¾„è®¾è®¡ä»åŸæ¥æºå¸¦åŠ¨æ ‡è¯†ï¼Œ<strong>æ”¹æˆåè¯</strong>ï¼Œå¯¹åº”èµ„æºçš„å”¯ä¸€æ ‡è¯†å³å¯ï¼</p></li></ul><h4 id="4-1-4-RESTFulé£æ ¼å¥½å¤„"><a href="#4-1-4-RESTFulé£æ ¼å¥½å¤„" class="headerlink" title="4.1.4 RESTFulé£æ ¼å¥½å¤„"></a>4.1.4 RESTFulé£æ ¼å¥½å¤„</h4><ol><li><p>å«è“„ï¼Œå®‰å…¨</p><p>ä½¿ç”¨é—®å·é”®å€¼å¯¹çš„æ–¹å¼ç»™æœåŠ¡å™¨ä¼ é€’æ•°æ®å¤ªæ˜æ˜¾ï¼Œå®¹æ˜“è¢«äººåˆ©ç”¨æ¥å¯¹ç³»ç»Ÿè¿›è¡Œç ´åã€‚ä½¿ç”¨ REST é£æ ¼æºå¸¦æ•°æ®ä¸å†éœ€è¦æ˜æ˜¾çš„æš´éœ²æ•°æ®çš„åç§°ã€‚</p></li><li><p>é£æ ¼ç»Ÿä¸€</p><p>URL åœ°å€æ•´ä½“æ ¼å¼ç»Ÿä¸€ï¼Œä»å‰åˆ°åå§‹ç»ˆéƒ½ä½¿ç”¨æ–œæ åˆ’åˆ†å„ä¸ªå•è¯ï¼Œç”¨ç®€å•ä¸€è‡´çš„æ ¼å¼è¡¨è¾¾è¯­ä¹‰ã€‚</p></li><li><p>æ— çŠ¶æ€</p><p>åœ¨è°ƒç”¨ä¸€ä¸ªæ¥å£ï¼ˆè®¿é—®ã€æ“ä½œèµ„æºï¼‰çš„æ—¶å€™ï¼Œå¯ä»¥ä¸ç”¨è€ƒè™‘ä¸Šä¸‹æ–‡ï¼Œä¸ç”¨è€ƒè™‘å½“å‰çŠ¶æ€ï¼Œæå¤§çš„é™ä½äº†ç³»ç»Ÿè®¾è®¡çš„å¤æ‚åº¦ã€‚</p></li><li><p>ä¸¥è°¨ï¼Œè§„èŒƒ</p><p>ä¸¥æ ¼æŒ‰ç…§ HTTP1.1 åè®®ä¸­å®šä¹‰çš„è¯·æ±‚æ–¹å¼æœ¬èº«çš„è¯­ä¹‰è¿›è¡Œæ“ä½œã€‚</p></li><li><p>ç®€æ´ï¼Œä¼˜é›…</p><p>è¿‡å»åšå¢åˆ æ”¹æŸ¥æ“ä½œéœ€è¦è®¾è®¡4ä¸ªä¸åŒçš„URLï¼Œç°åœ¨ä¸€ä¸ªå°±å¤Ÿäº†ã€‚</p><table><thead><tr><th>æ“ä½œ</th><th>ä¼ ç»Ÿé£æ ¼</th><th>REST é£æ ¼</th></tr></thead><tbody><tr><td>ä¿å­˜</td><td>&#x2F;CRUD&#x2F;saveEmp</td><td>URL åœ°å€ï¼š&#x2F;CRUD&#x2F;emp&#xA;è¯·æ±‚æ–¹å¼ï¼šPOST</td></tr><tr><td>åˆ é™¤</td><td>&#x2F;CRUD&#x2F;removeEmp?empId&#x3D;2</td><td>URL åœ°å€ï¼š&#x2F;CRUD&#x2F;emp&#x2F;2&#xA;è¯·æ±‚æ–¹å¼ï¼šDELETE</td></tr><tr><td>æ›´æ–°</td><td>&#x2F;CRUD&#x2F;updateEmp</td><td>URL åœ°å€ï¼š&#x2F;CRUD&#x2F;emp&#xA;è¯·æ±‚æ–¹å¼ï¼šPUT</td></tr><tr><td>æŸ¥è¯¢</td><td>&#x2F;CRUD&#x2F;editEmp?empId&#x3D;2</td><td>URL åœ°å€ï¼š&#x2F;CRUD&#x2F;emp&#x2F;2&#xA;è¯·æ±‚æ–¹å¼ï¼šGET</td></tr></tbody></table></li><li><p>ä¸°å¯Œçš„è¯­ä¹‰</p><p>é€šè¿‡ URL åœ°å€å°±å¯ä»¥çŸ¥é“èµ„æºä¹‹é—´çš„å…³ç³»ã€‚å®ƒèƒ½å¤ŸæŠŠä¸€å¥è¯ä¸­çš„å¾ˆå¤šå•è¯ç”¨æ–œæ è¿èµ·æ¥ï¼Œåè¿‡æ¥è¯´å°±æ˜¯å¯ä»¥åœ¨ URL åœ°å€ä¸­ç”¨ä¸€å¥è¯æ¥å……åˆ†è¡¨è¾¾è¯­ä¹‰ã€‚</p><blockquote><p><a href="http://localhost:8080/shop" title="http://localhost:8080/shop">http://localhost:8080/shop</a> <a href="http://localhost:8080/shop/product" title="http://localhost:8080/shop/product">http://localhost:8080/shop/product</a> <a href="http://localhost:8080/shop/product/cellPhone" title="http://localhost:8080/shop/product/cellPhone">http://localhost:8080/shop/product/cellPhone</a> <a href="http://localhost:8080/shop/product/cellPhone/iPhone" title="http://localhost:8080/shop/product/cellPhone/iPhone">http://localhost:8080/shop/product/cellPhone/iPhone</a></p></blockquote></li></ol><h3 id="4-2-RESTFulé£æ ¼å®æˆ˜"><a href="#4-2-RESTFulé£æ ¼å®æˆ˜" class="headerlink" title="4.2 RESTFulé£æ ¼å®æˆ˜"></a>4.2 RESTFulé£æ ¼å®æˆ˜</h3><h4 id="4-2-1-éœ€æ±‚åˆ†æ"><a href="#4-2-1-éœ€æ±‚åˆ†æ" class="headerlink" title="4.2.1 éœ€æ±‚åˆ†æ"></a>4.2.1 éœ€æ±‚åˆ†æ</h4><ul><li>æ•°æ®ç»“æ„ï¼š User {id å”¯ä¸€æ ‡è¯†,name ç”¨æˆ·åï¼Œage ç”¨æˆ·å¹´é¾„}</li><li>åŠŸèƒ½åˆ†æ<ul><li>ç”¨æˆ·æ•°æ®åˆ†é¡µå±•ç¤ºåŠŸèƒ½ï¼ˆæ¡ä»¶ï¼špage é¡µæ•° é»˜è®¤1ï¼Œsize æ¯é¡µæ•°é‡ é»˜è®¤ 10ï¼‰</li><li>ä¿å­˜ç”¨æˆ·åŠŸèƒ½</li><li>æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…åŠŸèƒ½</li><li>æ ¹æ®ç”¨æˆ·idæ›´æ–°ç”¨æˆ·æ•°æ®åŠŸèƒ½</li><li>æ ¹æ®ç”¨æˆ·idåˆ é™¤ç”¨æˆ·æ•°æ®åŠŸèƒ½</li><li>å¤šæ¡ä»¶æ¨¡ç³ŠæŸ¥è¯¢ç”¨æˆ·åŠŸèƒ½ï¼ˆæ¡ä»¶ï¼škeyword æ¨¡ç³Šå…³é”®å­—ï¼Œpage é¡µæ•° é»˜è®¤1ï¼Œsize æ¯é¡µæ•°é‡ é»˜è®¤ 10ï¼‰</li></ul></li></ul><h4 id="4-2-2-RESTFulé£æ ¼æ¥å£è®¾è®¡"><a href="#4-2-2-RESTFulé£æ ¼æ¥å£è®¾è®¡" class="headerlink" title="4.2.2 RESTFulé£æ ¼æ¥å£è®¾è®¡"></a>4.2.2 RESTFulé£æ ¼æ¥å£è®¾è®¡</h4><ol><li><p><strong>æ¥å£è®¾è®¡</strong></p><table><thead><tr><th>åŠŸèƒ½</th><th>æ¥å£å’Œè¯·æ±‚æ–¹å¼</th><th>è¯·æ±‚å‚æ•°</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td>åˆ†é¡µæŸ¥è¯¢</td><td>GET  &#x2F;user</td><td>page&#x3D;1&amp;size&#x3D;10</td><td>{ å“åº”æ•°æ® }</td></tr><tr><td>ç”¨æˆ·æ·»åŠ </td><td>POST &#x2F;user</td><td>{ user æ•°æ® }</td><td>{å“åº”æ•°æ®}</td></tr><tr><td>ç”¨æˆ·è¯¦æƒ…</td><td>GET &#x2F;user&#x2F;1</td><td>è·¯å¾„å‚æ•°</td><td>{å“åº”æ•°æ®}</td></tr><tr><td>ç”¨æˆ·æ›´æ–°</td><td>PUT &#x2F;user</td><td>{ user æ›´æ–°æ•°æ®}</td><td>{å“åº”æ•°æ®}</td></tr><tr><td>ç”¨æˆ·åˆ é™¤</td><td>DELETE &#x2F;user&#x2F;1</td><td>è·¯å¾„å‚æ•°</td><td>{å“åº”æ•°æ®}</td></tr><tr><td>æ¡ä»¶æ¨¡ç³Š</td><td>GET &#x2F;user&#x2F;search</td><td>page&#x3D;1&amp;size&#x3D;10&amp;keywork&#x3D;å…³é”®å­—</td><td>{å“åº”æ•°æ®}</td></tr></tbody></table></li><li><p><strong>é—®é¢˜è®¨è®º</strong></p><p>ä¸ºä»€ä¹ˆæŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…ï¼Œå°±ä½¿ç”¨è·¯å¾„ä¼ é€’å‚æ•°ï¼Œå¤šæ¡ä»¶æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå°±ä½¿ç”¨è¯·æ±‚å‚æ•°ä¼ é€’ï¼Ÿ</p><p>è¯¯åŒºï¼šrestfulé£æ ¼ä¸‹ï¼Œä¸æ˜¯æ‰€æœ‰è¯·æ±‚å‚æ•°éƒ½æ˜¯è·¯å¾„ä¼ é€’ï¼å¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹å¼ä¼ é€’ï¼</p><p>åœ¨ RESTful API çš„è®¾è®¡ä¸­ï¼Œè·¯å¾„å’Œè¯·æ±‚å‚æ•°å’Œè¯·æ±‚ä½“éƒ½æ˜¯ç”¨æ¥å‘æœåŠ¡å™¨ä¼ é€’ä¿¡æ¯çš„æ–¹å¼ã€‚</p><ul><li>å¯¹äºæŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…ï¼Œä½¿ç”¨è·¯å¾„ä¼ é€’å‚æ•°æ˜¯å› ä¸ºè¿™æ˜¯ä¸€ä¸ªå•ä¸€èµ„æºçš„æŸ¥è¯¢ï¼Œå³æŸ¥è¯¢ä¸€æ¡ç”¨æˆ·è®°å½•ã€‚ä½¿ç”¨è·¯å¾„å‚æ•°å¯ä»¥æ˜ç¡®æŒ‡å®šæ‰€è¯·æ±‚çš„èµ„æºï¼Œä¾¿äºæœåŠ¡å™¨å®šä½å¹¶è¿”å›å¯¹åº”çš„èµ„æºï¼Œä¹Ÿç¬¦åˆ RESTful é£æ ¼çš„è¦æ±‚ã€‚</li><li>è€Œå¯¹äºå¤šæ¡ä»¶æ¨¡ç³ŠæŸ¥è¯¢ï¼Œä½¿ç”¨è¯·æ±‚å‚æ•°ä¼ é€’å‚æ•°æ˜¯å› ä¸ºè¿™æ˜¯ä¸€ä¸ªèµ„æºé›†åˆçš„æŸ¥è¯¢ï¼Œå³æŸ¥è¯¢å¤šæ¡ç”¨æˆ·è®°å½•ã€‚ä½¿ç”¨è¯·æ±‚å‚æ•°å¯ä»¥é€šè¿‡ç»„åˆä¸åŒå‚æ•°æ¥é™åˆ¶æŸ¥è¯¢ç»“æœï¼Œè·¯å¾„å‚æ•°çš„ç»„åˆå’Œæ’åˆ—å¯èƒ½ä¼šå¾ˆå¤šï¼Œä¸å¦‚ä½¿ç”¨è¯·æ±‚å‚æ•°æ›´åŠ çµæ´»å’Œç®€æ´ã€‚<br>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€äº›é€šç”¨çš„åŸåˆ™å¯ä»¥éµå¾ªï¼š</li><li>è·¯å¾„å‚æ•°åº”è¯¥ç”¨äºæŒ‡å®šèµ„æºçš„å”¯ä¸€æ ‡è¯†æˆ–è€… IDï¼Œè€Œè¯·æ±‚å‚æ•°åº”è¯¥ç”¨äºæŒ‡å®šæŸ¥è¯¢æ¡ä»¶æˆ–è€…æ“ä½œå‚æ•°ã€‚</li><li>è¯·æ±‚å‚æ•°åº”è¯¥é™åˆ¶åœ¨ 10 ä¸ªä»¥å†…ï¼Œè¿‡å¤šçš„è¯·æ±‚å‚æ•°å¯èƒ½å¯¼è‡´æ¥å£éš¾ä»¥ç»´æŠ¤å’Œä½¿ç”¨ã€‚</li><li>å¯¹äºæ•æ„Ÿä¿¡æ¯ï¼Œæœ€å¥½ä½¿ç”¨ POST å’Œè¯·æ±‚ä½“æ¥ä¼ é€’å‚æ•°ã€‚</li><li><img src="/../../../ProTool/img/img1/image-20231014130339783.png" alt="image-20231014130339783"></li></ul></li></ol><h4 id="4-2-3-åå°æ¥å£å®ç°"><a href="#4-2-3-åå°æ¥å£å®ç°" class="headerlink" title="4.2.3 åå°æ¥å£å®ç°"></a>4.2.3 åå°æ¥å£å®ç°</h4><p>å‡†å¤‡ç”¨æˆ·å®ä½“ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.pojo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * projectName: com.atguigu.pojo</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·å®ä½“ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å‡†å¤‡ç”¨æˆ·Controller:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * projectName: com.atguigu.controller</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * description: ç”¨æˆ·æ¨¡å—çš„æ§åˆ¶å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡æ‹Ÿåˆ†é¡µæŸ¥è¯¢ä¸šåŠ¡æ¥å£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">queryPage</span><span class="params">(<span class="meta">@RequestParam(name = &quot;page&quot;,required = false,defaultValue = &quot;1&quot;)</span><span class="type">int</span> page,</span></span><br><span class="line"><span class="params">                            <span class="meta">@RequestParam(name = &quot;size&quot;,required = false,defaultValue = &quot;10&quot;)</span><span class="type">int</span> size)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;page = &quot;</span> + page + <span class="string">&quot;, size = &quot;</span> + size);</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ†é¡µæŸ¥è¯¢ä¸šåŠ¡!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;status&#x27;:&#x27;ok&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡æ‹Ÿç”¨æˆ·ä¿å­˜ä¸šåŠ¡æ¥å£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">saveUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user = &quot;</span> + user);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”¨æˆ·ä¿å­˜ä¸šåŠ¡!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;status&#x27;:&#x27;ok&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡æ‹Ÿç”¨æˆ·è¯¦æƒ…ä¸šåŠ¡æ¥å£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">detailUser</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;id = &quot;</span> + id);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”¨æˆ·è¯¦æƒ…ä¸šåŠ¡!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;status&#x27;:&#x27;ok&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡æ‹Ÿç”¨æˆ·æ›´æ–°ä¸šåŠ¡æ¥å£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">updateUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user = &quot;</span> + user);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”¨æˆ·æ›´æ–°ä¸šåŠ¡!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;status&#x27;:&#x27;ok&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡æ‹Ÿæ¡ä»¶åˆ†é¡µæŸ¥è¯¢ä¸šåŠ¡æ¥å£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;search&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">queryPage</span><span class="params">(<span class="meta">@RequestParam(name = &quot;page&quot;,required = false,defaultValue = &quot;1&quot;)</span><span class="type">int</span> page,</span></span><br><span class="line"><span class="params">                            <span class="meta">@RequestParam(name = &quot;size&quot;,required = false,defaultValue = &quot;10&quot;)</span><span class="type">int</span> size,</span></span><br><span class="line"><span class="params">                            <span class="meta">@RequestParam(name = &quot;keyword&quot;,required= false)</span>String keyword)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;page = &quot;</span> + page + <span class="string">&quot;, size = &quot;</span> + size + <span class="string">&quot;, keyword = &quot;</span> + keyword);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¡ä»¶åˆ†é¡µæŸ¥è¯¢ä¸šåŠ¡!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;status&#x27;:&#x27;ok&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äº”ã€SpringMVCå…¶ä»–æ‰©å±•"><a href="#äº”ã€SpringMVCå…¶ä»–æ‰©å±•" class="headerlink" title="äº”ã€SpringMVCå…¶ä»–æ‰©å±•"></a>äº”ã€SpringMVCå…¶ä»–æ‰©å±•</h2><h3 id="5-1-å…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶"><a href="#5-1-å…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶" class="headerlink" title="5.1 å…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶"></a>5.1 å…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶</h3><h4 id="5-1-1-å¼‚å¸¸å¤„ç†ä¸¤ç§æ–¹å¼"><a href="#5-1-1-å¼‚å¸¸å¤„ç†ä¸¤ç§æ–¹å¼" class="headerlink" title="5.1.1 å¼‚å¸¸å¤„ç†ä¸¤ç§æ–¹å¼"></a>5.1.1 å¼‚å¸¸å¤„ç†ä¸¤ç§æ–¹å¼</h4><p>å¼€å‘è¿‡ç¨‹ä¸­æ˜¯ä¸å¯é¿å…åœ°ä¼šå‡ºç°å„ç§å¼‚å¸¸æƒ…å†µçš„ï¼Œä¾‹å¦‚ç½‘ç»œè¿æ¥å¼‚å¸¸ã€æ•°æ®æ ¼å¼å¼‚å¸¸ã€ç©ºæŒ‡é’ˆå¼‚å¸¸ç­‰ç­‰ã€‚å¼‚å¸¸çš„å‡ºç°å¯èƒ½å¯¼è‡´ç¨‹åºçš„è¿è¡Œå‡ºç°é—®é¢˜ï¼Œç”šè‡³ç›´æ¥å¯¼è‡´ç¨‹åºå´©æºƒã€‚å› æ­¤ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåˆç†å¤„ç†å¼‚å¸¸ã€é¿å…å¼‚å¸¸äº§ç”Ÿã€ä»¥åŠå¯¹å¼‚å¸¸è¿›è¡Œæœ‰æ•ˆçš„è°ƒè¯•æ˜¯éå¸¸é‡è¦çš„ã€‚</p><p>å¯¹äºå¼‚å¸¸çš„å¤„ç†ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼š</p><ul><li><strong>ç¼–ç¨‹å¼å¼‚å¸¸å¤„ç†</strong>ï¼šæ˜¯æŒ‡åœ¨ä»£ç ä¸­æ˜¾å¼åœ°ç¼–å†™å¤„ç†å¼‚å¸¸çš„é€»è¾‘ã€‚å®ƒé€šå¸¸æ¶‰åŠåˆ°å¯¹å¼‚å¸¸ç±»å‹çš„æ£€æµ‹åŠå…¶å¤„ç†ï¼Œä¾‹å¦‚ä½¿ç”¨ <strong>try-catch å—æ¥æ•è·å¼‚å¸¸ï¼Œç„¶ååœ¨ catch å—ä¸­ç¼–å†™ç‰¹å®šçš„å¤„ç†ä»£ç ï¼Œæˆ–è€…åœ¨ finally å—ä¸­æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œã€‚</strong>åœ¨ç¼–ç¨‹å¼å¼‚å¸¸å¤„ç†ä¸­ï¼Œå¼€å‘äººå‘˜éœ€è¦æ˜¾å¼åœ°è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œå¼‚å¸¸å¤„ç†ä»£ç æ··æ‚åœ¨ä¸šåŠ¡ä»£ç ä¸­ï¼Œå¯¼è‡´ä»£ç å¯è¯»æ€§è¾ƒå·®ã€‚</li><li><strong>å£°æ˜å¼å¼‚å¸¸å¤„ç†ï¼š</strong>åˆ™æ˜¯å°†å¼‚å¸¸å¤„ç†çš„é€»è¾‘ä»å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œé€šè¿‡<strong>é…ç½®ç­‰æ–¹å¼è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†å’Œå¤„ç†ã€‚</strong>åœ¨å£°æ˜å¼å¼‚å¸¸å¤„ç†ä¸­ï¼Œå¼€å‘äººå‘˜åªéœ€è¦ä¸ºæ–¹æ³•æˆ–ç±»æ ‡æ³¨ç›¸åº”çš„æ³¨è§£ï¼ˆå¦‚ <code>@Throws</code> æˆ– <code>@ExceptionHandler</code>ï¼‰ï¼Œå°±å¯ä»¥å¤„ç†ç‰¹å®šç±»å‹çš„å¼‚å¸¸ã€‚ç›¸è¾ƒäºç¼–ç¨‹å¼å¼‚å¸¸å¤„ç†ï¼Œå£°æ˜å¼å¼‚å¸¸å¤„ç†å¯ä»¥ä½¿ä»£ç æ›´åŠ ç®€æ´ã€æ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚</li></ul><p>ç«™åœ¨å®è§‚è§’åº¦æ¥çœ‹å¾…å£°æ˜å¼äº‹åŠ¡å¤„ç†ï¼š</p><p>æ•´ä¸ªé¡¹ç›®ä»æ¶æ„è¿™ä¸ªå±‚é¢è®¾è®¡çš„å¼‚å¸¸å¤„ç†çš„ç»Ÿä¸€æœºåˆ¶å’Œè§„èŒƒã€‚</p><p>ä¸€ä¸ªé¡¹ç›®ä¸­ä¼šåŒ…å«å¾ˆå¤šä¸ªæ¨¡å—ï¼Œå„ä¸ªæ¨¡å—éœ€è¦åˆ†å·¥å®Œæˆã€‚å¦‚æœå¼ ä¸‰è´Ÿè´£çš„æ¨¡å—æŒ‰ç…§ A æ–¹æ¡ˆå¤„ç†å¼‚å¸¸ï¼Œæå››è´Ÿè´£çš„æ¨¡å—æŒ‰ç…§ B æ–¹æ¡ˆå¤„ç†å¼‚å¸¸â€¦â€¦å„ä¸ªæ¨¡å—å¤„ç†å¼‚å¸¸çš„æ€è·¯ã€ä»£ç ã€å‘½åç»†èŠ‚éƒ½ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆå°±ä¼šè®©æ•´ä¸ªé¡¹ç›®éå¸¸æ··ä¹±ã€‚</p><p>ä½¿ç”¨å£°æ˜å¼å¼‚å¸¸å¤„ç†ï¼Œå¯ä»¥ç»Ÿä¸€é¡¹ç›®å¤„ç†å¼‚å¸¸æ€è·¯ï¼Œé¡¹ç›®æ›´åŠ æ¸…æ™°æ˜äº†ï¼</p><h4 id="5-1-2-åŸºäºæ³¨è§£å¼‚å¸¸å£°æ˜å¼‚å¸¸å¤„ç†"><a href="#5-1-2-åŸºäºæ³¨è§£å¼‚å¸¸å£°æ˜å¼‚å¸¸å¤„ç†" class="headerlink" title="5.1.2 åŸºäºæ³¨è§£å¼‚å¸¸å£°æ˜å¼‚å¸¸å¤„ç†"></a>5.1.2 åŸºäºæ³¨è§£å¼‚å¸¸å£°æ˜å¼‚å¸¸å¤„ç†</h4><ol><li><p>å£°æ˜å¼‚å¸¸å¤„ç†æ§åˆ¶å™¨ç±»</p><p>å¼‚å¸¸å¤„ç†æ§åˆ¶ç±»ï¼Œç»Ÿä¸€å®šä¹‰å¼‚å¸¸å¤„ç†handleræ–¹æ³•ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * projectName: com.atguigu.execptionhandler</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * description: å…¨å±€å¼‚å¸¸å¤„ç†å™¨,å†…éƒ¨å¯ä»¥å®šä¹‰å¼‚å¸¸å¤„ç†Handler!</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@RestControllerAdvice</span> = <span class="doctag">@ControllerAdvice</span> + <span class="doctag">@ResponseBody</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ControllerAdvice</span> ä»£è¡¨å½“å‰ç±»çš„å¼‚å¸¸å¤„ç†controller! </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å£°æ˜å¼‚å¸¸å¤„ç†handeræ–¹æ³•</p><p>å¼‚å¸¸å¤„ç†handleræ–¹æ³•å’Œæ™®é€šçš„handleræ–¹æ³•å‚æ•°æ¥æ”¶å’Œå“åº”éƒ½ä¸€è‡´ï¼</p><p>åªä¸è¿‡å¼‚å¸¸å¤„ç†handleræ–¹æ³•è¦æ˜ å°„å¼‚å¸¸ï¼Œå‘ç”Ÿå¯¹åº”çš„å¼‚å¸¸ä¼šè°ƒç”¨ï¼</p><p>æ™®é€šçš„handleræ–¹æ³•è¦ä½¿ç”¨@RequestMappingæ³¨è§£æ˜ å°„è·¯å¾„ï¼Œå‘ç”Ÿå¯¹åº”çš„è·¯å¾„è°ƒç”¨ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¼‚å¸¸å¤„ç†handler </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ExceptionHandler</span>(HttpMessageNotReadableException.class) </span></span><br><span class="line"><span class="comment"> * è¯¥æ³¨è§£æ ‡è®°å¼‚å¸¸å¤„ç†Handler,å¹¶ä¸”æŒ‡å®šå‘ç”Ÿå¼‚å¸¸è°ƒç”¨è¯¥æ–¹æ³•!</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> e è·å–å¼‚å¸¸å¯¹è±¡!</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> è¿”å›handlerå¤„ç†ç»“æœ!</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExceptionHandler(HttpMessageNotReadableException.class)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">handlerJsonDateException</span><span class="params">(HttpMessageNotReadableException e)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å½“å‘ç”Ÿç©ºæŒ‡é’ˆå¼‚å¸¸ä¼šè§¦å‘æ­¤æ–¹æ³•!</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExceptionHandler(NullPointerException.class)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">handlerNullException</span><span class="params">(NullPointerException e)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰€æœ‰å¼‚å¸¸éƒ½ä¼šè§¦å‘æ­¤æ–¹æ³•!ä½†æ˜¯å¦‚æœæœ‰å…·ä½“çš„å¼‚å¸¸å¤„ç†Handler! </span></span><br><span class="line"><span class="comment"> * å…·ä½“å¼‚å¸¸å¤„ç†Handlerä¼˜å…ˆçº§æ›´é«˜!</span></span><br><span class="line"><span class="comment"> * ä¾‹å¦‚: å‘ç”ŸNullPointerExceptionå¼‚å¸¸!</span></span><br><span class="line"><span class="comment"> *       ä¼šè§¦å‘handlerNullExceptionæ–¹æ³•,ä¸ä¼šè§¦å‘handlerExceptionæ–¹æ³•!</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">handlerException</span><span class="params">(Exception e)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>é…ç½®æ–‡ä»¶æ‰«ææ§åˆ¶å™¨ç±»é…ç½®</p><p>ç¡®ä¿å¼‚å¸¸å¤„ç†æ§åˆ¶ç±»è¢«æ‰«æ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- æ‰«æcontrollerå¯¹åº”çš„åŒ…,å°†handleråŠ å…¥åˆ°ioc--&gt;</span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.atguigu.controller&quot;,</span></span><br><span class="line"><span class="meta">&quot;com.atguigu.exceptionhandler&quot;&#125;)</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="5-2-æ‹¦æˆªå™¨ä½¿ç”¨"><a href="#5-2-æ‹¦æˆªå™¨ä½¿ç”¨" class="headerlink" title="5.2 æ‹¦æˆªå™¨ä½¿ç”¨"></a>5.2 æ‹¦æˆªå™¨ä½¿ç”¨</h3><h4 id="5-2-1-æ‹¦æˆªå™¨æ¦‚å¿µ"><a href="#5-2-1-æ‹¦æˆªå™¨æ¦‚å¿µ" class="headerlink" title="5.2.1 æ‹¦æˆªå™¨æ¦‚å¿µ"></a>5.2.1 æ‹¦æˆªå™¨æ¦‚å¿µ</h4><p>æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨è§£å†³é—®é¢˜</p><ul><li><p>ç”Ÿæ´»ä¸­</p><p>ä¸ºäº†æé«˜ä¹˜è½¦æ•ˆç‡ï¼Œåœ¨ä¹˜å®¢è¿›å…¥ç«™å°å‰ç»Ÿä¸€æ£€ç¥¨</p><p><img src="/../../../ProTool/img/img1/img008_uQA2iP6_5n.png"></p></li><li><p>ç¨‹åºä¸­</p><p>åœ¨ç¨‹åºä¸­ï¼Œä½¿ç”¨æ‹¦æˆªå™¨åœ¨è¯·æ±‚åˆ°è¾¾å…·ä½“ handler æ–¹æ³•å‰ï¼Œç»Ÿä¸€æ‰§è¡Œæ£€æµ‹</p><p><img src="/../../../ProTool/img/img1/img009_aXz6GsRSMQ.png"></p></li></ul><p><img src="/../../../ProTool/img/img1/202310150105383.png" alt="image-20231014141252652"></p><p>æ‹¦æˆªå™¨ Springmvc VS è¿‡æ»¤å™¨ javaWebï¼š</p><ul><li>ç›¸ä¼¼ç‚¹<ul><li>æ‹¦æˆªï¼šå¿…é¡»å…ˆæŠŠè¯·æ±‚æ‹¦ä½ï¼Œæ‰èƒ½æ‰§è¡Œåç»­æ“ä½œ</li><li>è¿‡æ»¤ï¼šæ‹¦æˆªå™¨æˆ–è¿‡æ»¤å™¨å­˜åœ¨çš„æ„ä¹‰å°±æ˜¯å¯¹è¯·æ±‚è¿›è¡Œç»Ÿä¸€å¤„ç†</li><li>æ”¾è¡Œï¼šå¯¹è¯·æ±‚æ‰§è¡Œäº†å¿…è¦æ“ä½œåï¼Œæ”¾è¯·æ±‚è¿‡å»ï¼Œè®©å®ƒè®¿é—®åŸæœ¬æƒ³è¦è®¿é—®çš„èµ„æº</li></ul></li><li>ä¸åŒç‚¹<ul><li>å·¥ä½œå¹³å°ä¸åŒ<ul><li>è¿‡æ»¤å™¨å·¥ä½œåœ¨ Servlet å®¹å™¨ä¸­</li><li>æ‹¦æˆªå™¨å·¥ä½œåœ¨ SpringMVC çš„åŸºç¡€ä¸Š</li></ul></li><li>æ‹¦æˆªçš„èŒƒå›´<ul><li>è¿‡æ»¤å™¨ï¼šèƒ½å¤Ÿæ‹¦æˆªåˆ°çš„æœ€å¤§èŒƒå›´æ˜¯æ•´ä¸ª Web åº”ç”¨</li><li>æ‹¦æˆªå™¨ï¼šèƒ½å¤Ÿæ‹¦æˆªåˆ°çš„æœ€å¤§èŒƒå›´æ˜¯æ•´ä¸ª SpringMVC è´Ÿè´£çš„è¯·æ±‚</li></ul></li><li>IOC å®¹å™¨æ”¯æŒ<ul><li>è¿‡æ»¤å™¨ï¼šæƒ³å¾—åˆ° IOC å®¹å™¨éœ€è¦è°ƒç”¨ä¸“é—¨çš„å·¥å…·æ–¹æ³•ï¼Œæ˜¯é—´æ¥çš„</li><li>æ‹¦æˆªå™¨ï¼šå®ƒè‡ªå·±å°±åœ¨ IOC å®¹å™¨ä¸­ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä» IOC å®¹å™¨ä¸­è£…é…ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ç›´æ¥å¾—åˆ° IOC å®¹å™¨çš„æ”¯æŒ</li></ul></li></ul></li></ul><p>é€‰æ‹©ï¼š</p><p>åŠŸèƒ½éœ€è¦å¦‚æœç”¨ SpringMVC çš„æ‹¦æˆªå™¨èƒ½å¤Ÿå®ç°ï¼Œå°±ä¸ä½¿ç”¨è¿‡æ»¤å™¨ã€‚</p><p><img src="/../../../ProTool/img/img1/image_7rIm3LKXgr.png"></p><h4 id="5-2-2-æ‹¦æˆªå™¨ä½¿ç”¨"><a href="#5-2-2-æ‹¦æˆªå™¨ä½¿ç”¨" class="headerlink" title="5.2.2 æ‹¦æˆªå™¨ä½¿ç”¨"></a>5.2.2 æ‹¦æˆªå™¨ä½¿ç”¨</h4><ol><li><p>åˆ›å»ºæ‹¦æˆªå™¨ç±»</p></li><li><p><img src="/../../../ProTool/img/img1/image-20231014141727677.png" alt="image-20231014141727677"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Process01Interceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if( ! preHandler())&#123;return;&#125;</span></span><br><span class="line">    <span class="comment">// åœ¨å¤„ç†è¯·æ±‚çš„ç›®æ ‡ handler æ–¹æ³•å‰æ‰§è¡Œ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;request = &quot;</span> + request + <span class="string">&quot;, response = &quot;</span> + response + <span class="string">&quot;, handler = &quot;</span> + handler);</span><br><span class="line">        System.out.println(<span class="string">&quot;Process01Interceptor.preHandle&quot;</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">// è¿”å›trueï¼šæ”¾è¡Œ</span></span><br><span class="line">        <span class="comment">// è¿”å›falseï¼šä¸æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// åœ¨ç›®æ ‡ handler æ–¹æ³•ä¹‹åï¼ŒhandleræŠ¥é”™ä¸æ‰§è¡Œ!</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;request = &quot;</span> + request + <span class="string">&quot;, response = &quot;</span> + response + <span class="string">&quot;, handler = &quot;</span> + handler + <span class="string">&quot;, modelAndView = &quot;</span> + modelAndView);</span><br><span class="line">        System.out.println(<span class="string">&quot;Process01Interceptor.postHandle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// æ¸²æŸ“è§†å›¾ä¹‹åæ‰§è¡Œ(æœ€å),ä¸€å®šæ‰§è¡Œ!</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;request = &quot;</span> + request + <span class="string">&quot;, response = &quot;</span> + response + <span class="string">&quot;, handler = &quot;</span> + handler + <span class="string">&quot;, ex = &quot;</span> + ex);</span><br><span class="line">        System.out.println(<span class="string">&quot;Process01Interceptor.afterCompletion&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹¦æˆªå™¨æ–¹æ³•æ‹¦æˆªä½ç½®ï¼š</p><p><img src="/../../../ProTool/img/img1/image_FwhiGWjP_t.png"></p></li><li><p>ä¿®æ”¹é…ç½®ç±»æ·»åŠ æ‹¦æˆªå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebMvc</span>  <span class="comment">//jsonæ•°æ®å¤„ç†,å¿…é¡»ä½¿ç”¨æ­¤æ³¨è§£,å› ä¸ºä»–ä¼šåŠ å…¥jsonå¤„ç†å™¨</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.atguigu.controller&quot;,&quot;com.atguigu.exceptionhandler&quot;&#125;)</span> <span class="comment">//<span class="doctag">TODO:</span> è¿›è¡Œcontrolleræ‰«æ</span></span><br><span class="line"><span class="comment">//WebMvcConfigurer springMvcè¿›è¡Œç»„ä»¶é…ç½®çš„è§„èŒƒ,é…ç½®ç»„ä»¶,æä¾›å„ç§æ–¹æ³•! å‰æœŸå¯ä»¥å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é…ç½®jspå¯¹åº”çš„è§†å›¾è§£æå™¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureViewResolvers</span><span class="params">(ViewResolverRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//å¿«é€Ÿé…ç½®jspæ¨¡æ¿è¯­è¨€å¯¹åº”çš„</span></span><br><span class="line">        registry.jsp(<span class="string">&quot;/WEB-INF/views/&quot;</span>,<span class="string">&quot;.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¼€å¯é™æ€èµ„æºå¤„ç† &lt;mvc:default-servlet-handler/&gt;</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> &#123;</span><br><span class="line">        configurer.enable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ·»åŠ æ‹¦æˆªå™¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123; </span><br><span class="line">        <span class="comment">//å°†æ‹¦æˆªå™¨æ·»åŠ åˆ°Springmvcç¯å¢ƒ,é»˜è®¤æ‹¦æˆªæ‰€æœ‰Springmvcåˆ†å‘çš„è¯·æ±‚</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">Process01Interceptor</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. é…ç½®è¯¦è§£</span><br><span class="line"></span><br><span class="line">   1. é»˜è®¤æ‹¦æˆªå…¨éƒ¨</span><br><span class="line"></span><br><span class="line">      ```java</span><br><span class="line">      @Override</span><br><span class="line">      public void addInterceptors(InterceptorRegistry registry) &#123;</span><br><span class="line">          //å°†æ‹¦æˆªå™¨æ·»åŠ åˆ°Springmvcç¯å¢ƒ,é»˜è®¤æ‹¦æˆªæ‰€æœ‰Springmvcåˆ†å‘çš„è¯·æ±‚</span><br><span class="line">          registry.addInterceptor(new Process01Interceptor());</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br></pre></td></tr></table></figure><ol start="2"><li><p>ç²¾å‡†é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å°†æ‹¦æˆªå™¨æ·»åŠ åˆ°Springmvcç¯å¢ƒ,é»˜è®¤æ‹¦æˆªæ‰€æœ‰Springmvcåˆ†å‘çš„è¯·æ±‚</span></span><br><span class="line">    registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">Process01Interceptor</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ç²¾å‡†åŒ¹é…,è®¾ç½®æ‹¦æˆªå™¨å¤„ç†æŒ‡å®šè¯·æ±‚ è·¯å¾„å¯ä»¥è®¾ç½®ä¸€ä¸ªæˆ–è€…å¤šä¸ª,ä¸ºé¡¹ç›®ä¸‹è·¯å¾„å³å¯</span></span><br><span class="line">    <span class="comment">//addPathPatterns(&quot;/common/request/one&quot;) æ·»åŠ æ‹¦æˆªè·¯å¾„</span></span><br><span class="line">    <span class="comment">//ä¹Ÿæ”¯æŒ /* å’Œ /** æ¨¡ç³Šè·¯å¾„ã€‚ * ä»»æ„ä¸€å±‚å­—ç¬¦ä¸² ** ä»»æ„å±‚ ä»»æ„å­—ç¬¦ä¸²</span></span><br><span class="line">    registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">Process01Interceptor</span>()).addPathPatterns(<span class="string">&quot;/common/request/one&quot;</span>,<span class="string">&quot;/common/request/tow&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>æ’é™¤é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ·»åŠ æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å°†æ‹¦æˆªå™¨æ·»åŠ åˆ°Springmvcç¯å¢ƒ,é»˜è®¤æ‹¦æˆªæ‰€æœ‰Springmvcåˆ†å‘çš„è¯·æ±‚</span></span><br><span class="line">    registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">Process01Interceptor</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ç²¾å‡†åŒ¹é…,è®¾ç½®æ‹¦æˆªå™¨å¤„ç†æŒ‡å®šè¯·æ±‚ è·¯å¾„å¯ä»¥è®¾ç½®ä¸€ä¸ªæˆ–è€…å¤šä¸ª,ä¸ºé¡¹ç›®ä¸‹è·¯å¾„å³å¯</span></span><br><span class="line">    <span class="comment">//addPathPatterns(&quot;/common/request/one&quot;) æ·»åŠ æ‹¦æˆªè·¯å¾„</span></span><br><span class="line">    registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">Process01Interceptor</span>()).addPathPatterns(<span class="string">&quot;/common/request/one&quot;</span>,<span class="string">&quot;/common/request/tow&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æ’é™¤åŒ¹é…,æ’é™¤åº”è¯¥åœ¨åŒ¹é…çš„èŒƒå›´å†…æ’é™¤</span></span><br><span class="line">    <span class="comment">//addPathPatterns(&quot;/common/request/one&quot;) æ·»åŠ æ‹¦æˆªè·¯å¾„</span></span><br><span class="line">    <span class="comment">//excludePathPatterns(&quot;/common/request/tow&quot;); æ’é™¤è·¯å¾„,æ’é™¤åº”è¯¥åœ¨æ‹¦æˆªçš„èŒƒå›´å†…</span></span><br><span class="line">    registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">Process01Interceptor</span>())</span><br><span class="line">            .addPathPatterns(<span class="string">&quot;/common/request/one&quot;</span>,<span class="string">&quot;/common/request/tow&quot;</span>)</span><br><span class="line">            .excludePathPatterns(<span class="string">&quot;/common/request/tow&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li><li><p>å¤šä¸ªæ‹¦æˆªå™¨æ‰§è¡Œé¡ºåº</p><ol><li>preHandle() æ–¹æ³•ï¼šSpringMVC ä¼šæŠŠæ‰€æœ‰æ‹¦æˆªå™¨æ”¶é›†åˆ°ä¸€èµ·ï¼Œç„¶åæŒ‰ç…§é…ç½®é¡ºåºè°ƒç”¨å„ä¸ª preHandle() æ–¹æ³•ã€‚</li><li>postHandle() æ–¹æ³•ï¼šSpringMVC ä¼šæŠŠæ‰€æœ‰æ‹¦æˆªå™¨æ”¶é›†åˆ°ä¸€èµ·ï¼Œç„¶åæŒ‰ç…§é…ç½®ç›¸åçš„é¡ºåºè°ƒç”¨å„ä¸ª postHandle() æ–¹æ³•ã€‚</li><li>afterCompletion() æ–¹æ³•ï¼šSpringMVC ä¼šæŠŠæ‰€æœ‰æ‹¦æˆªå™¨æ”¶é›†åˆ°ä¸€èµ·ï¼Œç„¶åæŒ‰ç…§é…ç½®ç›¸åçš„é¡ºåºè°ƒç”¨å„ä¸ª afterCompletion() æ–¹æ³•ã€‚<img src="/../../../ProTool/img/img1/202310150105406.png" alt="image-20231014143224525"></li></ol></li></ol><h3 id="5-3-å‚æ•°æ ¡éªŒ"><a href="#5-3-å‚æ•°æ ¡éªŒ" class="headerlink" title="5.3 å‚æ•°æ ¡éªŒ"></a>5.3 å‚æ•°æ ¡éªŒ</h3><blockquote><p>åœ¨ Web åº”ç”¨ä¸‰å±‚æ¶æ„ä½“ç³»ä¸­ï¼Œè¡¨è¿°å±‚è´Ÿè´£æ¥æ”¶æµè§ˆå™¨æäº¤çš„æ•°æ®ï¼Œä¸šåŠ¡é€»è¾‘å±‚è´Ÿè´£æ•°æ®çš„å¤„ç†ã€‚ä¸ºäº†èƒ½å¤Ÿè®©ä¸šåŠ¡é€»è¾‘å±‚åŸºäºæ­£ç¡®çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¡¨è¿°å±‚å¯¹æ•°æ®è¿›è¡Œæ£€æŸ¥ï¼Œå°†é”™è¯¯çš„æ•°æ®éš”ç»åœ¨ä¸šåŠ¡é€»è¾‘å±‚ä¹‹å¤–ã€‚</p><p><img src="/../../../ProTool/img/img1/image-20231014143507329.png" alt="image-20231014143507329"></p></blockquote><ol><li><p><strong>æ ¡éªŒæ¦‚è¿°</strong></p><p>JSR 303 æ˜¯ Java ä¸º Bean æ•°æ®åˆæ³•æ€§æ ¡éªŒæä¾›çš„æ ‡å‡†æ¡†æ¶ï¼Œå®ƒå·²ç»åŒ…å«åœ¨ JavaEE 6.0 æ ‡å‡†ä¸­ã€‚JSR 303 é€šè¿‡åœ¨ Bean å±æ€§ä¸Šæ ‡æ³¨ç±»ä¼¼äº @NotNullã€@Max ç­‰æ ‡å‡†çš„æ³¨è§£æŒ‡å®šæ ¡éªŒè§„åˆ™ï¼Œå¹¶é€šè¿‡æ ‡å‡†çš„éªŒè¯æ¥å£å¯¹Beanè¿›è¡ŒéªŒè¯ã€‚</p><table><thead><tr><th>æ³¨è§£</th><th>è§„åˆ™</th></tr></thead><tbody><tr><td>@Null</td><td>æ ‡æ³¨å€¼å¿…é¡»ä¸º null</td></tr><tr><td>@NotNull</td><td>æ ‡æ³¨å€¼ä¸å¯ä¸º null</td></tr><tr><td>@AssertTrue</td><td>æ ‡æ³¨å€¼å¿…é¡»ä¸º true</td></tr><tr><td>@AssertFalse</td><td>æ ‡æ³¨å€¼å¿…é¡»ä¸º false</td></tr><tr><td>@Min(value)</td><td>æ ‡æ³¨å€¼å¿…é¡»å¤§äºæˆ–ç­‰äº value</td></tr><tr><td>@Max(value)</td><td>æ ‡æ³¨å€¼å¿…é¡»å°äºæˆ–ç­‰äº value</td></tr><tr><td>@DecimalMin(value)</td><td>æ ‡æ³¨å€¼å¿…é¡»å¤§äºæˆ–ç­‰äº value</td></tr><tr><td>@DecimalMax(value)</td><td>æ ‡æ³¨å€¼å¿…é¡»å°äºæˆ–ç­‰äº value</td></tr><tr><td>@Size(max,min)</td><td>æ ‡æ³¨å€¼å¤§å°å¿…é¡»åœ¨ max å’Œ min é™å®šçš„èŒƒå›´å†…</td></tr><tr><td>@Digits(integer,fratction)</td><td>æ ‡æ³¨å€¼å€¼å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œä¸”å¿…é¡»åœ¨å¯æ¥å—çš„èŒƒå›´å†…</td></tr><tr><td>@Past</td><td>æ ‡æ³¨å€¼åªèƒ½ç”¨äºæ—¥æœŸå‹ï¼Œä¸”å¿…é¡»æ˜¯è¿‡å»çš„æ—¥æœŸ</td></tr><tr><td>@Future</td><td>æ ‡æ³¨å€¼åªèƒ½ç”¨äºæ—¥æœŸå‹ï¼Œä¸”å¿…é¡»æ˜¯å°†æ¥çš„æ—¥æœŸ</td></tr><tr><td>@Pattern(value)</td><td>æ ‡æ³¨å€¼å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼</td></tr><tr><td>JSR 303 åªæ˜¯ä¸€å¥—æ ‡å‡†ï¼Œéœ€è¦æä¾›å…¶å®ç°æ‰å¯ä»¥ä½¿ç”¨ã€‚Hibernate Validator æ˜¯ JSR 303 çš„ä¸€ä¸ªå‚è€ƒå®ç°ï¼Œé™¤æ”¯æŒæ‰€æœ‰æ ‡å‡†çš„æ ¡éªŒæ³¨è§£å¤–ï¼Œå®ƒè¿˜æ”¯æŒä»¥ä¸‹çš„æ‰©å±•æ³¨è§£ï¼š</td><td></td></tr><tr><td>æ³¨è§£</td><td>è§„åˆ™</td></tr><tr><td>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-</td><td>â€”â€”â€”â€”â€”â€”â€“</td></tr><tr><td>@Email</td><td>æ ‡æ³¨å€¼å¿…é¡»æ˜¯æ ¼å¼æ­£ç¡®çš„ Email åœ°å€</td></tr><tr><td>@Length</td><td>æ ‡æ³¨å€¼å­—ç¬¦ä¸²å¤§å°å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…</td></tr><tr><td>@NotEmpty</td><td>æ ‡æ³¨å€¼å­—ç¬¦ä¸²ä¸èƒ½æ˜¯ç©ºå­—ç¬¦ä¸²</td></tr><tr><td>@Range</td><td>æ ‡æ³¨å€¼å¿…é¡»åœ¨æŒ‡å®šçš„èŒƒå›´å†…</td></tr><tr><td>Spring 4.0 ç‰ˆæœ¬å·²ç»æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®æ ¡éªŒæ¡†æ¶ï¼ŒåŒæ—¶æ”¯æŒ JSR 303 æ ‡å‡†çš„æ ¡éªŒæ¡†æ¶ã€‚Spring åœ¨è¿›è¡Œæ•°æ®ç»‘å®šæ—¶ï¼Œå¯åŒæ—¶è°ƒç”¨æ ¡éªŒæ¡†æ¶å®Œæˆæ•°æ®æ ¡éªŒå·¥ä½œã€‚åœ¨SpringMVC ä¸­ï¼Œå¯ç›´æ¥é€šè¿‡æ³¨è§£é©±åŠ¨ @EnableWebMvc çš„æ–¹å¼è¿›è¡Œæ•°æ®æ ¡éªŒã€‚Spring çš„ LocalValidatorFactoryBean æ—¢å®ç°äº† Spring çš„ Validator æ¥å£ï¼Œä¹Ÿå®ç°äº† JSR 303 çš„ Validator æ¥å£ã€‚åªè¦åœ¨Springå®¹å™¨ä¸­å®šä¹‰äº†ä¸€ä¸ªLocalValidatorFactoryBeanï¼Œå³å¯å°†å…¶æ³¨å…¥åˆ°éœ€è¦æ•°æ®æ ¡éªŒçš„ Beanä¸­ã€‚Springæœ¬èº«å¹¶æ²¡æœ‰æä¾›JSR 303çš„å®ç°ï¼Œæ‰€ä»¥å¿…é¡»å°†JSR 303çš„å®ç°è€…çš„jaråŒ…æ”¾åˆ°ç±»è·¯å¾„ä¸‹ã€‚</td><td></td></tr><tr><td>é…ç½® @EnableWebMvcåï¼ŒSpringMVC ä¼šé»˜è®¤è£…é…å¥½ä¸€ä¸ª LocalValidatorFactoryBeanï¼Œé€šè¿‡åœ¨å¤„ç†æ–¹æ³•çš„å…¥å‚ä¸Šæ ‡æ³¨ @Validated æ³¨è§£å³å¯è®© SpringMVC åœ¨å®Œæˆæ•°æ®ç»‘å®šåæ‰§è¡Œæ•°æ®æ ¡éªŒçš„å·¥ä½œã€‚</td><td></td></tr></tbody></table></li><li><p><strong>æ“ä½œæ¼”ç¤º</strong></p><ul><li><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ ¡éªŒæ³¨è§£ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.platform<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.jakartaee-web-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>9.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">&lt;!-- æ ¡éªŒæ³¨è§£å®ç°--&gt;</span>        </span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.hibernate.validator/hibernate-validator --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate.validator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.hibernate.validator/hibernate-validator-annotation-processor --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate.validator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator-annotation-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>åº”ç”¨æ ¡éªŒæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jakarta.validation.constraints.Email;</span><br><span class="line"><span class="keyword">import</span> jakarta.validation.constraints.Min;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.validator.constraints.Length;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * projectName: com.atguigu.pojo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">//age   1 &lt;=  age &lt; = 150</span></span><br><span class="line">    <span class="meta">@Min(10)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//name 3 &lt;= name.length &lt;= 6</span></span><br><span class="line">    <span class="meta">@Length(min = 3,max = 10)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//email é‚®ç®±æ ¼å¼</span></span><br><span class="line">    <span class="meta">@Email</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getEmail</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmail</span><span class="params">(String email)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>handleræ ‡è®°å’Œç»‘å®šé”™è¯¯æ”¶é›†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Validated</span> ä»£è¡¨åº”ç”¨æ ¡éªŒæ³¨è§£! å¿…é¡»æ·»åŠ !</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">save</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> User user,</span></span><br><span class="line"><span class="params">                       //åœ¨å®ä½“ç±»å‚æ•°å’Œ BindingResult ä¹‹é—´ä¸èƒ½æœ‰ä»»ä½•å…¶ä»–å‚æ•°, BindingResultå¯ä»¥æ¥å—é”™è¯¯ä¿¡æ¯,é¿å…ä¿¡æ¯æŠ›å‡º!</span></span><br><span class="line"><span class="params">                       BindingResult result)</span>&#123;</span><br><span class="line">       <span class="comment">//åˆ¤æ–­æ˜¯å¦æœ‰ä¿¡æ¯ç»‘å®šé”™è¯¯! æœ‰å¯ä»¥è‡ªè¡Œå¤„ç†!</span></span><br><span class="line">        <span class="keyword">if</span> (result.hasErrors())&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;é”™è¯¯&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">errorMsg</span> <span class="operator">=</span> result.getFieldError().toString();</span><br><span class="line">            <span class="keyword">return</span> errorMsg;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ²¡æœ‰,æ­£å¸¸å¤„ç†ä¸šåŠ¡å³å¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ­£å¸¸&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æµ‹è¯•æ•ˆæœ</p><p><img src="/../../../ProTool/img/img1/image_BKORDdDEb9.png"></p></li></ul></li><li><p><strong>æ˜“æ··æ€»ç»“</strong></p><p>@NotNullã€@NotEmptyã€@NotBlank éƒ½æ˜¯ç”¨äºåœ¨æ•°æ®æ ¡éªŒä¸­æ£€æŸ¥å­—æ®µå€¼æ˜¯å¦ä¸ºç©ºçš„æ³¨è§£ï¼Œä½†æ˜¯å®ƒä»¬çš„ç”¨æ³•å’Œæ ¡éªŒè§„åˆ™æœ‰æ‰€ä¸åŒã€‚</p><ol><li><p>@NotNull  (åŒ…è£…ç±»å‹ä¸ä¸ºnull)</p><p>@NotNull æ³¨è§£æ˜¯ JSR 303 è§„èŒƒä¸­å®šä¹‰çš„æ³¨è§£ï¼Œå½“è¢«æ ‡æ³¨çš„å­—æ®µå€¼ä¸º null æ—¶ï¼Œä¼šè®¤ä¸ºæ ¡éªŒå¤±è´¥è€ŒæŠ›å‡ºå¼‚å¸¸ã€‚è¯¥æ³¨è§£ä¸èƒ½ç”¨äºå­—ç¬¦ä¸²ç±»å‹çš„æ ¡éªŒï¼Œè‹¥è¦å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ ¡éªŒï¼Œåº”è¯¥ä½¿ç”¨ @NotBlank æˆ– @NotEmpty æ³¨è§£ã€‚</p></li><li><p>@NotEmpty (é›†åˆç±»å‹é•¿åº¦å¤§äº0)</p><p>@NotEmpty æ³¨è§£åŒæ ·æ˜¯ JSR 303 è§„èŒƒä¸­å®šä¹‰çš„æ³¨è§£ï¼Œå¯¹äº CharSequenceã€Collectionã€Map æˆ–è€…æ•°ç»„å¯¹è±¡ç±»å‹çš„å±æ€§è¿›è¡Œæ ¡éªŒï¼Œæ ¡éªŒæ—¶ä¼šæ£€æŸ¥è¯¥å±æ€§æ˜¯å¦ä¸º Null æˆ–è€… size()&#x3D;&#x3D;0ï¼Œå¦‚æœæ˜¯çš„è¯å°±ä¼šæ ¡éªŒå¤±è´¥ã€‚ä½†æ˜¯å¯¹äºå…¶ä»–ç±»å‹çš„å±æ€§ï¼Œè¯¥æ³¨è§£æ— æ•ˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯åªæ ¡éªŒç©ºæ ¼å‰åçš„å­—ç¬¦ä¸²ï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸²ä¸­é—´åªæœ‰ç©ºæ ¼ï¼Œä¸ä¼šè¢«è®¤ä¸ºæ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œæ ¡éªŒä¸ä¼šå¤±è´¥ã€‚</p></li><li><p>@NotBlank ï¼ˆå­—ç¬¦ä¸²ï¼Œä¸ä¸ºnullï¼Œåˆ‡ä¸ä¸ºâ€  â€œå­—ç¬¦ä¸²ï¼‰</p><p>@NotBlank æ³¨è§£æ˜¯ Hibernate Validator é™„åŠ çš„æ³¨è§£ï¼Œå¯¹äºå­—ç¬¦ä¸²ç±»å‹çš„å±æ€§è¿›è¡Œæ ¡éªŒï¼Œæ ¡éªŒæ—¶ä¼šæ£€æŸ¥è¯¥å±æ€§æ˜¯å¦ä¸º Null æˆ– â€œâ€ æˆ–è€…åªåŒ…å«ç©ºæ ¼ï¼Œå¦‚æœæ˜¯çš„è¯å°±ä¼šæ ¡éªŒå¤±è´¥ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ@NotBlank æ³¨è§£åªèƒ½ç”¨äºå­—ç¬¦ä¸²ç±»å‹çš„æ ¡éªŒã€‚<br>æ€»ä¹‹ï¼Œè¿™ä¸‰ç§æ³¨è§£éƒ½æ˜¯ç”¨äºæ ¡éªŒå­—æ®µå€¼æ˜¯å¦ä¸ºç©ºçš„æ³¨è§£ï¼Œä½†æ˜¯å…¶æ ¡éªŒè§„åˆ™å’Œç”¨æ³•æœ‰æ‰€ä¸åŒã€‚åœ¨è¿›è¡Œæ•°æ®æ ¡éªŒæ—¶ï¼Œéœ€è¦æ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©åˆé€‚çš„æ³¨è§£è¿›è¡Œæ ¡éªŒã€‚</p></li></ol></li></ol><h2 id="å…­ã€SpringMVCæ€»ç»“"><a href="#å…­ã€SpringMVCæ€»ç»“" class="headerlink" title="å…­ã€SpringMVCæ€»ç»“"></a>å…­ã€SpringMVCæ€»ç»“</h2><table><thead><tr><th>æ ¸å¿ƒç‚¹</th><th>æŒæ¡ç›®æ ‡</th></tr></thead><tbody><tr><td>springmvcæ¡†æ¶</td><td>ä¸»è¦ä½œç”¨ã€æ ¸å¿ƒç»„ä»¶ã€è°ƒç”¨æµç¨‹</td></tr><tr><td>ç®€åŒ–å‚æ•°æ¥æ”¶</td><td>è·¯å¾„è®¾è®¡ã€å‚æ•°æ¥æ”¶ã€è¯·æ±‚å¤´æ¥æ”¶ã€cookieæ¥æ”¶</td></tr><tr><td>ç®€åŒ–æ•°æ®å“åº”</td><td>æ¨¡æ¿é¡µé¢ã€è½¬å‘å’Œé‡å®šå‘ã€JSONæ•°æ®ã€é™æ€èµ„æº</td></tr><tr><td>restfulé£æ ¼è®¾è®¡</td><td>ä¸»è¦ä½œç”¨ã€å…·ä½“è§„èŒƒã€è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚å‚æ•°é€‰æ‹©</td></tr><tr><td>åŠŸèƒ½æ‰©å±•</td><td>å…¨å±€å¼‚å¸¸å¤„ç†ã€æ‹¦æˆªå™¨ã€å‚æ•°æ ¡éªŒæ³¨è§£</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;SpringMVC&quot;&gt;&lt;a href=&quot;#SpringMVC&quot; class=&quot;headerlink&quot; title=&quot;SpringMVC&quot;&gt;&lt;/a&gt;SpringMVC&lt;/h1&gt;&lt;h2 id=&quot;ç›®å½•&quot;&gt;&lt;a href=&quot;#ç›®å½•&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="åç«¯" scheme="https://axdmdyj.github.io/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
    <category term="SpringMVC" scheme="https://axdmdyj.github.io/tags/SpringMVC/"/>
    
  </entry>
  
  <entry>
    <title>TypeScript</title>
    <link href="https://axdmdyj.github.io/posts/d044eab7.html"/>
    <id>https://axdmdyj.github.io/posts/d044eab7.html</id>
    <published>2023-10-14T15:13:01.000Z</published>
    <updated>2023-11-21T06:54:08.361Z</updated>
    
    <content type="html"><![CDATA[<h1 id="TypeScript"><a href="#TypeScript" class="headerlink" title="TypeScript"></a>TypeScript</h1><p><img src="/../../../ProTool/img/img1/202310142311876-16972964465172.png" alt="image-20231014231100506"></p><h2 id="1-ç±»å‹æ¨æ–­"><a href="#1-ç±»å‹æ¨æ–­" class="headerlink" title="1.ç±»å‹æ¨æ–­"></a>1.ç±»å‹æ¨æ–­</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line"></span><br><span class="line">str = <span class="number">10</span>  <span class="comment">//æŠ¥é”™</span></span><br></pre></td></tr></table></figure><h2 id="2-ç±»å‹æ³¨è§£"><a href="#2-ç±»å‹æ³¨è§£" class="headerlink" title="2.ç±»å‹æ³¨è§£"></a>2.ç±»å‹æ³¨è§£</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">str</span>: <span class="built_in">string</span>    <span class="comment">//é¢„å®šä¹‰ä¸€ä¸ªç±»å‹</span></span><br><span class="line">str = <span class="string">&#x27;abc&#x27;</span></span><br></pre></td></tr></table></figure><h2 id="3-ç±»å‹æ–­è¨€"><a href="#3-ç±»å‹æ–­è¨€" class="headerlink" title="3.ç±»å‹æ–­è¨€"></a>3.ç±»å‹æ–­è¨€</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> numArr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="keyword">const</span> result = numArr.<span class="title function_">find</span>(<span class="function"><span class="params">item</span> =&gt;</span> item &gt; <span class="number">2</span>) <span class="keyword">as</span> <span class="built_in">number</span> <span class="comment">// as numberæ–­è¨€ä¸€å®šæœ‰å¤§äº2çš„æ•°</span></span><br><span class="line">result*<span class="number">5</span>  <span class="comment">// å¦‚æœä¸æ–­è¨€, è¿™è¡Œä¼šæŠ¥é”™,å› ä¸ºå¯èƒ½ressultæ˜¯undefined</span></span><br></pre></td></tr></table></figure><h2 id="4-åŸºç¡€ç±»å‹å’Œè”åˆç±»å‹"><a href="#4-åŸºç¡€ç±»å‹å’Œè”åˆç±»å‹" class="headerlink" title="4.åŸºç¡€ç±»å‹å’Œè”åˆç±»å‹"></a>4.åŸºç¡€ç±»å‹å’Œè”åˆç±»å‹</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŸºç¡€ç±»å‹, å½“æˆ‘ä»¬åˆ†é…è¿™äº›ç±»å‹ä»¥å, å°±ä¸èƒ½è¿›è¡Œå…¶ä»–ç±»å‹çš„è®¾ç½®äº†</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">v1</span>: <span class="built_in">string</span> = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">v2</span>: <span class="built_in">number</span> = <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">v3</span>: <span class="built_in">boolean</span> = <span class="literal">true</span></span><br><span class="line"><span class="comment">// ä»¥ä¸‹ä¸¤ç§ä¸å¸¸ç”¨</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">nu</span>: <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">un</span>: <span class="literal">undefined</span> = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è”åˆç±»å‹,å¯ä»¥æ˜¯ä¸€ç§ç±»å‹ä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ç§ç±»å‹</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">v4</span>: <span class="built_in">string</span> | <span class="literal">null</span> = <span class="literal">null</span>  <span class="comment">// nullå¯ä»¥èµ‹å€¼ç»™ä»»æ„ç±»å‹(å‰æä¸å¼€å¯ä¸¥æ ¼é…ç½®é¡¹)</span></span><br><span class="line"><span class="comment">// å…·ä½“å€¼çš„é™åˆ¶, åªèƒ½åˆ†é…å…¶ä¸­ä¹‹ä¸€</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">v5</span>: <span class="number">1</span>|<span class="number">2</span>|<span class="number">3</span> =<span class="number">5</span><span class="comment">//æŠ¥é”™   =2æ­£ç¡®</span></span><br></pre></td></tr></table></figure><h2 id="5-æ•°ç»„-å…ƒç»„-æšä¸¾"><a href="#5-æ•°ç»„-å…ƒç»„-æšä¸¾" class="headerlink" title="5.æ•°ç»„,å…ƒç»„,æšä¸¾"></a>5.æ•°ç»„,å…ƒç»„,æšä¸¾</h2><h3 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>: <span class="built_in">number</span>[] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];<span class="comment">//[1,2,3,&#x27;a&#x27;]æŠ¥é”™</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">arr1</span>: <span class="title class_">Array</span>&lt;<span class="built_in">string</span>&gt; = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>];<span class="comment">//[&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;1]æŠ¥é”™</span></span><br></pre></td></tr></table></figure><h3 id="å…ƒç»„"><a href="#å…ƒç»„" class="headerlink" title="å…ƒç»„"></a>å…ƒç»„</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">t1</span>: [<span class="built_in">number</span>,<span class="built_in">string</span>,<span class="built_in">number</span>] = [<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>,<span class="number">2</span>] <span class="comment">//å®šä¹‰ä¸€ä¸ªå…ƒç»„</span></span><br><span class="line"><span class="comment">// t1[0] = &#x27;a&#x27; æŠ¥é”™</span></span><br><span class="line">å¹¶ä¸ä¸€å®šè¦ä¸‰ä¸ªå€¼, å¯é€‰</span><br><span class="line"><span class="keyword">let</span> <span class="attr">t1</span>: [<span class="built_in">number</span>,<span class="built_in">string</span>,<span class="built_in">number</span>?] = [<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>,<span class="number">2</span>] <span class="comment">//2å»æ‰ä¹Ÿä¸æŠ¥é”™,ä½†&#x27;a&#x27;å»æ‰æŠ¥é”™</span></span><br></pre></td></tr></table></figure><h3 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰æšä¸¾ç±»å‹</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">MyEnum</span>&#123;</span><br><span class="line">    A,</span><br><span class="line">    B,</span><br><span class="line">    C</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¸¤ç§è®¿é—®æ–¹å¼</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">MyEnum</span>.<span class="property">A</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">MyEnum</span>[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><h3 id="Voidç±»å‹"><a href="#Voidç±»å‹" class="headerlink" title="Voidç±»å‹"></a>Voidç±»å‹</h3><p>åªèƒ½è¢«èµ‹å€¼ä¸º<code>undefined</code></p><h2 id="6-å‡½æ•°"><a href="#6-å‡½æ•°" class="headerlink" title="6.å‡½æ•°"></a>6.å‡½æ•°</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">MyFn</span> (<span class="attr">a</span>:<span class="built_in">number</span>, <span class="attr">b</span>:<span class="built_in">string</span>)   <span class="comment">//å‚æ•°æ¥æ”¶</span></span><br><span class="line">: <span class="built_in">number</span>&#123; <span class="comment">//è®¾ç½®è¿”å›å€¼ç±»å‹</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyFn</span> (<span class="attr">a</span>:<span class="built_in">number</span>, b?:<span class="built_in">string</span>, c?:<span class="built_in">boolean</span>, ...<span class="attr">rest</span>:<span class="built_in">number</span>[])   <span class="comment">//bå¯é€‰, å»ºè®®å¿…é€‰çš„æ”¾å·¦ä¾§, å¯é€‰çš„æ”¾å³ä¾§</span></span><br><span class="line">: <span class="built_in">number</span>&#123; <span class="comment">//è®¾ç½®è¿”å›å€¼ç±»å‹</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">const</span> f = <span class="title class_">MyFn</span>(<span class="number">20</span>,<span class="string">&#x27;abc&#x27;</span>,<span class="literal">true</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure><h2 id="7-æ¥å£"><a href="#7-æ¥å£" class="headerlink" title="7.æ¥å£"></a>7.æ¥å£</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰è‡ªå·±åˆ›å»ºç±»å‹çš„ä¸€ä¸ªçº¦æŸæ–¹å¼</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Obj</span>&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">age</span>:<span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">obj</span>:<span class="title class_">Obj</span>=&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>:<span class="number">10</span>  <span class="comment">//é¿å…ä¸€äº›é”™è¯¯, æ¯”å¦‚å†™æˆago = 10å°±ä¼šæŠ¥é”™</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">obj2</span>:<span class="title class_">Obj</span>=&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>:<span class="number">10</span>  <span class="comment">//é¿å…ä¸€äº›é”™è¯¯, æ¯”å¦‚å†™æˆago = 10å°±ä¼šæŠ¥é”™</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-ç±»å‹åˆ«å"><a href="#8-ç±»å‹åˆ«å" class="headerlink" title="8.ç±»å‹åˆ«å"></a>8.ç±»å‹åˆ«å</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyUserName</span> = <span class="built_in">string</span> | <span class="built_in">number</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="title class_">MyUserName</span> = <span class="string">&#x27;a&#x27;</span>  <span class="comment">// = 1ä¹Ÿå¯ä»¥</span></span><br></pre></td></tr></table></figure><h2 id="9-æ³›å‹"><a href="#9-æ³›å‹" class="headerlink" title="9.æ³›å‹"></a>9.æ³›å‹</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myFn</span>(<span class="params">a:<span class="built_in">number</span>,b:<span class="built_in">number</span></span>):<span class="built_in">number</span>[]&#123;</span><br><span class="line">    <span class="keyword">return</span> [a,b]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ”¹æˆé€šç”¨çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">function</span> myFn&lt;T&gt;(<span class="attr">a</span>:T,<span class="attr">b</span>:T):T[]&#123;</span><br><span class="line">    <span class="keyword">return</span> [a,b]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myfN&lt;<span class="built_in">number</span>&gt;(<span class="number">1</span>,<span class="number">2</span>) <span class="comment">//(1,&#x27;a&#x27;)æŠ¥é”™</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;TypeScript&quot;&gt;&lt;a href=&quot;#TypeScript&quot; class=&quot;headerlink&quot; title=&quot;TypeScript&quot;&gt;&lt;/a&gt;TypeScript&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/../../../ProTool/img/img1/2</summary>
      
    
    
    
    <category term="å‰ç«¯" scheme="https://axdmdyj.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="TypeScript" scheme="https://axdmdyj.github.io/tags/TypeScript/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•60å¤©è®­ç»ƒâ€“10-10-day35</title>
    <link href="https://axdmdyj.github.io/posts/9b8ac020.html"/>
    <id>https://axdmdyj.github.io/posts/9b8ac020.html</id>
    <published>2023-10-09T16:49:59.000Z</published>
    <updated>2023-11-12T08:53:08.572Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-II"><a href="#ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-II" class="headerlink" title="ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II"></a><a href="https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-ii/">ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II</a></h1><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><ul><li>åªæœ‰ä¸€åªè‚¡ç¥¨ï¼</li><li>å½“å‰åªæœ‰ä¹°è‚¡ç¥¨æˆ–è€…å–è‚¡ç¥¨çš„æ“ä½œ</li></ul><p>æƒ³è·å¾—åˆ©æ¶¦è‡³å°‘è¦ä¸¤å¤©ä¸ºä¸€ä¸ªäº¤æ˜“å•å…ƒã€‚</p><h2 id="è§£æ³•"><a href="#è§£æ³•" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>åˆ†è§£æœ¬é¢˜</p><p>å‡å¦‚ç¬¬ 0 å¤©ä¹°å…¥ï¼Œç¬¬ 3 å¤©å–å‡ºï¼Œé‚£ä¹ˆåˆ©æ¶¦ä¸ºï¼š<code>prices[3] - prices[0]ã€‚</code></p><p>ç›¸å½“äº<code>(prices[3] - prices[2]) + (prices[2] - prices[1]) + (prices[1] - prices[0])ã€‚</code></p><p><strong>æ­¤æ—¶å°†åˆ©æ¶¦åˆ†è§£ä¸ºæ¯å¤©ä¸ºå•ä½çš„ç»´åº¦ , è€Œä¸æ˜¯ä»è¿ç»­å‡ å¤©è€ƒè™‘</strong></p><p>pricesæ¯å¤©çš„åˆ©æ¶¦åºåˆ— <code>(prices[i] - prices[i - 1]).....(prices[1] - prices[0])</code></p><p><strong>æ”¶é›†æ­£åˆ©æ¶¦çš„åŒºé—´ï¼Œå°±æ˜¯è‚¡ç¥¨ä¹°å–çš„åŒºé—´ï¼Œè€Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨æœ€ç»ˆåˆ©æ¶¦ï¼Œä¸éœ€è¦è®°å½•åŒºé—´</strong>ã€‚</p><p>åªæ”¶é›†æ­£åˆ©æ¶¦ å°±æ˜¯è´ªå¿ƒæ‰€è´ªçš„åœ°æ–¹</p><p>&#x3D;&#x3D;å±€éƒ¨æœ€ä¼˜&#x3D;&#x3D; æ”¶é›†æ¯å¤©çš„æ­£åˆ©æ¶¦, å…¨å±€æœ€ä¼˜: æ±‚å¾—æœ€å¤§åˆ©æ¶¦</p><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; prices.length; i++)&#123;</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">            res += Math.max(prices[i] - prices[i - <span class="number">1</span>], <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="55-è·³è·ƒæ¸¸æˆ"><a href="#55-è·³è·ƒæ¸¸æˆ" class="headerlink" title="55. è·³è·ƒæ¸¸æˆ"></a><a href="https://leetcode.cn/problems/jump-game/">55. è·³è·ƒæ¸¸æˆ</a></h1><h2 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>è·³å‡ æ­¥æ— æ‰€è°“, å…³é”®åœ¨äºå¯è·³çš„è¦†ç›–èŒƒå›´</p><p>&#x3D;&gt; <strong>é—®é¢˜è½¬åŒ–ä¸º: è·³è·ƒè¦†ç›–çš„èŒƒå›´èƒ½ä¸èƒ½åˆ°è¾¾ç»ˆç‚¹</strong></p><h2 id="è§£æ³•-1"><a href="#è§£æ³•-1" class="headerlink" title="è§£æ³•"></a>è§£æ³•</h2><p>æ¯æ¬¡ç§»åŠ¨å–æœ€å¤§è·³è·ƒæ­¥æ•°ï¼ˆå¾—åˆ°æœ€å¤§çš„è¦†ç›–èŒƒå›´ï¼‰ï¼Œæ¯ç§»åŠ¨ä¸€ä¸ªå•ä½ï¼Œå°±æ›´æ–°æœ€å¤§è¦†ç›–èŒƒå›´ã€‚</p><p><strong>è´ªå¿ƒç®—æ³•å±€éƒ¨æœ€ä¼˜è§£ï¼šæ¯æ¬¡å–æœ€å¤§è·³è·ƒæ­¥æ•°ï¼ˆå–æœ€å¤§è¦†ç›–èŒƒå›´ï¼‰ï¼Œæ•´ä½“æœ€ä¼˜è§£ï¼šæœ€åå¾—åˆ°æ•´ä½“æœ€å¤§è¦†ç›–èŒƒå›´ï¼Œçœ‹æ˜¯å¦èƒ½åˆ°ç»ˆç‚¹</strong>ã€‚</p><h2 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canJump</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">cover</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(nums.length == <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= cover; i++)&#123;</span><br><span class="line">            cover = Math.max(i + nums[i] , cover);</span><br><span class="line">            <span class="keyword">if</span>(cover &gt;= nums.length - <span class="number">1</span>)&#123; </span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ <code>i &lt;= cover</code> åœ¨è¦†ç›–èŒƒå›´å†…ç§»åŠ¨, è¶…å‡ºè¦†ç›–èŒƒå›´æ²¡æœ‰æ„ä¹‰</p><h1 id="45-è·³è·ƒæ¸¸æˆ-II"><a href="#45-è·³è·ƒæ¸¸æˆ-II" class="headerlink" title="45. è·³è·ƒæ¸¸æˆ II"></a><a href="https://leetcode.cn/problems/jump-game-ii/">45. è·³è·ƒæ¸¸æˆ II</a></h1><h2 id="åˆ†æ-2"><a href="#åˆ†æ-2" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p><strong>å±€éƒ¨æœ€ä¼˜</strong>ï¼šå½“å‰å¯ç§»åŠ¨è·ç¦»å°½å¯èƒ½å¤šèµ°ï¼Œå¦‚æœè¿˜æ²¡åˆ°ç»ˆç‚¹ï¼Œæ­¥æ•°å†åŠ ä¸€ã€‚</p><p><strong>æ•´ä½“æœ€ä¼˜ï¼š</strong>ä¸€æ­¥å°½å¯èƒ½å¤šèµ°ï¼Œä»è€Œè¾¾åˆ°æœ€å°‘æ­¥æ•°ã€‚</p><p><strong>ä»è¦†ç›–èŒƒå›´å‡ºå‘ï¼Œä¸ç®¡æ€ä¹ˆè·³ï¼Œè¦†ç›–èŒƒå›´å†…ä¸€å®šæ˜¯å¯ä»¥è·³åˆ°çš„ï¼Œä»¥æœ€å°çš„æ­¥æ•°å¢åŠ è¦†ç›–èŒƒå›´ï¼Œè¦†ç›–èŒƒå›´ä¸€æ—¦è¦†ç›–äº†ç»ˆç‚¹ï¼Œå¾—åˆ°çš„å°±æ˜¯æœ€å°‘æ­¥æ•°ï¼</strong></p><h2 id="Code-2"><a href="#Code-2" class="headerlink" title="Code"></a>Code</h2><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line">    <span class="type">int</span> <span class="title function_">jump</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&amp; nums)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.size() == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> curDistance = <span class="number">0</span>;    <span class="comment">// å½“å‰è¦†ç›–æœ€è¿œè·ç¦»ä¸‹æ ‡</span></span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;            <span class="comment">// è®°å½•èµ°çš„æœ€å¤§æ­¥æ•°</span></span><br><span class="line">        <span class="type">int</span> nextDistance = <span class="number">0</span>;   <span class="comment">// ä¸‹ä¸€æ­¥è¦†ç›–æœ€è¿œè·ç¦»ä¸‹æ ‡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; nums.size(); i++) &#123;</span><br><span class="line">            nextDistance = max(nums[i] + i, nextDistance);  <span class="comment">// æ›´æ–°ä¸‹ä¸€æ­¥è¦†ç›–æœ€è¿œè·ç¦»ä¸‹æ ‡</span></span><br><span class="line">            <span class="keyword">if</span> (i == curDistance) &#123;                         <span class="comment">// é‡åˆ°å½“å‰è¦†ç›–æœ€è¿œè·ç¦»ä¸‹æ ‡</span></span><br><span class="line">                ans++;                                  <span class="comment">// éœ€è¦èµ°ä¸‹ä¸€æ­¥</span></span><br><span class="line">                curDistance = nextDistance;             <span class="comment">// æ›´æ–°å½“å‰è¦†ç›–æœ€è¿œè·ç¦»ä¸‹æ ‡ï¼ˆç›¸å½“äºåŠ æ²¹äº†ï¼‰</span></span><br><span class="line">                <span class="keyword">if</span> (nextDistance &gt;= nums.size() - <span class="number">1</span>) <span class="keyword">break</span>;  <span class="comment">// å½“å‰è¦†ç›–æœ€è¿œè·åˆ°è¾¾é›†åˆç»ˆç‚¹ï¼Œä¸ç”¨åšans++æ“ä½œäº†ï¼Œç›´æ¥ç»“æŸ</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-II&quot;&gt;&lt;a href=&quot;#ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-II&quot; class=&quot;headerlink&quot; title=&quot;ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problems/best-time-to</summary>
      
    
    
    
    <category term="ç®—æ³•60å¤©æ‰“å¡" scheme="https://axdmdyj.github.io/categories/%E7%AE%97%E6%B3%9560%E5%A4%A9%E6%89%93%E5%8D%A1/"/>
    
    
    <category term="å›æº¯ç®—æ³•" scheme="https://axdmdyj.github.io/tags/%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•60å¤©è®­ç»ƒâ€“10-07-day32</title>
    <link href="https://axdmdyj.github.io/posts/ce36b93.html"/>
    <id>https://axdmdyj.github.io/posts/ce36b93.html</id>
    <published>2023-10-07T12:46:42.000Z</published>
    <updated>2023-11-12T08:53:08.571Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å›æº¯ç®—æ³•æ€»ç»“"><a href="#å›æº¯ç®—æ³•æ€»ç»“" class="headerlink" title="å›æº¯ç®—æ³•æ€»ç»“"></a>å›æº¯ç®—æ³•æ€»ç»“</h1><h2 id="ç†è®ºåŸºç¡€"><a href="#ç†è®ºåŸºç¡€" class="headerlink" title="ç†è®ºåŸºç¡€"></a>ç†è®ºåŸºç¡€</h2><p><strong>å›æº¯æ˜¯é€’å½’çš„å‰¯äº§å“ï¼Œåªè¦æœ‰é€’å½’å°±ä¼šæœ‰å›æº¯</strong>ï¼Œæ‰€ä»¥å›æº¯æ³•ä¹Ÿç»å¸¸å’ŒäºŒå‰æ ‘éå†ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢æ··åœ¨ä¸€èµ·ï¼Œå› ä¸ºè¿™ä¸¤ç§æ–¹å¼éƒ½æ˜¯ç”¨äº†é€’å½’ã€‚</p><p>å›æº¯ç®—æ³•èƒ½è§£å†³å¦‚ä¸‹é—®é¢˜ï¼š</p><ul><li>ç»„åˆé—®é¢˜ï¼šNä¸ªæ•°é‡Œé¢æŒ‰ä¸€å®šè§„åˆ™æ‰¾å‡ºkä¸ªæ•°çš„é›†åˆ</li><li>æ’åˆ—é—®é¢˜ï¼šNä¸ªæ•°æŒ‰ä¸€å®šè§„åˆ™å…¨æ’åˆ—ï¼Œæœ‰å‡ ç§æ’åˆ—æ–¹å¼</li><li>åˆ‡å‰²é—®é¢˜ï¼šä¸€ä¸ªå­—ç¬¦ä¸²æŒ‰ä¸€å®šè§„åˆ™æœ‰å‡ ç§åˆ‡å‰²æ–¹å¼</li><li>å­é›†é—®é¢˜ï¼šä¸€ä¸ªNä¸ªæ•°çš„é›†åˆé‡Œæœ‰å¤šå°‘ç¬¦åˆæ¡ä»¶çš„å­é›†</li><li>æ£‹ç›˜é—®é¢˜ï¼šNçš‡åï¼Œè§£æ•°ç‹¬ç­‰ç­‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">void backtracking(å‚æ•°) &#123;</span><br><span class="line">    if (ç»ˆæ­¢æ¡ä»¶) &#123;</span><br><span class="line">        å­˜æ”¾ç»“æœ;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (é€‰æ‹©ï¼šæœ¬å±‚é›†åˆä¸­å…ƒç´ ï¼ˆæ ‘ä¸­èŠ‚ç‚¹å­©å­çš„æ•°é‡å°±æ˜¯é›†åˆçš„å¤§å°ï¼‰) &#123;</span><br><span class="line">        å¤„ç†èŠ‚ç‚¹;</span><br><span class="line">        backtracking(è·¯å¾„ï¼Œé€‰æ‹©åˆ—è¡¨); // é€’å½’</span><br><span class="line">        å›æº¯ï¼Œæ’¤é”€å¤„ç†ç»“æœ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»„åˆé—®é¢˜"><a href="#ç»„åˆé—®é¢˜" class="headerlink" title="ç»„åˆé—®é¢˜"></a>ç»„åˆé—®é¢˜</h2><p>é¢˜ç›®é“¾æ¥: <a href="https://leetcode.cn/problems/combinations/description/">https://leetcode.cn/problems/combinations/description/</a></p><p>é€šè¿‡åˆ—ä¸¾10086å±‚<code>forå¾ªç¯çš„ä¾‹å­, è¿›è€Œå¾—å‡ºä¸ºä»€ä¹ˆè¦ç”¨å›æº¯æ³•</code></p><p>æœç´¢çš„è¿‡ç¨‹ï¼š<strong>forå¾ªç¯æ¨ªå‘éå†ï¼Œé€’å½’çºµå‘éå†ï¼Œå›æº¯ä¸æ–­è°ƒæ•´ç»“æœé›†</strong>ï¼Œè¿™ä¸ªç†å¿µè´¯ç©¿æ•´ä¸ªå›æº¯æ³•ç³»åˆ—</p><p>å¯ä»¥é€šè¿‡æ€è€ƒåœ¨å“ªä¸€æ­¥ä¸éœ€è¦ç»§ç»­å¾€ä¸‹éå†äº†. ç„¶åè¿›è¡Œå‰ªæä¼˜åŒ–</p><p><strong>å‰ªæç²¾é«“æ˜¯ï¼šforå¾ªç¯åœ¨å¯»æ‰¾èµ·ç‚¹çš„æ—¶å€™è¦æœ‰ä¸€ä¸ªèŒƒå›´ï¼Œå¦‚æœè¿™ä¸ªèµ·ç‚¹åˆ°é›†åˆç»ˆæ­¢ä¹‹é—´çš„å…ƒç´ å·²ç»ä¸å¤Ÿé¢˜ç›®è¦æ±‚çš„kä¸ªå…ƒç´ äº†ï¼Œå°±æ²¡æœ‰å¿…è¦æœç´¢äº†</strong>ã€‚</p><p><strong>åœ¨forå¾ªç¯ä¸Šåšå‰ªææ“ä½œæ˜¯å›æº¯æ³•å‰ªæçš„å¸¸è§å¥—è·¯ï¼</strong></p><h2 id="ç»„åˆæ€»å’Œ"><a href="#ç»„åˆæ€»å’Œ" class="headerlink" title="ç»„åˆæ€»å’Œ"></a>ç»„åˆæ€»å’Œ</h2><p>é¢˜ç›®é“¾æ¥: <a href="https://leetcode.cn/problems/combination-sum-iii/description/">https://leetcode.cn/problems/combination-sum-iii/description/</a></p><p>æ•´ä½“æ€è·¯è¿˜æ˜¯ä¸€æ ·çš„ï¼Œæœ¬é¢˜çš„å‰ªæä¼šå¥½æƒ³ä¸€äº›ï¼Œå³ï¼š<strong>å·²é€‰å…ƒç´ æ€»å’Œå¦‚æœå·²ç»å¤§äºnï¼ˆé¢˜ä¸­è¦æ±‚çš„å’Œï¼‰äº†ï¼Œé‚£ä¹ˆå¾€åéå†å°±æ²¡æœ‰æ„ä¹‰äº†ï¼Œç›´æ¥å‰ªæ‰</strong></p><p>æ‰€ä»¥å‰ªæçš„ä»£ç å¯ä»¥åœ¨forå¾ªç¯åŠ ä¸Š <code>i &lt;= 9 - (k - path.size()) + 1</code> çš„é™åˆ¶ï¼</p><h2 id="ç»„æ•°æ€»å’Œ"><a href="#ç»„æ•°æ€»å’Œ" class="headerlink" title="ç»„æ•°æ€»å’Œ(||)"></a>ç»„æ•°æ€»å’Œ(||)</h2><p>éœ€è¦ä½¿ç”¨startIndexçš„æƒ…å†µ</p><ul><li>å¦‚æœæ˜¯ä¸€ä¸ªé›†åˆæ¥æ±‚ç»„åˆçš„è¯ï¼Œå°±éœ€è¦startIndex</li><li>å¦‚æœæ˜¯å¤šä¸ªé›†åˆå–ç»„åˆï¼Œå„ä¸ªé›†åˆä¹‹é—´ç›¸äº’ä¸å½±å“ï¼Œé‚£ä¹ˆå°±ä¸ç”¨startIndex</li></ul><p><strong>åªæ˜¯è¯´æ±‚ç»„åˆçš„æƒ…å†µï¼Œå¦‚æœæ˜¯æ’åˆ—é—®é¢˜ï¼Œåˆæ˜¯å¦ä¸€å¥—åˆ†æçš„å¥—è·¯</strong>ã€‚</p><h2 id="ç»„åˆ-ä¸‰"><a href="#ç»„åˆ-ä¸‰" class="headerlink" title="ç»„åˆ(ä¸‰)"></a>ç»„åˆ(ä¸‰)</h2><p>é›†åˆå…ƒç´ ä¼šæœ‰é‡å¤ï¼Œä½†è¦æ±‚è§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„ç»„åˆã€‚</p><p>ä¸¤ä¸ªç»´åº¦ï¼Œä¸€ä¸ªç»´åº¦æ˜¯åŒä¸€æ ‘æä¸Šâ€œä½¿ç”¨è¿‡â€ï¼Œä¸€ä¸ªç»´åº¦æ˜¯åŒä¸€æ ‘å±‚ä¸Šâ€œä½¿ç”¨è¿‡â€ã€‚</p><p><strong>åœ¨candidates[i] &#x3D;&#x3D; candidates[i - 1]ç›¸åŒçš„æƒ…å†µä¸‹ï¼š</strong></p><ul><li>used[i - 1] &#x3D;&#x3D; trueï¼Œè¯´æ˜åŒä¸€æ ‘æcandidates[i - 1]ä½¿ç”¨è¿‡</li><li>used[i - 1] &#x3D;&#x3D; falseï¼Œè¯´æ˜åŒä¸€æ ‘å±‚candidates[i - 1]ä½¿ç”¨è¿‡</li></ul><h2 id="å¤šä¸ªé›†åˆæ±‚ç»„åˆ"><a href="#å¤šä¸ªé›†åˆæ±‚ç»„åˆ" class="headerlink" title="å¤šä¸ªé›†åˆæ±‚ç»„åˆ"></a>å¤šä¸ªé›†åˆæ±‚ç»„åˆ</h2><p>å¼€å§‹ç”¨å¤šä¸ªé›†åˆæ¥æ±‚ç»„åˆï¼Œè¿˜æ˜¯ç†Ÿæ‚‰çš„æ¨¡æ¿é¢˜ç›®ï¼Œä½†æ˜¯æœ‰ä¸€äº›ç»†èŠ‚ã€‚</p><p><strong>å› ä¸ºæœ¬é¢˜æ¯ä¸€ä¸ªæ•°å­—ä»£è¡¨çš„æ˜¯ä¸åŒé›†åˆï¼Œä¹Ÿå°±æ˜¯æ±‚ä¸åŒé›†åˆä¹‹é—´çš„ç»„åˆï¼Œè€Œ<a href="https://programmercarl.com/0077.%E7%BB%84%E5%90%88.html">å›æº¯ç®—æ³•ï¼šæ±‚ç»„åˆé—®é¢˜ï¼ (opens new window)</a>å’Œ<a href="https://programmercarl.com/0216.%E7%BB%84%E5%90%88%E6%80%BB%E5%92%8CIII.html">å›æº¯ç®—æ³•ï¼šæ±‚ç»„åˆæ€»å’Œï¼ (opens new window)</a>éƒ½æ˜¯æ˜¯æ±‚åŒä¸€ä¸ªé›†åˆä¸­çš„ç»„åˆï¼</strong></p><h2 id="åˆ‡å‰²é—®é¢˜"><a href="#åˆ‡å‰²é—®é¢˜" class="headerlink" title="åˆ‡å‰²é—®é¢˜"></a>åˆ‡å‰²é—®é¢˜</h2><ul><li>åˆ‡å‰²é—®é¢˜å…¶å®ç±»ä¼¼ç»„åˆé—®é¢˜</li><li>å¦‚ä½•æ¨¡æ‹Ÿé‚£äº›åˆ‡å‰²çº¿</li><li>åˆ‡å‰²é—®é¢˜ä¸­é€’å½’å¦‚ä½•ç»ˆæ­¢</li><li>åœ¨é€’å½’å¾ªç¯ä¸­å¦‚ä½•æˆªå–å­ä¸²</li><li>å¦‚ä½•åˆ¤æ–­å›æ–‡</li></ul><p><strong>ç”¨æ±‚è§£ç»„åˆé—®é¢˜çš„æ€è·¯æ¥è§£å†³ åˆ‡å‰²é—®é¢˜æœ¬é¢˜å°±æˆåŠŸä¸€å¤§åŠäº†</strong>ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¯¹ç€æ¨¡æ¿ç…§è‘«èŠ¦ç”»ç“¢ã€‚</p><p><strong>ä½†ååºå¦‚ä½•æ¨¡æ‹Ÿåˆ‡å‰²çº¿ï¼Œå¦‚ä½•ç»ˆæ­¢ï¼Œå¦‚ä½•æˆªå–å­ä¸²ï¼Œå…¶å®éƒ½ä¸å¥½æƒ³ï¼Œæœ€ååˆ¤æ–­å›æ–‡ç®—æ˜¯æœ€ç®€å•çš„äº†</strong>ã€‚</p><p><strong>æœ¬é¢˜è¿˜æœ‰ç»†èŠ‚ï¼Œä¾‹å¦‚ï¼šåˆ‡å‰²è¿‡çš„åœ°æ–¹ä¸èƒ½é‡å¤åˆ‡å‰²æ‰€ä»¥é€’å½’å‡½æ•°éœ€è¦ä¼ å…¥i + 1</strong>ã€‚</p><h2 id="å­é›†é—®é¢˜"><a href="#å­é›†é—®é¢˜" class="headerlink" title="å­é›†é—®é¢˜"></a>å­é›†é—®é¢˜</h2><p><strong>åœ¨æ ‘å½¢ç»“æ„ä¸­å­é›†é—®é¢˜æ˜¯è¦æ”¶é›†æ‰€æœ‰èŠ‚ç‚¹çš„ç»“æœï¼Œè€Œç»„åˆé—®é¢˜æ˜¯æ”¶é›†å¶å­èŠ‚ç‚¹çš„ç»“æœ</strong>ã€‚</p><p><strong>æœ¬é¢˜å…¶å®å¯ä»¥ä¸éœ€è¦åŠ ç»ˆæ­¢æ¡ä»¶</strong>ï¼Œå› ä¸ºstartIndex &gt;&#x3D; nums.size()ï¼Œæœ¬å±‚forå¾ªç¯æœ¬æ¥ä¹Ÿç»“æŸäº†ï¼Œæœ¬æ¥æˆ‘ä»¬å°±è¦éå†æ•´æ£µæ ‘ã€‚</p><h2 id="é€’å¢å­åºåˆ—"><a href="#é€’å¢å­åºåˆ—" class="headerlink" title="é€’å¢å­åºåˆ—"></a>é€’å¢å­åºåˆ—</h2><p><strong>ä½¿ç”¨seté’ˆå¯¹åŒä¸€çˆ¶èŠ‚ç‚¹æœ¬å±‚å»é‡ï¼Œä½†å­é›†é—®é¢˜ä¸€å®šè¦æ’åºï¼Œ</strong></p><h2 id="æ’åˆ—é—®é¢˜"><a href="#æ’åˆ—é—®é¢˜" class="headerlink" title="æ’åˆ—é—®é¢˜"></a>æ’åˆ—é—®é¢˜</h2><p>æ’åˆ—æ˜¯æœ‰åºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ [1,2] å’Œ [2,1] æ˜¯ä¸¤ä¸ªé›†åˆï¼Œè¿™å’Œä¹‹å‰åˆ†æçš„å­é›†ä»¥åŠç»„åˆæ‰€ä¸åŒçš„åœ°æ–¹ã€‚</p><p>å¯ä»¥çœ‹å‡ºå…ƒç´ 1åœ¨[1,2]ä¸­å·²ç»ä½¿ç”¨è¿‡äº†ï¼Œä½†æ˜¯åœ¨[2,1]ä¸­è¿˜è¦åœ¨ä½¿ç”¨ä¸€æ¬¡1ï¼Œæ‰€ä»¥å¤„ç†æ’åˆ—é—®é¢˜å°±ä¸ç”¨ä½¿ç”¨startIndexäº†ã€‚</p><ul><li>æ¯å±‚éƒ½æ˜¯ä»0å¼€å§‹æœç´¢è€Œä¸æ˜¯startIndex</li><li>éœ€è¦usedæ•°ç»„è®°å½•pathé‡Œéƒ½æ”¾äº†å“ªäº›å…ƒç´ äº†</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å›æº¯ç®—æ³•æ€»ç»“&quot;&gt;&lt;a href=&quot;#å›æº¯ç®—æ³•æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;å›æº¯ç®—æ³•æ€»ç»“&quot;&gt;&lt;/a&gt;å›æº¯ç®—æ³•æ€»ç»“&lt;/h1&gt;&lt;h2 id=&quot;ç†è®ºåŸºç¡€&quot;&gt;&lt;a href=&quot;#ç†è®ºåŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;ç†</summary>
      
    
    
    
    <category term="ç®—æ³•60å¤©æ‰“å¡" scheme="https://axdmdyj.github.io/categories/%E7%AE%97%E6%B3%9560%E5%A4%A9%E6%89%93%E5%8D%A1/"/>
    
    
    <category term="å›æº¯ç®—æ³•" scheme="https://axdmdyj.github.io/tags/%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•60å¤©è®­ç»ƒâ€“10-04-day25</title>
    <link href="https://axdmdyj.github.io/posts/ba74d5ec.html"/>
    <id>https://axdmdyj.github.io/posts/ba74d5ec.html</id>
    <published>2023-10-04T13:06:10.000Z</published>
    <updated>2023-11-12T08:53:08.571Z</updated>
    
    <content type="html"><![CDATA[<h1 id="39-ç»„åˆæ€»å’Œ"><a href="#39-ç»„åˆæ€»å’Œ" class="headerlink" title="39. ç»„åˆæ€»å’Œ"></a><a href="https://leetcode.cn/problems/combination-sum/">39. ç»„åˆæ€»å’Œ</a></h1><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><blockquote><p> ç¬¬ä¸€çœ¼åšè¿™ä¸ªä»¥ä¸ºè·Ÿå‰é¢çš„éƒ½ä¸€æ ·,æ— è„‘ä¸‰éƒ¨æ›².ä½†åæ¥æ‰å‘ç°é¢˜ç»™çš„è§£é‡Šè¯´,é›†åˆä¸­çš„æ•°å¯ä»¥ä½¿ç”¨å¤šæ¬¡. å‚»çœ¼äº†. é‚£æ€ä¹ˆå»è€ƒè™‘ç»ˆæ­¢æ¡ä»¶å‘¢. è¿˜æœ‰å¦‚ä½•å»æ·±åº¦æœç´¢å’Œå®½åº¦æœç´¢å‘¢?</p></blockquote><p>â€‹æ³¨æ„å¶å­èŠ‚ç‚¹çš„è¿”å›æ¡ä»¶ï¼Œå› ä¸ºæœ¬é¢˜æ²¡æœ‰ç»„åˆæ•°é‡è¦æ±‚ï¼Œä»…ä»…æ˜¯æ€»å’Œçš„é™åˆ¶ï¼Œæ‰€ä»¥é€’<strong>å½’æ²¡æœ‰å±‚æ•°çš„é™åˆ¶ï¼Œåªè¦é€‰å–çš„å…ƒç´ æ€»å’Œè¶…è¿‡targetï¼Œå°±è¿”å›ï¼</strong></p><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><h3 id="å›æº¯ä¸‰éƒ¨æ›²"><a href="#å›æº¯ä¸‰éƒ¨æ›²" class="headerlink" title="å›æº¯ä¸‰éƒ¨æ›²"></a>å›æº¯ä¸‰éƒ¨æ›²</h3><ul><li>é€’å½’å‡½æ•°å‚æ•°</li></ul><p>äºŒç»´æ•°ç»„resultå­˜æ”¾ç»“æœé›†ï¼Œæ•°ç»„pathå­˜æ”¾ç¬¦åˆæ¡ä»¶çš„ç»“æœã€‚</p><p>å‚æ•°: </p><p>é›†åˆ</p><p><code>candiates</code> é¢˜ç›®ç»™çš„æ•°ç»„</p><p><code>target</code> ç›®æ ‡å’Œ</p><p><code>sum</code> æ€»å’Œ</p><p><code>startIndex</code> </p><blockquote><p><strong>startIndexæ¥æ§åˆ¶forå¾ªç¯çš„èµ·å§‹ä½ç½®ï¼Œå¯¹äºç»„åˆé—®é¢˜ï¼Œä»€ä¹ˆæ—¶å€™éœ€è¦startIndexå‘¢ï¼Ÿ</strong></p><p>å¦‚æœæ˜¯ä¸€ä¸ªé›†åˆæ¥æ±‚ç»„åˆçš„è¯ï¼Œå°±éœ€è¦startInde</p><p>å¦‚æœæ˜¯å¤šä¸ªé›†åˆå–ç»„åˆï¼Œå„ä¸ªé›†åˆä¹‹é—´ç›¸äº’ä¸å½±å“ï¼Œé‚£ä¹ˆå°±ä¸ç”¨startIndex</p></blockquote><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ector&lt;<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&gt; result;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; path;</span><br><span class="line"><span class="type">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&amp; candidates, <span class="type">int</span> target, <span class="type">int</span> sum, <span class="type">int</span> startIndex)</span></span><br></pre></td></tr></table></figure><ul><li>é€’å½’ç»ˆæ­¢æ¡ä»¶</li></ul><p>æ ¹æ®é¢˜ç›®, ç»ˆæ­¢æ¡ä»¶åªæœ‰ä¸¤ç§: sumå¤§äºtargetå’Œsumç­‰äºtargetã€‚</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (sum &gt; target) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (sum == target) &#123;</span><br><span class="line">    result.push_back(path);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å•å±‚æœç´¢çš„é€»è¾‘</li></ul><p>å•å±‚forå¾ªç¯ä¾ç„¶æ˜¯ä»startIndexå¼€å§‹ï¼Œæœç´¢candidatesé›†åˆã€‚</p><p>å¦‚ä½•é‡å¤é€‰å–?</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = startIndex; i &lt; candidates.size(); i++) &#123;</span><br><span class="line">    sum += candidates[i];</span><br><span class="line">    path.push_back(candidates[i]);</span><br><span class="line">    backtracking(candidates, target, sum, i); <span class="comment">// å…³é”®ç‚¹:ä¸ç”¨i+1äº†ï¼Œè¡¨ç¤ºå¯ä»¥é‡å¤è¯»å–å½“å‰çš„æ•°</span></span><br><span class="line">    sum -= candidates[i];   <span class="comment">// å›æº¯</span></span><br><span class="line">    path.pop_back();        <span class="comment">// å›æº¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸ç”¨i+1äº†ï¼Œè¡¨ç¤ºå¯ä»¥é‡å¤è¯»å–å½“å‰çš„æ•°</strong></p><p>ç›¸å½“äºä¸‹ä¸€å±‚é€’å½’å¾ªç¯ ,  i è¿˜æ˜¯ä»è¿™ä¸€å±‚çš„startIndexå¼€å§‹, è¿™æ ·å°±å®ç°å¯é‡å¤è¯»å–å•¦</p><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><h3 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h3><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; path;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&gt; res;</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&amp; candidates,<span class="type">int</span> startIndex, <span class="type">int</span> target, <span class="type">int</span> sum)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sum == target)&#123;</span><br><span class="line">            res.push_back(path);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(sum &gt; target)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ¯å±‚éå†</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = startIndex; i &lt;  candidates.size(); i++)&#123;</span><br><span class="line">            sum += candidates[i];</span><br><span class="line">            path.push_back(candidates[i]);</span><br><span class="line">            backtracking(candidates, i, target, sum);</span><br><span class="line">            <span class="comment">//å›æº¯</span></span><br><span class="line">            sum -= candidates[i];</span><br><span class="line">            path.pop_back();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&gt; combinationSum(<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&amp; candidates, <span class="type">int</span> target) &#123;</span><br><span class="line">         backtracking(candidates, <span class="number">0</span>, target, <span class="number">0</span>);</span><br><span class="line">         <span class="keyword">return</span> res;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    List&lt;Integer&gt; path = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target, <span class="type">int</span> startIndex, <span class="type">int</span> sum)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sum == target)&#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(sum &gt; target)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å•å±‚éå†</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> startIndex; i &lt; candidates.length; i++)&#123;</span><br><span class="line">            path.add(candidates[i]);</span><br><span class="line">            sum += candidates[i];</span><br><span class="line"></span><br><span class="line">            backtracking(candidates, target, i, sum);</span><br><span class="line">            sum -= candidates[i];</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        backtracking(candidates, target, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‰ªæä¼˜åŒ–"><a href="#å‰ªæä¼˜åŒ–" class="headerlink" title="å‰ªæä¼˜åŒ–"></a>å‰ªæä¼˜åŒ–</h2><p>å¯¹äºsumå·²ç»å¤§äºtargetçš„æƒ…å†µï¼Œå…¶å®æ˜¯ä¾ç„¶è¿›å…¥äº†ä¸‹ä¸€å±‚é€’å½’ï¼Œåªæ˜¯ä¸‹ä¸€å±‚é€’å½’ç»“æŸåˆ¤æ–­çš„æ—¶å€™ï¼Œä¼šåˆ¤æ–­sum &gt; targetçš„è¯å°±è¿”å›ã€‚</p><p>å¯ä»¥åœ¨forå¾ªç¯åˆ¤æ–­çš„ç»ˆæ­¢æ¡ä»¶ä¸­å¢åŠ é™åˆ¶: </p><blockquote><p>å¦‚æœå·²ç»çŸ¥é“ä¸‹ä¸€å±‚çš„sumä¼šå¤§äºtargetï¼Œå°±æ²¡æœ‰å¿…è¦è¿›å…¥ä¸‹ä¸€å±‚é€’å½’äº†</p><p><strong>å¯¹æ€»é›†åˆæ’åºä¹‹åï¼Œå¦‚æœä¸‹ä¸€å±‚çš„sumï¼ˆå°±æ˜¯æœ¬å±‚çš„ sum + candidates[i]ï¼‰å·²ç»å¤§äºtargetï¼Œå°±å¯ä»¥ç»“æŸæœ¬è½®forå¾ªç¯çš„éå†</strong>ã€‚</p></blockquote><p>æ‰€ä»¥å•å±‚<code>for</code> æœç´¢å¯ä»¥æ”¹ä¸º sum+&#x3D; candidatesåŸæœ¬æ˜¯åœ¨forå¾ªç¯é‡Œé¢ .åœ¨è¿™é‡Œåˆ¤æ–­, å°±ä¼šå°‘èµ°ä¸‹é¢çš„é€’å½’å‡½æ•°, å®Œæˆå‰ªæçš„ç›®çš„</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = startIndex; i &lt; candidates.size() &amp;&amp; sum + candidates[i] &lt;= target; i++)</span><br></pre></td></tr></table></figure><h1 id="40-ç»„åˆæ€»å’Œ-II"><a href="#40-ç»„åˆæ€»å’Œ-II" class="headerlink" title="40. ç»„åˆæ€»å’Œ II"></a><a href="https://leetcode.cn/problems/combination-sum-ii/">40. ç»„åˆæ€»å’Œ II</a></h1><h2 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>è·Ÿä¸Šä¸€é¢˜ä¸åŒçš„æ˜¯, æœ¬é¢˜candidates ä¸­çš„æ¯ä¸ªæ•°å­—åœ¨æ¯ä¸ªç»„åˆä¸­åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚</p><p>æœ¬é¢˜æ•°ç»„candidatesçš„å…ƒç´ <strong>æ˜¯æœ‰é‡å¤</strong>çš„ï¼Œè€Œ<a href="https://programmercarl.com/0039.%E7%BB%84%E5%90%88%E6%80%BB%E5%92%8C.html">39.ç»„åˆæ€»å’Œ (opens new window)</a>æ˜¯æ— é‡å¤å…ƒç´ çš„æ•°ç»„candidates</p><p><strong>æ‰€è°“å»é‡ï¼Œå…¶å®å°±æ˜¯ä½¿ç”¨è¿‡çš„å…ƒç´ ä¸èƒ½é‡å¤é€‰å–</strong></p><p>ç»„åˆé—®é¢˜å¯ä»¥æŠ½è±¡ä¸ºæ ‘å½¢ç»“æ„ï¼Œé‚£ä¹ˆâ€œä½¿ç”¨è¿‡â€åœ¨è¿™ä¸ªæ ‘å½¢ç»“æ„ä¸Šæ˜¯æœ‰ä¸¤ä¸ªç»´åº¦çš„ï¼Œä¸€ä¸ªç»´åº¦æ˜¯åŒä¸€æ ‘æä¸Šä½¿ç”¨è¿‡ï¼Œä¸€ä¸ªç»´åº¦æ˜¯åŒä¸€æ ‘å±‚ä¸Šä½¿ç”¨è¿‡ã€‚</p><p>å›çœ‹ä¸€ä¸‹é¢˜ç›®ï¼Œå…ƒç´ åœ¨åŒä¸€ä¸ªç»„åˆå†…æ˜¯å¯ä»¥é‡å¤çš„ï¼Œæ€ä¹ˆé‡å¤éƒ½æ²¡äº‹ï¼Œä½†ä¸¤ä¸ªç»„åˆä¸èƒ½ç›¸åŒã€‚</p><p><strong>æ‰€ä»¥æˆ‘ä»¬è¦å»é‡çš„æ˜¯åŒä¸€æ ‘å±‚ä¸Šçš„â€œä½¿ç”¨è¿‡â€ï¼ŒåŒä¸€æ ‘æä¸Šçš„éƒ½æ˜¯ä¸€ä¸ªç»„åˆé‡Œçš„å…ƒç´ ï¼Œä¸ç”¨å»é‡</strong>ã€‚</p><h2 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p><strong>å›æº¯ä¸‰éƒ¨æ›²</strong></p><ul><li>é€’å½’å‡½æ•°å‚æ•°</li></ul><p>åŠ ä¸€ä¸ª<code>used[]</code> æ•°ç»„, ç”¨æ¥è®°å½•åŒä¸€æ ‘æä¸Šçš„å…ƒç´ æ˜¯å¦ä½¿ç”¨è¿‡</p><p>ç”¨æ¥è®°å½•åŒä¸€æ•°å±‚ä¸Šçš„å…ƒç´ æ˜¯å¦ä½¿ç”¨è¿‡</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&gt; result; <span class="comment">// å­˜æ”¾ç»„åˆé›†åˆ</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; path;           <span class="comment">// ç¬¦åˆæ¡ä»¶çš„ç»„åˆ</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&amp; candidates, <span class="type">int</span> target, <span class="type">int</span> sum, <span class="type">int</span> startIndex, <span class="built_in">vector</span>&lt;<span class="type">bool</span>&gt;&amp; used)</span> &#123;</span><br></pre></td></tr></table></figure><ul><li>é€’å½’ç»ˆæ­¢æ¡ä»¶</li></ul><p>è·Ÿä¸Šä¸€é¢˜ä¸€æ ·çš„</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (sum &gt; target) &#123; <span class="comment">// è¿™ä¸ªæ¡ä»¶å…¶å®å¯ä»¥çœç•¥</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (sum == target) &#123;</span><br><span class="line">    result.push_back(path);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å•å±‚æœç´¢é€»è¾‘</li></ul><p><strong>è¿™é‡Œä¸ä¸Šä¸€é¢˜æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å»é‡å•¦</strong>,<strong>ä¸€å®šä¸€å®š!!è¦åœ¨å¼€å§‹å…ˆæ’åº</strong></p><p>éš¾ç‚¹åœ¨äºå¦‚ä½•åˆ¤æ–­åŒä¸€æ ‘å±‚ä¸Šçš„å…ƒç´ æ˜¯å¦ä½¿ç”¨è¿‡</p><p>ç”¨<code>used</code> æ•°ç»„, 0 ä»£è¡¨æ²¡ç”¨è¿‡, 1 ä»£è¡¨å·²ç»ç”¨è¿‡</p><ul><li>used[i - 1] &#x3D;&#x3D; trueï¼Œè¯´æ˜åŒä¸€æ ‘æcandidates[i - 1]ä½¿ç”¨è¿‡</li><li>used[i - 1] &#x3D;&#x3D; falseï¼Œè¯´æ˜åŒä¸€æ ‘å±‚candidates[i - 1]ä½¿ç”¨è¿‡</li></ul><p>ä¸ºä»€ä¹ˆ used[i - 1] &#x3D;&#x3D; false å°±æ˜¯åŒä¸€æ ‘å±‚å‘¢?</p><p>å› ä¸ºåŒä¸€æ ‘å±‚ï¼Œused[i - 1] &#x3D;&#x3D; false æ‰èƒ½è¡¨ç¤ºï¼Œå½“å‰å–çš„ candidates[i] æ˜¯ä» candidates[i - 1] å›æº¯è€Œæ¥çš„ã€‚</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = startIndex; i &lt; candidates.size() &amp;&amp; sum + candidates[i] &lt;= target; i++) &#123;</span><br><span class="line">    <span class="comment">// used[i - 1] == trueï¼Œè¯´æ˜åŒä¸€æ ‘æcandidates[i - 1]ä½¿ç”¨è¿‡</span></span><br><span class="line">    <span class="comment">// used[i - 1] == falseï¼Œè¯´æ˜åŒä¸€æ ‘å±‚candidates[i - 1]ä½¿ç”¨è¿‡</span></span><br><span class="line">    <span class="comment">// è¦å¯¹åŒä¸€æ ‘å±‚ä½¿ç”¨è¿‡çš„å…ƒç´ è¿›è¡Œè·³è¿‡</span></span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; candidates[i] == candidates[i - <span class="number">1</span>] &amp;&amp; used[i - <span class="number">1</span>] == <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    sum += candidates[i];</span><br><span class="line">    path.push_back(candidates[i]);</span><br><span class="line">    used[i] = <span class="literal">true</span>;</span><br><span class="line">    backtracking(candidates, target, sum, i + <span class="number">1</span>, used); <span class="comment">// å’Œ39.ç»„åˆæ€»å’Œçš„åŒºåˆ«1ï¼šè¿™é‡Œæ˜¯i+1ï¼Œæ¯ä¸ªæ•°å­—åœ¨æ¯ä¸ªç»„åˆä¸­åªèƒ½ä½¿ç”¨ä¸€æ¬¡</span></span><br><span class="line">    used[i] = <span class="literal">false</span>;</span><br><span class="line">    sum -= candidates[i];</span><br><span class="line">    path.pop_back();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    List&lt;Integer&gt; path = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">boolean</span>[] used;</span><br><span class="line">    <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target, <span class="type">int</span> startIndex, <span class="type">int</span> sum, <span class="type">boolean</span>[] used)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sum == target)&#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(sum &gt; target)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// å•å±‚éå†</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> startIndex; i &lt; candidates.length ; i++)&#123;</span><br><span class="line">            <span class="comment">// used[i - 1] == trueï¼Œè¯´æ˜åŒä¸€æ ‘æcandidates[i - 1]ä½¿ç”¨è¿‡</span></span><br><span class="line">            <span class="comment">// used[i - 1] == falseï¼Œè¯´æ˜åŒä¸€æ ‘å±‚candidates[i - 1]ä½¿ç”¨è¿‡</span></span><br><span class="line">            <span class="comment">// è¦å¯¹åŒä¸€æ ‘å±‚ä½¿ç”¨è¿‡çš„å…ƒç´ è¿›è¡Œè·³è¿‡</span></span><br><span class="line">            <span class="keyword">if</span>(i &gt; <span class="number">0</span>&amp;&amp; candidates[i] == candidates[i-<span class="number">1</span>] &amp;&amp; used[i - <span class="number">1</span>] == <span class="literal">false</span>) <span class="keyword">continue</span>;</span><br><span class="line">            used[i] = <span class="literal">true</span>;</span><br><span class="line">            path.add(candidates[i]);</span><br><span class="line">            sum += candidates[i];</span><br><span class="line"></span><br><span class="line">            backtracking(candidates, target, i+<span class="number">1</span>, sum, used);</span><br><span class="line">            sum -= candidates[i];</span><br><span class="line">            path.remove(path.size()-<span class="number">1</span>);</span><br><span class="line">            used[i] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum2</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        used = <span class="keyword">new</span> <span class="title class_">boolean</span>[candidates.length];</span><br><span class="line">        <span class="comment">// åŠ æ ‡å¿—æ•°ç»„ï¼Œç”¨æ¥è¾…åŠ©åˆ¤æ–­åŒå±‚èŠ‚ç‚¹æ˜¯å¦å·²ç»éå†</span></span><br><span class="line">        Arrays.fill(used, <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// ä¸ºäº†å°†é‡å¤çš„æ•°å­—éƒ½æ”¾åˆ°ä¸€èµ·ï¼Œæ‰€ä»¥å…ˆè¿›è¡Œæ’åº</span></span><br><span class="line">        Arrays.sort(candidates);</span><br><span class="line">        backtracking(candidates, target, <span class="number">0</span>, <span class="number">0</span>, used);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¯­æ³•å°è¡¥å……"><a href="#è¯­æ³•å°è¡¥å……" class="headerlink" title="è¯­æ³•å°è¡¥å……"></a>è¯­æ³•å°è¡¥å……</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">used</span><span class="params">(candidates.size(), <span class="literal">false</span>)</span></span>;</span><br></pre></td></tr></table></figure><p>åœ¨javaä¸­,å¯ä»¥è¿™ä¹ˆå®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Arrays.fill(used, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><h1 id="131-åˆ†å‰²å›æ–‡ä¸²"><a href="#131-åˆ†å‰²å›æ–‡ä¸²" class="headerlink" title="131. åˆ†å‰²å›æ–‡ä¸²"></a><a href="https://leetcode.cn/problems/palindrome-partitioning/">131. åˆ†å‰²å›æ–‡ä¸²</a></h1><h2 id="åˆ†æ-2"><a href="#åˆ†æ-2" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>ä¸¤ä¸ªå…³é”®é—®é¢˜:</p><ol><li>åˆ‡å‰²é—®é¢˜ï¼Œæœ‰ä¸åŒçš„åˆ‡å‰²æ–¹å¼</li><li>åˆ¤æ–­å›æ–‡</li></ol><p><strong>åˆ‡å‰²é—®é¢˜ç±»ä¼¼äºç»„åˆé—®é¢˜</strong></p><ul><li>ç»„åˆé—®é¢˜ï¼šé€‰å–ä¸€ä¸ªaä¹‹åï¼Œåœ¨bcdefä¸­å†å»é€‰å–ç¬¬äºŒä¸ªï¼Œé€‰å–bä¹‹ååœ¨cdefä¸­å†é€‰å–ç¬¬ä¸‰ä¸ªâ€¦..ã€‚</li><li>åˆ‡å‰²é—®é¢˜ï¼šåˆ‡å‰²ä¸€ä¸ªaä¹‹åï¼Œåœ¨bcdefä¸­å†å»åˆ‡å‰²ç¬¬äºŒæ®µï¼Œåˆ‡å‰²bä¹‹ååœ¨cdefä¸­å†åˆ‡å‰²ç¬¬ä¸‰æ®µâ€¦..ã€‚</li></ul><p>é€’å½’çºµå‘é€ä¸ªåˆ‡å‰², </p><p>forå¾ªç¯æ¨ªå‘éå†åˆ‡å‰²</p><h2 id="æ€è·¯-2"><a href="#æ€è·¯-2" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p><strong>å›æº¯ä¸‰éƒ¨æ›²</strong></p><ul><li>é€’å½’å‡½æ•°å‚æ•°</li></ul><p>pathå­˜æ”¾åˆ‡å‰²åçš„å›æ–‡å­ä¸²</p><p>äºŒç»´æ•°ç»„reså­˜æ”¾ç»“æœé›†</p><p>startIndex , è¿™é‡Œå°±ä¸€ä¸ªé›†åˆ,æ‰€ä»¥ä¹Ÿè¦ä½¿ç”¨</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&gt; result;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; path; <span class="comment">// æ”¾å·²ç»å›æ–‡çš„å­ä¸²</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">backtracking</span> <span class="params">(<span class="type">const</span> <span class="built_in">string</span>&amp; s, <span class="type">int</span> startIndex)</span> &#123;</span><br></pre></td></tr></table></figure><ul><li>é€’å½’å‡½æ•°ç»ˆæ­¢æ¡ä»¶</li></ul><p>è¿™ä¸ªstartIndexå°±å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªåˆ‡å‰²çº¿</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">backtracking</span> <span class="params">(<span class="type">const</span> string&amp; s, <span class="type">int</span> startIndex)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœèµ·å§‹ä½ç½®å·²ç»å¤§äºsçš„å¤§å°ï¼Œè¯´æ˜å·²ç»æ‰¾åˆ°äº†ä¸€ç»„åˆ†å‰²æ–¹æ¡ˆäº†</span></span><br><span class="line">    <span class="keyword">if</span> (startIndex &gt;= s.<span class="built_in">size</span>()) &#123;</span><br><span class="line">        result.<span class="built_in">push_back</span>(path);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å•å±‚æœç´¢é€»è¾‘</li></ul><p><strong>ä¸»è¦æ˜¯åœ¨é€’å½’å¾ªç¯ä¸­å¦‚ä½•å–å­ä¸²</strong></p><p><code>startIndex =&gt; i</code> å°±æ˜¯å­ä¸²</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = startIndex; i &lt; s.size(); i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isPalindrome(s, startIndex, i)) &#123; <span class="comment">// æ˜¯å›æ–‡å­ä¸²</span></span><br><span class="line">        <span class="comment">// è·å–[startIndex,i]åœ¨sä¸­çš„å­ä¸²</span></span><br><span class="line">        <span class="built_in">string</span> str = s.substr(startIndex, i - startIndex + <span class="number">1</span>);</span><br><span class="line">        path.push_back(str);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;                <span class="comment">// å¦‚æœä¸æ˜¯åˆ™ç›´æ¥è·³è¿‡</span></span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    backtracking(s, i + <span class="number">1</span>); <span class="comment">// å¯»æ‰¾i+1ä¸ºèµ·å§‹ä½ç½®çš„å­ä¸²</span></span><br><span class="line">    path.pop_back();        <span class="comment">// å›æº¯è¿‡ç¨‹ï¼Œå¼¹å‡ºæœ¬æ¬¡å·²ç»æ·»åŠ çš„å­ä¸²</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å› ä¸ºä¸èƒ½åˆ‡å‰²åœ¨åŒä¸€å¤„, éå†åˆ°ä¸‹ä¸€å±‚çš„æ—¶å€™, i+1</p></blockquote><ul><li>åˆ¤æ–­å›æ–‡å­—ç¬¦ä¸²</li></ul><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> <span class="title function_">isPalindrome</span><span class="params">(<span class="type">const</span> <span class="built_in">string</span>&amp; s, <span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = start, j = end; i &lt; j; i++, j--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s[i] != s[j]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Code-2"><a href="#Code-2" class="headerlink" title="Code"></a>Code</h2><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">private:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&gt; result;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; path; <span class="comment">// æ”¾å·²ç»å›æ–‡çš„å­ä¸²</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">backtracking</span> <span class="params">(<span class="type">const</span> <span class="built_in">string</span>&amp; s, <span class="type">int</span> startIndex)</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœèµ·å§‹ä½ç½®å·²ç»å¤§äºsçš„å¤§å°ï¼Œè¯´æ˜å·²ç»æ‰¾åˆ°äº†ä¸€ç»„åˆ†å‰²æ–¹æ¡ˆäº†</span></span><br><span class="line">        <span class="keyword">if</span> (startIndex &gt;= s.size()) &#123;</span><br><span class="line">            result.push_back(path);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = startIndex; i &lt; s.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isPalindrome(s, startIndex, i)) &#123;   <span class="comment">// æ˜¯å›æ–‡å­ä¸²</span></span><br><span class="line">                <span class="comment">// è·å–[startIndex,i]åœ¨sä¸­çš„å­ä¸²</span></span><br><span class="line">                <span class="built_in">string</span> str = s.substr(startIndex, i - startIndex + <span class="number">1</span>);</span><br><span class="line">                path.push_back(str);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;                                <span class="comment">// ä¸æ˜¯å›æ–‡ï¼Œè·³è¿‡</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            backtracking(s, i + <span class="number">1</span>); <span class="comment">// å¯»æ‰¾i+1ä¸ºèµ·å§‹ä½ç½®çš„å­ä¸²</span></span><br><span class="line">            path.pop_back(); <span class="comment">// å›æº¯è¿‡ç¨‹ï¼Œå¼¹å‡ºæœ¬æ¬¡å·²ç»æ·»åŠ çš„å­ä¸²</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">bool</span> <span class="title function_">isPalindrome</span><span class="params">(<span class="type">const</span> <span class="built_in">string</span>&amp; s, <span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = start, j = end; i &lt; j; i++, j--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s[i] != s[j]) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">public:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&gt; partition(<span class="built_in">string</span> s) &#123;</span><br><span class="line">        result.clear();</span><br><span class="line">        path.clear();</span><br><span class="line">        backtracking(s, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;39-ç»„åˆæ€»å’Œ&quot;&gt;&lt;a href=&quot;#39-ç»„åˆæ€»å’Œ&quot; class=&quot;headerlink&quot; title=&quot;39. ç»„åˆæ€»å’Œ&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problems/combination-sum/&quot;&gt;39. ç»„åˆæ€»å’Œ</summary>
      
    
    
    
    <category term="ç®—æ³•60å¤©æ‰“å¡" scheme="https://axdmdyj.github.io/categories/%E7%AE%97%E6%B3%9560%E5%A4%A9%E6%89%93%E5%8D%A1/"/>
    
    
    <category term="å›æº¯ç®—æ³•" scheme="https://axdmdyj.github.io/tags/%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•60å¤©è®­ç»ƒâ€“10-03-day24</title>
    <link href="https://axdmdyj.github.io/posts/8d4dbf4.html"/>
    <id>https://axdmdyj.github.io/posts/8d4dbf4.html</id>
    <published>2023-10-03T11:39:51.000Z</published>
    <updated>2023-11-12T08:53:08.572Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="216-ç»„åˆæ€»å’Œ-III"><a href="#216-ç»„åˆæ€»å’Œ-III" class="headerlink" title="216. ç»„åˆæ€»å’Œ III"></a><a href="https://leetcode.cn/problems/combination-sum-iii/">216. ç»„åˆæ€»å’Œ III</a></h1><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>æœ¬é¢˜ç›¸å½“äºæ˜¯åœ¨</p><p><a href="https://leetcode.cn/problems/combinations/">77. ç»„åˆ</a>å¤šäº†ä¸€ä¸ªåˆ¤æ–­æ‰¾å‡ºçš„é›†åˆä¹‹å’Œç­‰äºnçš„åˆ¤æ–­</p><p>å› ä¸ºæ•°åªèƒ½å–ä»1 ~ 9</p><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>å›æº¯ä¸‰éƒ¨æ›²</p><ul><li>ç¬¬ä¸€æ›²:ç¡®å®šé€’å½’å‡½æ•°å‚æ•°</li></ul><p>ä¾ç„¶å®šä¹‰path å’Œ resultä¸ºå…¨å±€å˜é‡</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&gt; result; <span class="comment">// å­˜æ”¾ç»“æœé›†</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; path; <span class="comment">// ç¬¦åˆæ¡ä»¶çš„ç»“æœ</span></span><br></pre></td></tr></table></figure><blockquote><ul><li>targetSumï¼ˆintï¼‰ç›®æ ‡å’Œï¼Œä¹Ÿå°±æ˜¯é¢˜ç›®ä¸­çš„nã€‚</li><li>kï¼ˆintï¼‰å°±æ˜¯é¢˜ç›®ä¸­è¦æ±‚kä¸ªæ•°çš„é›†åˆã€‚</li><li>sumï¼ˆintï¼‰ä¸ºå·²ç»æ”¶é›†çš„å…ƒç´ çš„æ€»å’Œï¼Œä¹Ÿå°±æ˜¯pathé‡Œå…ƒç´ çš„æ€»å’Œã€‚</li><li>startIndexï¼ˆintï¼‰ä¸ºä¸‹ä¸€å±‚forå¾ªç¯æœç´¢çš„èµ·å§‹ä½ç½®ã€‚</li></ul></blockquote><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&gt; result;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; path;</span><br><span class="line"><span class="type">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> targetSum, <span class="type">int</span> k, <span class="type">int</span> sum, <span class="type">int</span> startIndex)</span></span><br></pre></td></tr></table></figure><p>è¡¥å……ä¸€ä¸‹: å›æº¯ç®—æ³•é€’å½’çš„å‚æ•°å¾ˆéš¾ä¸€æ¬¡ç¡®å®š,éœ€è¦ç”¨åˆ°ä»€ä¹ˆå‚æ•°,å¡«ä»€ä¹ˆå‚æ•°</p><ul><li>ç¬¬äºŒæ›²:ç¡®å®šç»ˆæ­¢æ¡ä»¶</li></ul><p>è·Ÿç»„åˆä¸€æ ·,éå†åˆ°ç¬¬kå±‚å…¶å®å°±å·²ç»å°†æ ‘çš„æ·±åº¦éå†å®Œäº†</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (path.size() == k) &#123;</span><br><span class="line">    <span class="keyword">if</span> (sum == targetSum) result.push_back(path);</span><br><span class="line">    <span class="keyword">return</span>; <span class="comment">// å¦‚æœpath.size() == k ä½†sum != targetSum ç›´æ¥è¿”å›</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¬¬ä¸‰æ›²: å•å±‚æœç´¢</li></ul><p>æ¯ä¸€å±‚éƒ½æ˜¯éå†çš„æ•°éƒ½æ˜¯ä¸Šä¸€å±‚çš„æ•°<code>-1</code>,å› ä¸ºé›†åˆä¸­ä¸èƒ½å‡ºç°é‡å¤çš„æ•°</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = startIndex; i &lt;= <span class="number">9</span>; i++) &#123;</span><br><span class="line">    sum += i;</span><br><span class="line">    path.push_back(i);</span><br><span class="line">    backtracking(targetSum, k, sum, i + <span class="number">1</span>); <span class="comment">// æ³¨æ„i+1è°ƒæ•´startIndex</span></span><br><span class="line">    sum -= i; <span class="comment">// å›æº¯</span></span><br><span class="line">    path.pop_back(); <span class="comment">// å›æº¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€è€ƒè¿™æ®µä»£ç çš„æ—¶å€™,æš‚æ—¶ä¸è¦å»è€ƒè™‘backtrackingé‡Œé¢çš„è¿‡ç¨‹,ç›´æ¥åˆ°<code>sum  -= i</code>å’Œ<code>pop.pop_back</code>,ç„¶åè¿›è¡Œä¸‹ä¸€å±‚forå¾ªç¯,è¿™ä¸¤ä¸ªç›¸å½“äºæ˜¯æ¸…ç†æˆ˜åœºäº†,ç„¶åæ¢ä¸€ä¸ª<code>i</code>å†æ‰“ä¸€é</p><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><h3 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h3><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; path;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&gt;res;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> targetSum, <span class="type">int</span> k, <span class="type">int</span> sum, <span class="type">int</span> startIndex)</span>&#123;</span><br><span class="line">        <span class="comment">// ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span>(path.size() == k)&#123;</span><br><span class="line">            <span class="keyword">if</span>(targetSum == sum) &#123;</span><br><span class="line">                res.push_back(path);</span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//å•å±‚æœç´¢</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = startIndex; i &lt;= <span class="number">9</span> ; i++)&#123;</span><br><span class="line">            path.push_back(i);</span><br><span class="line">            sum += i;</span><br><span class="line">            backtracking(targetSum,k,sum,i+<span class="number">1</span>);</span><br><span class="line">            sum -= i;</span><br><span class="line">            path.pop_back();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&gt; combinationSum3(<span class="type">int</span> k, <span class="type">int</span> n) &#123;</span><br><span class="line">        backtracking(n, k, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="å‰ªæä¼˜åŒ–"><a href="#å‰ªæä¼˜åŒ–" class="headerlink" title="å‰ªæä¼˜åŒ–"></a>å‰ªæä¼˜åŒ–</h2><p>å¦‚æœå·²ç»é€‰çš„å…ƒç´  å·²ç»å¤§äº<code>targetSum</code>äº†,é‚£ä¹ˆä¹Ÿæ²¡æœ‰å¿…è¦ç»§ç»­å¾€ä¸‹éå†äº†</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‰ªææ“ä½œ</span></span><br><span class="line"><span class="keyword">if</span>(sum) &gt; targetSum&#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆä»£ç </p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; path;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&gt;res;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> targetSum, <span class="type">int</span> k, <span class="type">int</span> sum, <span class="type">int</span> startIndex)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sum &gt; targetSum) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span>(path.size() == k)&#123;</span><br><span class="line">            <span class="keyword">if</span>(targetSum == sum) &#123;</span><br><span class="line">                res.push_back(path);</span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//å•å±‚æœç´¢</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = startIndex; i &lt;= <span class="number">9</span> ; i++)&#123;</span><br><span class="line">            path.push_back(i);</span><br><span class="line">            sum += i;</span><br><span class="line">            backtracking(targetSum,k,sum,i+<span class="number">1</span>);</span><br><span class="line">            sum -= i;</span><br><span class="line">            path.pop_back();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&gt; combinationSum3(<span class="type">int</span> k, <span class="type">int</span> n) &#123;</span><br><span class="line">        backtracking(n, k, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="17-ç”µè¯å·ç çš„å­—æ¯ç»„åˆ"><a href="#17-ç”µè¯å·ç çš„å­—æ¯ç»„åˆ" class="headerlink" title="17. ç”µè¯å·ç çš„å­—æ¯ç»„åˆ"></a><a href="https://leetcode.cn/problems/letter-combinations-of-a-phone-number/">17. ç”µè¯å·ç çš„å­—æ¯ç»„åˆ</a></h1><h2 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>æœ¬é¢˜ä¸€çœ¼çœ‹å¯ä»¥æš´åŠ›,å› ä¸ºå¦‚æœ<code>digit = 2</code>, é‚£ä¹ˆä¸¤å±‚foré­‚ç¯é…’åäº†. ä½†å¦‚æœ<code>digit=10086</code> å±‚å‘¢,forå¾ªç¯æ˜¯å¹¶ä¸å¯èƒ½çš„. è¿™æ˜¯å’Œ<a href="https://leetcode.cn/problems/combinations/">77. ç»„åˆ</a>åœ¨åˆšå¼€å§‹åˆ†ææ—¶ä¸€æ ·çš„é—®é¢˜</p><p>ç†è§£æœ¬é¢˜åï¼Œè¦è§£å†³å¦‚ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼š</p><ul><li>æ•°å­—å’Œå­—æ¯å¦‚ä½•æ˜ å°„</li><li>ä¸¤ä¸ªå­—æ¯å°±ä¸¤ä¸ªforå¾ªç¯ï¼Œä¸‰ä¸ªå­—ç¬¦æˆ‘å°±ä¸‰ä¸ªforå¾ªç¯ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç„¶åå‘ç°ä»£ç æ ¹æœ¬å†™ä¸å‡ºæ¥</li><li>è¾“å…¥1 * #æŒ‰é”®ç­‰ç­‰å¼‚å¸¸æƒ…å†µ</li></ul><h2 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><h3 id="æ•°å­—å’Œå­—æ¯å¦‚ä½•æ˜ å°„"><a href="#æ•°å­—å’Œå­—æ¯å¦‚ä½•æ˜ å°„" class="headerlink" title="æ•°å­—å’Œå­—æ¯å¦‚ä½•æ˜ å°„"></a>æ•°å­—å’Œå­—æ¯å¦‚ä½•æ˜ å°„</h3><p>å¯ä»¥ç”¨<code>map</code>, æˆ–è€…å®šä¹‰ä¸€ä¸ªäºŒç»´æ•°ç»„,</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="built_in">string</span> letterMap[<span class="number">10</span>] = &#123;</span><br><span class="line">    <span class="string">&quot;&quot;</span>, <span class="comment">// 0</span></span><br><span class="line">    <span class="string">&quot;&quot;</span>, <span class="comment">// 1</span></span><br><span class="line">    <span class="string">&quot;abc&quot;</span>, <span class="comment">// 2</span></span><br><span class="line">    <span class="string">&quot;def&quot;</span>, <span class="comment">// 3</span></span><br><span class="line">    <span class="string">&quot;ghi&quot;</span>, <span class="comment">// 4</span></span><br><span class="line">    <span class="string">&quot;jkl&quot;</span>, <span class="comment">// 5</span></span><br><span class="line">    <span class="string">&quot;mno&quot;</span>, <span class="comment">// 6</span></span><br><span class="line">    <span class="string">&quot;pqrs&quot;</span>, <span class="comment">// 7</span></span><br><span class="line">    <span class="string">&quot;tuv&quot;</span>, <span class="comment">// 8</span></span><br><span class="line">    <span class="string">&quot;wxyz&quot;</span>, <span class="comment">// 9</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="å›æº¯æ³•æ¥è§£å†³nä¸ªforå¾ªç¯çš„é—®é¢˜"><a href="#å›æº¯æ³•æ¥è§£å†³nä¸ªforå¾ªç¯çš„é—®é¢˜" class="headerlink" title="å›æº¯æ³•æ¥è§£å†³nä¸ªforå¾ªç¯çš„é—®é¢˜"></a>å›æº¯æ³•æ¥è§£å†³nä¸ªforå¾ªç¯çš„é—®é¢˜</h3><p>ä¾ç„¶æ˜¯: æ·±åº¦å°±æ˜¯å­—æ¯é›†åˆçš„é•¿åº¦</p><h3 id="å›æº¯ä¸‰éƒ¨æ›²"><a href="#å›æº¯ä¸‰éƒ¨æ›²" class="headerlink" title="å›æº¯ä¸‰éƒ¨æ›²"></a>å›æº¯ä¸‰éƒ¨æ›²</h3><ul><li>ç¬¬ä¸€æ›²: ç¡®å®šå›æº¯å‡½æ•°å‚æ•°</li></ul><p>è¿™ä¸ªåœ¨å®é™…åšé¢˜ä¸­ä¸å¯èƒ½ä¸€ä¸‹å­æƒ³å‡ºæ¥,ç”¨åˆ°ä»€ä¹ˆå†™ä»€ä¹ˆ</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; result;<span class="comment">//å­—ç¬¦ä¸²æ•°ç»„resultä¿å­˜èµ·æ¥</span></span><br><span class="line"><span class="built_in">string</span> s;<span class="comment">//æ”¶é›†å¶å­èŠ‚ç‚¹çš„ç»“æœ</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">const</span> <span class="built_in">string</span>&amp; digits, <span class="type">int</span> index)</span><span class="comment">//è®°å½•éå†ç¬¬å‡ ä¸ªæ•°å­—</span></span><br></pre></td></tr></table></figure><p>const string&amp; digitç›¸å½“äºå–äº†ä¸€ä¸ªåˆ«å,å¼•ç”¨digitä½†ä¸æ”¹å˜å…¶å­—ç¬¦ä¸²å†…å®¹</p><ul><li>ç¡®å®šç»ˆæ­¢æ¡ä»¶</li></ul><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(intdex == digits.size())&#123;<span class="comment">//éå†åˆ°æ ‘åº•äº†</span></span><br><span class="line">    result.push_back(s);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¡®å®šå•å±‚éå†é€»è¾‘</li></ul><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> digit = digits[index] - <span class="string">&#x27;0&#x27;</span>;        <span class="comment">// å°†indexæŒ‡å‘çš„æ•°å­—è½¬ä¸ºint</span></span><br><span class="line"><span class="built_in">string</span> letters = letterMap[digit];      <span class="comment">// å–æ•°å­—å¯¹åº”çš„å­—ç¬¦é›†</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; letters.size(); i++) &#123;</span><br><span class="line">    s.push_back(letters[i]);            <span class="comment">// å¤„ç†</span></span><br><span class="line">    backtracking(digits, index + <span class="number">1</span>);    <span class="comment">// é€’å½’ï¼Œæ³¨æ„index+1ï¼Œä¸€ä¸‹å±‚è¦å¤„ç†ä¸‹ä¸€ä¸ªæ•°å­—äº†</span></span><br><span class="line">    s.pop_back();                       <span class="comment">// å›æº¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œçš„forå¾ªç¯å¹¶ä¸æ˜¯ä»startIndexå¼€å§‹éå†çš„</strong> <strong>å› ä¸ºæœ¬é¢˜æ¯ä¸€ä¸ªæ•°å­—ä»£è¡¨çš„æ˜¯ä¸åŒé›†åˆï¼Œä¹Ÿå°±æ˜¯æ±‚ä¸åŒé›†åˆä¹‹é—´çš„ç»„åˆ</strong>ï¼Œ<strong>è€Œ<a href="https://programmercarl.com/0077.%E7%BB%84%E5%90%88.html">77. ç»„åˆ (opens new window)</a>å’Œ<a href="https://programmercarl.com/0216.%E7%BB%84%E5%90%88%E6%80%BB%E5%92%8CIII.html">216.ç»„åˆæ€»å’ŒIII (opens new window)</a>éƒ½æ˜¯æ±‚åŒä¸€ä¸ªé›†åˆä¸­çš„ç»„åˆï¼</strong></p><p>æ³¨æ„ï¼šè¾“å…¥1 * #æŒ‰é”®ç­‰ç­‰å¼‚å¸¸æƒ…å†µ</p><h2 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h2><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line">    <span class="type">const</span> <span class="built_in">string</span> letterMap[<span class="number">10</span>] = &#123;</span><br><span class="line">        <span class="string">&quot;&quot;</span>, <span class="comment">// 0</span></span><br><span class="line">        <span class="string">&quot;&quot;</span>, <span class="comment">// 1</span></span><br><span class="line">        <span class="string">&quot;abc&quot;</span>, <span class="comment">// 2</span></span><br><span class="line">        <span class="string">&quot;def&quot;</span>, <span class="comment">// 3</span></span><br><span class="line">        <span class="string">&quot;ghi&quot;</span>, <span class="comment">// 4</span></span><br><span class="line">        <span class="string">&quot;jkl&quot;</span>, <span class="comment">// 5</span></span><br><span class="line">        <span class="string">&quot;mno&quot;</span>, <span class="comment">// 6</span></span><br><span class="line">        <span class="string">&quot;pqrs&quot;</span>, <span class="comment">// 7</span></span><br><span class="line">        <span class="string">&quot;tuv&quot;</span>, <span class="comment">// 8</span></span><br><span class="line">        <span class="string">&quot;wxyz&quot;</span>, <span class="comment">// 9</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> s;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;res;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">const</span> <span class="built_in">string</span>&amp; digits, <span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index == digits.size())&#123;</span><br><span class="line">            res.push_back(s);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> digit = digits[index] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        <span class="built_in">string</span> letters = letterMap[digit];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; letters.size(); i++)&#123;</span><br><span class="line">            s.push_back(letters[i]);</span><br><span class="line">            backtracking(digits, index + <span class="number">1</span>);</span><br><span class="line">            s.pop_back();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; <span class="title function_">letterCombinations</span><span class="params">(<span class="built_in">string</span> digits)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(digits.size() == <span class="number">0</span>) <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">        backtracking(digits,<span class="number">0</span>) ;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;216-ç»„åˆæ€»å’Œ-III&quot;&gt;&lt;a href=&quot;#216-ç»„åˆæ€»å’Œ-III&quot; class=&quot;headerlink&quot; title=&quot;216. ç»„åˆæ€»å’Œ III&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problem</summary>
      
    
    
    
    <category term="ç®—æ³•60å¤©æ‰“å¡" scheme="https://axdmdyj.github.io/categories/%E7%AE%97%E6%B3%9560%E5%A4%A9%E6%89%93%E5%8D%A1/"/>
    
    
    <category term="å›æº¯ç®—æ³•" scheme="https://axdmdyj.github.io/tags/%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•60å¤©è®­ç»ƒâ€“10-02-day23</title>
    <link href="https://axdmdyj.github.io/posts/30c745e3.html"/>
    <id>https://axdmdyj.github.io/posts/30c745e3.html</id>
    <published>2023-10-02T08:27:10.000Z</published>
    <updated>2023-11-12T08:53:08.569Z</updated>
    
    <content type="html"><![CDATA[<h1 id="77-ç»„åˆ"><a href="#77-ç»„åˆ" class="headerlink" title="77. ç»„åˆ"></a><a href="https://leetcode.cn/problems/combinations/">77. ç»„åˆ</a></h1><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>å¦‚æœ <code>k = 2</code></p><p>å°±ç›´æ¥å¯ä»¥ç”¨ä¸¤å±‚forå¾ªç¯å¯ä»¥è§£å†³</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; j &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†å¦‚æœ <code> k = 10086å‘¢</code> ä¸å¯èƒ½å»ç”¨10086å±‚forå¾ªç¯</p><p>è¿™æ—¶å€™å¯ä»¥è€ƒè™‘å–ç”¨å›æº¯ç®—æ³•æ¥è§£å†³æš´åŠ›éƒ½è§£å†³ä¸äº†çš„é—®é¢˜</p><p>é€’å½’æ¥åšå±‚å åµŒå¥—ï¼ˆå¯ä»¥ç†è§£æ˜¯å¼€kå±‚forå¾ªç¯ï¼‰ï¼Œ<strong>æ¯ä¸€æ¬¡çš„é€’å½’ä¸­åµŒå¥—ä¸€ä¸ªforå¾ªç¯ï¼Œé‚£ä¹ˆé€’å½’å°±å¯ä»¥ç”¨äºè§£å†³å¤šå±‚åµŒå¥—å¾ªç¯çš„é—®é¢˜äº†</strong>ã€‚</p><blockquote><p>æ­¤æ—¶,åœ¨ <code>n = 100 , k = 50çš„æ—¶å€™</code> å°±æ˜¯é€’å½’50å±‚</p></blockquote><p><strong>æ¯æ¬¡ä»é›†åˆä¸­é€‰å–å…ƒç´ ï¼Œå¯é€‰æ‹©çš„èŒƒå›´éšç€é€‰æ‹©çš„è¿›è¡Œè€Œæ”¶ç¼©ï¼Œè°ƒæ•´å¯é€‰æ‹©çš„èŒƒå›´</strong></p><p>å¯¹äºä¸€ä¸ªé›†åˆ,ç›¸å½“äºæ˜¯é€’å½’æ ‘çš„å®½åº¦,è€Œkç›¸å½“äºæ˜¯é€’å½’çš„æ·±åº¦</p><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><h3 id="å›æº¯ä¸‰éƒ¨æ›²"><a href="#å›æº¯ä¸‰éƒ¨æ›²" class="headerlink" title="å›æº¯ä¸‰éƒ¨æ›²"></a>å›æº¯ä¸‰éƒ¨æ›²</h3><ul><li>é€’å½’çš„è¿”å›å€¼ä»¥åŠå‚æ•°</li></ul><p>å…ˆå®šä¹‰ä¸¤ä¸ªå…¨å±€å˜é‡:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; result; <span class="comment">// å­˜æ”¾ç¬¦åˆæ¡ä»¶ç»“æœçš„é›†åˆ</span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; path; <span class="comment">// ç”¨æ¥å­˜æ”¾ç¬¦åˆæ¡ä»¶ç»“æœ</span></span><br></pre></td></tr></table></figure><ul><li>å›æº¯å‡½æ•°çš„ä¸‰ä¸ªå‚æ•°</li></ul><p>n, é›†åˆå¤§å°.   k ç»„åˆé›†åˆçš„å¤§å°(æ ‘çš„æ·±åº¦)</p><p><strong>startIndex</strong> è®°å½•ä¸‹ä¸€å±‚é€’å½’ä»å“ªå¼€å§‹,é¿å…é‡å¤</p><p>æ¯”å¦‚1,2,3,4ä¸‹ä¸€å±‚å°±è¦ä»2å¼€å§‹</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&gt; result; <span class="comment">// å­˜æ”¾ç¬¦åˆæ¡ä»¶ç»“æœçš„é›†åˆ</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; path; <span class="comment">// ç”¨æ¥å­˜æ”¾ç¬¦åˆæ¡ä»¶å•ä¸€ç»“æœ</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k, <span class="type">int</span> startIndex)</span></span><br></pre></td></tr></table></figure><ul><li>å›æº¯ç»ˆæ­¢æ¡ä»¶</li></ul><p>pathæ•°ç»„çš„å¤§å°ç­‰äºkæ—¶,æ‰¾åˆ°äº†ä¸€ä¸ªå­é›†å¤§å°ä¸ºkçš„ç»„åˆ,åœ¨pathå­˜çš„å°±æ˜¯æ ¹èŠ‚ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è·¯å¾„</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (path.size() == k) &#123;</span><br><span class="line">    result.push_back(path);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å•å±‚æœç´¢çš„è¿‡ç¨‹</li></ul><p>forå¾ªç¯, &#x3D;&gt;  æ¨ªå‘éå†é›†åˆ</p><p>é€’å½’ &#x3D;&gt; çºµå‘éå†</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = startIndex; i &lt;= n; i++) &#123; <span class="comment">// æ§åˆ¶æ ‘çš„æ¨ªå‘éå†</span></span><br><span class="line">    path.push_back(i); <span class="comment">// å¤„ç†èŠ‚ç‚¹</span></span><br><span class="line">    backtracking(n, k, i + <span class="number">1</span>); <span class="comment">// é€’å½’ï¼šæ§åˆ¶æ ‘çš„çºµå‘éå†ï¼Œæ³¨æ„ä¸‹ä¸€å±‚æœç´¢è¦ä»i+1å¼€å§‹</span></span><br><span class="line">    path.pop_back(); <span class="comment">// å›æº¯ï¼Œæ’¤é”€å¤„ç†çš„èŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å›æº¯æ¨¡ç‰ˆ"><a href="#å›æº¯æ¨¡ç‰ˆ" class="headerlink" title="å›æº¯æ¨¡ç‰ˆ"></a>å›æº¯æ¨¡ç‰ˆ</h2><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">backtracking</span><span class="params">(å‚æ•°)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ç»ˆæ­¢æ¡ä»¶) &#123;</span><br><span class="line">        å­˜æ”¾ç»“æœ;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (é€‰æ‹©ï¼šæœ¬å±‚é›†åˆä¸­å…ƒç´ ï¼ˆæ ‘ä¸­èŠ‚ç‚¹å­©å­çš„æ•°é‡å°±æ˜¯é›†åˆçš„å¤§å°ï¼‰) &#123;</span><br><span class="line">        å¤„ç†èŠ‚ç‚¹;</span><br><span class="line">        backtracking(è·¯å¾„ï¼Œé€‰æ‹©åˆ—è¡¨); <span class="comment">// é€’å½’</span></span><br><span class="line">        å›æº¯ï¼Œæ’¤é”€å¤„ç†ç»“æœ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¤æ‚åº¦"><a href="#å¤æ‚åº¦" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h2><ul><li>æ—¶é—´å¤æ‚åº¦: O(n * 2^n)</li><li>ç©ºé—´å¤æ‚åº¦: O(n)</li></ul><h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><h2 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h2><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; path;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&gt; res;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k, <span class="type">int</span> startIndex)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(path.size() == k) &#123;</span><br><span class="line">            res.push_back(path);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = startIndex; i &lt;= n; i++)&#123;</span><br><span class="line">            path.push_back(i); <span class="comment">// å¤„ç†ç»“ç‚¹</span></span><br><span class="line">            backtracking(n , k , i+<span class="number">1</span>); <span class="comment">//é€’å½’,ä¸èƒ½ä½¿ç”¨++iæ”¹å˜åŸæ¥çš„å€¼</span></span><br><span class="line">            path.pop_back();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">     &#125;</span><br><span class="line">public:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&gt; combine(<span class="type">int</span> n, <span class="type">int</span> k) &#123;</span><br><span class="line">        backtracking(n, k, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="java"><a href="#java" class="headerlink" title="java"></a>java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> LinkedList&lt;Integer&gt; path = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k , <span class="type">int</span> startIndex)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(path.size() == k) &#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> startIndex; i &lt;= n ; i++)&#123;</span><br><span class="line">            path.add(i);</span><br><span class="line">            backtracking(n, k , i + <span class="number">1</span>);</span><br><span class="line">            path.removeLast();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combine</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">            backtracking(n , k , <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‰ªæä¼˜åŒ–"><a href="#å‰ªæä¼˜åŒ–" class="headerlink" title="å‰ªæä¼˜åŒ–"></a>å‰ªæä¼˜åŒ–</h1><p>å›æº¯æ³•è™½ç„¶æ˜¯æš´åŠ›æœç´¢,ä½†æœ‰æ—¶å€™ä¹Ÿæ˜¯å¯ä»¥å‰ªæä¼˜åŒ–çš„</p><p>åœ¨éå†ä¸­</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = startIndex; i &lt;= n; i++) &#123;</span><br><span class="line">    path.<span class="built_in">push_back</span>(i);</span><br><span class="line">    <span class="built_in">backtracking</span>(n, k, i + <span class="number">1</span>);</span><br><span class="line">    path.<span class="built_in">pop_back</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€‹å½“n &#x3D; 9, k &#x3D; 9, é‚£ä¹ˆ èµ·å§‹ä»2å¼€å§‹åˆ°9ä¹Ÿä¸åˆ°9ä¸ªæ•°,</p><p>è¿™ä¸ªåœ°æ–¹å°±å¯ä»¥å‰ªæäº†</p><ul><li>å·²ç»é€‰æ‹©çš„å…ƒç´ ä¸ªæ•°ï¼špath.size();</li><li>è¿˜éœ€è¦çš„å…ƒç´ ä¸ªæ•°ä¸º: k - path.size();</li><li>åœ¨é›†åˆnä¸­è‡³å¤šè¦ä»è¯¥èµ·å§‹ä½ç½® : n - (k - path.size()) + 1ï¼Œå¼€å§‹éå†</li></ul><p>ä¸¾ä¸€ä¸ª<code>n = 9</code>  <code>k  - 4</code> å°±çŸ¥é“ä¸Šé¢ä¸‰æ­¥æ“ä½œæ˜¯ä¸ºä»€ä¹ˆäº†</p><p>forå¾ªç¯ä¼˜åŒ–å</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = startIndex; i &lt;= n - (k - path.size()) + <span class="number">1</span>; i++) <span class="comment">// iä¸ºæœ¬æ¬¡æœç´¢çš„èµ·å§‹ä½ç½®</span></span><br></pre></td></tr></table></figure><h1 id="Code-å‰ªæä¼˜åŒ–"><a href="#Code-å‰ªæä¼˜åŒ–" class="headerlink" title="Code(å‰ªæä¼˜åŒ–)"></a>Code(å‰ªæä¼˜åŒ–)</h1><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">private:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&gt; result;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; path;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k, <span class="type">int</span> startIndex)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (path.size() == k) &#123;</span><br><span class="line">            result.push_back(path);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = startIndex; i &lt;= n - (k - path.size()) + <span class="number">1</span>; i++) &#123; <span class="comment">// ä¼˜åŒ–çš„åœ°æ–¹</span></span><br><span class="line">            path.push_back(i); <span class="comment">// å¤„ç†èŠ‚ç‚¹</span></span><br><span class="line">            backtracking(n, k, i + <span class="number">1</span>);</span><br><span class="line">            path.pop_back(); <span class="comment">// å›æº¯ï¼Œæ’¤é”€å¤„ç†çš„èŠ‚ç‚¹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;&gt; combine(<span class="type">int</span> n, <span class="type">int</span> k) &#123;</span><br><span class="line">        backtracking(n, k, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;77-ç»„åˆ&quot;&gt;&lt;a href=&quot;#77-ç»„åˆ&quot; class=&quot;headerlink&quot; title=&quot;77. ç»„åˆ&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problems/combinations/&quot;&gt;77. ç»„åˆ&lt;/a&gt;&lt;/h1&gt;&lt;h</summary>
      
    
    
    
    <category term="ç®—æ³•60å¤©æ‰“å¡" scheme="https://axdmdyj.github.io/categories/%E7%AE%97%E6%B3%9560%E5%A4%A9%E6%89%93%E5%8D%A1/"/>
    
    
    <category term="å›æº¯ç®—æ³•" scheme="https://axdmdyj.github.io/tags/%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•60å¤©è®­ç»ƒâ€“9-21-day16</title>
    <link href="https://axdmdyj.github.io/posts/8d213e83.html"/>
    <id>https://axdmdyj.github.io/posts/8d213e83.html</id>
    <published>2023-09-24T10:41:31.000Z</published>
    <updated>2023-11-12T08:53:08.575Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"><a href="#104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦" class="headerlink" title="104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"></a><a href="https://leetcode.cn/problems/maximum-depth-of-binary-tree/">104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</a></h1><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>æ±‚æœ€å¤§æ·±åº¦, é¦–å…ˆå¯ä»¥æƒ³åˆ°,å‰åºéå†å’Œååºéå†</p><p>å¯¹äºæ±‚æ·±åº¦,å’Œæ±‚é«˜åº¦.éƒ½å¯ä»¥ç”¨ååºéå†,å› ä¸ºä¸€ä¸ªäºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦å’Œæœ€å¤§çš„é«˜åº¦æ˜¯ç›¸ç­‰çš„</p><p>é‚£ä¹ˆå¦‚ä½•æ±‚æœ€å¤§æ·±åº¦å‘¢?</p><p>å¯ä»¥ä½¿ç”¨é€’å½’,å³é€’å½’çš„æ±‚å·¦å³ä¸¤èŠ‚ç‚¹çš„é•¿åº¦, å¹¶å°†å·¦å³ä¸¤èŠ‚ç‚¹çš„é•¿åº¦å–æœ€å¤§å€¼.</p><p><img src="https://gitee.com/coderlyj916/picture/raw/master/img/imags/202309241939134.png" alt="image-20230924185157004"></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><h3 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h3><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() : val(0), left(nullptr), right(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(nullptr), right(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getdepth</span><span class="params">(TreeNode* node)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> leftdepth = getdepth(node-&gt;left);</span><br><span class="line">        <span class="type">int</span> rightdepth = getdepth(node-&gt;right);</span><br><span class="line">        <span class="type">int</span> depth = <span class="number">1</span> + max(leftdepth,rightdepth);</span><br><span class="line">        <span class="keyword">return</span> depth;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode* root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getdepth(root);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="java"><a href="#java" class="headerlink" title="java"></a>java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getdepth</span><span class="params">(TreeNode node)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">leftdepth</span> <span class="operator">=</span> getdepth(node.left);</span><br><span class="line">        <span class="type">int</span> <span class="variable">rightdepth</span> <span class="operator">=</span> getdepth(node.right);</span><br><span class="line">        <span class="type">int</span> <span class="variable">depth</span> <span class="operator">=</span> <span class="number">1</span> + Math.max(leftdepth,rightdepth);</span><br><span class="line">        <span class="keyword">return</span> depth;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getdepth(root);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="111-äºŒå‰æ ‘çš„æœ€å°æ·±åº¦"><a href="#111-äºŒå‰æ ‘çš„æœ€å°æ·±åº¦" class="headerlink" title="111. äºŒå‰æ ‘çš„æœ€å°æ·±åº¦"></a><a href="https://leetcode.cn/problems/minimum-depth-of-binary-tree/">111. äºŒå‰æ ‘çš„æœ€å°æ·±åº¦</a></h1><h2 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>ä¸€çœ¼çœ‹å…¶å®å’Œæ±‚<a href="https://leetcode.cn/problems/maximum-depth-of-binary-tree/">104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</a>ç±»ä¼¼,ä½†è¿˜æ˜¯æœ‰å¾ˆå¤šç»†èŠ‚çš„åŒºåˆ«çš„</p><p>å› ä¸ºå½“åœ¨æ ¹ç»“ç‚¹æœ‰ç©ºçš„å­èŠ‚ç‚¹çš„æ—¶å€™å°±ä¼šå‡ºç°é”™è¯¯</p><p><img src="https://gitee.com/coderlyj916/picture/raw/master/img/imags/202309241856074.png" alt="image-20230924185607931"></p><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><h3 id="C-1"><a href="#C-1" class="headerlink" title="C++"></a>C++</h3><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() : val(0), left(nullptr), right(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(nullptr), right(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getDepth</span><span class="params">(TreeNode* node)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node == <span class="literal">NULL</span> ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> leftDepth = getDepth(node-&gt;left);</span><br><span class="line">        <span class="type">int</span> rightDepth = getDepth(node-&gt;right);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(node-&gt;left == <span class="literal">NULL</span> &amp;&amp; node-&gt;right != <span class="literal">NULL</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span> + rightDepth;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(node-&gt;left != <span class="literal">NULL</span> &amp;&amp;node-&gt;right == <span class="literal">NULL</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span> + leftDepth;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> result = <span class="number">1</span> + min(leftDepth,rightDepth);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode* root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getDepth(root);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="java-1"><a href="#java-1" class="headerlink" title="java"></a>java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">getDepth</span><span class="params">(TreeNode node)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">leftDepth</span> <span class="operator">=</span> getDepth(node.left);</span><br><span class="line">        <span class="type">int</span> <span class="variable">rightDepth</span> <span class="operator">=</span> getDepth(node.right);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(node.left != <span class="literal">null</span> &amp;&amp; node.right == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span> + leftDepth;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(node.left == <span class="literal">null</span> &amp;&amp; node.right != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span> + rightDepth;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">1</span> + Math.min(leftDepth,rightDepth);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getDepth(root);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="222-å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°"><a href="#222-å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°" class="headerlink" title="222. å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°"></a><a href="https://leetcode.cn/problems/count-complete-tree-nodes/">222. å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°</a></h1><h2 id="æ€è·¯-2"><a href="#æ€è·¯-2" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>æ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯ååºéå†,åšæ³•è·Ÿå‰ä¸¤é“æ˜¯ä¸€æ ·çš„.</p><p>ä½†å› ä¸ºæ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘,æ ¹æ®å®Œå…¨äºŒå‰æ ‘çš„æ€§è´¨,æˆ‘ä»¬åˆå¯ä»¥é‡‡ç”¨å¦ä¸€ç§æ–¹æ³•</p><p>:<img src="https://gitee.com/coderlyj916/picture/raw/master/img/imags/202309241941772.png" alt="image-20230924194150634"></p><h2 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h2><h3 id="java-2"><a href="#java-2" class="headerlink" title="java"></a>java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">(TreeNode node)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span>(node == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">leftCount</span> <span class="operator">=</span> getCount(node.left);</span><br><span class="line">        <span class="type">int</span> <span class="variable">rightCount</span> <span class="operator">=</span> getCount(node.right);</span><br><span class="line">        <span class="type">int</span> <span class="variable">countNodes</span> <span class="operator">=</span> leftCount + rightCount + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> countNodes;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countNodes</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> getCount(root);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨å®Œå…¨äºŒå‰æ ‘æ€§è´¨"><a href="#åˆ©ç”¨å®Œå…¨äºŒå‰æ ‘æ€§è´¨" class="headerlink" title="åˆ©ç”¨å®Œå…¨äºŒå‰æ ‘æ€§è´¨"></a>åˆ©ç”¨å®Œå…¨äºŒå‰æ ‘æ€§è´¨</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">countNodes</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        TreeNode* left = root-&gt;left;</span><br><span class="line">        TreeNode* right = root-&gt;right;</span><br><span class="line">        <span class="type">int</span> leftDepth = <span class="number">0</span>, rightDepth = <span class="number">0</span>; <span class="comment">// è¿™é‡Œåˆå§‹ä¸º0æ˜¯æœ‰ç›®çš„çš„ï¼Œä¸ºäº†ä¸‹é¢æ±‚æŒ‡æ•°æ–¹ä¾¿</span></span><br><span class="line">        <span class="keyword">while</span> (left) &#123;  <span class="comment">// æ±‚å·¦å­æ ‘æ·±åº¦</span></span><br><span class="line">            left = left-&gt;left;</span><br><span class="line">            leftDepth++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (right) &#123; <span class="comment">// æ±‚å³å­æ ‘æ·±åº¦</span></span><br><span class="line">            right = right-&gt;right;</span><br><span class="line">            rightDepth++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (leftDepth == rightDepth) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="number">2</span> &lt;&lt; leftDepth) - <span class="number">1</span>; <span class="comment">// æ³¨æ„(2&lt;&lt;1) ç›¸å½“äº2^2ï¼Œæ‰€ä»¥leftDepthåˆå§‹ä¸º0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">countNodes</span>(root-&gt;left) + <span class="built_in">countNodes</span>(root-&gt;right) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦&quot;&gt;&lt;a href=&quot;#104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦&quot; class=&quot;headerlink&quot; title=&quot;104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://leetcode.cn/problem</summary>
      
    
    
    
    <category term="ç®—æ³•60å¤©æ‰“å¡" scheme="https://axdmdyj.github.io/categories/%E7%AE%97%E6%B3%9560%E5%A4%A9%E6%89%93%E5%8D%A1/"/>
    
    
    <category term="äºŒå‰æ ‘" scheme="https://axdmdyj.github.io/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•60å¤©è®­ç»ƒâ€“9-19-day14</title>
    <link href="https://axdmdyj.github.io/posts/de4f162b.html"/>
    <id>https://axdmdyj.github.io/posts/de4f162b.html</id>
    <published>2023-09-19T15:49:28.000Z</published>
    <updated>2023-11-12T08:53:08.573Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-äºŒå‰æ ‘ç†è®ºåŸºç¡€"><a href="#1-äºŒå‰æ ‘ç†è®ºåŸºç¡€" class="headerlink" title="1. äºŒå‰æ ‘ç†è®ºåŸºç¡€"></a>1. äºŒå‰æ ‘ç†è®ºåŸºç¡€</h1><h2 id="1-1-äºŒå‰æ ‘çš„ç§ç±»"><a href="#1-1-äºŒå‰æ ‘çš„ç§ç±»" class="headerlink" title="1.1 äºŒå‰æ ‘çš„ç§ç±»"></a>1.1 äºŒå‰æ ‘çš„ç§ç±»</h2><ul><li>æ»¡äºŒå‰æ ‘: æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹éƒ½ä¸º0æˆ–2</li><li>å®Œå…¨äºŒå‰æ ‘: é™¤äº†æœ€åº•å±‚çš„ç»“ç‚¹,å…¶ä»–ç»“ç‚¹æ¯å±‚èŠ‚ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§å€¼</li><li>äºŒå‰æœç´¢æ ‘:æ‰€æœ‰å·¦ç»“ç‚¹çš„å€¼éƒ½å°äºæ ¹ç»“ç‚¹</li><li>å¹³è¡¡äºŒå‰æ ‘: å·¦å³ä¸¤ä¸ªå­æ ‘é«˜åº¦æœ€å¤§å€¼ä¸èƒ½è¶…è¿‡1</li></ul><h2 id="1-2-äºŒå‰æ ‘å­˜å‚¨æ–¹å¼"><a href="#1-2-äºŒå‰æ ‘å­˜å‚¨æ–¹å¼" class="headerlink" title="1.2 äºŒå‰æ ‘å­˜å‚¨æ–¹å¼"></a>1.2 äºŒå‰æ ‘å­˜å‚¨æ–¹å¼</h2><h3 id="é¡ºåºå­˜å‚¨"><a href="#é¡ºåºå­˜å‚¨" class="headerlink" title="é¡ºåºå­˜å‚¨"></a>é¡ºåºå­˜å‚¨</h3><p>é¡ºåºå­˜å‚¨çš„å…ƒç´ åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­åˆ†å¸ƒçš„ï¼Œé€šå¸¸ç”¨æ•°ç»„æ¥å­˜å‚¨ã€‚å¦‚æœçˆ¶èŠ‚ç‚¹çš„æ•°ç»„ä¸‹æ ‡æ˜¯ rootï¼Œé‚£ä¹ˆå®ƒçš„å·¦å­©å­å°±æ˜¯ root * 2 + 1ï¼Œå³å­©å­å°±æ˜¯ root * 2 + 2ã€‚</p><h3 id="1-3-äºŒå‰æ ‘çš„éå†æ–¹å¼"><a href="#1-3-äºŒå‰æ ‘çš„éå†æ–¹å¼" class="headerlink" title="1.3 äºŒå‰æ ‘çš„éå†æ–¹å¼"></a>1.3 äºŒå‰æ ‘çš„éå†æ–¹å¼</h3><ul><li><p>æ·±åº¦ä¼˜å…ˆéå† </p></li><li><blockquote><p>å‰åºéå†,ä¸­åºéå†, ååºéå†</p></blockquote></li><li><p>å¹¿åº¦ä¼˜å…ˆéå†</p></li><li><blockquote><p>å±‚åºéå†</p></blockquote></li></ul><h1 id="äºŒå‰æ ‘çš„å®šä¹‰"><a href="#äºŒå‰æ ‘çš„å®šä¹‰" class="headerlink" title="äºŒå‰æ ‘çš„å®šä¹‰"></a>äºŒå‰æ ‘çš„å®šä¹‰</h1><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Struct twoTreeNode&#123;</span><br><span class="line"><span class="type">int</span> value;</span><br><span class="line">twoTreeNode *left;</span><br><span class="line">twoTreeNode *right;</span><br><span class="line">twoTreeNode(<span class="type">int</span> x): val(x),left(<span class="literal">NULL</span>),right(<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-äºŒå‰æ ‘ç†è®ºåŸºç¡€&quot;&gt;&lt;a href=&quot;#1-äºŒå‰æ ‘ç†è®ºåŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;1. äºŒå‰æ ‘ç†è®ºåŸºç¡€&quot;&gt;&lt;/a&gt;1. äºŒå‰æ ‘ç†è®ºåŸºç¡€&lt;/h1&gt;&lt;h2 id=&quot;1-1-äºŒå‰æ ‘çš„ç§ç±»&quot;&gt;&lt;a href=&quot;#1-1-äºŒå‰æ ‘çš„ç§ç±»&quot; c</summary>
      
    
    
    
    <category term="ç®—æ³•60å¤©æ‰“å¡" scheme="https://axdmdyj.github.io/categories/%E7%AE%97%E6%B3%9560%E5%A4%A9%E6%89%93%E5%8D%A1/"/>
    
    
    <category term="äºŒå‰æ ‘" scheme="https://axdmdyj.github.io/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•60å¤©è®­ç»ƒâ€“9-18-day13</title>
    <link href="https://axdmdyj.github.io/posts/e65c883c.html"/>
    <id>https://axdmdyj.github.io/posts/e65c883c.html</id>
    <published>2023-09-17T17:03:45.000Z</published>
    <updated>2023-11-12T08:53:08.573Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><h1 id="239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼"><a href="#239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼" class="headerlink" title="239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼"></a><a href="https://leetcode.cn/problems/sliding-window-maximum/">239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼</a></h1><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>å› ä¸ºè¦æ±‚æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼,</p><p>æ‰€ä»¥æ¯”è¾ƒå®¹æ˜“å®ç°çš„ä¾¿æ˜¯,è‡ªå·±å®šä¹‰ä¸€ä¸ªç»“æ„,èƒ½å¤Ÿè®©é˜Ÿåˆ—å¤´å§‹ç»ˆæ˜¯æ»‘åŠ¨çª—å£ä¸­æœ€å¤§çš„:</p><p><img src="https://gitee.com/coderlyj916/picture/raw/master/img/imags/202309190106567.png" alt="image-20230919010607211"></p><p><img src="https://gitee.com/coderlyj916/picture/raw/master/img/imags/202309190106585.png" alt="image-20230919010613196"></p><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyQue</span>&#123;</span><br><span class="line">    Deque&lt;Integer&gt; deque = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">poll</span><span class="params">(<span class="type">int</span> value)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!deque.isEmpty() &amp;&amp; value == deque.peek())&#123;</span><br><span class="line">            deque.poll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> val)</span>&#123;</span><br><span class="line">            <span class="keyword">while</span>(!deque.isEmpty()  &amp;&amp; val &gt; deque.getLast())&#123;</span><br><span class="line">                deque.removeLast();</span><br><span class="line">            &#125;</span><br><span class="line">            deque.add(val);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> deque.peek();</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] maxSlidingWindow(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">    <span class="keyword">if</span>(nums.length == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length - k  + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// å­˜æ”¾ç»“æœå…ƒç´ çš„æ•°ç»„</span></span><br><span class="line">    <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">    <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">MyQue</span> <span class="variable">myque</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyQue</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++)&#123;</span><br><span class="line">        myque.add(nums[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    res[num++] = myque.peek();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> k; i &lt; nums.length; i++)&#123;</span><br><span class="line">        myque.poll(nums[i-k]);</span><br><span class="line"></span><br><span class="line">        myque.add(nums[i]);</span><br><span class="line">        res[num++] = myque.peek();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>C++:</p><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyQue</span>&#123;</span></span><br><span class="line">    Deque&lt;Integer&gt; <span class="built_in">deque</span> = new LinkedList&lt;&gt;();</span><br><span class="line">    <span class="type">void</span> <span class="title function_">poll</span><span class="params">(<span class="type">int</span> value)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">deque</span>.isEmpty() &amp;&amp; value == <span class="built_in">deque</span>.peek())&#123;</span><br><span class="line">            <span class="built_in">deque</span>.poll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="type">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> val)</span>&#123;</span><br><span class="line">            <span class="keyword">while</span>(!<span class="built_in">deque</span>.isEmpty()  &amp;&amp; val &gt; <span class="built_in">deque</span>.getLast())&#123;</span><br><span class="line">                <span class="built_in">deque</span>.removeLast();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">deque</span>.add(val);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">deque</span>.peek();</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public <span class="type">int</span>[] maxSlidingWindow(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">    <span class="keyword">if</span>(nums.length == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> len = nums.length - k  + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// å­˜æ”¾ç»“æœå…ƒç´ çš„æ•°ç»„</span></span><br><span class="line">    <span class="type">int</span>[] res = new <span class="type">int</span>[len];</span><br><span class="line">    <span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    MyQue myque = new MyQue();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i++)&#123;</span><br><span class="line">        myque.add(nums[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    res[num++] = myque.peek();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = k; i &lt; nums.length; i++)&#123;</span><br><span class="line">        myque.poll(nums[i-k]);</span><br><span class="line"></span><br><span class="line">        myque.add(nums[i]);</span><br><span class="line">        res[num++] = myque.peek();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt;

&lt;h1 id=&quot;239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼&quot;&gt;&lt;a href=&quot;#239-æ»‘åŠ¨çª—å£æœ€å¤§å€¼&quot; class=&quot;headerlink&quot; title=&quot;239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼&quot;&gt;&lt;/a&gt;&lt;a h</summary>
      
    
    
    
    <category term="ç®—æ³•60å¤©æ‰“å¡" scheme="https://axdmdyj.github.io/categories/%E7%AE%97%E6%B3%9560%E5%A4%A9%E6%89%93%E5%8D%A1/"/>
    
    
    <category term="æ ˆå’Œé˜Ÿåˆ—" scheme="https://axdmdyj.github.io/tags/%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>Cookieå’ŒSessionåŒºåˆ«</title>
    <link href="https://axdmdyj.github.io/posts/6bead416.html"/>
    <id>https://axdmdyj.github.io/posts/6bead416.html</id>
    <published>2023-09-16T16:13:08.000Z</published>
    <updated>2023-11-12T08:53:08.559Z</updated>
    
    <content type="html"><![CDATA[<p>Cookieå’ŒSessionéƒ½ç”¨äºç®¡ç†ç”¨æˆ·çš„çŠ¶æ€å’Œèº«ä»½ï¼Œä½†å®ƒä»¬åœ¨å­˜å‚¨ä½ç½®ã€æ•°æ®å®¹é‡ã€å®‰å…¨æ€§å’Œä¼ è¾“æ–¹å¼ç­‰æ–¹é¢å­˜åœ¨ä¸€äº›å…³é”®åŒºåˆ«ï¼Œä¸‹é¢é€šè¿‡å…·ä½“ç¤ºä¾‹æ¥è¯´æ˜è¿™äº›åŒºåˆ«ï¼š</p><ol><li><p>å­˜å‚¨ä½ç½®ï¼š</p><ul><li><strong>Cookie</strong>ï¼šCookieæ•°æ®å­˜å‚¨åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­ã€‚è¿™æ„å‘³ç€æœåŠ¡å™¨å¯ä»¥å°†ä¸€äº›ä¿¡æ¯å­˜å‚¨åœ¨ç”¨æˆ·çš„è®¡ç®—æœºä¸Šï¼Œä»¥ä¾¿åœ¨åç»­è¯·æ±‚ä¸­ä½¿ç”¨ã€‚</li><li><strong>Session</strong>ï¼šSessionæ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œä¸ä¼šåœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­ç•™ä¸‹ç—•è¿¹ã€‚</li></ul></li><li><p>æ•°æ®å®¹é‡ï¼š</p><ul><li><strong>Cookie</strong>ï¼šCookieçš„å­˜å‚¨å®¹é‡é€šå¸¸è¾ƒå°ï¼Œä¸€èˆ¬é™åˆ¶åœ¨å‡ KBã€‚è¿™é€‚ç”¨äºå­˜å‚¨å°‘é‡çš„æ–‡æœ¬æ•°æ®ï¼Œå¦‚ç”¨æˆ·é¦–é€‰é¡¹æˆ–è´­ç‰©è½¦ä¸­çš„å‡ ä¸ªå•†å“ã€‚</li><li><strong>Session</strong>ï¼šSessionçš„å­˜å‚¨å®¹é‡é€šå¸¸è¾ƒå¤§ï¼Œä¸å—æ˜ç¡®å®šä¹‰çš„é™åˆ¶ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥åˆ©ç”¨æœåŠ¡å™¨çš„èµ„æºï¼Œç”¨äºå­˜å‚¨æ›´å¤šçš„æ•°æ®ï¼Œå¦‚ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦å†…å®¹ç­‰ã€‚</li></ul></li><li><p>å®‰å…¨æ€§ï¼š</p><ul><li><strong>Cookie</strong>ï¼šç”±äºCookieå­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­ï¼Œå®ƒä»¬å®¹æ˜“å—åˆ°å®‰å…¨å¨èƒã€‚ä¾‹å¦‚ï¼ŒCookieå¯ä»¥è¢«ç”¨æˆ·æŸ¥çœ‹å’Œä¿®æ”¹ï¼Œä»è€Œå¯èƒ½å¼•å‘å®‰å…¨æ¼æ´ã€‚</li><li><strong>Session</strong>ï¼šSessionæ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œä¸å®¹æ˜“è¢«ç”¨æˆ·ç›´æ¥è®¿é—®æˆ–ç¯¡æ”¹ï¼Œå› æ­¤ç›¸å¯¹æ›´å®‰å…¨ã€‚</li></ul></li><li><p>ä¼ è¾“æ–¹å¼ï¼š</p><ul><li><strong>Cookie</strong>ï¼šæ¯æ¬¡ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€HTTPè¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å°†ç›¸å…³çš„Cookieä¿¡æ¯é™„åŠ åˆ°è¯·æ±‚å¤´ä¸­ï¼Œä»¥ä¾¿æœåŠ¡å™¨å¯ä»¥æå–è¿™äº›ä¿¡æ¯ã€‚</li><li><strong>Session</strong>ï¼šé€šå¸¸ï¼ŒSession IDä¼šå­˜å‚¨åœ¨Cookieä¸­æˆ–è€…é€šè¿‡URLå‚æ•°ä¼ é€’ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨ä½¿ç”¨Session IDæ¥æŸ¥æ‰¾å¹¶è¿˜åŸç”¨æˆ·çš„ä¼šè¯æ•°æ®ã€‚</li></ul></li></ol><p>ç¤ºä¾‹ï¼š<br>å‡è®¾æœ‰ä¸€ä¸ªåœ¨çº¿è´­ç‰©ç½‘ç«™ï¼Œç”¨æˆ·åœ¨ç™»å½•åå¯ä»¥å°†å•†å“æ·»åŠ åˆ°è´­ç‰©è½¦ã€‚ä»¥ä¸‹æ˜¯Cookieå’ŒSessionåœ¨è¿™ä¸ªåœºæ™¯ä¸­çš„åº”ç”¨ï¼š</p><ul><li><p><strong>Cookieçš„åº”ç”¨</strong>ï¼šå½“ç”¨æˆ·ç™»å½•åï¼ŒæœåŠ¡å™¨å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ…å«ç”¨æˆ·IDå’Œè´­ç‰©è½¦å†…å®¹çš„Cookieï¼Œå¹¶åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­å­˜å‚¨ã€‚æ¯æ¬¡ç”¨æˆ·æµè§ˆä¸åŒå•†å“æˆ–æŸ¥çœ‹è´­ç‰©è½¦æ—¶ï¼Œæµè§ˆå™¨éƒ½ä¼šè‡ªåŠ¨å°†Cookieä¿¡æ¯å‘é€åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨é€šè¿‡Cookieä¸­çš„ç”¨æˆ·IDæ¥è¯†åˆ«ç”¨æˆ·ï¼Œå¹¶è·å–è´­ç‰©è½¦å†…å®¹ã€‚ç„¶è€Œï¼Œç”±äºCookieæ˜“äºä¿®æ”¹ï¼Œç”¨æˆ·å¯èƒ½å°è¯•ç¯¡æ”¹è´­ç‰©è½¦ä¸­çš„å•†å“æ•°é‡ã€‚</p></li><li><p><strong>Sessionçš„åº”ç”¨</strong>ï¼šå½“ç”¨æˆ·ç™»å½•åï¼ŒæœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªä¸è¯¥ç”¨æˆ·ç›¸å…³è”çš„Sessionï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·IDå’Œè´­ç‰©è½¦å†…å®¹ç­‰ä¿¡æ¯ã€‚Sessionæ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œè€Œä¸ä¼šå‘é€åˆ°ç”¨æˆ·æµè§ˆå™¨ä¸­ã€‚æ¯æ¬¡ç”¨æˆ·è¿›è¡Œæ“ä½œæ—¶ï¼ŒæœåŠ¡å™¨ä½¿ç”¨Session IDï¼ˆé€šå¸¸å­˜å‚¨åœ¨Cookieä¸­ï¼‰æ¥æŸ¥æ‰¾å¹¶è¿˜åŸç”¨æˆ·çš„è´­ç‰©è½¦å†…å®¹ï¼Œè€Œç”¨æˆ·æ— æ³•ç›´æ¥ä¿®æ”¹Sessionæ•°æ®ï¼Œå› ä¸ºå®ƒä»¬ä½äºæœåŠ¡å™¨ä¸Šï¼Œæ›´åŠ å®‰å…¨ã€‚</p></li></ul><p>ç»¼ä¸Šæ‰€è¿°ï¼ŒCookieå’ŒSessionåœ¨ä¸åŒæƒ…å†µä¸‹ç”¨äºç®¡ç†ç”¨æˆ·çŠ¶æ€å’Œèº«ä»½ï¼Œå…·æœ‰å„è‡ªçš„ä¼˜åŠ¿å’Œé™åˆ¶ï¼Œå¼€å‘äººå‘˜åº”æ ¹æ®åº”ç”¨ç¨‹åºçš„éœ€æ±‚å’Œå®‰å…¨æ€§è€ƒè™‘é€‰æ‹©åˆé€‚çš„æœºåˆ¶ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Cookieå’ŒSessionéƒ½ç”¨äºç®¡ç†ç”¨æˆ·çš„çŠ¶æ€å’Œèº«ä»½ï¼Œä½†å®ƒä»¬åœ¨å­˜å‚¨ä½ç½®ã€æ•°æ®å®¹é‡ã€å®‰å…¨æ€§å’Œä¼ è¾“æ–¹å¼ç­‰æ–¹é¢å­˜åœ¨ä¸€äº›å…³é”®åŒºåˆ«ï¼Œä¸‹é¢é€šè¿‡å…·ä½“ç¤ºä¾‹æ¥è¯´æ˜è¿™äº›åŒºåˆ«ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;å­˜å‚¨ä½ç½®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Cookie&lt;/strong&gt;</summary>
      
    
    
    
    <category term="æ¯æ—¥å…«è‚¡" scheme="https://axdmdyj.github.io/categories/%E6%AF%8F%E6%97%A5%E5%85%AB%E8%82%A1/"/>
    
    
    <category term="å…«è‚¡" scheme="https://axdmdyj.github.io/tags/%E5%85%AB%E8%82%A1/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•60å¤©è®­ç»ƒâ€“9-15-day10</title>
    <link href="https://axdmdyj.github.io/posts/1e82b846.html"/>
    <id>https://axdmdyj.github.io/posts/1e82b846.html</id>
    <published>2023-09-15T10:20:28.000Z</published>
    <updated>2024-01-05T10:34:59.302Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /><p>[TOC]</p><h1 id="232-ç”¨æ ˆå®ç°é˜Ÿåˆ—"><a href="#232-ç”¨æ ˆå®ç°é˜Ÿåˆ—" class="headerlink" title="232. ç”¨æ ˆå®ç°é˜Ÿåˆ—"></a><a href="https://leetcode.cn/problems/implement-queue-using-stacks/">232. ç”¨æ ˆå®ç°é˜Ÿåˆ—</a></h1><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>é¦–å…ˆåº”è¯¥å…ˆæ˜ç¡®é˜Ÿåˆ—æ˜¯å…ˆè¿›å…ˆå‡º,</p><p>è€Œæ ˆæ˜¯å…ˆè¿›åå‡º,è€Œå¦‚æœæƒ³ç”¨æ ˆå®ç°é˜Ÿåˆ—,å°±å¯ä»¥å°è¯•ç”¨ä¸¤ä¸ªæ ˆ</p><p>è¿›æ ˆå’Œå‡ºæ ˆ</p><ul><li>è¿›æ ˆæ¨¡æ‹Ÿå…¥é˜Ÿåˆ—</li><li>å‡ºæ ˆæ¨¡æ‹Ÿå…ˆå‡ºé˜Ÿåˆ—</li></ul><p>ç”»å›¾å¦‚ä¸‹</p><p><img src="https://gitee.com/coderlyj916/picture/raw/master/img/imags/202309171830073.png" alt="image-20230917183021976"></p><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyQueue</span> &#123;</span><br><span class="line"></span><br><span class="line">Stack&lt;Integer&gt; stIn;</span><br><span class="line">Stack&lt;Integer&gt; stOut;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyQueue</span><span class="params">()</span> &#123;</span><br><span class="line">      stIn = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">stOut = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">stIn.push(x);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">       </span><br><span class="line"><span class="keyword">if</span>(stOut.isEmpty())&#123;</span><br><span class="line">    <span class="keyword">while</span>(!stIn.isEmpty())&#123;</span><br><span class="line">        stOut.push(stIn.pop());</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> stOut.pop();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="built_in">this</span>.pop();</span><br><span class="line">stOut.push(res);</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> stOut.isEmpty()&amp;&amp;stIn.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your MyQueue object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * MyQueue obj = new MyQueue();</span></span><br><span class="line"><span class="comment"> * obj.push(x);</span></span><br><span class="line"><span class="comment"> * int param_2 = obj.pop();</span></span><br><span class="line"><span class="comment"> * int param_3 = obj.peek();</span></span><br><span class="line"><span class="comment"> * boolean param_4 = obj.empty();</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h3 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h3><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyQueue</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line"><span class="built_in">stack</span>&lt;<span class="type">int</span>&gt; stIn;</span><br><span class="line"><span class="built_in">stack</span>&lt;<span class="type">int</span>&gt; stOut;</span><br><span class="line"></span><br><span class="line">    MyQueue() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">stIn.push(x);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(stOut.empty())&#123;</span><br><span class="line">    <span class="keyword">while</span>(!stIn.empty())&#123;</span><br><span class="line">        stOut.push(stIn.top());</span><br><span class="line">        stIn.pop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> result = stOut.top();</span><br><span class="line">stOut.pop();</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">int</span> res = this-&gt;pop();</span><br><span class="line">stOut.push(res);</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="type">bool</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> stIn.empty()&amp;&amp;stOut.empty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your MyQueue object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * MyQueue obj = new MyQueue();</span></span><br><span class="line"><span class="comment"> * obj.push(x);</span></span><br><span class="line"><span class="comment"> * int param_2 = obj.pop();</span></span><br><span class="line"><span class="comment"> * int param_3 = obj.peek();</span></span><br><span class="line"><span class="comment"> * bool param_4 = obj.empty();</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h2 id="å¤æ‚åº¦"><a href="#å¤æ‚åº¦" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h2><p>æ—¶é—´å¤æ‚åº¦: pushå’Œemptyä¸ºO(1), popå’Œpeekä¸ºO(n)</p><p>ç©ºé—´å¤æ‚åº¦: O(n)</p><h1 id="225-ç”¨é˜Ÿåˆ—å®ç°æ ˆ"><a href="#225-ç”¨é˜Ÿåˆ—å®ç°æ ˆ" class="headerlink" title="225. ç”¨é˜Ÿåˆ—å®ç°æ ˆ"></a><a href="https://leetcode.cn/problems/implement-stack-using-queues/">225. ç”¨é˜Ÿåˆ—å®ç°æ ˆ</a></h1><h2 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>é˜Ÿåˆ—æ˜¯å…ˆè¿›å…ˆå‡ºåŸåˆ™,</p><p>è€Œæ ˆæ˜¯å…ˆè¿›åå‡ºåŸåˆ™</p><p>å› æ­¤,å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªé˜Ÿåˆ—æ¥å®ç°æ ˆ</p><p><strong>å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—æ¥å®ç°æ ˆ</strong></p><p>æ»¡è¶³å…ˆè¿›åå‡ºçš„æ–¹æ³•å°±æ˜¯; å…¥é˜Ÿåˆ—ä¹‹å,å°±å°†è¿™ä¸ªæ•°æ”¾åˆ°é˜Ÿé¦–</p><p><img src="https://gitee.com/coderlyj916/picture/raw/master/img/imags/202309171847163.png" alt="image-20230917184757095"></p><h2 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h2><h3 id="C-1"><a href="#C-1" class="headerlink" title="C++"></a>C++</h3><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStack</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line"><span class="built_in">queue</span>&lt;<span class="type">int</span>&gt; que;</span><br><span class="line">    MyStack() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">que.push(x);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">int</span> size = que.size();</span><br><span class="line">size--;</span><br><span class="line"><span class="keyword">while</span>(size--)&#123;</span><br><span class="line">    que.push(que.front());</span><br><span class="line">    que.pop();</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> res = que.front();</span><br><span class="line">que.pop();</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="title function_">top</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> que.back();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">bool</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> que.empty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your MyStack object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * MyStack* obj = new MyStack();</span></span><br><span class="line"><span class="comment"> * obj-&gt;push(x);</span></span><br><span class="line"><span class="comment"> * int param_2 = obj-&gt;pop();</span></span><br><span class="line"><span class="comment"> * int param_3 = obj-&gt;top();</span></span><br><span class="line"><span class="comment"> * bool param_4 = obj-&gt;empty();</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h2 id="Java-1"><a href="#Java-1" class="headerlink" title="Java"></a>Java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyStack</span> &#123;</span><br><span class="line">    Queue&lt;Integer&gt; que = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyStack</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">            que.add(x);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        rePosition();</span><br><span class="line">        <span class="keyword">return</span> que.poll();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">top</span><span class="params">()</span> &#123;</span><br><span class="line">        rePosition();</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> que.poll();</span><br><span class="line">        que.add(res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> que.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rePosition</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> que.size();</span><br><span class="line">        size--; <span class="comment">// ä¸åŒ…æ‹¬åˆšåˆšæ·»åŠ çš„æ•°</span></span><br><span class="line">        <span class="keyword">while</span>(size-- &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            que.add(que.poll());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your MyStack object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * MyStack obj = new MyStack();</span></span><br><span class="line"><span class="comment"> * obj.push(x);</span></span><br><span class="line"><span class="comment"> * int param_2 = obj.pop();</span></span><br><span class="line"><span class="comment"> * int param_3 = obj.top();</span></span><br><span class="line"><span class="comment"> * boolean param_4 = obj.empty();</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h2 id="å¤æ‚åº¦-1"><a href="#å¤æ‚åº¦-1" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h2><ul><li>æ—¶é—´å¤æ‚åº¦: popä¸ºO(n)ï¼Œå…¶ä»–ä¸ºO(1)</li><li>ç©ºé—´å¤æ‚åº¦: O(n)</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt;

&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;232-ç”¨æ ˆå®ç°é˜Ÿåˆ—&quot;&gt;&lt;a href=&quot;#232-ç”¨æ ˆå®ç°é˜Ÿåˆ—&quot; class=&quot;headerlink&quot; title=&quot;232. ç”¨æ ˆå®ç°é˜Ÿåˆ—</summary>
      
    
    
    
    <category term="ç®—æ³•60å¤©æ‰“å¡" scheme="https://axdmdyj.github.io/categories/%E7%AE%97%E6%B3%9560%E5%A4%A9%E6%89%93%E5%8D%A1/"/>
    
    
    <category term="æ ˆå’Œé˜Ÿåˆ—" scheme="https://axdmdyj.github.io/tags/%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97/"/>
    
  </entry>
  
</feed>
